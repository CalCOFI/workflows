<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-12-09">

<title>Scrape &amp; Ingest CalCOFI CTD Data into DuckDB</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="scrape_ctd_files/libs/clipboard/clipboard.min.js"></script>
<script src="scrape_ctd_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="scrape_ctd_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="scrape_ctd_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="scrape_ctd_files/libs/quarto-html/popper.min.js"></script>
<script src="scrape_ctd_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="scrape_ctd_files/libs/quarto-html/anchor.min.js"></script>
<link href="scrape_ctd_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="scrape_ctd_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="scrape_ctd_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="scrape_ctd_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="scrape_ctd_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="scrape_ctd_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="scrape_ctd_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="scrape_ctd_files/libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="scrape_ctd_files/libs/datatables-binding-0.34.0/datatables.js"></script>
<script src="scrape_ctd_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="scrape_ctd_files/libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="scrape_ctd_files/libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="scrape_ctd_files/libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="scrape_ctd_files/libs/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet">
<script src="scrape_ctd_files/libs/crosstalk-1.2.2/js/crosstalk.min.js"></script>
<script src="scrape_ctd_files/libs/plotly-binding-4.11.0/plotly.js"></script>
<script src="scrape_ctd_files/libs/typedarray-0.1/typedarray.min.js"></script>
<link href="scrape_ctd_files/libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="scrape_ctd_files/libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><span class="header-section-number">1</span> Overview</a>
  <ul class="collapse">
  <li><a href="#key-features" id="toc-key-features" class="nav-link" data-scroll-target="#key-features"><span class="header-section-number">1.1</span> Key Features</a></li>
  <li><a href="#usage" id="toc-usage" class="nav-link" data-scroll-target="#usage"><span class="header-section-number">1.2</span> Usage</a></li>
  <li><a href="#notes" id="toc-notes" class="nav-link" data-scroll-target="#notes"><span class="header-section-number">1.3</span> Notes</a></li>
  </ul></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup"><span class="header-section-number">2</span> Setup</a></li>
  <li><a href="#scrape-ctd-download-links" id="toc-scrape-ctd-download-links" class="nav-link" data-scroll-target="#scrape-ctd-download-links"><span class="header-section-number">3</span> Scrape CTD Download Links</a></li>
  <li><a href="#download-and-unzip-files" id="toc-download-and-unzip-files" class="nav-link" data-scroll-target="#download-and-unzip-files"><span class="header-section-number">4</span> Download and Unzip Files</a></li>
  <li><a href="#find-and-prioritize-ctd-data-files" id="toc-find-and-prioritize-ctd-data-files" class="nav-link" data-scroll-target="#find-and-prioritize-ctd-data-files"><span class="header-section-number">5</span> Find and Prioritize CTD Data Files</a></li>
  <li><a href="#read-and-standardize-ctd-files" id="toc-read-and-standardize-ctd-files" class="nav-link" data-scroll-target="#read-and-standardize-ctd-files"><span class="header-section-number">6</span> Read and Standardize CTD Files</a></li>
  <li><a href="#transform-data" id="toc-transform-data" class="nav-link" data-scroll-target="#transform-data"><span class="header-section-number">7</span> Transform Data</a></li>
  <li><a href="#todo" id="toc-todo" class="nav-link" data-scroll-target="#todo"><span class="header-section-number">8</span> TODO</a>
  <ul class="collapse">
  <li><a href="#process-raw-data" id="toc-process-raw-data" class="nav-link" data-scroll-target="#process-raw-data"><span class="header-section-number">8.1</span> Process raw data</a></li>
  <li><a href="#check-for-duplicates" id="toc-check-for-duplicates" class="nav-link" data-scroll-target="#check-for-duplicates"><span class="header-section-number">8.2</span> Check for duplicates</a></li>
  </ul></li>
  <li><a href="#ingest-into-duckdb" id="toc-ingest-into-duckdb" class="nav-link" data-scroll-target="#ingest-into-duckdb"><span class="header-section-number">9</span> Ingest into DuckDB</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">10</span> Summary</a></li>
  <li><a href="#interactive-gantt-chart" id="toc-interactive-gantt-chart" class="nav-link" data-scroll-target="#interactive-gantt-chart"><span class="header-section-number">11</span> Interactive Gantt Chart</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Scrape &amp; Ingest CalCOFI CTD Data into DuckDB</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2025-12-09</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="overview" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="overview"><span class="header-section-number">1</span> Overview</h2>
<p>This notebook scrapes CalCOFI CTD data from <a href="https://calcofi.org/data/oceanographic-data/ctd-cast-files/" class="uri">https://calcofi.org/data/oceanographic-data/ctd-cast-files/</a>, downloads only <strong>final</strong> and <strong>preliminary</strong> CTD files, and ingests them into a DuckDB database.</p>
<section id="key-features" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="key-features"><span class="header-section-number">1.1</span> Key Features</h3>
<ol type="1">
<li><p><strong>Web Scraping</strong>: Scrapes for all CTD .zip download links</p></li>
<li><p><strong>Smart Filtering</strong>:</p>
<ul>
<li>Downloads all .zip files for archival completeness</li>
<li>Only unzips <code>final</code> (e.g., 20-2105SH_CTDFinalQC.zip) and <code>preliminary</code> (e.g., 20-2507SR_CTDPrelim.zip) files</li>
<li>Skips unzipping raw/cast/test files to save disk space</li>
</ul></li>
<li><p><strong>Download &amp; Unzip</strong>: Downloads all zip files to <code>~/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download</code> but only extracts final and preliminary data</p></li>
<li><p><strong>Priority-based Selection</strong>:</p>
<ul>
<li>For each cruise (identified by yy-yymm + ship code), selects final if available</li>
<li>Falls back to preliminary if final not available for that cruise</li>
<li>Completely excludes raw/test/prodo cast files</li>
</ul></li>
<li><p><strong>Union Strategy</strong>:</p>
<ul>
<li>Merges upcast (U) and downcast (D) CSV files into single “ctd” table</li>
<li>Adds <code>stage</code> flag: “F” for final, “P” for preliminary</li>
<li>Adds <code>cast_dir</code> flag: “U” for upcast, “D” for downcast</li>
</ul></li>
<li><p><strong>Data Standardization</strong>:</p>
<ul>
<li>Converts all column names to <code>lower_snake_case</code> using <code>janitor::clean_names()</code></li>
<li>Creates spatial index on <code>lat_dec</code> and <code>lon_dec</code> fields</li>
<li>Preserves <code>cruise_id</code> and <code>source_file</code> metadata</li>
</ul></li>
</ol>
</section>
<section id="usage" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="usage"><span class="header-section-number">1.2</span> Usage</h3>
<p>To run the notebook:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>quarto<span class="sc">::</span><span class="fu">quarto_render</span>(<span class="st">"scrape_ctd.qmd"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="notes" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="notes"><span class="header-section-number">1.3</span> Notes</h3>
<ul>
<li>All .zip files are downloaded for archival purposes, but only final/prelim are unzipped</li>
<li>Only processes CSV files from final (<code>db-csvs/*.csv</code>) and preliminary directories</li>
<li>Downloads can be resumed (already-downloaded files are skipped)</li>
<li>Both upcast (U) and downcast (D) profiles are included in the database</li>
<li>The priority system ensures you only get final data when available, otherwise preliminary</li>
<li>Spatial index enables efficient geographic queries on lat_dec and lon_dec</li>
</ul>
</section>
</section>
<section id="setup" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="setup"><span class="header-section-number">2</span> Setup</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>librarian<span class="sc">::</span><span class="fu">shelf</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  dplyr,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  DBI,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  DT,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  duckdb,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  fs,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  glue,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  here,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  httr,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  janitor,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  lubridate,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  purrr,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  readr,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  rvest,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  sf,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  stringr,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  tibble,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  tidyr,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  zip,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">quiet =</span> T</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co"># variables</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://calcofi.org/data/oceanographic-data/ctd-cast-files/"</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>dir_dl <span class="ot">&lt;-</span> <span class="st">"~/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download"</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>dir_dl <span class="ot">&lt;-</span> <span class="fu">path_expand</span>(dir_dl)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>db_path <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"{dir_dl}/calcofi-ctd.duckdb"</span>)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>db_redo <span class="ot">&lt;-</span> T <span class="co"># set to TRUE to re-download and re-ingest</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co"># create directory if it doesn't exist</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="fu">dir_create</span>(dir_dl, <span class="at">recurse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="co"># delete if exixsts (for fresh run)</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file_exists</span>(db_path) <span class="sc">&amp;</span> db_redo) {</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file_delete</span>(db_path)</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="co"># setup duckdb with spatial extension</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="co"># dbDisconnect(con, shutdown = TRUE); duckdb_shutdown(duckdb()); rm(con)</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(duckdb<span class="sc">::</span><span class="fu">duckdb</span>(<span class="at">read_only =</span> F), <span class="at">dbdir =</span> db_path)</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con, <span class="st">"INSTALL spatial;"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con, <span class="st">"LOAD spatial;"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
</section>
<section id="scrape-ctd-download-links" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="scrape-ctd-download-links"><span class="header-section-number">3</span> Scrape CTD Download Links</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read web page, extract all .zip download links</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>d_zips <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url) <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">"a[href$='.zip']"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_attr</span>(<span class="st">"href"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">url =</span> _) <span class="sc">|&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ensure full URLs</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">url =</span> <span class="fu">if_else</span>(</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_starts</span>(url, <span class="st">"http"</span>),</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>      url,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"https://calcofi.org"</span>, url)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract file_zip</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">file_zip =</span> <span class="fu">basename</span>(url),</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract year from URL path</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">str_extract</span>(url, <span class="st">"/(</span><span class="sc">\\</span><span class="st">d{4})/"</span>, <span class="at">group =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">as.integer</span>(),</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract month from URL path</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">str_extract</span>(url, <span class="st">"-</span><span class="sc">\\</span><span class="st">d{2}(</span><span class="sc">\\</span><span class="st">d{2})"</span>, <span class="at">group =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">as.integer</span>(),</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract cruise identifier (yymm + ship code)</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">cruise_id =</span> <span class="fu">str_extract</span>(</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>      file_zip,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>      <span class="st">"</span><span class="sc">\\</span><span class="st">d{2}-(</span><span class="sc">\\</span><span class="st">d{4}[A-Z0-9]{2,4})"</span>,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">group =</span> <span class="dv">1</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">TODO</span><span class="co">: confirm oddball ship codes (normally 2 letters): 0404NHJD (4 letters),  0907M2 (letter + number)</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># classify data type based on file_zip patterns</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">zip_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(file_zip, <span class="st">"CTDFinal"</span>) <span class="sc">~</span> <span class="st">"final"</span>,</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(file_zip, <span class="st">"CTDPrelim"</span>) <span class="sc">~</span> <span class="st">"preliminary"</span>,</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(file_zip, <span class="st">"CTDCast|CTD_Cast"</span>) <span class="sc">~</span> <span class="st">"raw"</span>,</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(file_zip, <span class="st">"CTDTest"</span>) <span class="sc">~</span> <span class="st">"test"</span>,</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"unknown"</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="co"># stop if other detected</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(d_zips<span class="sc">$</span>zip_type <span class="sc">==</span> <span class="st">"unknown"</span>)) {</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"Unknown zip_type detected in file_zips"</span>)</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="co"># show summary (all files)</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>d_zips <span class="sc">|&gt;</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">file_zip =</span> <span class="fu">glue</span>(<span class="st">"&lt;a href={url}&gt;{file_zip}&lt;/a&gt;"</span>)</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>url) <span class="sc">|&gt;</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"All zip files to download"</span>,</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">escape =</span> F</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-beb7f3dcaa925748e069" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-beb7f3dcaa925748e069">{"x":{"filter":"none","vertical":false,"caption":"<caption>All zip files to download<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242"],["<a href=https://calcofi.org/downloads/2025/20-2501RL_CTDCast.zip>20-2501RL_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2025/20-2501RL_CTDPrelim.zip>20-2501RL_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2025/20-2502RL_CTDCast.zip>20-2502RL_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2025/20-2502RL_CTDPrelim.zip>20-2502RL_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2025/20-2504SH_CTDCast.zip>20-2504SH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2025/20-2504SH_CTDPrelim.zip>20-2504SH_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2025/20-2507SR_CTDCast.zip>20-2507SR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2025/20-2507SR_CTDPrelim.zip>20-2507SR_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2025/20-2511SR_CTDCast.zip>20-2511SR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2025/20-2511SR_CTDPrelim.zip>20-2511SR_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2024/20-2401RL_CTDCast.zip>20-2401RL_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2024/20-2401RL_CTDPrelim.zip>20-2401RL_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2024/20-2404SH_CTDCast.zip>20-2404SH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2024/20-2404SH_CTDPrelim.zip>20-2404SH_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2024/20-2408SR_CTDCast.zip>20-2408SR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2024/20-2408SR_CTDPrelim.zip>20-2408SR_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2024/20-2411SR_CTDCast.zip>20-2411SR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2024/20-2411SR_CTDPrelim.zip>20-2411SR_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2023/20-2301RL_CTDCast.zip>20-2301RL_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2023/20-2301RL_CTDPrelim.zip>20-2301RL_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2023/20-2304SH_CTDCast.zip>20-2304SH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2023/20-2304SH_CTDPrelim.zip>20-2304SH_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2023/20-2307SR_CTDCast.zip>20-2307SR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2023/20-2307SR_CTDPrelim.zip>20-2307SR_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2023/20-2311SR_CTDCast.zip>20-2311SR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2023/20-2311SR_CTDPrelim.zip>20-2311SR_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2022/20-2204SH_CTDCast.zip>20-2204SH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2022/20-2204SH_CTDPrelim.zip>20-2204SH_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2022/20-2208BH_CTDCast.zip>20-2208BH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2022/20-2208BH_CTDPrelim.zip>20-2208BH_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2022/20-2211SR_CTDCast.zip>20-2211SR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2022/20-2211SR_CTDPrelim.zip>20-2211SR_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2021/20-2101RL_CTDCast.zip>20-2101RL_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2021/20-2101RL_CTDFinalQC.zip>20-2101RL_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2021/20-2105SH_CTDCast.zip>20-2105SH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2021/20-2105SH_CTDFinalQC.zip>20-2105SH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2021/20-2107SR_CTDCast.zip>20-2107SR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2021/20-2107SR_CTDPrelim.zip>20-2107SR_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2021/20-2111SR_CTDCast.zip>20-2111SR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2021/20-2111SR_CTDPrelim.zip>20-2111SR_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2020/20-2001RL_CTDCast.zip>20-2001RL_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2020/20-2001RL_CTDFinalQC.zip>20-2001RL_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2020/20-2007SR_CTD_Cast.zip>20-2007SR_CTD_Cast.zip<\/a>","<a href=https://calcofi.org/downloads/2020/20-2007SR_CTDFinalQC.zip>20-2007SR_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2020/20-2010SR_CTD_Cast.zip>20-2010SR_CTD_Cast.zip<\/a>","<a href=https://calcofi.org/downloads/2020/20-2010SR_CTDFinalQC.zip>20-2010SR_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2019/20-1902RL_CTDCast.zip>20-1902RL_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2019/20-1902RL_CTDFinalQC.zip>20-1902RL_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2019/20-1904RL_CTDCast.zip>20-1904RL_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2019/20-1904RL_CTDFinalQC.zip>20-1904RL_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2019/20-1907BH_CTDCast.zip>20-1907BH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2019/20-1907BH_CTDFinalQC.zip>20-1907BH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2019/20-1911OC_CTDCast.zip>20-1911OC_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2019/20-1911OC_CTDFinalQC.zip>20-1911OC_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2018/20-1802SH_CTDCast.zip>20-1802SH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2018/20-1802SH_CTDFinalQC.zip>20-1802SH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2018/20-1804SH_CTDCast.zip>20-1804SH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2018/20-1804SH_CTDFinalQC.zip>20-1804SH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2018/20-1806SR_CTDCast.zip>20-1806SR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2018/20-1806SR_CTDFinalQC.zip>20-1806SR_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2018/20-1810SR_CTDCast.zip>20-1810SR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2018/20-1810SR_CTDFinalQC.zip>20-1810SR_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2017/20-1701RL_CTDCast.zip>20-1701RL_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2017/20-1701RL_CTDFinalQC.zip>20-1701RL_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2017/20-1704SH_CTDCast.zip>20-1704SH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2017/20-1704SH_CTDFinalQC.zip>20-1704SH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2017/20-1708SR_CTDCast.zip>20-1708SR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2017/20-1708SR_CTDFinalQC.zip>20-1708SR_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2017/20-1711SR_CTDCast.zip>20-1711SR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2017/20-1711SR_CTDFinalQC.zip>20-1711SR_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2016/20-1601RL_CTDCast.zip>20-1601RL_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2016/20-1601RL_CTDFinalQC.zip>20-1601RL_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2016/20-1604SH_CTDCast.zip>20-1604SH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2016/20-1604SH_CTDFinalQC.zip>20-1604SH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2016/20-1607OS_CTDCast.zip>20-1607OS_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2016/20-1607OS_CTDFinalQC.zip>20-1607OS_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2016/20-1611SR_CTDCast.zip>20-1611SR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2016/20-1611SR_CTDFinalQC.zip>20-1611SR_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2015/20-1501NH_CTDCast.zip>20-1501NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2015/20-1501NH_CTDFinalQC.zip>20-1501NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2015/20-1504NH_CTDCast.zip>20-1504NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2015/20-1504NH_CTDFinalQC.zip>20-1504NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2015/20-1507OC_CTDCast.zip>20-1507OC_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2015/20-1507OC_CTDFinalQC.zip>20-1507OC_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2015/20-1511OC_CTDCast.zip>20-1511OC_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2015/20-1511OC_CTDFinalQC.zip>20-1511OC_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2014/20-1402SH_CTDCast.zip>20-1402SH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2014/20-1402SH_CTDFinalQC.zip>20-1402SH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2014/20-1404OS_CTDCast.zip>20-1404OS_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2014/20-1404OS_CTDFinalQC.zip>20-1404OS_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2014/20-1407NH_CTDCast.zip>20-1407NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2014/20-1407NH_CTDFinalQC.zip>20-1407NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2014/20-1411NH_CTDCast.zip>20-1411NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2014/20-1411NH_CTDFinalQC.zip>20-1411NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2013/20-1301SH_CTDCast.zip>20-1301SH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2013/20-1301SH_CTDFinalQC.zip>20-1301SH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2013/20-1304SH_CTDCast.zip>20-1304SH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2013/20-1304SH_CTDFinalQC.zip>20-1304SH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2013/20-1307NH_CTDCast.zip>20-1307NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2013/20-1307NH_CTDFinalQC.zip>20-1307NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2013/20-1311NH_CTDCast.zip>20-1311NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2013/20-1311NH_CTDFinalQC.zip>20-1311NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2012/20-1202NH_CTDCast.zip>20-1202NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2012/20-1202NH_CTDFinalQC.zip>20-1202NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2012/20-1203NH_CTDCast.zip>20-1203NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2012/20-1203SH_CTDFinalQC.zip>20-1203SH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2012/20-1207OS_CTDCast.zip>20-1207OS_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2012/20-1207OS_CTDFinalQC.zip>20-1207OS_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2012/20-1210NH_CTDCast.zip>20-1210NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2012/20-1210NH_CTDFinalQC.zip>20-1210NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2011/20-1101NH_CTDCast.zip>20-1101NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2011/20-1101NH_CTDFinalQC.zip>20-1101NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2011/20-1104SH_CTDCast.zip>20-1104SH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2011/20-1104SH_CTDFinalQC.zip>20-1104SH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2011/20-1108NH_CTDCast.zip>20-1108NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2011/20-1108NH_CTDFinalQC.zip>20-1108NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2011/20-1110NH_CTDCast.zip>20-1110NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2011/20-1110NH_CTDFinalQC.zip>20-1110NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2010/20-1001NH_CTDCast.zip>20-1001NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2010/20-1001NH_CTDFinalQC.zip>20-1001NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2010/20-1004MF_CTDCast.zip>20-1004MF_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2010/20-1004MF_CTDFinalQC.zip>20-1004MF_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2010/20-1008NH_CTDCast.zip>20-1008NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2010/20-1008NH_CTDFinalQC.zip>20-1008NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2010/20-1011NH_CTDCast.zip>20-1011NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2010/20-1011NH_CTDFinalQC.zip>20-1011NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2009/20-0901NH_CTDCast.zip>20-0901NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2009/20-0901NH_CTDFinalQC.zip>20-0901NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2009/20-0903JD_CTDCast.zip>20-0903JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2009/20-0903JD_CTDFinalQC.zip>20-0903JD_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2009/20-0907M2_CTDCast.zip>20-0907M2_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2009/20-0907M2_CTDFinalQC.zip>20-0907M2_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2009/20-0911NH_CTDCast.zip>20-0911NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2009/20-0911NH_CTDFinalQC.zip>20-0911NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2008/20-0801JD_CTDCast.zip>20-0801JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2008/20-0801JD_CTDFinalQC.zip>20-0801JD_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2008/20-0804JD_CTDCast.zip>20-0804JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2008/20-0804JD_CTDFinalQC.zip>20-0804JD_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2008/20-0808NH_CTDCast.zip>20-0808NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2008/20-0808NH_CTDFinalQC.zip>20-0808NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2008/20-0810NH_CTDCast.zip>20-0810NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2008/20-0810NH_CTDFinalQC.zip>20-0810NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2007/20-0701JD_CTDCast.zip>20-0701JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2007/20-0701JD_CTDFinalQC.zip>20-0701JD_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2007/20-0704JD_CTDCast.zip>20-0704JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2007/20-0704JD_CTDFinalQC.zip>20-0704JD_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2007/20-0707NH_CTDCast.zip>20-0707NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2007/20-0707NH_CTDFinalQC.zip>20-0707NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2007/20-0711NH_CTDCast.zip>20-0711NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2007/20-0711NH_CTDFinalQC.zip>20-0711NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2006/20-0602JD_CTDCast.zip>20-0602JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2006/20-0602JD_CTDFinalQC.zip>20-0602JD_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2006/20-0604NH_CTDCast.zip>20-0604NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2006/20-0604NH_CTDFinalQC.zip>20-0604NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2006/20-0607NH_CTDCast.zip>20-0607NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2006/20-0607NH_CTDFinalQC.zip>20-0607NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2006/20-0610RR_CTDCast.zip>20-0610RR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2006/20-0610RR_CTDFinalQC.zip>20-0610RR_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2005/20-0501NH_CTDCast.zip>20-0501NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2005/20-0501NH_CTDFinalQC.zip>20-0501NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2005/20-0504NH_CTDCast.zip>20-0504NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2005/20-0504NH_CTDFinalQC.zip>20-0504NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2005/20-0507NH_CTDCast.zip>20-0507NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2005/20-0507NH_CTDFinalQC.zip>20-0507NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2005/20-0511NH_CTDCast.zip>20-0511NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2005/20-0511NH_CTDFinalQC.zip>20-0511NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2004/20-0401JD_CTDCast.zip>20-0401JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2004/20-0401JD_CTDFinalQC.zip>20-0401JD_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2004/20-0404NH_CTDCast.zip>20-0404NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2004/20-0404NHJD_CTDFinalQC.zip>20-0404NHJD_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2004/20-0407JD_CTDCast.zip>20-0407JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2004/20-0407JD_CTDFinalQC.zip>20-0407JD_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2004/20-0411RR_CTDCast.zip>20-0411RR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2004/20-0411RR_CTDFinalQC.zip>20-0411RR_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2003/20-0302JD_CTDCast.zip>20-0302JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2003/20-0302JD_CTDFinalQC.zip>20-0302JD_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2003/20-0304RR_CTDCast.zip>20-0304RR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2003/20-0307NH_CTDCast.zip>20-0307NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2003/20-0307NH_CTDFinalQC.zip>20-0307NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2003/20-0310NH_CTDCast.zip>20-0310NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2003/20-0310NH_CTDFinalQC.zip>20-0310NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2002/20-0201JD_CTDCast.zip>20-0201JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2002/20-0204JD_CTDCast.zip>20-0204JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2002/20-0207NH_CTDCast.zip>20-0207NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2002/20-0211NH_CTDCast.zip>20-0211NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2001/20-0101JD_CTDCast.zip>20-0101JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2001/20-0104JD_CTDCast.zip>20-0104JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2001/20-0107NH_CTDCast.zip>20-0107NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2001/20-0110NH_CTDCast.zip>20-0110NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2000/20-0001NH_CTDCast.zip>20-0001NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2000/20-0004JD_CTDCast.zip>20-0004JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2000/20-0007NH_CTDCast.zip>20-0007NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2000/20-0010NH_CTDCast.zip>20-0010NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1999/19-9901RR_CTDCast.zip>19-9901RR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1999/19-9904JD_CTDCast.zip>19-9904JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1999/19-9908NH_CTDCast.zip>19-9908NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1999/19-9910NH_CTDCast.zip>19-9910NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1998/19-9802JD_CTDCast.zip>19-9802JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1998/19-9802JD_CTDFinalQC.zip>19-9802JD_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/1998/19-9803SP_CTDCast.zip>19-9803SP_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1998/19-9804JD_CTDCast.zip>19-9804JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1998/19-9804JD_CTDFinalQC.zip>19-9804JD_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/1998/19-9805SP_CTDCast.zip>19-9805SP_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1998/19-9807NH_CTDCast.zip>19-9807NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1998/19-9807NH_CTDFinalQC.zip>19-9807NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/1998/19-9808SP_CTDCast.zip>19-9808SP_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1998/19-9809NH_CTDCast.zip>19-9809NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1998/19-9810SP_CTDCast.zip>19-9810SP_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1998/19-9811SP_CTDCast.zip>19-9811SP_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1998/19-9812SP_CTDCast.zip>19-9812SP_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1997/19-9702JD_CTDCast.zip>19-9702JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1997/19-9704NH_CTDCast.zip>19-9704NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1997/19-9707JD_CTDCast.zip>19-9707JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1997/19-9709NH_CTDCast.zip>19-9709NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1997/19-9712SP_CTDCast.zip>19-9712SP_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1996/19-9602JD_CTDCast.zip>19-9602JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1996/19-9604JD_CTDCast.zip>19-9604JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1996/19-9608NH_CTDCast.zip>19-9608NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1996/19-9610RR_CTDCast.zip>19-9610RR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1995/19-9501JD_CTDCast.zip>19-9501JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1995/19-9504NH_CTDCast.zip>19-9504NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1995/19-9507JD_CTDCast.zip>19-9507JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1995/19-9510NH_CTDCast.zip>19-9510NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1994/19-9401JD_CTDCast.zip>19-9401JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1994/19-9403JD_CTDCast.zip>19-9403JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1994/19-9408NH_CTDCast.zip>19-9408NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1994/19-9410NH_CTDCast.zip>19-9410NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1993/19-9301JD_CTDTest.zip>19-9301JD_CTDTest.zip<\/a>","<a href=https://calcofi.org/downloads/1993/19-9304JD_CTDTest.zip>19-9304JD_CTDTest.zip<\/a>","<a href=https://calcofi.org/downloads/1993/19-9308NH_CTDCast.zip>19-9308NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1993/19-9310NH_CTDCast.zip>19-9310NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1992/19-9202JD_CTDCastProdoStas.zip>19-9202JD_CTDCastProdoStas.zip<\/a>","<a href=https://calcofi.org/downloads/1992/19-9204JD_CTDTest01.zip>19-9204JD_CTDTest01.zip<\/a>","<a href=https://calcofi.org/downloads/1992/19-9207NH_CTDCastProdoStas.zip>19-9207NH_CTDCastProdoStas.zip<\/a>","<a href=https://calcofi.org/downloads/1992/19-9210NH_CTDCastProdoStas.zip>19-9210NH_CTDCastProdoStas.zip<\/a>","<a href=https://calcofi.org/downloads/1992/19-9210NH_CTDTest.zip>19-9210NH_CTDTest.zip<\/a>","<a href=https://calcofi.org/downloads/1991/19-9101JD_CTDTest.zip>19-9101JD_CTDTest.zip<\/a>","<a href=https://calcofi.org/downloads/1991/19-9103JD_CTDTest.zip>19-9103JD_CTDTest.zip<\/a>","<a href=https://calcofi.org/downloads/1991/19-9108JD_CTDCast.zip>19-9108JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1991/19-9110NH_CTDCast.zip>19-9110NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1990/19-9003JD_CTDTest.zip>19-9003JD_CTDTest.zip<\/a>","<a href=https://calcofi.org/downloads/1990/19-9011NH_CTDTest.zip>19-9011NH_CTDTest.zip<\/a>"],[2025,2025,2025,2025,2025,2025,2025,2025,2025,2025,2024,2024,2024,2024,2024,2024,2024,2024,2023,2023,2023,2023,2023,2023,2023,2023,2022,2022,2022,2022,2022,2022,2021,2021,2021,2021,2021,2021,2021,2021,2020,2020,2020,2020,2020,2020,2019,2019,2019,2019,2019,2019,2019,2019,2018,2018,2018,2018,2018,2018,2018,2018,2017,2017,2017,2017,2017,2017,2017,2017,2016,2016,2016,2016,2016,2016,2016,2016,2015,2015,2015,2015,2015,2015,2015,2015,2014,2014,2014,2014,2014,2014,2014,2014,2013,2013,2013,2013,2013,2013,2013,2013,2012,2012,2012,2012,2012,2012,2012,2012,2011,2011,2011,2011,2011,2011,2011,2011,2010,2010,2010,2010,2010,2010,2010,2010,2009,2009,2009,2009,2009,2009,2009,2009,2008,2008,2008,2008,2008,2008,2008,2008,2007,2007,2007,2007,2007,2007,2007,2007,2006,2006,2006,2006,2006,2006,2006,2006,2005,2005,2005,2005,2005,2005,2005,2005,2004,2004,2004,2004,2004,2004,2004,2004,2003,2003,2003,2003,2003,2003,2003,2002,2002,2002,2002,2001,2001,2001,2001,2000,2000,2000,2000,1999,1999,1999,1999,1998,1998,1998,1998,1998,1998,1998,1998,1998,1998,1998,1998,1998,1997,1997,1997,1997,1997,1996,1996,1996,1996,1995,1995,1995,1995,1994,1994,1994,1994,1993,1993,1993,1993,1992,1992,1992,1992,1992,1991,1991,1991,1991,1990,1990],[1,1,2,2,4,4,7,7,11,11,1,1,4,4,8,8,11,11,1,1,4,4,7,7,11,11,4,4,8,8,11,11,1,1,5,5,7,7,11,11,1,1,7,7,10,10,2,2,4,4,7,7,11,11,2,2,4,4,6,6,10,10,1,1,4,4,8,8,11,11,1,1,4,4,7,7,11,11,1,1,4,4,7,7,11,11,2,2,4,4,7,7,11,11,1,1,4,4,7,7,11,11,2,2,3,3,7,7,10,10,1,1,4,4,8,8,10,10,1,1,4,4,8,8,11,11,1,1,3,3,7,7,11,11,1,1,4,4,8,8,10,10,1,1,4,4,7,7,11,11,2,2,4,4,7,7,10,10,1,1,4,4,7,7,11,11,1,1,4,4,7,7,11,11,2,2,4,7,7,10,10,1,4,7,11,1,4,7,10,1,4,7,10,1,4,8,10,2,2,3,4,4,5,7,7,8,9,10,11,12,2,4,7,9,12,2,4,8,10,1,4,7,10,1,3,8,10,1,4,8,10,2,4,7,10,10,1,3,8,10,3,11],["2501RL","2501RL","2502RL","2502RL","2504SH","2504SH","2507SR","2507SR","2511SR","2511SR","2401RL","2401RL","2404SH","2404SH","2408SR","2408SR","2411SR","2411SR","2301RL","2301RL","2304SH","2304SH","2307SR","2307SR","2311SR","2311SR","2204SH","2204SH","2208BH","2208BH","2211SR","2211SR","2101RL","2101RL","2105SH","2105SH","2107SR","2107SR","2111SR","2111SR","2001RL","2001RL","2007SR","2007SR","2010SR","2010SR","1902RL","1902RL","1904RL","1904RL","1907BH","1907BH","1911OC","1911OC","1802SH","1802SH","1804SH","1804SH","1806SR","1806SR","1810SR","1810SR","1701RL","1701RL","1704SH","1704SH","1708SR","1708SR","1711SR","1711SR","1601RL","1601RL","1604SH","1604SH","1607OS","1607OS","1611SR","1611SR","1501NH","1501NH","1504NH","1504NH","1507OC","1507OC","1511OC","1511OC","1402SH","1402SH","1404OS","1404OS","1407NH","1407NH","1411NH","1411NH","1301SH","1301SH","1304SH","1304SH","1307NH","1307NH","1311NH","1311NH","1202NH","1202NH","1203NH","1203SH","1207OS","1207OS","1210NH","1210NH","1101NH","1101NH","1104SH","1104SH","1108NH","1108NH","1110NH","1110NH","1001NH","1001NH","1004MF","1004MF","1008NH","1008NH","1011NH","1011NH","0901NH","0901NH","0903JD","0903JD","0907M2","0907M2","0911NH","0911NH","0801JD","0801JD","0804JD","0804JD","0808NH","0808NH","0810NH","0810NH","0701JD","0701JD","0704JD","0704JD","0707NH","0707NH","0711NH","0711NH","0602JD","0602JD","0604NH","0604NH","0607NH","0607NH","0610RR","0610RR","0501NH","0501NH","0504NH","0504NH","0507NH","0507NH","0511NH","0511NH","0401JD","0401JD","0404NH","0404NHJD","0407JD","0407JD","0411RR","0411RR","0302JD","0302JD","0304RR","0307NH","0307NH","0310NH","0310NH","0201JD","0204JD","0207NH","0211NH","0101JD","0104JD","0107NH","0110NH","0001NH","0004JD","0007NH","0010NH","9901RR","9904JD","9908NH","9910NH","9802JD","9802JD","9803SP","9804JD","9804JD","9805SP","9807NH","9807NH","9808SP","9809NH","9810SP","9811SP","9812SP","9702JD","9704NH","9707JD","9709NH","9712SP","9602JD","9604JD","9608NH","9610RR","9501JD","9504NH","9507JD","9510NH","9401JD","9403JD","9408NH","9410NH","9301JD","9304JD","9308NH","9310NH","9202JD","9204JD","9207NH","9210NH","9210NH","9101JD","9103JD","9108JD","9110NH","9003JD","9011NH"],["raw","preliminary","raw","preliminary","raw","preliminary","raw","preliminary","raw","preliminary","raw","preliminary","raw","preliminary","raw","preliminary","raw","preliminary","raw","preliminary","raw","preliminary","raw","preliminary","raw","preliminary","raw","preliminary","raw","preliminary","raw","preliminary","raw","final","raw","final","raw","preliminary","raw","preliminary","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","raw","final","raw","final","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","final","raw","raw","final","raw","raw","final","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","test","test","raw","raw","raw","test","raw","raw","test","test","test","raw","raw","test","test"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>file_zip<\/th>\n      <th>year<\/th>\n      <th>month<\/th>\n      <th>cruise_id<\/th>\n      <th>zip_type<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"file_zip","targets":1},{"name":"year","targets":2},{"name":"month","targets":3},{"name":"cruise_id","targets":4},{"name":"zip_type","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="download-and-unzip-files" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="download-and-unzip-files"><span class="header-section-number">4</span> Download and Unzip Files</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># function to download and optionally unzip a file</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>download_and_unzip <span class="ot">&lt;-</span> <span class="cf">function</span>(url, dest_dir, zip_type, <span class="at">unzip =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  file_zip <span class="ot">&lt;-</span> <span class="fu">basename</span>(url)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  dest_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dest_dir, file_zip)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  dir_unzip <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dest_dir, <span class="fu">str_remove</span>(file_zip, <span class="st">"</span><span class="sc">\\</span><span class="st">.zip$"</span>))</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># skip if already downloaded</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">file_exists</span>(dest_file)) {</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Already exists: {file_zip}"</span>))</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Downloading: {file_zip}"</span>))</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download.file</span>(url, dest_file, <span class="at">mode =</span> <span class="st">"wb"</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># skip if already unzipped</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (unzip <span class="sc">&amp;&amp;</span> <span class="fu">dir_exists</span>(dir_unzip)) {</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Already unzipped: {file_zip}"</span>))</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># only unzip if final or preliminary (case-insensitive)</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (zip_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"final"</span>, <span class="st">"preliminary"</span>)) {</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Unzipping: {file_zip}"</span>))</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dir_create</span>(dir_unzip, <span class="at">recurse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unzip</span>(dest_file, <span class="at">exdir =</span> dir_unzip)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (unzip) {</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Skipping unzip (not final/preliminary): {file_zip}"</span>))</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="co"># download all files, but only unzip final and preliminary</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>d_zips <span class="sc">|&gt;</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pwalk</span>(<span class="cf">function</span>(url, file_zip, zip_type, ...) {</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download_and_unzip</span>(url, dir_dl, zip_type, <span class="at">unzip =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Download and extraction complete!"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<ul>
<li><p>2025-Jul:</p>
<ul>
<li>Preliminary CTD 1m-Binned<br>
<a href="https://calcofi.org/downloads/2025/20-2507SR_CTDPrelim.zip">20-2507SR_CTD<strong>Prelim</strong>.zip</a><br>
<strong>Preliminary CTD 1m-Binned</strong>: Raw CTD sensor data that have gone through SBE Data Processing, and obvious bad sensor readings have been flagged during initial QAQC. Bottle data has not yet been merged with the CTD data. CTD Salinity, Oxygen, Fluorescence, and Nitrate profiles have not been corrected to the bottle data. Cruise corrected Nitrate sensor data (EstNO3_CruiseCorr) has been converted from raw voltage using a sensor calibration done before each cruise, but not yet corrected using CTD vs.&nbsp;Bottle regressions.&nbsp;</li>
</ul></li>
<li><p>2021-Jul:</p>
<ul>
<li><p><del>Prodo Cast</del> Raw CTD Data<br>
<a href="https://calcofi.org/downloads/2021/20-2107SR_CTDCast.zip">20-2107SR_CTD<strong>Cast</strong>.zip</a></p></li>
<li><p>Preliminary CTD &amp; Bottle 1m-Binned<br>
<a href="https://calcofi.org/downloads/2021/20-2107SR_CTDPrelim.zip">20-2107SR_CTD<strong>Prelim</strong>.zip</a><br>
<strong>Preliminary CTD &amp; Bottle 1m-Binned</strong>: Preliminary CTD sensor data that have been merged with QAQC’ed bottle data. CTD Salinity, Oxygen, Fluorescence, and Nitrate profiles have been corrected using CTD vs.&nbsp;bottle regressions.&nbsp;</p></li>
</ul></li>
<li><p>2021-May:</p>
<ul>
<li><p>Raw CTD Data<br>
<a href="https://calcofi.org/downloads/2021/20-2105SH_CTDCast.zip">20-2105SH_CTD<strong>Cast</strong>.zip</a><br>
<strong>Raw CTD Data</strong>: Data files (.xmlcon, .hex, .bl, .nav, .prn, .mrk, .hdr) directly from SBE Software (<a href="https://www.seabird.com/">Sea-Bird Scientific</a>) with no processing or corrections applied.</p></li>
<li><p>Final 1m-Binned<br>
<a href="https://calcofi.org/downloads/2021/20-2105SH_CTDFinalQC.zip">20-2105SH_CTD<strong>FinalQC</strong>.zip</a><br>
<strong>Final 1m-Binned</strong>: CTD data that have passed through the CalCOFI quality control process. After standard Seasoft-processing (Sea-Bird Scientific’s data-processing suite) tuned for our SBE 911plus CTD, the .asc files are processed by SIO-CalCOFI in-house software (BtlVsCTD). Averaged (4-sec or 1-meter bin-averaged) CTD sensor data are matched with corresponding bottle data, then <strong>cruise-corrected</strong> and <strong>station-corrected</strong>. Zipped file includes: metadata and .asc, .hdr, .btl, and upcast &amp; downcast .csvs (“u” and “d”; by station and concatenated).</p>
<ul>
<li><p><strong>Cruise-corrected CTD data</strong>: CTD sensor data that are corrected using regression coefficients derived from 4-sec average sensor data vs bottle data comparisons for the entire cruise, meaning all casts with bottle samples (n=~1400; fliers omitted; column labels ‘_CruiseCorr’).</p></li>
<li><p><strong>Station-corrected CTD data</strong>: CTD sensor data that are corrected using regression coefficients generated dynamically for each cast, 1m bin-averaged sensor data vs bottle data (n=~20; fliers omitted; column labels ‘_StaCorr’).</p>
<ul>
<li>Since sensor behavior may vary from station to station, station-corrected CTD sensor data for salinity, oxygen, estimated nitrate, and estimated chlorophyll-a are considered the best, particularly for estimated nitrate.</li>
</ul></li>
</ul></li>
</ul></li>
<li><p>1992-Feb:</p>
<ul>
<li>Prodo Cast<br>
<a href="https://calcofi.org/downloads/1992/19-9202JD_CTDCastProdoStas.zip">19-9202JD_CTD<strong>CastProdoStas</strong>.zip</a><br>
<strong>Test Cast/Prodo Cast</strong>: The Seabird 911plus CTD was first tested in Mar 1990 (9003JD) but is still under development. CTD data from Mar 1990 – 1991 were occasional system &amp; feasibility tests (“<strong>test casts</strong>“). As confidence in data quality improved, the CTD-Rosette began being used for daily primary productivity sample collection casts (“<strong>prodo casts</strong>“) in 1992 (6 depths from one station per day).</li>
</ul></li>
<li><p>1990-Mar:</p>
<ul>
<li>Test Cast<br>
<a href="https://calcofi.org/downloads/1990/19-9003JD_CTDTest.zip">19-9003JD_CTD<strong>Test</strong>.zip</a></li>
</ul></li>
</ul>
</section>
<section id="find-and-prioritize-ctd-data-files" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="find-and-prioritize-ctd-data-files"><span class="header-section-number">5</span> Find and Prioritize CTD Data Files</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create file inventory</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>d_csv <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="fu">dir_ls</span>(dir_dl, <span class="at">recurse =</span> <span class="cn">TRUE</span>, <span class="at">regexp =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.csv$"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">file_csv =</span> <span class="fu">basename</span>(path),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">path_unzip =</span> <span class="fu">str_replace</span>(path, <span class="fu">glue</span>(<span class="st">"{dir_dl}/"</span>), <span class="st">""</span>),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get first directory in path_unzip</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">dir_unzip =</span> <span class="fu">str_extract</span>(path_unzip, <span class="st">"^[^/]+"</span>),</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">cruise_id =</span> <span class="fu">str_extract</span>(</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>      path_unzip,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">"</span><span class="sc">\\</span><span class="st">d{2}-(</span><span class="sc">\\</span><span class="st">d{4}[A-Z0-9]{2,4})_.*"</span>,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">group =</span> <span class="dv">1</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># classify data type from parent directory</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">data_stage =</span> <span class="fu">case_when</span>(</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(path_unzip, <span class="st">"Final.*db[_|-]csv"</span>) <span class="sc">~</span> <span class="st">"final"</span>,</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(path_unzip, <span class="st">"Prelim.*db[_|-]csv"</span>) <span class="sc">~</span> <span class="st">"preliminary"</span>,</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>      <span class="co"># </span><span class="al">TODO</span><span class="co">: note these strange exceptions</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>      cruise_id <span class="sc">==</span> <span class="st">"2507SR"</span> <span class="sc">&amp;</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(path_unzip, <span class="st">"Prelim.*csv"</span>) <span class="sc">~</span> <span class="st">"preliminary"</span>,</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>      cruise_id <span class="sc">==</span> <span class="st">"2111SR"</span> <span class="sc">&amp;</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>          path_unzip,</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Prelim.*csvs-plots.*2111SR.*csv"</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">~</span> <span class="st">"preliminary"</span>,</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> <span class="cn">NA_character_</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># detect cast direction from file_csv (U=upcast, D=downcast)</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">cast_dir =</span> <span class="fu">case_when</span>(</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(file_csv, <span class="fu">regex</span>(<span class="st">"U</span><span class="sc">\\</span><span class="st">.csv$"</span>, <span class="at">ignore_case =</span> T)) <span class="sc">~</span> <span class="st">"U"</span>,</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(file_csv, <span class="fu">regex</span>(<span class="st">"D</span><span class="sc">\\</span><span class="st">.csv$"</span>, <span class="at">ignore_case =</span> T)) <span class="sc">~</span> <span class="st">"D"</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># prioritize: final=1, preliminary=2</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">priority =</span> <span class="fu">case_when</span>(</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>      data_stage <span class="sc">==</span> <span class="st">"final"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>      data_stage <span class="sc">==</span> <span class="st">"preliminary"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(cruise_id, path_unzip) <span class="sc">|&gt;</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(cruise_id, path_unzip) <span class="sc">|&gt;</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># keep only final and preliminary files</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(data_stage <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"final"</span>, <span class="st">"preliminary"</span>))</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a><span class="co"># for each cruise, keep only final if available, otherwise preliminary</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>d_priority <span class="ot">&lt;-</span> d_csv <span class="sc">|&gt;</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cruise_id) <span class="sc">|&gt;</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">best_priority =</span> <span class="fu">min</span>(priority),</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>d_csv <span class="ot">&lt;-</span> d_csv <span class="sc">|&gt;</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(d_priority, <span class="at">by =</span> <span class="st">"cruise_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(priority <span class="sc">==</span> best_priority) <span class="sc">|&gt;</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>best_priority)</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>cruises_csv_notzip <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>(d_csv<span class="sc">$</span>cruise_id),</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>(d_zips<span class="sc">$</span>cruise_id)</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">length</span>(cruises_csv_notzip) <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: cruises_zip_notcsv: find workable form of raw data</span></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>cruises_zip_notcsv <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>(d_zips<span class="sc">$</span>cruise_id),</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>(d_csv<span class="sc">$</span>cruise_id)</span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a><span class="co">#  [1] "0001NH" "0004JD" "0007NH" "0010NH" "0101JD" "0104JD" "0107NH" "0110NH" "0201JD" "0204JD" "0207NH"</span></span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a><span class="co"># [12] "0211NH" "0304RR" "0404NH" "1203NH" "9003JD" "9011NH" "9101JD" "9103JD" "9108JD" "9110NH" "9202JD"</span></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a><span class="co"># [23] "9204JD" "9207NH" "9210NH" "9301JD" "9304JD" "9308NH" "9310NH" "9401JD" "9403JD" "9408NH" "9410NH"</span></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a><span class="co"># [34] "9501JD" "9504NH" "9507JD" "9510NH" "9602JD" "9604JD" "9608NH" "9610RR" "9702JD" "9704NH" "9707JD"</span></span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a><span class="co"># [45] "9709NH" "9712SP" "9803SP" "9805SP" "9808SP" "9809NH" "9810SP" "9811SP" "9812SP" "9901RR" "9904JD"</span></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a><span class="co"># [56] "9908NH" "9910NH"</span></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: plot(ctdDecimate(ctdTrim(read.ctd("stn123.cnv")))) per [oce](https://dankelley.github.io/oce/articles/B_ctd.html#raw-data)</span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a><span class="co"># librarian::shelf(oce, quiet = T)</span></span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a><span class="co"># dir_raw &lt;- "/Users/bbest/Library/CloudStorage/GoogleDrive-ben@ecoquants.com/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/19-9003JD_CTDTest"</span></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a><span class="co"># raw_9003JD_dat &lt;- '/STA3-2.DAT'</span></span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a><span class="co"># d_ctd &lt;- read.ctd(dir_ls(dir_raw)) |&gt; plot(ctdDecimate(ctdTrim(.)))</span></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a><span class="co"># if (length(missing_cruises) &gt; 0) {</span></span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a><span class="co">#   warning(glue("Warning: Missing cruises with no final/preliminary files: {paste(missing_cruises, collapse = ', ')}"))</span></span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a><span class="co">#   # 0404JD</span></span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a><span class="co"># summary</span></span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>d_csv <span class="sc">|&gt;</span></span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>path) <span class="sc">|&gt;</span></span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(cruise_id, path_unzip) <span class="sc">|&gt;</span></span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(cruise_id, path_unzip) <span class="sc">|&gt;</span></span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(, <span class="at">caption =</span> <span class="st">"Files to Ingest"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-260ec094a4d1cda0a82e" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-260ec094a4d1cda0a82e">{"x":{"filter":"none","vertical":false,"caption":"<caption>Files to Ingest<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246"],["0302JD","0302JD","0302JD","0302JD","0302JD","0302JD","0307NH","0307NH","0307NH","0307NH","0310NH","0310NH","0401JD","0401JD","0404NHJD","0404NHJD","0404NHJD","0404NHJD","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0411RR","0411RR","0501NH","0501NH","0504NH","0504NH","0507NH","0507NH","0511NH","0511NH","0602JD","0602JD","0604NH","0604NH","0607NH","0607NH","0610RR","0610RR","0701JD","0701JD","0701JD","0701JD","0704JD","0704JD","0707NH","0707NH","0707NH","0707NH","0707NH","0707NH","0707NH","0707NH","0711NH","0711NH","0711NH","0711NH","0801JD","0801JD","0801JD","0801JD","0801JD","0801JD","0804JD","0804JD","0808NH","0808NH","0810NH","0810NH","0901NH","0901NH","0903JD","0903JD","0907M2","0907M2","0911NH","0911NH","1001NH","1001NH","1004MF","1004MF","1008NH","1008NH","1011NH","1011NH","1101NH","1101NH","1104SH","1104SH","1104SH","1104SH","1104SH","1104SH","1104SH","1104SH","1108NH","1108NH","1110NH","1110NH","1202NH","1202NH","1203SH","1203SH","1207OS","1207OS","1210NH","1210NH","1301SH","1301SH","1304SH","1304SH","1307NH","1307NH","1311NH","1311NH","1402SH","1402SH","1404OS","1404OS","1407NH","1407NH","1411NH","1411NH","1501NH","1501NH","1501NH","1501NH","1501NH","1501NH","1504NH","1504NH","1507OC","1507OC","1511OC","1511OC","1601RL","1601RL","1604SH","1604SH","1607OS","1607OS","1611SR","1611SR","1701RL","1701RL","1701RL","1701RL","1701RL","1701RL","1704SH","1704SH","1704SH","1704SH","1704SH","1704SH","1708SR","1708SR","1711SR","1711SR","1802SH","1802SH","1804SH","1804SH","1806SR","1806SR","1810SR","1810SR","1902RL","1902RL","1904RL","1904RL","1907BH","1907BH","1911OC","1911OC","2001RL","2001RL","2007SR","2007SR","2010SR","2010SR","2101RL","2101RL","2105SH","2105SH","2107SR","2107SR","2111SR","2111SR","2204SH","2204SH","2208BH","2208BH","2211SR","2211SR","2301RL","2301RL","2304SH","2304SH","2307SR","2307SR","2307SR","2307SR","2311SR","2311SR","2311SR","2311SR","2401RL","2401RL","2401RL","2401RL","2404SH","2404SH","2408SR","2408SR","2411SR","2411SR","2501RL","2501RL","2502RL","2502RL","2504SH","2504SH","2507SR","2507SR","9802JD","9802JD","9804JD","9804JD","9804JD","9804JD","9804JD","9804JD","9807NH","9807NH"],["20-0302JD_CTDFinalQC/db_csvs/20-0302JD_CTDBTL_001-100D.csv","20-0302JD_CTDFinalQC/db_csvs/20-0302JD_CTDBTL_001-100U.csv","20-0302JD_CTDFinalQC/db_csvs/south-north/20-0302JD_CTDBTL_001-073ID.csv","20-0302JD_CTDFinalQC/db_csvs/south-north/20-0302JD_CTDBTL_001-073IU.csv","20-0302JD_CTDFinalQC/db_csvs/south-north/20-0302JD_CTDBTL_074-100ID.csv","20-0302JD_CTDFinalQC/db_csvs/south-north/20-0302JD_CTDBTL_074-100IU.csv","20-0307NH_CTDFinalQC/db_csvs/20-0307NH_CTDBTL_001-526ID.csv","20-0307NH_CTDFinalQC/db_csvs/20-0307NH_CTDBTL_001-526IU.csv","20-0307NH_CTDFinalQC/db_csvs/20-0307NH_CTDBTL_044-060ID.csv","20-0307NH_CTDFinalQC/db_csvs/20-0307NH_CTDBTL_044-060IU.csv","20-0310NH_CTDFinalQC/db_csvs/20-0310NH_CTDBTL_001-066D.csv","20-0310NH_CTDFinalQC/db_csvs/20-0310NH_CTDBTL_001-066U.csv","20-0401JD_CTDFinalQC/db_csvs/20-0401JD_CTDBTL_001-098ID.csv","20-0401JD_CTDFinalQC/db_csvs/20-0401JD_CTDBTL_001-098IU.csv","20-0404NHJD_CTDFinalQC/db_csvs/20-0404JD_CTDBTL_067-094ID.csv","20-0404NHJD_CTDFinalQC/db_csvs/20-0404JD_CTDBTL_067-094IU.csv","20-0404NHJD_CTDFinalQC/db_csvs/20-0404NH_CTDBTL_001-066ID.csv","20-0404NHJD_CTDFinalQC/db_csvs/20-0404NH_CTDBTL_001-066IU.csv","20-0407JD_CTDFinalQC/db_csvs/20-0407JD_CTDBTL_001-012ID.csv","20-0407JD_CTDFinalQC/db_csvs/20-0407JD_CTDBTL_001-012IU.csv","20-0407JD_CTDFinalQC/db_csvs/20-0407JD_CTDBTL_013-074ID.csv","20-0407JD_CTDFinalQC/db_csvs/20-0407JD_CTDBTL_013-074IU.csv","20-0407JD_CTDFinalQC/db_csvs/pieces/20-0407JD_CTDBTL_001-002ID.csv","20-0407JD_CTDFinalQC/db_csvs/pieces/20-0407JD_CTDBTL_001-002IU.csv","20-0407JD_CTDFinalQC/db_csvs/pieces/20-0407JD_CTDBTL_003-012ID.csv","20-0407JD_CTDFinalQC/db_csvs/pieces/20-0407JD_CTDBTL_003-012IU.csv","20-0407JD_CTDFinalQC/db_csvs/pieces/20-0407JD_CTDBTL_013-028ID.csv","20-0407JD_CTDFinalQC/db_csvs/pieces/20-0407JD_CTDBTL_013-028IU.csv","20-0407JD_CTDFinalQC/db_csvs/pieces/20-0407JD_CTDBTL_029-039ID.csv","20-0407JD_CTDFinalQC/db_csvs/pieces/20-0407JD_CTDBTL_029-039IU.csv","20-0407JD_CTDFinalQC/db_csvs/pieces/20-0407JD_CTDBTL_040-074ID.csv","20-0407JD_CTDFinalQC/db_csvs/pieces/20-0407JD_CTDBTL_040-074IU.csv","20-0411RR_CTDFinalQC/db_csvs/20-0411RR_CTDBTL_001-965ID.csv","20-0411RR_CTDFinalQC/db_csvs/20-0411RR_CTDBTL_001-965IU.csv","20-0501NH_CTDFinalQC/db_csvs/20-0501NH_CTDBTL_001-075D.csv","20-0501NH_CTDFinalQC/db_csvs/20-0501NH_CTDBTL_001-075U.csv","20-0504NH_CTDFinalQC/db_csvs/20-0504NH_CTDBTL_001-075D.csv","20-0504NH_CTDFinalQC/db_csvs/20-0504NH_CTDBTL_001-075U.csv","20-0507NH_CTDFinalQC/db_csvs/20-0507NH_CTDBTL_001-075D.csv","20-0507NH_CTDFinalQC/db_csvs/20-0507NH_CTDBTL_001-075U.csv","20-0511NH_CTDFinalQC/db_csvs/20-0511NH_CTDBTL_001-072D.csv","20-0511NH_CTDFinalQC/db_csvs/20-0511NH_CTDBTL_001-072U.csv","20-0602JD_CTDFinalQC/db_csvs/20-0602JD_CTDBTL_001-096D.csv","20-0602JD_CTDFinalQC/db_csvs/20-0602JD_CTDBTL_001-096U.csv","20-0604NH_CTDFinalQC/db_csvs/20-0604NH_CTDBTL_001-563ID.csv","20-0604NH_CTDFinalQC/db_csvs/20-0604NH_CTDBTL_001-563IU.csv","20-0607NH_CTDFinalQC/db_csvs/20-0607NH_CTDBTL_001-074ID.csv","20-0607NH_CTDFinalQC/db_csvs/20-0607NH_CTDBTL_001-074IU.csv","20-0610RR_CTDFinalQC/db-csvs/20-0610RR_CTDBTL_001-567D.csv","20-0610RR_CTDFinalQC/db-csvs/20-0610RR_CTDBTL_001-567U.csv","20-0701JD_CTDFinalQC/db_csvs/20-0701JD_CTDBTL_001-084D.csv","20-0701JD_CTDFinalQC/db_csvs/20-0701JD_CTDBTL_001-084IDnoQC.csv","20-0701JD_CTDFinalQC/db_csvs/20-0701JD_CTDBTL_001-084IUnoQC.csv","20-0701JD_CTDFinalQC/db_csvs/20-0701JD_CTDBTL_001-084U.csv","20-0704JD_CTDFinalQC/db-csvs/20-0704JD_CTDBTL_001-555ID.csv","20-0704JD_CTDFinalQC/db-csvs/20-0704JD_CTDBTL_001-555IU.csv","20-0707NH_CTDFinalQC/db-csvs/20-0707NH_CTDBTL_001-073ID.csv","20-0707NH_CTDFinalQC/db-csvs/20-0707NH_CTDBTL_001-073IU.csv","20-0707NH_CTDFinalQC/db-csvs/separateRuns/20-0707NH_CTDBTL_001-012ID.csv","20-0707NH_CTDFinalQC/db-csvs/separateRuns/20-0707NH_CTDBTL_001-012IU.csv","20-0707NH_CTDFinalQC/db-csvs/separateRuns/20-0707NH_CTDBTL_013-046ID.csv","20-0707NH_CTDFinalQC/db-csvs/separateRuns/20-0707NH_CTDBTL_013-046IU.csv","20-0707NH_CTDFinalQC/db-csvs/separateRuns/20-0707NH_CTDBTL_047-073ID.csv","20-0707NH_CTDFinalQC/db-csvs/separateRuns/20-0707NH_CTDBTL_047-073IU.csv","20-0711NH_CTDFinalQC/db-csvs/20-0711_CTDBTL_001-067Dno001b.csv","20-0711NH_CTDFinalQC/db-csvs/20-0711_CTDBTL_001-067ID.csv","20-0711NH_CTDFinalQC/db-csvs/20-0711_CTDBTL_001-067IU.csv","20-0711NH_CTDFinalQC/db-csvs/20-0711_CTDBTL_001-067Uno001b.csv","20-0801JD_CTDFinalQC/db-csvs/20-0801JD_CTDBTL_001-545ID.csv","20-0801JD_CTDFinalQC/db-csvs/20-0801JD_CTDBTL_001-545IU.csv","20-0801JD_CTDFinalQC/db-csvs/20-0801_CTDBTL_001-545D.csv","20-0801JD_CTDFinalQC/db-csvs/20-0801_CTDBTL_001-545ID.csv","20-0801JD_CTDFinalQC/db-csvs/20-0801_CTDBTL_001-545IU.csv","20-0801JD_CTDFinalQC/db-csvs/20-0801_CTDBTL_001-545U.csv","20-0804JD_CTDFinalQC/db-csvs/20-0804JD_CTDBTL_001-177ID.csv","20-0804JD_CTDFinalQC/db-csvs/20-0804JD_CTDBTL_001-177IU.csv","20-0808NH_CTDFinalQC/db-csvs/20-0808_CTDBTL_001-069D.csv","20-0808NH_CTDFinalQC/db-csvs/20-0808_CTDBTL_001-069U.csv","20-0810NH_CTDFinalQC/db-csvs/20-0810NH_CTDBTL_001-073ID.csv","20-0810NH_CTDFinalQC/db-csvs/20-0810NH_CTDBTL_001-073IU.csv","20-0901NH_CTDFinalQC/db-csvs/20-0901NH_CTDBTL_001-075ID.csv","20-0901NH_CTDFinalQC/db-csvs/20-0901NH_CTDBTL_001-075IU.csv","20-0903JD_CTDFinalQC/db-csvs/20-0903JD_CTDBTL_001-071ID.csv","20-0903JD_CTDFinalQC/db-csvs/20-0903JD_CTDBTL_001-071IU.csv","20-0907M2_CTDFinalQC/db_csvs/20-0907M2_CTDBTL_001-961ID.csv","20-0907M2_CTDFinalQC/db_csvs/20-0907M2_CTDBTL_001-961IU.csv","20-0911NH_CTDFinalQC/db_csvs/20-0911NH_CTDBTL_001-075ID.csv","20-0911NH_CTDFinalQC/db_csvs/20-0911NH_CTDBTL_001-075IU.csv","20-1001NH_CTDFinalQC/db_csvs/20-1001NH_CTDBTL_001-093D.csv","20-1001NH_CTDFinalQC/db_csvs/20-1001NH_CTDBTL_001-093U.csv","20-1004MF_CTDFinalQC/db_csvs/20-1004MF_CTDBTL_123-682ID.csv","20-1004MF_CTDFinalQC/db_csvs/20-1004MF_CTDBTL_123-682IU.csv","20-1008NH_CTDFinalQC/db_csvs/20-1008NH_CTDBTL_001-075ID.csv","20-1008NH_CTDFinalQC/db_csvs/20-1008NH_CTDBTL_001-075IU.csv","20-1011NH_CTDFinalQC/db_csvs/20-1011NH_CTDBTL_001-067ID.csv","20-1011NH_CTDFinalQC/db_csvs/20-1011NH_CTDBTL_001-067IU.csv","20-1101NH_CTDFinalQC/db_csvs/20-1101NH_CTDBTL_001-106D.csv","20-1101NH_CTDFinalQC/db_csvs/20-1101NH_CTDBTL_001-106U.csv","20-1104SH_CTDFinalQC/db_csvs/20-1104SH_CTDBTL_037-114ID.csv","20-1104SH_CTDFinalQC/db_csvs/20-1104SH_CTDBTL_037-114IU.csv","20-1104SH_CTDFinalQC/db_csvs/separate_runs/20-1104SH_CTDBTL_031-035ID.csv","20-1104SH_CTDFinalQC/db_csvs/separate_runs/20-1104SH_CTDBTL_031-035IU.csv","20-1104SH_CTDFinalQC/db_csvs/separate_runs/20-1104SH_CTDBTL_031-114ID.csv","20-1104SH_CTDFinalQC/db_csvs/separate_runs/20-1104SH_CTDBTL_031-114IU.csv","20-1104SH_CTDFinalQC/db_csvs/separate_runs/20-1104SH_CTDBTL_036-036ID.csv","20-1104SH_CTDFinalQC/db_csvs/separate_runs/20-1104SH_CTDBTL_036-036IU.csv","20-1108NH_CTDFinalQC/db_csvs/20-1108NH_CTDBTL_001-072ID.csv","20-1108NH_CTDFinalQC/db_csvs/20-1108NH_CTDBTL_001-072IU.csv","20-1110NH_CTDFinalQC/db_csv/20-1110NH_CTDBTL_001-666ID.csv","20-1110NH_CTDFinalQC/db_csv/20-1110NH_CTDBTL_001-666IU.csv","20-1202NH_CTDFinalQC/db_csvs/20-1202NH_CTDBTL_001-075D.csv","20-1202NH_CTDFinalQC/db_csvs/20-1202NH_CTDBTL_001-075U.csv","20-1203SH_CTDFinalQC/db_csvs/20-1203SH_CTDBTL_001-057D.csv","20-1203SH_CTDFinalQC/db_csvs/20-1203SH_CTDBTL_001-057U.csv","20-1207OS_CTDFinalQC/db_csvs/20-1207OS_CTDBTL_001-075D.csv","20-1207OS_CTDFinalQC/db_csvs/20-1207OS_CTDBTL_001-075U.csv","20-1210NH_CTDFinalQC/db_csv/20-1210NH_CTDBTL_001-075D.csv","20-1210NH_CTDFinalQC/db_csv/20-1210NH_CTDBTL_001-075U.csv","20-1301SH_CTDFinalQC/db_csvs/20-1301SH_CTDBTL_001-090D.csv","20-1301SH_CTDFinalQC/db_csvs/20-1301SH_CTDBTL_001-090U.csv","20-1304SH_CTDFinalQC/db_csv/20-1304SH_CTDBTL_001-109D.csv","20-1304SH_CTDFinalQC/db_csv/20-1304SH_CTDBTL_001-109U.csv","20-1307NH_CTDFinalQC/db_csv/20-1307NH_CTDBTL_001-074D.csv","20-1307NH_CTDFinalQC/db_csv/20-1307NH_CTDBTL_001-074U.csv","20-1311NH_CTDFinalQC/db_csv/20-1311NH_CTDBTL_001-521D.csv","20-1311NH_CTDFinalQC/db_csv/20-1311NH_CTDBTL_001-521U.csv","20-1402SH_CTDFinalQC/db_csv/20-1402SH_CTDBTL_001-036D.csv","20-1402SH_CTDFinalQC/db_csv/20-1402SH_CTDBTL_001-036U.csv","20-1404OS_CTDFinalQC/db_csv/20-1404OS_CTDBTL_001-070D.csv","20-1404OS_CTDFinalQC/db_csv/20-1404OS_CTDBTL_001-070U.csv","20-1407NH_CTDFinalQC/db_csv/20-1407NH_CTDBTL_001-075D.csv","20-1407NH_CTDFinalQC/db_csv/20-1407NH_CTDBTL_001-075U.csv","20-1411NH_CTDFinalQC/db_csv/20-1411NH_CTDBTL_001-076D.csv","20-1411NH_CTDFinalQC/db_csv/20-1411NH_CTDBTL_001-076U.csv","20-1501NH_CTDFinalQC/db_csv/20-1501NH_CTDBTL_001-100D.csv","20-1501NH_CTDFinalQC/db_csv/20-1501NH_CTDBTL_001-100U.csv","20-1501NH_CTDFinalQC/db_csv/dualTCO/20-1501NH_CTDBTL_001-064D.csv","20-1501NH_CTDFinalQC/db_csv/dualTCO/20-1501NH_CTDBTL_001-064U.csv","20-1501NH_CTDFinalQC/db_csv/singleTCO/20-1501NH_CTDBTL_004-100D.csv","20-1501NH_CTDFinalQC/db_csv/singleTCO/20-1501NH_CTDBTL_004-100U.csv","20-1504NH_CTDFinalQC/db_csvs/20-1504NH_CTDBTL_001-070D.csv","20-1504NH_CTDFinalQC/db_csvs/20-1504NH_CTDBTL_001-070U.csv","20-1507OC_CTDFinalQC/db_csv/20-1507OC_CTDBTL_001-071D.csv","20-1507OC_CTDFinalQC/db_csv/20-1507OC_CTDBTL_001-071U.csv","20-1511OC_CTDFinalQC/db_csvs/20-1511OC_CTDBTL_001-070D.csv","20-1511OC_CTDFinalQC/db_csvs/20-1511OC_CTDBTL_001-070U.csv","20-1601RL_CTDFinalQC/db_csvs/20-1601RL_CTDBTL_001-104D.csv","20-1601RL_CTDFinalQC/db_csvs/20-1601RL_CTDBTL_001-104U.csv","20-1604SH_CTDFinalQC/db_csvs/20-1604SH_CTDBTL_001-101D.csv","20-1604SH_CTDFinalQC/db_csvs/20-1604SH_CTDBTL_001-101U.csv","20-1607OS_CTDFinalQC/db_csvs/20-1607OS_CTDBTL_001-068D.csv","20-1607OS_CTDFinalQC/db_csvs/20-1607OS_CTDBTL_001-068U.csv","20-1611SR_CTDFinalQC/db_csvs/20-1611SR_CTDBTL_001-075D.csv","20-1611SR_CTDFinalQC/db_csvs/20-1611SR_CTDBTL_001-075U.csv","20-1701RL_CTDFinalQC/db_csvs/20-1701RL_CTDBTL_001-083D.csv","20-1701RL_CTDFinalQC/db_csvs/20-1701RL_CTDBTL_001-083U.csv","20-1701RL_CTDFinalQC/db_csvs/ISUS_separateRuns/20-1701RL_CTDBTL_001-020D.csv","20-1701RL_CTDFinalQC/db_csvs/ISUS_separateRuns/20-1701RL_CTDBTL_001-020U.csv","20-1701RL_CTDFinalQC/db_csvs/ISUS_separateRuns/20-1701RL_CTDBTL_021-083D.csv","20-1701RL_CTDFinalQC/db_csvs/ISUS_separateRuns/20-1701RL_CTDBTL_021-083U.csv","20-1704SH_CTDFinalQC/db_csvs/20-1704SH_CTDBTL_001-104D.csv","20-1704SH_CTDFinalQC/db_csvs/20-1704SH_CTDBTL_001-104U.csv","20-1704SH_CTDFinalQC/db_csvs/separatelyProcessed/20-1704SH_CTDBTL_001-040D.csv","20-1704SH_CTDFinalQC/db_csvs/separatelyProcessed/20-1704SH_CTDBTL_001-040U.csv","20-1704SH_CTDFinalQC/db_csvs/separatelyProcessed/20-1704SH_CTDBTL_041-104D.csv","20-1704SH_CTDFinalQC/db_csvs/separatelyProcessed/20-1704SH_CTDBTL_041-104U.csv","20-1708SR_CTDFinalQC/db_csvs/20-1708SR_CTDBTL_001-073D.csv","20-1708SR_CTDFinalQC/db_csvs/20-1708SR_CTDBTL_001-073U.csv","20-1711SR_CTDFinalQC/db-csvs/20-1711SR_CTDBTL_001-074D.csv","20-1711SR_CTDFinalQC/db-csvs/20-1711SR_CTDBTL_001-074U.csv","20-1802SH_CTDFinalQC/db_csvs/20-1802SH_CTDBTL_001-045D.csv","20-1802SH_CTDFinalQC/db_csvs/20-1802SH_CTDBTL_001-045U.csv","20-1804SH_CTDFinalQC/db_csvs/20-1804SH_CTDBTL_001-103D.csv","20-1804SH_CTDFinalQC/db_csvs/20-1804SH_CTDBTL_001-103U.csv","20-1806SR_CTDFinalQC/db_csvs/20-1806SR_CTDBTL_001-072D.csv","20-1806SR_CTDFinalQC/db_csvs/20-1806SR_CTDBTL_001-072U.csv","20-1810SR_CTDFinalQC/db_csvs/20-1810SR_CTDBTL_001-074D.csv","20-1810SR_CTDFinalQC/db_csvs/20-1810SR_CTDBTL_001-074U.csv","20-1902RL_CTDFinalQC/db_csvs/20-1902RL_CTDBTL_001-029D.csv","20-1902RL_CTDFinalQC/db_csvs/20-1902RL_CTDBTL_001-029U.csv","20-1904RL_CTDFinalQC/20-1904RL_FinalCTD/db_csvs/20-1904RL_CTDBTL_001-069D.csv","20-1904RL_CTDFinalQC/20-1904RL_FinalCTD/db_csvs/20-1904RL_CTDBTL_001-069U.csv","20-1907BH_CTDFinalQC/db-csvs/20-1907BH_CTDBTL_001-070D.csv","20-1907BH_CTDFinalQC/db-csvs/20-1907BH_CTDBTL_001-070U.csv","20-1911OC_CTDFinalQC/db-csvs/20-1911OC_CTDBTL_001-075D.csv","20-1911OC_CTDFinalQC/db-csvs/20-1911OC_CTDBTL_001-075U.csv","20-2001RL_CTDFinalQC/db-csvs/20-2001RL_CTDBTL_001-104D.csv","20-2001RL_CTDFinalQC/db-csvs/20-2001RL_CTDBTL_001-104U.csv","20-2007SR_CTDFinalQC/20-2007SR_CTDFinalQC/db-csvs/20-2007SR_CTDBTL_001-075D.csv","20-2007SR_CTDFinalQC/20-2007SR_CTDFinalQC/db-csvs/20-2007SR_CTDBTL_001-075U.csv","20-2010SR_CTDFinalQC/20-2010SR_CTDFinalQC/20-2010SR_CTDFinalQC/db-csvs/20-2010SR_CTDBTL_001-071D.csv","20-2010SR_CTDFinalQC/20-2010SR_CTDFinalQC/20-2010SR_CTDFinalQC/db-csvs/20-2010SR_CTDBTL_001-071U.csv","20-2101RL_CTDFinalQC/20-2101RL_CTDFinalQC/db-csvs/20-2101RL_CTDBTL_001-078D.csv","20-2101RL_CTDFinalQC/20-2101RL_CTDFinalQC/db-csvs/20-2101RL_CTDBTL_001-078U.csv","20-2105SH_CTDFinalQC/db-csvs/20-2105SH_CTDBTL_001-044D.csv","20-2105SH_CTDFinalQC/db-csvs/20-2105SH_CTDBTL_001-044U.csv","20-2107SR_CTDPrelim/db-csvs/20-2107SR_CTDBTL_001-071D.csv","20-2107SR_CTDPrelim/db-csvs/20-2107SR_CTDBTL_001-071U.csv","20-2111SR_CTDPrelim/20-2111SRCTDPrelim/csvs-plots/20-2111SR_CTDBTL_001-075D.csv","20-2111SR_CTDPrelim/20-2111SRCTDPrelim/csvs-plots/20-2111SR_CTDBTL_001-075U.csv","20-2204SH_CTDPrelim/db-csvs/20-2204SH_CTDBTL_001-101D.csv","20-2204SH_CTDPrelim/db-csvs/20-2204SH_CTDBTL_001-101U.csv","20-2208BH_CTDPrelim/db-csvs/20-2208BH_CTDBTL_001-067D.csv","20-2208BH_CTDPrelim/db-csvs/20-2208BH_CTDBTL_001-067U.csv","20-2211SR_CTDPrelim/db-csvs/20-2211_CTDBTL_001-073D.csv","20-2211SR_CTDPrelim/db-csvs/20-2211_CTDBTL_001-073U.csv","20-2301RL_CTDPrelim/db-csvs/20-2301RL_CTDBTL_001-072D.csv","20-2301RL_CTDPrelim/db-csvs/20-2301RL_CTDBTL_001-072U.csv","20-2304SH_CTDPrelim/db-csvs/20-2304SH_CTDBTL_001-114D.csv","20-2304SH_CTDPrelim/db-csvs/20-2304SH_CTDBTL_001-114U.csv","20-2307SR_CTDPrelim/db-csvs/20-2307SR_CTDBTL_001-056D.csv","20-2307SR_CTDPrelim/db-csvs/20-2307SR_CTDBTL_001-056U.csv","20-2307SR_CTDPrelim/db-csvs/20-2307SR_CTDBTL_057-069D.csv","20-2307SR_CTDPrelim/db-csvs/20-2307SR_CTDBTL_057-069U.csv","20-2311SR_CTDPrelim/db-csvs/20-2311SR_CTDBTL_001-050D.csv","20-2311SR_CTDPrelim/db-csvs/20-2311SR_CTDBTL_001-050U.csv","20-2311SR_CTDPrelim/db-csvs/20-2311SR_CTDBTL_051-075D.csv","20-2311SR_CTDPrelim/db-csvs/20-2311SR_CTDBTL_051-075U.csv","20-2401RL_CTDPrelim/20-2401RL_CTDPrelim/db_csvs/20-2401RL_CTDBTL_001-016D.csv","20-2401RL_CTDPrelim/20-2401RL_CTDPrelim/db_csvs/20-2401RL_CTDBTL_001-016U.csv","20-2401RL_CTDPrelim/20-2401RL_CTDPrelim/db_csvs/20-2401RL_CTDBTL_017-033D.csv","20-2401RL_CTDPrelim/20-2401RL_CTDPrelim/db_csvs/20-2401RL_CTDBTL_017-033U.csv","20-2404SH_CTDPrelim/db-csvs/20-2404SH_CTDBTL_001-116D.csv","20-2404SH_CTDPrelim/db-csvs/20-2404SH_CTDBTL_001-116U.csv","20-2408SR_CTDPrelim/db-csvs/20-2408SR_CTDBTL_001-075D.csv","20-2408SR_CTDPrelim/db-csvs/20-2408SR_CTDBTL_001-075U.csv","20-2411SR_CTDPrelim/db-csvs/20-2411SR_CTDBTL_001-048D.csv","20-2411SR_CTDPrelim/db-csvs/20-2411SR_CTDBTL_001-048U.csv","20-2501RL_CTDPrelim/db-csvs/20-2501RL_CTDBTL_001-116D.csv","20-2501RL_CTDPrelim/db-csvs/20-2501RL_CTDBTL_001-116U.csv","20-2502RL_CTDPrelim/db-csvs/20-2502RL_CTDBTL_001-003D.csv","20-2502RL_CTDPrelim/db-csvs/20-2502RL_CTDBTL_001-003U.csv","20-2504SH_CTDPrelim/db-csvs/20-2504SH_CTDBTL_001-116D.csv","20-2504SH_CTDPrelim/db-csvs/20-2504SH_CTDBTL_001-116U.csv","20-2507SR_CTDPrelim/20-2507_CTD_001-055D.csv","20-2507SR_CTDPrelim/20-2507_CTD_001-055U.csv","19-9802JD_CTDFinalQC/db_csv/19-9802JD_CTDBTL_001-066D.csv","19-9802JD_CTDFinalQC/db_csv/19-9802JD_CTDBTL_001-066U.csv","19-9804JD_CTDFinalQC/db_csv/19-9804JD_CTDBTL_001-085D.csv","19-9804JD_CTDFinalQC/db_csv/19-9804JD_CTDBTL_001-085U.csv","19-9804JD_CTDFinalQC/db_csv/separate/20-9804JD_CTDBTL_001-050D.csv","19-9804JD_CTDFinalQC/db_csv/separate/20-9804JD_CTDBTL_001-050U.csv","19-9804JD_CTDFinalQC/db_csv/separate/20-9804JD_CTDBTL_051-085D.csv","19-9804JD_CTDFinalQC/db_csv/separate/20-9804JD_CTDBTL_051-085U.csv","19-9807NH_CTDFinalQC/db_csv/20-9807NH_CTDBTL_001-070D.csv","19-9807NH_CTDFinalQC/db_csv/20-9807NH_CTDBTL_001-070U.csv"],["20-0302JD_CTDBTL_001-100D.csv","20-0302JD_CTDBTL_001-100U.csv","20-0302JD_CTDBTL_001-073ID.csv","20-0302JD_CTDBTL_001-073IU.csv","20-0302JD_CTDBTL_074-100ID.csv","20-0302JD_CTDBTL_074-100IU.csv","20-0307NH_CTDBTL_001-526ID.csv","20-0307NH_CTDBTL_001-526IU.csv","20-0307NH_CTDBTL_044-060ID.csv","20-0307NH_CTDBTL_044-060IU.csv","20-0310NH_CTDBTL_001-066D.csv","20-0310NH_CTDBTL_001-066U.csv","20-0401JD_CTDBTL_001-098ID.csv","20-0401JD_CTDBTL_001-098IU.csv","20-0404JD_CTDBTL_067-094ID.csv","20-0404JD_CTDBTL_067-094IU.csv","20-0404NH_CTDBTL_001-066ID.csv","20-0404NH_CTDBTL_001-066IU.csv","20-0407JD_CTDBTL_001-012ID.csv","20-0407JD_CTDBTL_001-012IU.csv","20-0407JD_CTDBTL_013-074ID.csv","20-0407JD_CTDBTL_013-074IU.csv","20-0407JD_CTDBTL_001-002ID.csv","20-0407JD_CTDBTL_001-002IU.csv","20-0407JD_CTDBTL_003-012ID.csv","20-0407JD_CTDBTL_003-012IU.csv","20-0407JD_CTDBTL_013-028ID.csv","20-0407JD_CTDBTL_013-028IU.csv","20-0407JD_CTDBTL_029-039ID.csv","20-0407JD_CTDBTL_029-039IU.csv","20-0407JD_CTDBTL_040-074ID.csv","20-0407JD_CTDBTL_040-074IU.csv","20-0411RR_CTDBTL_001-965ID.csv","20-0411RR_CTDBTL_001-965IU.csv","20-0501NH_CTDBTL_001-075D.csv","20-0501NH_CTDBTL_001-075U.csv","20-0504NH_CTDBTL_001-075D.csv","20-0504NH_CTDBTL_001-075U.csv","20-0507NH_CTDBTL_001-075D.csv","20-0507NH_CTDBTL_001-075U.csv","20-0511NH_CTDBTL_001-072D.csv","20-0511NH_CTDBTL_001-072U.csv","20-0602JD_CTDBTL_001-096D.csv","20-0602JD_CTDBTL_001-096U.csv","20-0604NH_CTDBTL_001-563ID.csv","20-0604NH_CTDBTL_001-563IU.csv","20-0607NH_CTDBTL_001-074ID.csv","20-0607NH_CTDBTL_001-074IU.csv","20-0610RR_CTDBTL_001-567D.csv","20-0610RR_CTDBTL_001-567U.csv","20-0701JD_CTDBTL_001-084D.csv","20-0701JD_CTDBTL_001-084IDnoQC.csv","20-0701JD_CTDBTL_001-084IUnoQC.csv","20-0701JD_CTDBTL_001-084U.csv","20-0704JD_CTDBTL_001-555ID.csv","20-0704JD_CTDBTL_001-555IU.csv","20-0707NH_CTDBTL_001-073ID.csv","20-0707NH_CTDBTL_001-073IU.csv","20-0707NH_CTDBTL_001-012ID.csv","20-0707NH_CTDBTL_001-012IU.csv","20-0707NH_CTDBTL_013-046ID.csv","20-0707NH_CTDBTL_013-046IU.csv","20-0707NH_CTDBTL_047-073ID.csv","20-0707NH_CTDBTL_047-073IU.csv","20-0711_CTDBTL_001-067Dno001b.csv","20-0711_CTDBTL_001-067ID.csv","20-0711_CTDBTL_001-067IU.csv","20-0711_CTDBTL_001-067Uno001b.csv","20-0801JD_CTDBTL_001-545ID.csv","20-0801JD_CTDBTL_001-545IU.csv","20-0801_CTDBTL_001-545D.csv","20-0801_CTDBTL_001-545ID.csv","20-0801_CTDBTL_001-545IU.csv","20-0801_CTDBTL_001-545U.csv","20-0804JD_CTDBTL_001-177ID.csv","20-0804JD_CTDBTL_001-177IU.csv","20-0808_CTDBTL_001-069D.csv","20-0808_CTDBTL_001-069U.csv","20-0810NH_CTDBTL_001-073ID.csv","20-0810NH_CTDBTL_001-073IU.csv","20-0901NH_CTDBTL_001-075ID.csv","20-0901NH_CTDBTL_001-075IU.csv","20-0903JD_CTDBTL_001-071ID.csv","20-0903JD_CTDBTL_001-071IU.csv","20-0907M2_CTDBTL_001-961ID.csv","20-0907M2_CTDBTL_001-961IU.csv","20-0911NH_CTDBTL_001-075ID.csv","20-0911NH_CTDBTL_001-075IU.csv","20-1001NH_CTDBTL_001-093D.csv","20-1001NH_CTDBTL_001-093U.csv","20-1004MF_CTDBTL_123-682ID.csv","20-1004MF_CTDBTL_123-682IU.csv","20-1008NH_CTDBTL_001-075ID.csv","20-1008NH_CTDBTL_001-075IU.csv","20-1011NH_CTDBTL_001-067ID.csv","20-1011NH_CTDBTL_001-067IU.csv","20-1101NH_CTDBTL_001-106D.csv","20-1101NH_CTDBTL_001-106U.csv","20-1104SH_CTDBTL_037-114ID.csv","20-1104SH_CTDBTL_037-114IU.csv","20-1104SH_CTDBTL_031-035ID.csv","20-1104SH_CTDBTL_031-035IU.csv","20-1104SH_CTDBTL_031-114ID.csv","20-1104SH_CTDBTL_031-114IU.csv","20-1104SH_CTDBTL_036-036ID.csv","20-1104SH_CTDBTL_036-036IU.csv","20-1108NH_CTDBTL_001-072ID.csv","20-1108NH_CTDBTL_001-072IU.csv","20-1110NH_CTDBTL_001-666ID.csv","20-1110NH_CTDBTL_001-666IU.csv","20-1202NH_CTDBTL_001-075D.csv","20-1202NH_CTDBTL_001-075U.csv","20-1203SH_CTDBTL_001-057D.csv","20-1203SH_CTDBTL_001-057U.csv","20-1207OS_CTDBTL_001-075D.csv","20-1207OS_CTDBTL_001-075U.csv","20-1210NH_CTDBTL_001-075D.csv","20-1210NH_CTDBTL_001-075U.csv","20-1301SH_CTDBTL_001-090D.csv","20-1301SH_CTDBTL_001-090U.csv","20-1304SH_CTDBTL_001-109D.csv","20-1304SH_CTDBTL_001-109U.csv","20-1307NH_CTDBTL_001-074D.csv","20-1307NH_CTDBTL_001-074U.csv","20-1311NH_CTDBTL_001-521D.csv","20-1311NH_CTDBTL_001-521U.csv","20-1402SH_CTDBTL_001-036D.csv","20-1402SH_CTDBTL_001-036U.csv","20-1404OS_CTDBTL_001-070D.csv","20-1404OS_CTDBTL_001-070U.csv","20-1407NH_CTDBTL_001-075D.csv","20-1407NH_CTDBTL_001-075U.csv","20-1411NH_CTDBTL_001-076D.csv","20-1411NH_CTDBTL_001-076U.csv","20-1501NH_CTDBTL_001-100D.csv","20-1501NH_CTDBTL_001-100U.csv","20-1501NH_CTDBTL_001-064D.csv","20-1501NH_CTDBTL_001-064U.csv","20-1501NH_CTDBTL_004-100D.csv","20-1501NH_CTDBTL_004-100U.csv","20-1504NH_CTDBTL_001-070D.csv","20-1504NH_CTDBTL_001-070U.csv","20-1507OC_CTDBTL_001-071D.csv","20-1507OC_CTDBTL_001-071U.csv","20-1511OC_CTDBTL_001-070D.csv","20-1511OC_CTDBTL_001-070U.csv","20-1601RL_CTDBTL_001-104D.csv","20-1601RL_CTDBTL_001-104U.csv","20-1604SH_CTDBTL_001-101D.csv","20-1604SH_CTDBTL_001-101U.csv","20-1607OS_CTDBTL_001-068D.csv","20-1607OS_CTDBTL_001-068U.csv","20-1611SR_CTDBTL_001-075D.csv","20-1611SR_CTDBTL_001-075U.csv","20-1701RL_CTDBTL_001-083D.csv","20-1701RL_CTDBTL_001-083U.csv","20-1701RL_CTDBTL_001-020D.csv","20-1701RL_CTDBTL_001-020U.csv","20-1701RL_CTDBTL_021-083D.csv","20-1701RL_CTDBTL_021-083U.csv","20-1704SH_CTDBTL_001-104D.csv","20-1704SH_CTDBTL_001-104U.csv","20-1704SH_CTDBTL_001-040D.csv","20-1704SH_CTDBTL_001-040U.csv","20-1704SH_CTDBTL_041-104D.csv","20-1704SH_CTDBTL_041-104U.csv","20-1708SR_CTDBTL_001-073D.csv","20-1708SR_CTDBTL_001-073U.csv","20-1711SR_CTDBTL_001-074D.csv","20-1711SR_CTDBTL_001-074U.csv","20-1802SH_CTDBTL_001-045D.csv","20-1802SH_CTDBTL_001-045U.csv","20-1804SH_CTDBTL_001-103D.csv","20-1804SH_CTDBTL_001-103U.csv","20-1806SR_CTDBTL_001-072D.csv","20-1806SR_CTDBTL_001-072U.csv","20-1810SR_CTDBTL_001-074D.csv","20-1810SR_CTDBTL_001-074U.csv","20-1902RL_CTDBTL_001-029D.csv","20-1902RL_CTDBTL_001-029U.csv","20-1904RL_CTDBTL_001-069D.csv","20-1904RL_CTDBTL_001-069U.csv","20-1907BH_CTDBTL_001-070D.csv","20-1907BH_CTDBTL_001-070U.csv","20-1911OC_CTDBTL_001-075D.csv","20-1911OC_CTDBTL_001-075U.csv","20-2001RL_CTDBTL_001-104D.csv","20-2001RL_CTDBTL_001-104U.csv","20-2007SR_CTDBTL_001-075D.csv","20-2007SR_CTDBTL_001-075U.csv","20-2010SR_CTDBTL_001-071D.csv","20-2010SR_CTDBTL_001-071U.csv","20-2101RL_CTDBTL_001-078D.csv","20-2101RL_CTDBTL_001-078U.csv","20-2105SH_CTDBTL_001-044D.csv","20-2105SH_CTDBTL_001-044U.csv","20-2107SR_CTDBTL_001-071D.csv","20-2107SR_CTDBTL_001-071U.csv","20-2111SR_CTDBTL_001-075D.csv","20-2111SR_CTDBTL_001-075U.csv","20-2204SH_CTDBTL_001-101D.csv","20-2204SH_CTDBTL_001-101U.csv","20-2208BH_CTDBTL_001-067D.csv","20-2208BH_CTDBTL_001-067U.csv","20-2211_CTDBTL_001-073D.csv","20-2211_CTDBTL_001-073U.csv","20-2301RL_CTDBTL_001-072D.csv","20-2301RL_CTDBTL_001-072U.csv","20-2304SH_CTDBTL_001-114D.csv","20-2304SH_CTDBTL_001-114U.csv","20-2307SR_CTDBTL_001-056D.csv","20-2307SR_CTDBTL_001-056U.csv","20-2307SR_CTDBTL_057-069D.csv","20-2307SR_CTDBTL_057-069U.csv","20-2311SR_CTDBTL_001-050D.csv","20-2311SR_CTDBTL_001-050U.csv","20-2311SR_CTDBTL_051-075D.csv","20-2311SR_CTDBTL_051-075U.csv","20-2401RL_CTDBTL_001-016D.csv","20-2401RL_CTDBTL_001-016U.csv","20-2401RL_CTDBTL_017-033D.csv","20-2401RL_CTDBTL_017-033U.csv","20-2404SH_CTDBTL_001-116D.csv","20-2404SH_CTDBTL_001-116U.csv","20-2408SR_CTDBTL_001-075D.csv","20-2408SR_CTDBTL_001-075U.csv","20-2411SR_CTDBTL_001-048D.csv","20-2411SR_CTDBTL_001-048U.csv","20-2501RL_CTDBTL_001-116D.csv","20-2501RL_CTDBTL_001-116U.csv","20-2502RL_CTDBTL_001-003D.csv","20-2502RL_CTDBTL_001-003U.csv","20-2504SH_CTDBTL_001-116D.csv","20-2504SH_CTDBTL_001-116U.csv","20-2507_CTD_001-055D.csv","20-2507_CTD_001-055U.csv","19-9802JD_CTDBTL_001-066D.csv","19-9802JD_CTDBTL_001-066U.csv","19-9804JD_CTDBTL_001-085D.csv","19-9804JD_CTDBTL_001-085U.csv","20-9804JD_CTDBTL_001-050D.csv","20-9804JD_CTDBTL_001-050U.csv","20-9804JD_CTDBTL_051-085D.csv","20-9804JD_CTDBTL_051-085U.csv","20-9807NH_CTDBTL_001-070D.csv","20-9807NH_CTDBTL_001-070U.csv"],["20-0302JD_CTDFinalQC","20-0302JD_CTDFinalQC","20-0302JD_CTDFinalQC","20-0302JD_CTDFinalQC","20-0302JD_CTDFinalQC","20-0302JD_CTDFinalQC","20-0307NH_CTDFinalQC","20-0307NH_CTDFinalQC","20-0307NH_CTDFinalQC","20-0307NH_CTDFinalQC","20-0310NH_CTDFinalQC","20-0310NH_CTDFinalQC","20-0401JD_CTDFinalQC","20-0401JD_CTDFinalQC","20-0404NHJD_CTDFinalQC","20-0404NHJD_CTDFinalQC","20-0404NHJD_CTDFinalQC","20-0404NHJD_CTDFinalQC","20-0407JD_CTDFinalQC","20-0407JD_CTDFinalQC","20-0407JD_CTDFinalQC","20-0407JD_CTDFinalQC","20-0407JD_CTDFinalQC","20-0407JD_CTDFinalQC","20-0407JD_CTDFinalQC","20-0407JD_CTDFinalQC","20-0407JD_CTDFinalQC","20-0407JD_CTDFinalQC","20-0407JD_CTDFinalQC","20-0407JD_CTDFinalQC","20-0407JD_CTDFinalQC","20-0407JD_CTDFinalQC","20-0411RR_CTDFinalQC","20-0411RR_CTDFinalQC","20-0501NH_CTDFinalQC","20-0501NH_CTDFinalQC","20-0504NH_CTDFinalQC","20-0504NH_CTDFinalQC","20-0507NH_CTDFinalQC","20-0507NH_CTDFinalQC","20-0511NH_CTDFinalQC","20-0511NH_CTDFinalQC","20-0602JD_CTDFinalQC","20-0602JD_CTDFinalQC","20-0604NH_CTDFinalQC","20-0604NH_CTDFinalQC","20-0607NH_CTDFinalQC","20-0607NH_CTDFinalQC","20-0610RR_CTDFinalQC","20-0610RR_CTDFinalQC","20-0701JD_CTDFinalQC","20-0701JD_CTDFinalQC","20-0701JD_CTDFinalQC","20-0701JD_CTDFinalQC","20-0704JD_CTDFinalQC","20-0704JD_CTDFinalQC","20-0707NH_CTDFinalQC","20-0707NH_CTDFinalQC","20-0707NH_CTDFinalQC","20-0707NH_CTDFinalQC","20-0707NH_CTDFinalQC","20-0707NH_CTDFinalQC","20-0707NH_CTDFinalQC","20-0707NH_CTDFinalQC","20-0711NH_CTDFinalQC","20-0711NH_CTDFinalQC","20-0711NH_CTDFinalQC","20-0711NH_CTDFinalQC","20-0801JD_CTDFinalQC","20-0801JD_CTDFinalQC","20-0801JD_CTDFinalQC","20-0801JD_CTDFinalQC","20-0801JD_CTDFinalQC","20-0801JD_CTDFinalQC","20-0804JD_CTDFinalQC","20-0804JD_CTDFinalQC","20-0808NH_CTDFinalQC","20-0808NH_CTDFinalQC","20-0810NH_CTDFinalQC","20-0810NH_CTDFinalQC","20-0901NH_CTDFinalQC","20-0901NH_CTDFinalQC","20-0903JD_CTDFinalQC","20-0903JD_CTDFinalQC","20-0907M2_CTDFinalQC","20-0907M2_CTDFinalQC","20-0911NH_CTDFinalQC","20-0911NH_CTDFinalQC","20-1001NH_CTDFinalQC","20-1001NH_CTDFinalQC","20-1004MF_CTDFinalQC","20-1004MF_CTDFinalQC","20-1008NH_CTDFinalQC","20-1008NH_CTDFinalQC","20-1011NH_CTDFinalQC","20-1011NH_CTDFinalQC","20-1101NH_CTDFinalQC","20-1101NH_CTDFinalQC","20-1104SH_CTDFinalQC","20-1104SH_CTDFinalQC","20-1104SH_CTDFinalQC","20-1104SH_CTDFinalQC","20-1104SH_CTDFinalQC","20-1104SH_CTDFinalQC","20-1104SH_CTDFinalQC","20-1104SH_CTDFinalQC","20-1108NH_CTDFinalQC","20-1108NH_CTDFinalQC","20-1110NH_CTDFinalQC","20-1110NH_CTDFinalQC","20-1202NH_CTDFinalQC","20-1202NH_CTDFinalQC","20-1203SH_CTDFinalQC","20-1203SH_CTDFinalQC","20-1207OS_CTDFinalQC","20-1207OS_CTDFinalQC","20-1210NH_CTDFinalQC","20-1210NH_CTDFinalQC","20-1301SH_CTDFinalQC","20-1301SH_CTDFinalQC","20-1304SH_CTDFinalQC","20-1304SH_CTDFinalQC","20-1307NH_CTDFinalQC","20-1307NH_CTDFinalQC","20-1311NH_CTDFinalQC","20-1311NH_CTDFinalQC","20-1402SH_CTDFinalQC","20-1402SH_CTDFinalQC","20-1404OS_CTDFinalQC","20-1404OS_CTDFinalQC","20-1407NH_CTDFinalQC","20-1407NH_CTDFinalQC","20-1411NH_CTDFinalQC","20-1411NH_CTDFinalQC","20-1501NH_CTDFinalQC","20-1501NH_CTDFinalQC","20-1501NH_CTDFinalQC","20-1501NH_CTDFinalQC","20-1501NH_CTDFinalQC","20-1501NH_CTDFinalQC","20-1504NH_CTDFinalQC","20-1504NH_CTDFinalQC","20-1507OC_CTDFinalQC","20-1507OC_CTDFinalQC","20-1511OC_CTDFinalQC","20-1511OC_CTDFinalQC","20-1601RL_CTDFinalQC","20-1601RL_CTDFinalQC","20-1604SH_CTDFinalQC","20-1604SH_CTDFinalQC","20-1607OS_CTDFinalQC","20-1607OS_CTDFinalQC","20-1611SR_CTDFinalQC","20-1611SR_CTDFinalQC","20-1701RL_CTDFinalQC","20-1701RL_CTDFinalQC","20-1701RL_CTDFinalQC","20-1701RL_CTDFinalQC","20-1701RL_CTDFinalQC","20-1701RL_CTDFinalQC","20-1704SH_CTDFinalQC","20-1704SH_CTDFinalQC","20-1704SH_CTDFinalQC","20-1704SH_CTDFinalQC","20-1704SH_CTDFinalQC","20-1704SH_CTDFinalQC","20-1708SR_CTDFinalQC","20-1708SR_CTDFinalQC","20-1711SR_CTDFinalQC","20-1711SR_CTDFinalQC","20-1802SH_CTDFinalQC","20-1802SH_CTDFinalQC","20-1804SH_CTDFinalQC","20-1804SH_CTDFinalQC","20-1806SR_CTDFinalQC","20-1806SR_CTDFinalQC","20-1810SR_CTDFinalQC","20-1810SR_CTDFinalQC","20-1902RL_CTDFinalQC","20-1902RL_CTDFinalQC","20-1904RL_CTDFinalQC","20-1904RL_CTDFinalQC","20-1907BH_CTDFinalQC","20-1907BH_CTDFinalQC","20-1911OC_CTDFinalQC","20-1911OC_CTDFinalQC","20-2001RL_CTDFinalQC","20-2001RL_CTDFinalQC","20-2007SR_CTDFinalQC","20-2007SR_CTDFinalQC","20-2010SR_CTDFinalQC","20-2010SR_CTDFinalQC","20-2101RL_CTDFinalQC","20-2101RL_CTDFinalQC","20-2105SH_CTDFinalQC","20-2105SH_CTDFinalQC","20-2107SR_CTDPrelim","20-2107SR_CTDPrelim","20-2111SR_CTDPrelim","20-2111SR_CTDPrelim","20-2204SH_CTDPrelim","20-2204SH_CTDPrelim","20-2208BH_CTDPrelim","20-2208BH_CTDPrelim","20-2211SR_CTDPrelim","20-2211SR_CTDPrelim","20-2301RL_CTDPrelim","20-2301RL_CTDPrelim","20-2304SH_CTDPrelim","20-2304SH_CTDPrelim","20-2307SR_CTDPrelim","20-2307SR_CTDPrelim","20-2307SR_CTDPrelim","20-2307SR_CTDPrelim","20-2311SR_CTDPrelim","20-2311SR_CTDPrelim","20-2311SR_CTDPrelim","20-2311SR_CTDPrelim","20-2401RL_CTDPrelim","20-2401RL_CTDPrelim","20-2401RL_CTDPrelim","20-2401RL_CTDPrelim","20-2404SH_CTDPrelim","20-2404SH_CTDPrelim","20-2408SR_CTDPrelim","20-2408SR_CTDPrelim","20-2411SR_CTDPrelim","20-2411SR_CTDPrelim","20-2501RL_CTDPrelim","20-2501RL_CTDPrelim","20-2502RL_CTDPrelim","20-2502RL_CTDPrelim","20-2504SH_CTDPrelim","20-2504SH_CTDPrelim","20-2507SR_CTDPrelim","20-2507SR_CTDPrelim","19-9802JD_CTDFinalQC","19-9802JD_CTDFinalQC","19-9804JD_CTDFinalQC","19-9804JD_CTDFinalQC","19-9804JD_CTDFinalQC","19-9804JD_CTDFinalQC","19-9804JD_CTDFinalQC","19-9804JD_CTDFinalQC","19-9807NH_CTDFinalQC","19-9807NH_CTDFinalQC"],["final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","final","final","final","final","final","final","final","final","final","final"],["D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D",null,null,"U","D","U","D","U","D","U","D","U","D","U",null,"D","U",null,"D","U","D","D","U","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U"],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>cruise_id<\/th>\n      <th>path_unzip<\/th>\n      <th>file_csv<\/th>\n      <th>dir_unzip<\/th>\n      <th>data_stage<\/th>\n      <th>cast_dir<\/th>\n      <th>priority<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":7},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"cruise_id","targets":1},{"name":"path_unzip","targets":2},{"name":"file_csv","targets":3},{"name":"dir_unzip","targets":4},{"name":"data_stage","targets":5},{"name":"cast_dir","targets":6},{"name":"priority","targets":7}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="read-and-standardize-ctd-files" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="read-and-standardize-ctd-files"><span class="header-section-number">6</span> Read and Standardize CTD Files</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read and combine all files (both upcast and downcast)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>d_csv <span class="ot">&lt;-</span> d_csv <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">basename</span>(path)) <span class="sc">|&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">map2</span>(path, <span class="fu">seq_along</span>(path), \(path, idx) {</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Reading {idx}/{nrow(d_csv)}: {basename(path)}"</span>))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>      <span class="co"># detect repeat header rows and skip them</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>      <span class="co"># eg line 69 of '20-0711NH_CTDFinalQC/db-csvs/20-0711_CTDBTL_001-067Dno001b.csv'</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Read all lines to detect repeat headers</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>      all_lines <span class="ot">&lt;-</span> <span class="fu">read_lines</span>(path)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>      header_line <span class="ot">&lt;-</span> all_lines[<span class="dv">1</span>]</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Find all rows that exactly match the header (excluding the first row)</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>      repeat_header_rows <span class="ot">&lt;-</span> <span class="fu">which</span>(all_lines[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">==</span> header_line)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(repeat_header_rows) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove repeat header rows from the data</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>        all_lines <span class="ot">&lt;-</span> all_lines[<span class="sc">-</span>(repeat_header_rows <span class="sc">+</span> <span class="dv">1</span>)]</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Write cleaned data to temporary file</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>        tmp_file <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">".csv"</span>)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_lines</span>(all_lines, tmp_file)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Read from cleaned file</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>        data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(tmp_file, <span class="at">guess_max =</span> <span class="cn">Inf</span>, <span class="at">show_col_types =</span> F) <span class="sc">|&gt;</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>          <span class="fu">clean_names</span>()</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Clean up</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        <span class="fu">file_delete</span>(tmp_file)</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># No repeat headers, read normally</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>        data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(path, <span class="at">guess_max =</span> <span class="cn">Inf</span>, <span class="at">show_col_types =</span> F) <span class="sc">|&gt;</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>          <span class="fu">clean_names</span>()</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>      data</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>    }),</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add nrows per file to ctd_data</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrows =</span> <span class="fu">map_int</span>(data, <span class="sc">~</span> <span class="cf">if</span> (<span class="fu">is.null</span>(.x)) <span class="dv">0</span> <span class="cf">else</span> <span class="fu">nrow</span>(.x))</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>d_csv <span class="sc">|&gt;</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(cruise_id, file_csv) <span class="sc">|&gt;</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cruise_id, file_csv, nrows) <span class="sc">|&gt;</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Number of rows read per file"</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># big marks for thousands</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatCurrency</span>(<span class="st">"nrows"</span>, <span class="at">currency =</span> <span class="st">""</span>, <span class="at">digits =</span> <span class="dv">0</span>, <span class="at">mark =</span> <span class="st">","</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-cd1d2facb690ef78ce39" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-cd1d2facb690ef78ce39">{"x":{"filter":"none","vertical":false,"caption":"<caption>Number of rows read per file<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246"],["0302JD","0302JD","0302JD","0302JD","0302JD","0302JD","0307NH","0307NH","0307NH","0307NH","0310NH","0310NH","0401JD","0401JD","0404NHJD","0404NHJD","0404NHJD","0404NHJD","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0411RR","0411RR","0501NH","0501NH","0504NH","0504NH","0507NH","0507NH","0511NH","0511NH","0602JD","0602JD","0604NH","0604NH","0607NH","0607NH","0610RR","0610RR","0701JD","0701JD","0701JD","0701JD","0704JD","0704JD","0707NH","0707NH","0707NH","0707NH","0707NH","0707NH","0707NH","0707NH","0711NH","0711NH","0711NH","0711NH","0801JD","0801JD","0801JD","0801JD","0801JD","0801JD","0804JD","0804JD","0808NH","0808NH","0810NH","0810NH","0901NH","0901NH","0903JD","0903JD","0907M2","0907M2","0911NH","0911NH","1001NH","1001NH","1004MF","1004MF","1008NH","1008NH","1011NH","1011NH","1101NH","1101NH","1104SH","1104SH","1104SH","1104SH","1104SH","1104SH","1104SH","1104SH","1108NH","1108NH","1110NH","1110NH","1202NH","1202NH","1203SH","1203SH","1207OS","1207OS","1210NH","1210NH","1301SH","1301SH","1304SH","1304SH","1307NH","1307NH","1311NH","1311NH","1402SH","1402SH","1404OS","1404OS","1407NH","1407NH","1411NH","1411NH","1501NH","1501NH","1501NH","1501NH","1501NH","1501NH","1504NH","1504NH","1507OC","1507OC","1511OC","1511OC","1601RL","1601RL","1604SH","1604SH","1607OS","1607OS","1611SR","1611SR","1701RL","1701RL","1701RL","1701RL","1701RL","1701RL","1704SH","1704SH","1704SH","1704SH","1704SH","1704SH","1708SR","1708SR","1711SR","1711SR","1802SH","1802SH","1804SH","1804SH","1806SR","1806SR","1810SR","1810SR","1902RL","1902RL","1904RL","1904RL","1907BH","1907BH","1911OC","1911OC","2001RL","2001RL","2007SR","2007SR","2010SR","2010SR","2101RL","2101RL","2105SH","2105SH","2107SR","2107SR","2111SR","2111SR","2204SH","2204SH","2208BH","2208BH","2211SR","2211SR","2301RL","2301RL","2304SH","2304SH","2307SR","2307SR","2307SR","2307SR","2311SR","2311SR","2311SR","2311SR","2401RL","2401RL","2401RL","2401RL","2404SH","2404SH","2408SR","2408SR","2411SR","2411SR","2501RL","2501RL","2502RL","2502RL","2504SH","2504SH","2507SR","2507SR","9802JD","9802JD","9804JD","9804JD","9804JD","9804JD","9804JD","9804JD","9807NH","9807NH"],["20-0302JD_CTDBTL_001-073ID.csv","20-0302JD_CTDBTL_001-073IU.csv","20-0302JD_CTDBTL_001-100D.csv","20-0302JD_CTDBTL_001-100U.csv","20-0302JD_CTDBTL_074-100ID.csv","20-0302JD_CTDBTL_074-100IU.csv","20-0307NH_CTDBTL_001-526ID.csv","20-0307NH_CTDBTL_001-526IU.csv","20-0307NH_CTDBTL_044-060ID.csv","20-0307NH_CTDBTL_044-060IU.csv","20-0310NH_CTDBTL_001-066D.csv","20-0310NH_CTDBTL_001-066U.csv","20-0401JD_CTDBTL_001-098ID.csv","20-0401JD_CTDBTL_001-098IU.csv","20-0404JD_CTDBTL_067-094ID.csv","20-0404JD_CTDBTL_067-094IU.csv","20-0404NH_CTDBTL_001-066ID.csv","20-0404NH_CTDBTL_001-066IU.csv","20-0407JD_CTDBTL_001-002ID.csv","20-0407JD_CTDBTL_001-002IU.csv","20-0407JD_CTDBTL_001-012ID.csv","20-0407JD_CTDBTL_001-012IU.csv","20-0407JD_CTDBTL_003-012ID.csv","20-0407JD_CTDBTL_003-012IU.csv","20-0407JD_CTDBTL_013-028ID.csv","20-0407JD_CTDBTL_013-028IU.csv","20-0407JD_CTDBTL_013-074ID.csv","20-0407JD_CTDBTL_013-074IU.csv","20-0407JD_CTDBTL_029-039ID.csv","20-0407JD_CTDBTL_029-039IU.csv","20-0407JD_CTDBTL_040-074ID.csv","20-0407JD_CTDBTL_040-074IU.csv","20-0411RR_CTDBTL_001-965ID.csv","20-0411RR_CTDBTL_001-965IU.csv","20-0501NH_CTDBTL_001-075D.csv","20-0501NH_CTDBTL_001-075U.csv","20-0504NH_CTDBTL_001-075D.csv","20-0504NH_CTDBTL_001-075U.csv","20-0507NH_CTDBTL_001-075D.csv","20-0507NH_CTDBTL_001-075U.csv","20-0511NH_CTDBTL_001-072D.csv","20-0511NH_CTDBTL_001-072U.csv","20-0602JD_CTDBTL_001-096D.csv","20-0602JD_CTDBTL_001-096U.csv","20-0604NH_CTDBTL_001-563ID.csv","20-0604NH_CTDBTL_001-563IU.csv","20-0607NH_CTDBTL_001-074ID.csv","20-0607NH_CTDBTL_001-074IU.csv","20-0610RR_CTDBTL_001-567D.csv","20-0610RR_CTDBTL_001-567U.csv","20-0701JD_CTDBTL_001-084D.csv","20-0701JD_CTDBTL_001-084IDnoQC.csv","20-0701JD_CTDBTL_001-084IUnoQC.csv","20-0701JD_CTDBTL_001-084U.csv","20-0704JD_CTDBTL_001-555ID.csv","20-0704JD_CTDBTL_001-555IU.csv","20-0707NH_CTDBTL_001-012ID.csv","20-0707NH_CTDBTL_001-012IU.csv","20-0707NH_CTDBTL_001-073ID.csv","20-0707NH_CTDBTL_001-073IU.csv","20-0707NH_CTDBTL_013-046ID.csv","20-0707NH_CTDBTL_013-046IU.csv","20-0707NH_CTDBTL_047-073ID.csv","20-0707NH_CTDBTL_047-073IU.csv","20-0711_CTDBTL_001-067Dno001b.csv","20-0711_CTDBTL_001-067ID.csv","20-0711_CTDBTL_001-067IU.csv","20-0711_CTDBTL_001-067Uno001b.csv","20-0801JD_CTDBTL_001-545ID.csv","20-0801JD_CTDBTL_001-545IU.csv","20-0801_CTDBTL_001-545D.csv","20-0801_CTDBTL_001-545ID.csv","20-0801_CTDBTL_001-545IU.csv","20-0801_CTDBTL_001-545U.csv","20-0804JD_CTDBTL_001-177ID.csv","20-0804JD_CTDBTL_001-177IU.csv","20-0808_CTDBTL_001-069D.csv","20-0808_CTDBTL_001-069U.csv","20-0810NH_CTDBTL_001-073ID.csv","20-0810NH_CTDBTL_001-073IU.csv","20-0901NH_CTDBTL_001-075ID.csv","20-0901NH_CTDBTL_001-075IU.csv","20-0903JD_CTDBTL_001-071ID.csv","20-0903JD_CTDBTL_001-071IU.csv","20-0907M2_CTDBTL_001-961ID.csv","20-0907M2_CTDBTL_001-961IU.csv","20-0911NH_CTDBTL_001-075ID.csv","20-0911NH_CTDBTL_001-075IU.csv","20-1001NH_CTDBTL_001-093D.csv","20-1001NH_CTDBTL_001-093U.csv","20-1004MF_CTDBTL_123-682ID.csv","20-1004MF_CTDBTL_123-682IU.csv","20-1008NH_CTDBTL_001-075ID.csv","20-1008NH_CTDBTL_001-075IU.csv","20-1011NH_CTDBTL_001-067ID.csv","20-1011NH_CTDBTL_001-067IU.csv","20-1101NH_CTDBTL_001-106D.csv","20-1101NH_CTDBTL_001-106U.csv","20-1104SH_CTDBTL_031-035ID.csv","20-1104SH_CTDBTL_031-035IU.csv","20-1104SH_CTDBTL_031-114ID.csv","20-1104SH_CTDBTL_031-114IU.csv","20-1104SH_CTDBTL_036-036ID.csv","20-1104SH_CTDBTL_036-036IU.csv","20-1104SH_CTDBTL_037-114ID.csv","20-1104SH_CTDBTL_037-114IU.csv","20-1108NH_CTDBTL_001-072ID.csv","20-1108NH_CTDBTL_001-072IU.csv","20-1110NH_CTDBTL_001-666ID.csv","20-1110NH_CTDBTL_001-666IU.csv","20-1202NH_CTDBTL_001-075D.csv","20-1202NH_CTDBTL_001-075U.csv","20-1203SH_CTDBTL_001-057D.csv","20-1203SH_CTDBTL_001-057U.csv","20-1207OS_CTDBTL_001-075D.csv","20-1207OS_CTDBTL_001-075U.csv","20-1210NH_CTDBTL_001-075D.csv","20-1210NH_CTDBTL_001-075U.csv","20-1301SH_CTDBTL_001-090D.csv","20-1301SH_CTDBTL_001-090U.csv","20-1304SH_CTDBTL_001-109D.csv","20-1304SH_CTDBTL_001-109U.csv","20-1307NH_CTDBTL_001-074D.csv","20-1307NH_CTDBTL_001-074U.csv","20-1311NH_CTDBTL_001-521D.csv","20-1311NH_CTDBTL_001-521U.csv","20-1402SH_CTDBTL_001-036D.csv","20-1402SH_CTDBTL_001-036U.csv","20-1404OS_CTDBTL_001-070D.csv","20-1404OS_CTDBTL_001-070U.csv","20-1407NH_CTDBTL_001-075D.csv","20-1407NH_CTDBTL_001-075U.csv","20-1411NH_CTDBTL_001-076D.csv","20-1411NH_CTDBTL_001-076U.csv","20-1501NH_CTDBTL_001-064D.csv","20-1501NH_CTDBTL_001-064U.csv","20-1501NH_CTDBTL_001-100D.csv","20-1501NH_CTDBTL_001-100U.csv","20-1501NH_CTDBTL_004-100D.csv","20-1501NH_CTDBTL_004-100U.csv","20-1504NH_CTDBTL_001-070D.csv","20-1504NH_CTDBTL_001-070U.csv","20-1507OC_CTDBTL_001-071D.csv","20-1507OC_CTDBTL_001-071U.csv","20-1511OC_CTDBTL_001-070D.csv","20-1511OC_CTDBTL_001-070U.csv","20-1601RL_CTDBTL_001-104D.csv","20-1601RL_CTDBTL_001-104U.csv","20-1604SH_CTDBTL_001-101D.csv","20-1604SH_CTDBTL_001-101U.csv","20-1607OS_CTDBTL_001-068D.csv","20-1607OS_CTDBTL_001-068U.csv","20-1611SR_CTDBTL_001-075D.csv","20-1611SR_CTDBTL_001-075U.csv","20-1701RL_CTDBTL_001-020D.csv","20-1701RL_CTDBTL_001-020U.csv","20-1701RL_CTDBTL_001-083D.csv","20-1701RL_CTDBTL_001-083U.csv","20-1701RL_CTDBTL_021-083D.csv","20-1701RL_CTDBTL_021-083U.csv","20-1704SH_CTDBTL_001-040D.csv","20-1704SH_CTDBTL_001-040U.csv","20-1704SH_CTDBTL_001-104D.csv","20-1704SH_CTDBTL_001-104U.csv","20-1704SH_CTDBTL_041-104D.csv","20-1704SH_CTDBTL_041-104U.csv","20-1708SR_CTDBTL_001-073D.csv","20-1708SR_CTDBTL_001-073U.csv","20-1711SR_CTDBTL_001-074D.csv","20-1711SR_CTDBTL_001-074U.csv","20-1802SH_CTDBTL_001-045D.csv","20-1802SH_CTDBTL_001-045U.csv","20-1804SH_CTDBTL_001-103D.csv","20-1804SH_CTDBTL_001-103U.csv","20-1806SR_CTDBTL_001-072D.csv","20-1806SR_CTDBTL_001-072U.csv","20-1810SR_CTDBTL_001-074D.csv","20-1810SR_CTDBTL_001-074U.csv","20-1902RL_CTDBTL_001-029D.csv","20-1902RL_CTDBTL_001-029U.csv","20-1904RL_CTDBTL_001-069D.csv","20-1904RL_CTDBTL_001-069U.csv","20-1907BH_CTDBTL_001-070D.csv","20-1907BH_CTDBTL_001-070U.csv","20-1911OC_CTDBTL_001-075D.csv","20-1911OC_CTDBTL_001-075U.csv","20-2001RL_CTDBTL_001-104D.csv","20-2001RL_CTDBTL_001-104U.csv","20-2007SR_CTDBTL_001-075D.csv","20-2007SR_CTDBTL_001-075U.csv","20-2010SR_CTDBTL_001-071D.csv","20-2010SR_CTDBTL_001-071U.csv","20-2101RL_CTDBTL_001-078D.csv","20-2101RL_CTDBTL_001-078U.csv","20-2105SH_CTDBTL_001-044D.csv","20-2105SH_CTDBTL_001-044U.csv","20-2107SR_CTDBTL_001-071D.csv","20-2107SR_CTDBTL_001-071U.csv","20-2111SR_CTDBTL_001-075D.csv","20-2111SR_CTDBTL_001-075U.csv","20-2204SH_CTDBTL_001-101D.csv","20-2204SH_CTDBTL_001-101U.csv","20-2208BH_CTDBTL_001-067D.csv","20-2208BH_CTDBTL_001-067U.csv","20-2211_CTDBTL_001-073D.csv","20-2211_CTDBTL_001-073U.csv","20-2301RL_CTDBTL_001-072D.csv","20-2301RL_CTDBTL_001-072U.csv","20-2304SH_CTDBTL_001-114D.csv","20-2304SH_CTDBTL_001-114U.csv","20-2307SR_CTDBTL_001-056D.csv","20-2307SR_CTDBTL_001-056U.csv","20-2307SR_CTDBTL_057-069D.csv","20-2307SR_CTDBTL_057-069U.csv","20-2311SR_CTDBTL_001-050D.csv","20-2311SR_CTDBTL_001-050U.csv","20-2311SR_CTDBTL_051-075D.csv","20-2311SR_CTDBTL_051-075U.csv","20-2401RL_CTDBTL_001-016D.csv","20-2401RL_CTDBTL_001-016U.csv","20-2401RL_CTDBTL_017-033D.csv","20-2401RL_CTDBTL_017-033U.csv","20-2404SH_CTDBTL_001-116D.csv","20-2404SH_CTDBTL_001-116U.csv","20-2408SR_CTDBTL_001-075D.csv","20-2408SR_CTDBTL_001-075U.csv","20-2411SR_CTDBTL_001-048D.csv","20-2411SR_CTDBTL_001-048U.csv","20-2501RL_CTDBTL_001-116D.csv","20-2501RL_CTDBTL_001-116U.csv","20-2502RL_CTDBTL_001-003D.csv","20-2502RL_CTDBTL_001-003U.csv","20-2504SH_CTDBTL_001-116D.csv","20-2504SH_CTDBTL_001-116U.csv","20-2507_CTD_001-055D.csv","20-2507_CTD_001-055U.csv","19-9802JD_CTDBTL_001-066D.csv","19-9802JD_CTDBTL_001-066U.csv","19-9804JD_CTDBTL_001-085D.csv","19-9804JD_CTDBTL_001-085U.csv","20-9804JD_CTDBTL_001-050D.csv","20-9804JD_CTDBTL_001-050U.csv","20-9804JD_CTDBTL_051-085D.csv","20-9804JD_CTDBTL_051-085U.csv","20-9807NH_CTDBTL_001-070D.csv","20-9807NH_CTDBTL_001-070U.csv"],[31990,32022,42856,42901,10866,10879,26697,26544,1128,1132,29723,29780,46804,47405,15696,15730,29572,29629,71,73,5196,5206,5125,5133,8012,8021,24325,24366,3289,3297,13024,13048,32648,32661,29827,29862,29920,29969,30008,30048,28204,28313,43972,44101,29764,29854,30066,30075,30902,30907,39356,39356,39372,39371,40794,40871,4683,4691,29743,29792,14649,14671,10411,10430,28662,28662,28732,28664,28798,28858,28798,28798,28858,28858,39465,39535,29798,29863,29925,29986,30033,30102,29019,29081,54821,54961,35989,36099,48764,48884,28900,28495,36066,36141,33302,33357,52510,53969,1105,1111,27775,28271,519,520,26151,26640,33007,33093,36196,36280,33413,33498,25367,25428,30002,30104,33114,33200,41523,41625,33031,33125,32892,32969,36067,36142,14637,14676,27264,27330,33412,33498,33089,33180,21953,22010,41713,41823,19760,19813,27300,27378,28323,28408,30736,31337,42972,43072,41393,41511,27305,27363,32761,32844,8886,8891,31986,32064,23100,23173,15783,15838,42787,42934,27004,27096,29321,29414,29361,29434,19394,19438,42284,42394,29930,30008,29863,29958,11844,11881,26826,26919,27817,27894,29810,29883,42687,42815,30071,30456,27732,27780,30965,30948,18718,18733,28782,28815,30078,30134,40815,40937,20904,20944,29293,29387,28812,29005,46129,46327,24096,24162,3642,3647,38758,37936,8409,8440,7263,7285,6167,6190,47269,46806,29882,29942,17900,17942,47391,47442,1265,1266,45897,45982,22441,22473,29462,29543,37830,37921,22219,22275,15611,15646,32087,32130]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>cruise_id<\/th>\n      <th>file_csv<\/th>\n      <th>nrows<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatCurrency(data, \"\", 0, 3, \",\", \".\", true, null);\n  }"},{"className":"dt-right","targets":3},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"cruise_id","targets":1},{"name":"file_csv","targets":2},{"name":"nrows","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="transform-data" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="transform-data"><span class="header-section-number">7</span> Transform Data</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Detect expected types from the most common type across all files</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>d_csv <span class="ot">&lt;-</span> d_csv <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Identify completely empty columns in each data frame</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_empties =</span> <span class="fu">map</span>(data, \(x) {</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tibble</span>(</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">col_name =</span> <span class="fu">names</span>(x),</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">n_empty =</span> <span class="fu">map_int</span>(x, \(col) <span class="fu">sum</span>(<span class="fu">is.na</span>(col)))</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(n_empty <span class="sc">==</span> <span class="fu">nrow</span>(x)) <span class="sc">|&gt;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(col_name)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    }),</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract column types from each data frame</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_types =</span> <span class="fu">map2</span>(data, col_empties, \(x, y) {</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tibble</span>(</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">col_name =</span> <span class="fu">names</span>(x),</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">col_type =</span> <span class="fu">map_chr</span>(x, \(col) <span class="fu">class</span>(col)[<span class="dv">1</span>])</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="sc">!</span>col_name <span class="sc">%in%</span> y)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the most common type for each column across all files</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>d_types <span class="ot">&lt;-</span> d_csv <span class="sc">|&gt;</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(path, col_types) <span class="sc">|&gt;</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(col_types) <span class="sc">|&gt;</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(col_name, col_type) <span class="sc">|&gt;</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(col_name) <span class="sc">|&gt;</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(n, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(col_name, <span class="at">expected_type =</span> col_type)</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify files with type mismatches</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>d_mismatches <span class="ot">&lt;-</span> d_csv <span class="sc">|&gt;</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cruise_id, path, col_types) <span class="sc">|&gt;</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(col_types) <span class="sc">|&gt;</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(d_types, <span class="at">by =</span> <span class="st">"col_name"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(col_type <span class="sc">!=</span> expected_type) <span class="sc">|&gt;</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(col_name, path)</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Log mismatches if any exist</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(d_mismatches) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Type mismatches detected - converting columns..."</span>)</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind data, converting mismatched columns to expected type</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>d_bind <span class="ot">&lt;-</span> d_csv <span class="sc">|&gt;</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">map2</span>(data, path, \(x, p) {</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Get columns that need type conversion for this file</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>      x_mismatches <span class="ot">&lt;-</span> d_mismatches <span class="sc">|&gt;</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(path <span class="sc">==</span> p)</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">nrow</span>(x_mismatches) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(x_mismatches)) {</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>          col <span class="ot">&lt;-</span> x_mismatches<span class="sc">$</span>col_name[i]</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>          expected <span class="ot">&lt;-</span> x_mismatches<span class="sc">$</span>expected_type[i]</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Count NAs before conversion</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>          na_before <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(x[[col]]))</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Convert to expected type</span></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>          <span class="fu">suppressWarnings</span>({</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>            x[[col]] <span class="ot">&lt;-</span> <span class="cf">switch</span>(</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>              expected,</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>              <span class="st">"numeric"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(x[[col]]),</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>              <span class="st">"integer"</span> <span class="ot">=</span> <span class="fu">as.integer</span>(x[[col]]),</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>              <span class="st">"logical"</span> <span class="ot">=</span> <span class="fu">as.logical</span>(x[[col]]),</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>              <span class="st">"character"</span> <span class="ot">=</span> <span class="fu">as.character</span>(x[[col]]),</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>              x[[col]]</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>          })</span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Count NAs after conversion</span></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>          na_after <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(x[[col]]))</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>          na_generated <span class="ot">&lt;-</span> na_after <span class="sc">-</span> na_before</span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (na_generated <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>            <span class="fu">message</span>(<span class="fu">glue</span>(</span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>              <span class="st">"  {basename(p)}: {col} ({x_mismatches$col_type[i]} → {expected}) generated {na_generated} NAs"</span></span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>            ))</span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Store NA count in d_mismatches for reporting</span></span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>          d_mismatches[</span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>            d_mismatches<span class="sc">$</span>path <span class="sc">==</span> p <span class="sc">&amp;</span> d_mismatches<span class="sc">$</span>col_name <span class="sc">==</span> col,</span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>            <span class="st">"nas_generated"</span></span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a>          ] <span class="ot">&lt;&lt;-</span> na_generated</span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a>      x</span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(data)</span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a><span class="co"># Report on type mismatches with NA generation</span></span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(d_mismatches) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Summary by column</span></span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a>  d_mismatches <span class="sc">|&gt;</span></span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(col_name, expected_type, col_type) <span class="sc">|&gt;</span></span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_files =</span> <span class="fu">n</span>(),</span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a>      <span class="at">total_nas =</span> <span class="fu">sum</span>(nas_generated, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a>      <span class="at">files =</span> <span class="fu">paste</span>(<span class="fu">basename</span>(path), <span class="at">collapse =</span> <span class="st">"; "</span>),</span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(total_nas)) <span class="sc">|&gt;</span></span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a>    <span class="fu">datatable</span>(</span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Type mismatches by column"</span>,</span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a>      <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">20</span>)</span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">formatCurrency</span>(</span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">"n_files"</span>, <span class="st">"total_nas"</span>),</span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a>      <span class="at">currency =</span> <span class="st">""</span>,</span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">0</span>,</span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true" tabindex="-1"></a>      <span class="at">mark =</span> <span class="st">","</span></span>
<span id="cb10-117"><a href="#cb10-117" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-118"><a href="#cb10-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-119"><a href="#cb10-119" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Summary by file</span></span>
<span id="cb10-120"><a href="#cb10-120" aria-hidden="true" tabindex="-1"></a>  d_mismatches <span class="sc">|&gt;</span></span>
<span id="cb10-121"><a href="#cb10-121" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb10-122"><a href="#cb10-122" aria-hidden="true" tabindex="-1"></a>      <span class="at">path_csv =</span> <span class="fu">basename</span>(path),</span>
<span id="cb10-123"><a href="#cb10-123" aria-hidden="true" tabindex="-1"></a>      <span class="at">col_expr =</span> <span class="fu">glue</span>(</span>
<span id="cb10-124"><a href="#cb10-124" aria-hidden="true" tabindex="-1"></a>        <span class="st">"{col_name}: {col_type} → {expected_type} ({nas_generated} NAs)&lt;br&gt;"</span></span>
<span id="cb10-125"><a href="#cb10-125" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb10-126"><a href="#cb10-126" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb10-127"><a href="#cb10-127" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(path_csv, col_name) <span class="sc">|&gt;</span></span>
<span id="cb10-128"><a href="#cb10-128" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(path_csv) <span class="sc">|&gt;</span></span>
<span id="cb10-129"><a href="#cb10-129" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb10-130"><a href="#cb10-130" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_columns =</span> <span class="fu">n</span>(),</span>
<span id="cb10-131"><a href="#cb10-131" aria-hidden="true" tabindex="-1"></a>      <span class="at">total_nas =</span> <span class="fu">sum</span>(nas_generated, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb10-132"><a href="#cb10-132" aria-hidden="true" tabindex="-1"></a>      <span class="at">columns =</span> <span class="fu">paste</span>(col_expr, <span class="at">collapse =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>),</span>
<span id="cb10-133"><a href="#cb10-133" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb10-134"><a href="#cb10-134" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb10-135"><a href="#cb10-135" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(total_nas), path_csv) <span class="sc">|&gt;</span></span>
<span id="cb10-136"><a href="#cb10-136" aria-hidden="true" tabindex="-1"></a>    <span class="fu">datatable</span>(</span>
<span id="cb10-137"><a href="#cb10-137" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Type mismatches by file"</span>,</span>
<span id="cb10-138"><a href="#cb10-138" aria-hidden="true" tabindex="-1"></a>      <span class="at">escape =</span> <span class="cn">FALSE</span>,</span>
<span id="cb10-139"><a href="#cb10-139" aria-hidden="true" tabindex="-1"></a>      <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">20</span>)</span>
<span id="cb10-140"><a href="#cb10-140" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb10-141"><a href="#cb10-141" aria-hidden="true" tabindex="-1"></a>    <span class="fu">formatCurrency</span>(</span>
<span id="cb10-142"><a href="#cb10-142" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">"n_columns"</span>, <span class="st">"total_nas"</span>),</span>
<span id="cb10-143"><a href="#cb10-143" aria-hidden="true" tabindex="-1"></a>      <span class="at">currency =</span> <span class="st">""</span>,</span>
<span id="cb10-144"><a href="#cb10-144" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">0</span>,</span>
<span id="cb10-145"><a href="#cb10-145" aria-hidden="true" tabindex="-1"></a>      <span class="at">mark =</span> <span class="st">","</span></span>
<span id="cb10-146"><a href="#cb10-146" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-147"><a href="#cb10-147" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-74c31ff6b79027ed8da3" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-74c31ff6b79027ed8da3">{"x":{"filter":"none","vertical":false,"caption":"<caption>Type mismatches by file<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54"],["20-1210NH_CTDBTL_001-075U.csv","20-1210NH_CTDBTL_001-075D.csv","20-0507NH_CTDBTL_001-075D.csv","20-0507NH_CTDBTL_001-075U.csv","19-9802JD_CTDBTL_001-066D.csv","19-9802JD_CTDBTL_001-066U.csv","20-0407JD_CTDBTL_013-074ID.csv","20-0407JD_CTDBTL_013-074IU.csv","20-0407JD_CTDBTL_040-074ID.csv","20-0407JD_CTDBTL_040-074IU.csv","20-0504NH_CTDBTL_001-075D.csv","20-0504NH_CTDBTL_001-075U.csv","20-0511NH_CTDBTL_001-072D.csv","20-0511NH_CTDBTL_001-072U.csv","20-0602JD_CTDBTL_001-096U.csv","20-0701JD_CTDBTL_001-084D.csv","20-0701JD_CTDBTL_001-084IDnoQC.csv","20-0701JD_CTDBTL_001-084IUnoQC.csv","20-0701JD_CTDBTL_001-084U.csv","20-0704JD_CTDBTL_001-555ID.csv","20-0707NH_CTDBTL_001-012ID.csv","20-0707NH_CTDBTL_001-012IU.csv","20-0707NH_CTDBTL_047-073ID.csv","20-0707NH_CTDBTL_047-073IU.csv","20-0711_CTDBTL_001-067Dno001b.csv","20-0711_CTDBTL_001-067ID.csv","20-0711_CTDBTL_001-067IU.csv","20-0711_CTDBTL_001-067Uno001b.csv","20-1004MF_CTDBTL_123-682ID.csv","20-1004MF_CTDBTL_123-682IU.csv","20-1104SH_CTDBTL_031-035ID.csv","20-1104SH_CTDBTL_031-035IU.csv","20-1104SH_CTDBTL_036-036ID.csv","20-1104SH_CTDBTL_036-036IU.csv","20-1203SH_CTDBTL_001-057D.csv","20-1203SH_CTDBTL_001-057U.csv","20-1501NH_CTDBTL_001-100D.csv","20-1501NH_CTDBTL_001-100U.csv","20-1501NH_CTDBTL_004-100D.csv","20-1501NH_CTDBTL_004-100U.csv","20-1511OC_CTDBTL_001-070U.csv","20-1810SR_CTDBTL_001-074D.csv","20-1810SR_CTDBTL_001-074U.csv","20-1904RL_CTDBTL_001-069U.csv","20-2007SR_CTDBTL_001-075U.csv","20-2107SR_CTDBTL_001-071U.csv","20-2111SR_CTDBTL_001-075D.csv","20-2211_CTDBTL_001-073U.csv","20-2301RL_CTDBTL_001-072D.csv","20-2301RL_CTDBTL_001-072U.csv","20-2307SR_CTDBTL_001-056D.csv","20-2311SR_CTDBTL_001-050D.csv","20-2401RL_CTDBTL_001-016U.csv","20-9807NH_CTDBTL_001-070D.csv"],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,3,3,3,1,3,3,3,1,1,1,1,1,1,1,2,2,1],[192,191,3,3,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],["ox_bu_m: character → numeric (192 NAs)<br>","ox_bu_m: character → numeric (191 NAs)<br>","phaeo: character → numeric (3 NAs)<br>","phaeo: character → numeric (3 NAs)<br>","phaeo: character → numeric (1 NAs)<br>","phaeo: character → numeric (1 NAs)<br>","phaeo: character → numeric (1 NAs)<br>","phaeo: character → numeric (1 NAs)<br>","phaeo: character → numeric (1 NAs)<br>","phaeo: character → numeric (1 NAs)<br>","phaeo: character → numeric (1 NAs)<br>","phaeo: character → numeric (1 NAs)<br>","phaeo: character → numeric (1 NAs)<br>","phaeo: character → numeric (1 NAs)<br>","salt1_corr: character → numeric (0 NAs)<br>\nsalt2_corr: character → numeric (0 NAs)<br>","event_num: character → numeric (0 NAs)<br>","event_num: character → numeric (0 NAs)<br>","event_num: character → numeric (0 NAs)<br>\nsalt2_corr: character → numeric (0 NAs)<br>","event_num: character → numeric (0 NAs)<br>","salt2_corr: character → numeric (0 NAs)<br>","ord_occ: numeric → character (0 NAs)<br>","ord_occ: numeric → character (0 NAs)<br>","ord_occ: numeric → character (0 NAs)<br>","ord_occ: numeric → character (0 NAs)<br>","salt1_corr: character → numeric (0 NAs)<br>","salt1_corr: character → numeric (0 NAs)<br>","salt1_corr: character → numeric (0 NAs)<br>","salt1_corr: character → numeric (0 NAs)<br>","ord_occ: numeric → character (0 NAs)<br>","ord_occ: numeric → character (0 NAs)<br>","ord_occ: numeric → character (0 NAs)<br>","ord_occ: numeric → character (0 NAs)<br>","ord_occ: numeric → character (0 NAs)<br>","ord_occ: numeric → character (0 NAs)<br>","ord_occ: numeric → character (0 NAs)<br>","ord_occ: numeric → character (0 NAs)<br>","line: numeric → character (0 NAs)<br>\nord_occ: numeric → character (0 NAs)<br>\nsta: numeric → character (0 NAs)<br>","line: numeric → character (0 NAs)<br>\nord_occ: numeric → character (0 NAs)<br>\nsta: numeric → character (0 NAs)<br>","line: numeric → character (0 NAs)<br>\nord_occ: numeric → character (0 NAs)<br>\nsta: numeric → character (0 NAs)<br>","line: numeric → character (0 NAs)<br>\nord_occ: numeric → character (0 NAs)<br>\nsta: numeric → character (0 NAs)<br>","salt_ave_corr: character → numeric (0 NAs)<br>","line: numeric → character (0 NAs)<br>\nord_occ: numeric → character (0 NAs)<br>\nsta: numeric → character (0 NAs)<br>","line: numeric → character (0 NAs)<br>\nord_occ: numeric → character (0 NAs)<br>\nsta: numeric → character (0 NAs)<br>","line: numeric → character (0 NAs)<br>\nord_occ: numeric → character (0 NAs)<br>\nsta: numeric → character (0 NAs)<br>","salt1_corr: character → numeric (0 NAs)<br>","salt1_corr: character → numeric (0 NAs)<br>","salt1_corr: character → numeric (0 NAs)<br>","salt1_corr: character → numeric (0 NAs)<br>","salt1_corr: character → numeric (0 NAs)<br>","salt1_corr: character → numeric (0 NAs)<br>","salt1_corr: character → numeric (0 NAs)<br>","salt1_corr: character → numeric (0 NAs)<br>\nsalt_ave_corr: character → numeric (0 NAs)<br>","salt1_corr: character → numeric (0 NAs)<br>\nsalt_ave_corr: character → numeric (0 NAs)<br>","salt_ave_corr: character → numeric (0 NAs)<br>"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>path_csv<\/th>\n      <th>n_columns<\/th>\n      <th>total_nas<\/th>\n      <th>columns<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":20,"columnDefs":[{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatCurrency(data, \"\", 0, 3, \",\", \".\", true, null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatCurrency(data, \"\", 0, 3, \",\", \".\", true, null);\n  }"},{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"path_csv","targets":1},{"name":"n_columns","targets":2},{"name":"total_nas","targets":3},{"name":"columns","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,20,25,50,100]}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render"],"jsHooks":[]}</script>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: drop study / replace with cruise_id</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># d_bind$study |&gt; table(useNA = "ifany")</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># d_bind$cruise_id |&gt; table(useNA = "ifany") # NAs: 10,9782</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>d_bind <span class="sc">|&gt;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(study),</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(cruise_id),</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    cruise_id <span class="sc">!=</span> study</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(study, cruise_id, path_unzip) <span class="sc">|&gt;</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Mismatch between study and cruise_id"</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-7106cc1162abcd5ee1d2" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7106cc1162abcd5ee1d2">{"x":{"filter":"none","vertical":false,"caption":"<caption>Mismatch between study and cruise_id<\/caption>","data":[["1","2","3","4"],["0404JD","0404JD","0404NH","0404NH"],["0404NHJD","0404NHJD","0404NHJD","0404NHJD"],["20-0404NHJD_CTDFinalQC/db_csvs/20-0404JD_CTDBTL_067-094ID.csv","20-0404NHJD_CTDFinalQC/db_csvs/20-0404JD_CTDBTL_067-094IU.csv","20-0404NHJD_CTDFinalQC/db_csvs/20-0404NH_CTDBTL_001-066ID.csv","20-0404NHJD_CTDFinalQC/db_csvs/20-0404NH_CTDBTL_001-066IU.csv"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>study<\/th>\n      <th>cruise_id<\/th>\n      <th>path_unzip<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"study","targets":1},{"name":"cruise_id","targets":2},{"name":"path_unzip","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#   study  cruise_id path_unzip</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 0404JD 0404NHJD  20-0404NHJD_CTDFinalQC/db_csvs/20-0404JD_CTDBTL_067-094ID.csv</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 0404JD 0404NHJD  20-0404NHJD_CTDFinalQC/db_csvs/20-0404JD_CTDBTL_067-094IU.csv</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 0404NH 0404NHJD  20-0404NHJD_CTDFinalQC/db_csvs/20-0404NH_CTDBTL_001-066ID.csv</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 0404NH 0404NHJD  20-0404NHJD_CTDFinalQC/db_csvs/20-0404NH_CTDBTL_001-066IU.csv</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 Study  0711NH    20-0711NH_CTDFinalQC/db-csvs/20-0711_CTDBTL_001-067Dno001b.csv</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># update cruise_id to study where mismatched, except if study is "Study"</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>d_bind <span class="ot">&lt;-</span> d_bind <span class="sc">|&gt;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">cruise_id =</span> <span class="fu">if_else</span>(</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(study) <span class="sc">&amp;</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        cruise_id <span class="sc">!=</span> study <span class="sc">&amp;</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>        study <span class="sc">!=</span> <span class="st">"Study"</span>,</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>      study,</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>      cruise_id</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">source_file =</span> path_unzip</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(source_file, <span class="at">.after =</span> cruise_id) <span class="sc">|&gt;</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>path_unzip,</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>path,</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>file_csv,</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>dir_unzip,</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>priority,</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>project,</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>study,</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>nrows,</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>col_empties,</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>col_types</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="co"># d_bind |&gt;</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(is.na(ord_occ)) |&gt;</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   pull(cast_id) |&gt;</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   table()</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="co"># 0707_037d 0707_037u 0707_072d 0707_072u 0907_026d 0907_026u 0907_027d 0907_027u</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a><span class="co">#      1024      1024       460       460       518       518       277       277</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="co"># update ord_occ from cast_id where missing</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>d_bind <span class="ot">&lt;-</span> d_bind <span class="sc">|&gt;</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">ord_occ =</span> <span class="fu">if_else</span>(</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(ord_occ) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(cast_id),</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_extract</span>(cast_id, <span class="st">"_(</span><span class="sc">\\</span><span class="st">d{3})"</span>, <span class="at">group =</span> <span class="dv">1</span>),</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>      ord_occ</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a><span class="co"># is.na(d_bind$event_num) |&gt; table()</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a><span class="co">#     FALSE       TRUE</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a><span class="co"># 3,927,815  2,881,340</span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: figure out missing ord_occ</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a><span class="co"># format date ----</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a><span class="co"># apply formats depending on pattern</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>d_bind <span class="ot">&lt;-</span> d_bind <span class="sc">|&gt;</span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_time_utc =</span> <span class="fu">trim</span>(date_time_utc),</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">dtime_utc =</span> <span class="cn">NA</span>, <span class="co"># _POSIXct_, # 163,181 | 6,596,130 failed to parse.</span></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">dtime_utc =</span> <span class="fu">if_else</span>(</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>        date_time_utc, <span class="co"># eg "23-Jan-1998 17:50:44"  "3-JAN-1998 17:50:44"</span></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>        <span class="st">"^</span><span class="sc">\\</span><span class="st">d{1,2}-[A-z]{3}-</span><span class="sc">\\</span><span class="st">d{4} </span><span class="sc">\\</span><span class="st">d{1,2}:</span><span class="sc">\\</span><span class="st">d{1,2}:</span><span class="sc">\\</span><span class="st">d{1,2}$"</span></span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>      <span class="fu">suppressWarnings</span>(<span class="fu">dmy_hms</span>(date_time_utc, <span class="at">tz =</span> <span class="st">"UTC"</span>)),</span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>      dtime_utc</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">dtime_utc =</span> <span class="fu">if_else</span>(</span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(</span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>        date_time_utc, <span class="co"># eg "01/01/2015 17:12", "1/01/2015 17:12", "1/1/2015 17:12"</span></span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>        <span class="st">"^</span><span class="sc">\\</span><span class="st">d{1,2}/</span><span class="sc">\\</span><span class="st">d{1,2}/</span><span class="sc">\\</span><span class="st">d{4} </span><span class="sc">\\</span><span class="st">d{1,2}:</span><span class="sc">\\</span><span class="st">d{1,2}$"</span></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>      <span class="fu">suppressWarnings</span>(<span class="fu">mdy_hm</span>(date_time_utc, <span class="at">tz =</span> <span class="st">"UTC"</span>)),</span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>      dtime_utc</span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(dtime_utc, <span class="at">.before =</span> date_time_utc) <span class="sc">|&gt;</span></span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select(-date_time_utc, -date_time_pst) |&gt;</span></span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(dtime_utc, depth)</span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(d_bind<span class="sc">$</span>dtime_utc)))</span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a><span class="co"># fill in missing lon,lat from line,sta ----</span></span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a>d_bind <span class="ot">&lt;-</span> d_bind <span class="sc">|&gt;</span></span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon_dec =</span> <span class="fu">if_else</span>(</span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(lon_dec) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(line) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(sta),</span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(<span class="fu">sf_project</span>(</span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>        <span class="at">from =</span> <span class="st">"+proj=calcofi"</span>,</span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a>        <span class="at">to =</span> <span class="st">"+proj=longlat +datum=WGS84"</span>,</span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a>        <span class="at">pts =</span> <span class="fu">cbind</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(line), <span class="at">y =</span> <span class="fu">as.numeric</span>(sta))</span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a>      )[, <span class="dv">1</span>]),</span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a>      lon_dec</span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat_dec =</span> <span class="fu">if_else</span>(</span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(lat_dec) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(line) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(sta),</span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(<span class="fu">sf_project</span>(</span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a>        <span class="at">from =</span> <span class="st">"+proj=calcofi"</span>,</span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a>        <span class="at">to =</span> <span class="st">"+proj=longlat +datum=WGS84"</span>,</span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a>        <span class="at">pts =</span> <span class="fu">cbind</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(line), <span class="at">y =</span> <span class="fu">as.numeric</span>(sta))</span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a>      )[, <span class="dv">2</span>]),</span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a>      lat_dec</span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a><span class="co"># show first and last 100 rows</span></span>
<span id="cb12-109"><a href="#cb12-109" aria-hidden="true" tabindex="-1"></a>d_bind <span class="sc">|&gt;</span></span>
<span id="cb12-110"><a href="#cb12-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, (<span class="fu">n</span>() <span class="sc">-</span> <span class="dv">9</span>)<span class="sc">:</span><span class="fu">n</span>())) <span class="sc">|&gt;</span></span>
<span id="cb12-111"><a href="#cb12-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(</span>
<span id="cb12-112"><a href="#cb12-112" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="fu">glue</span>(</span>
<span id="cb12-113"><a href="#cb12-113" aria-hidden="true" tabindex="-1"></a>      <span class="st">"First and last 10 rows of combined CTD data (nrows: {format(nrow(d_bind), big.mark = ',')})"</span></span>
<span id="cb12-114"><a href="#cb12-114" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-115"><a href="#cb12-115" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-0c55f06782ba546ebf20" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0c55f06782ba546ebf20">{"x":{"filter":"none","vertical":false,"caption":"<caption>First and last 10 rows of combined CTD data (nrows: 6,813,712)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],["9802JD","9802JD","9802JD","9802JD","9802JD","9802JD","9802JD","9802JD","9802JD","9802JD","2507SR","2507SR","2507SR","2507SR","2507SR","2507SR","2507SR","2507SR","2507SR","2507SR"],["19-9802JD_CTDFinalQC/db_csv/19-9802JD_CTDBTL_001-066D.csv","19-9802JD_CTDFinalQC/db_csv/19-9802JD_CTDBTL_001-066D.csv","19-9802JD_CTDFinalQC/db_csv/19-9802JD_CTDBTL_001-066D.csv","19-9802JD_CTDFinalQC/db_csv/19-9802JD_CTDBTL_001-066D.csv","19-9802JD_CTDFinalQC/db_csv/19-9802JD_CTDBTL_001-066D.csv","19-9802JD_CTDFinalQC/db_csv/19-9802JD_CTDBTL_001-066D.csv","19-9802JD_CTDFinalQC/db_csv/19-9802JD_CTDBTL_001-066D.csv","19-9802JD_CTDFinalQC/db_csv/19-9802JD_CTDBTL_001-066D.csv","19-9802JD_CTDFinalQC/db_csv/19-9802JD_CTDBTL_001-066D.csv","19-9802JD_CTDFinalQC/db_csv/19-9802JD_CTDBTL_001-066D.csv","20-2507SR_CTDPrelim/20-2507_CTD_001-055U.csv","20-2507SR_CTDPrelim/20-2507_CTD_001-055U.csv","20-2507SR_CTDPrelim/20-2507_CTD_001-055U.csv","20-2507SR_CTDPrelim/20-2507_CTD_001-055U.csv","20-2507SR_CTDPrelim/20-2507_CTD_001-055U.csv","20-2507SR_CTDPrelim/20-2507_CTD_001-055U.csv","20-2507SR_CTDPrelim/20-2507_CTD_001-055U.csv","20-2507SR_CTDPrelim/20-2507_CTD_001-055U.csv","20-2507SR_CTDPrelim/20-2507_CTD_001-055U.csv","20-2507SR_CTDPrelim/20-2507_CTD_001-055U.csv"],["final","final","final","final","final","final","final","final","final","final","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary","preliminary"],["D","D","D","D","D","D","D","D","D","D","U","U","U","U","U","U","U","U","U","U"],["001","001","001","001","001","001","001","001","001","001","055","055","055","055","055","055","055","055","055","055"],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],["9802_001d","9802_001d","9802_001d","9802_001d","9802_001d","9802_001d","9802_001d","9802_001d","9802_001d","9802_001d","2507_055u","2507_055u","2507_055u","2507_055u","2507_055u","2507_055u","2507_055u","2507_055u","2507_055u","2507_055u"],["1998-01-23T11:14:25Z","1998-01-23T11:14:50Z","1998-01-23T11:14:50Z","1998-01-23T11:14:52Z","1998-01-23T11:14:54Z","1998-01-23T11:14:57Z","1998-01-23T11:14:58Z","1998-01-23T11:15:00Z","1998-01-23T11:15:03Z","1998-01-23T11:15:04Z","2025-07-29T04:26:33Z","2025-07-29T04:26:36Z","2025-07-29T04:26:39Z","2025-07-29T04:26:42Z","2025-07-29T04:26:44Z","2025-07-29T04:26:47Z","2025-07-29T04:26:50Z","2025-07-29T04:27:19Z","2025-07-29T04:28:13Z","2025-07-29T04:28:16Z"],["23-Jan-1998 11:14:25","23-Jan-1998 11:14:50","23-Jan-1998 11:14:50","23-Jan-1998 11:14:52","23-Jan-1998 11:14:54","23-Jan-1998 11:14:57","23-Jan-1998 11:14:58","23-Jan-1998 11:15:00","23-Jan-1998 11:15:03","23-Jan-1998 11:15:04","29-Jul-2025 04:26:33","29-Jul-2025 04:26:36","29-Jul-2025 04:26:39","29-Jul-2025 04:26:42","29-Jul-2025 04:26:44","29-Jul-2025 04:26:47","29-Jul-2025 04:26:50","29-Jul-2025 04:27:19","29-Jul-2025 04:28:13","29-Jul-2025 04:28:16"],["23-Jan-1998 03:14:25","23-Jan-1998 03:14:50","23-Jan-1998 03:14:50","23-Jan-1998 03:14:52","23-Jan-1998 03:14:54","23-Jan-1998 03:14:57","23-Jan-1998 03:14:58","23-Jan-1998 03:15:00","23-Jan-1998 03:15:03","23-Jan-1998 03:15:04","28-Jul-2025 20:26:33","28-Jul-2025 20:26:36","28-Jul-2025 20:26:39","28-Jul-2025 20:26:42","28-Jul-2025 20:26:44","28-Jul-2025 20:26:47","28-Jul-2025 20:26:50","28-Jul-2025 20:27:19","28-Jul-2025 20:28:13","28-Jul-2025 20:28:16"],[32.9563724259334,32.9563724259334,32.9563724259334,32.9563724259334,32.9563724259334,32.9563724259334,32.9563724259334,32.9563724259334,32.9563724259334,32.9563724259334,34.2247,34.2247,34.2247,34.2247,34.2247,34.2247,34.2247,34.2247,34.2247,34.2247],[-117.3052132775284,-117.3052132775284,-117.3052132775284,-117.3052132775284,-117.3052132775284,-117.3052132775284,-117.3052132775284,-117.3052132775284,-117.3052132775284,-117.3052132775284,-119.41086,-119.41086,-119.41086,-119.41086,-119.41086,-119.41086,-119.41086,-119.41086,-119.41086,-119.41086],["093.3 026.7","093.3 026.7","093.3 026.7","093.3 026.7","093.3 026.7","093.3 026.7","093.3 026.7","093.3 026.7","093.3 026.7","093.3 026.7","083.3 040.6","083.3 040.6","083.3 040.6","083.3 040.6","083.3 040.6","083.3 040.6","083.3 040.6","083.3 040.6","083.3 040.6","083.3 040.6"],["093.3","093.3","093.3","093.3","093.3","093.3","093.3","093.3","093.3","093.3","083.3","083.3","083.3","083.3","083.3","083.3","083.3","083.3","083.3","083.3"],["026.7","026.7","026.7","026.7","026.7","026.7","026.7","026.7","026.7","026.7","040.6","040.6","040.6","040.6","040.6","040.6","040.6","040.6","040.6","040.6"],[2,3,4,5,6,7,8,9,10,11,10,9,8,7,6,5,4,3,2,1],[2.014,3.021,4.028,5.035,6.042,7.049,8.055999999999999,9.063000000000001,10.07,11.077,10.072,9.065,8.058,7.051,6.043,5.036,4.029,3.022,2.014,1.007],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[17.915,17.9442,17.9709,17.9473,17.8728,17.8677,17.8647,17.8635,17.8623,17.8608,13.4463,13.9669,15.6527,15.9398,16.3752,16.5092,16.581,16.5954,16.616,16.623],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,13.5002,13.9497,15.5536,15.8705,16.1402,16.4763,16.5219,16.5916,16.6166,16.6295],[9,9,9,9,9,9,9,9,9,9,null,null,null,null,null,null,null,null,null,null],[17.915,17.9442,17.9709,17.9473,17.8728,17.8677,17.8647,17.8635,17.8623,17.8608,13.4733,13.9583,15.6031,15.9051,16.2577,16.4928,16.5514,16.5935,16.6163,16.6262],[34.0512,34.0512,34.0518,34.0506,34.0512,34.0509,34.0511,34.0512,34.051,34.051,33.5486,33.5633,33.5736,33.57,33.5755,33.5694,33.5634,33.5587,33.5579,33.5582],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[34.0506,34.0506,34.0512,34.05,34.0506,34.0503,34.0505,34.0506,34.0504,34.0504,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,33.5353,33.5543,33.5322,33.5285,33.5423,33.5361,33.5398,33.5479,33.554,33.5532],[9,9,9,9,9,9,9,9,9,9,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[34.0506,34.0506,34.0512,34.05,34.0506,34.0503,34.0505,34.0506,34.0504,34.0504,null,null,null,null,null,null,null,null,null,null],[5.30874,5.32249,5.30606,5.30639,5.3194,5.32372,5.3307,5.32715,5.32599,5.32407,5.5922,6.6096,6.4136,6.5021,6.4632,6.4145,6.3694,6.3684,6.3697,6.1973],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[5.2155,5.2289,5.2129,5.2132,5.2259,5.2301,5.2368,5.2334,5.2323,5.2304,null,null,null,null,null,null,null,null,null,null],[5.2781,5.2919,5.2755,5.2758,5.2888,5.2932,5.3002,5.2966,5.2954,5.2935,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,5.1506,6.0312,5.9339,6.0254,6.0769,6.0518,6.0462,6.0421,6.0468,5.7845],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[231.40354,232.00435,231.28987,231.30292,231.86579,232.05418,232.35788,232.20327,232.15244,232.06898,243.614,287.961,279.518,283.395,281.725,279.611,277.652,277.612,277.671,270.154],[224.844,225.4276,224.7336,224.7463,225.293,225.476,225.771,225.6209,225.5715,225.4904,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,224.383,262.762,258.615,262.624,264.879,263.808,263.566,263.391,263.595,252.162],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[0.7999000000000001,0.7154,0.7064,0.6955,0.7378,0.9851,0.9497,0.864,0.7982,0.8547,0.3416,0.5123,0.6334,0.6076,0.4563,0.3303,0.2796,0.2578,0.2518,0.2401],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[0.4737,0.4094,0.4025,0.3942,0.4264,0.6146,0.5876,0.5224,0.4724,0.5154,null,null,null,null,null,null,null,null,null,null],[0.6777,0.6127,0.6045,0.5943000000000001,0.632,0.7453,0.7403999999999999,0.7128,0.6766,0.7085,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,0.6613,0.5561,0.4366,0.3288,0.2608,0.2118,0.1803,0.1586,0.1531,0.1528],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,7.6721,6.0904,4.2944,2.6737,1.6502,0.9136,0.4407,0.1147,0.0317,0.0274],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[24.5663,24.5593,24.5532,24.5581,24.5769,24.5778,24.5788,24.5792,24.5794,24.5798,25.1794,25.0829,24.7285,24.6617,24.5666,24.5311,24.5098,24.5028,24.4974,24.496],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,25.1583,25.0796,24.7189,24.6454,24.5946,24.5131,24.5054,24.4955,24.4943,24.4907],[9,9,9,9,9,9,9,9,9,9,null,null,null,null,null,null,null,null,null,null],[0.6929999999999999,0.6909999999999999,0.6879999999999999,0.696,0.704,0.701,0.699,0.698,0.697,0.699,0.9333,1.0902,1.1119,1.1031,1.0984,1.0934,1.091,1.0825,1.0823,1.0807],[84.1014,84.1461,84.20189999999999,84.0337,83.8725,83.91930000000001,83.9602,83.98650000000001,83.9958,83.9718,79.1936,76.1473,75.73139999999999,75.89870000000001,75.988,76.08280000000001,76.1297,76.28959999999999,76.294,76.3254],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,7.859,7.857,7.854,7.847,7.843,7.841,7.844,7.877,7.938,7.94],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,8.698399999999999,8.698399999999999,8.698399999999999,8.698399999999999,8.698399999999999,8.698399999999999,8.698399999999999,8.947100000000001,8.676500000000001,8.698399999999999],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[9999,9999,9999,9999,9999,9999,9999,9999,9999,9999,0.11855,0.11943,0.11727,0.11709,0.12255,0.12644,0.13416,0.11943,0.10197,0.10966],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[17.9147,17.9437,17.9702,17.9465,17.8717,17.8665,17.8634,17.8619,17.8606,17.859,13.4449,13.9656,15.6515,15.9387,16.3743,16.5084,16.5803,16.5949,16.6157,16.6228],[null,null,null,null,null,null,null,null,null,null,13.4988,13.9484,15.5524,15.8694,16.1392,16.4755,16.5213,16.5912,16.6163,16.6294],[0.0029,0.008500000000000001,0.0116,0.015,0.0184,0.0218,0.0252,0.0286,0.0319,0.0353,0.0828,0.0828,0.0828,0.0828,0.0828,0.0828,0.0828,0.0858,0.0915,0.0912],[336.138,336.845,337.461,337.029,335.276,335.218,335.164,335.16,335.179,335.173,277.977,287.14,320.87,327.207,336.236,339.588,341.58,342.216,342.697,342.798],[5.40233,5.3993,5.39653,5.399,5.40671,5.40725,5.40755,5.40767,5.4078,5.40795,94.363,112.72,113.135,115.346,115.64,115.064,114.411,114.422,114.491,111.407],[null,null,null,null,null,null,null,null,null,null,86.999,102.819,104.443,106.718,108.206,108.467,108.466,108.545,108.686,103.997],[1,null,null,null,null,null,null,null,null,11,null,null,null,null,null,null,null,null,null,null],[17.95,null,null,null,null,null,null,null,null,17.85,null,null,null,null,null,null,null,null,null,null],[34.049,null,null,null,null,null,null,null,null,34.047,null,null,null,null,null,null,null,null,null,null],[5.3,null,null,null,null,null,null,null,null,5.3,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[0.8,null,null,null,null,null,null,null,null,0.68,null,null,null,null,null,null,null,null,null,null],[0.26,null,null,null,null,null,null,null,null,0.29,null,null,null,null,null,null,null,null,null,null],[0.5,null,null,null,null,null,null,null,null,0.5,null,null,null,null,null,null,null,null,null,null],[0.32,null,null,null,null,null,null,null,null,0.32,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[0.4,null,null,null,null,null,null,null,null,0.4,null,null,null,null,null,null,null,null,null,null],[2.1,null,null,null,null,null,null,null,null,2.1,null,null,null,null,null,null,null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>cruise_id<\/th>\n      <th>source_file<\/th>\n      <th>data_stage<\/th>\n      <th>cast_dir<\/th>\n      <th>ord_occ<\/th>\n      <th>event_num<\/th>\n      <th>cast_id<\/th>\n      <th>dtime_utc<\/th>\n      <th>date_time_utc<\/th>\n      <th>date_time_pst<\/th>\n      <th>lat_dec<\/th>\n      <th>lon_dec<\/th>\n      <th>sta_id<\/th>\n      <th>line<\/th>\n      <th>sta<\/th>\n      <th>depth<\/th>\n      <th>pressure<\/th>\n      <th>pr_q<\/th>\n      <th>temp1<\/th>\n      <th>temp1q<\/th>\n      <th>temp2<\/th>\n      <th>temp2q<\/th>\n      <th>temp_ave<\/th>\n      <th>salt1<\/th>\n      <th>salt1q<\/th>\n      <th>salt1_corr<\/th>\n      <th>salt2<\/th>\n      <th>salt2q<\/th>\n      <th>salt2_corr<\/th>\n      <th>salt_ave_corr<\/th>\n      <th>ox1<\/th>\n      <th>ox1q<\/th>\n      <th>ox1_cruise_corr<\/th>\n      <th>ox1_sta_corr<\/th>\n      <th>ox2<\/th>\n      <th>ox2q<\/th>\n      <th>ox2_cruise_corr<\/th>\n      <th>ox2_sta_corr<\/th>\n      <th>ox_ave_sta_corr<\/th>\n      <th>ox1u_m<\/th>\n      <th>ox1u_m_cruise_corr<\/th>\n      <th>ox1u_m_sta_corr<\/th>\n      <th>ox2u_m<\/th>\n      <th>ox2u_m_cruise_corr<\/th>\n      <th>ox2u_m_sta_corr<\/th>\n      <th>ox_aveu_m_sta_corr<\/th>\n      <th>fluor_v<\/th>\n      <th>fluor_q<\/th>\n      <th>est_chl_cruise_corr<\/th>\n      <th>est_chl_sta_corr<\/th>\n      <th>isusv<\/th>\n      <th>isusq<\/th>\n      <th>est_no3_cruise_corr<\/th>\n      <th>est_no3_sta_corr<\/th>\n      <th>sig_theta_ts1<\/th>\n      <th>sig_theta_ts1q<\/th>\n      <th>sig_theta_ts2<\/th>\n      <th>sig_theta_ts2q<\/th>\n      <th>bat<\/th>\n      <th>x_miss<\/th>\n      <th>trans_q<\/th>\n      <th>p_h<\/th>\n      <th>p_hq<\/th>\n      <th>spar<\/th>\n      <th>sparq<\/th>\n      <th>par<\/th>\n      <th>parq<\/th>\n      <th>po_t1<\/th>\n      <th>po_t2<\/th>\n      <th>dyn_ht<\/th>\n      <th>sva<\/th>\n      <th>ox_sat1<\/th>\n      <th>ox_sat2<\/th>\n      <th>btl_depth<\/th>\n      <th>btl_temp<\/th>\n      <th>salt_b<\/th>\n      <th>ox_b<\/th>\n      <th>ox_bu_m<\/th>\n      <th>chl_a<\/th>\n      <th>phaeo<\/th>\n      <th>no3<\/th>\n      <th>no2<\/th>\n      <th>nh4<\/th>\n      <th>po4<\/th>\n      <th>sil<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[6,11,12,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"cruise_id","targets":1},{"name":"source_file","targets":2},{"name":"data_stage","targets":3},{"name":"cast_dir","targets":4},{"name":"ord_occ","targets":5},{"name":"event_num","targets":6},{"name":"cast_id","targets":7},{"name":"dtime_utc","targets":8},{"name":"date_time_utc","targets":9},{"name":"date_time_pst","targets":10},{"name":"lat_dec","targets":11},{"name":"lon_dec","targets":12},{"name":"sta_id","targets":13},{"name":"line","targets":14},{"name":"sta","targets":15},{"name":"depth","targets":16},{"name":"pressure","targets":17},{"name":"pr_q","targets":18},{"name":"temp1","targets":19},{"name":"temp1q","targets":20},{"name":"temp2","targets":21},{"name":"temp2q","targets":22},{"name":"temp_ave","targets":23},{"name":"salt1","targets":24},{"name":"salt1q","targets":25},{"name":"salt1_corr","targets":26},{"name":"salt2","targets":27},{"name":"salt2q","targets":28},{"name":"salt2_corr","targets":29},{"name":"salt_ave_corr","targets":30},{"name":"ox1","targets":31},{"name":"ox1q","targets":32},{"name":"ox1_cruise_corr","targets":33},{"name":"ox1_sta_corr","targets":34},{"name":"ox2","targets":35},{"name":"ox2q","targets":36},{"name":"ox2_cruise_corr","targets":37},{"name":"ox2_sta_corr","targets":38},{"name":"ox_ave_sta_corr","targets":39},{"name":"ox1u_m","targets":40},{"name":"ox1u_m_cruise_corr","targets":41},{"name":"ox1u_m_sta_corr","targets":42},{"name":"ox2u_m","targets":43},{"name":"ox2u_m_cruise_corr","targets":44},{"name":"ox2u_m_sta_corr","targets":45},{"name":"ox_aveu_m_sta_corr","targets":46},{"name":"fluor_v","targets":47},{"name":"fluor_q","targets":48},{"name":"est_chl_cruise_corr","targets":49},{"name":"est_chl_sta_corr","targets":50},{"name":"isusv","targets":51},{"name":"isusq","targets":52},{"name":"est_no3_cruise_corr","targets":53},{"name":"est_no3_sta_corr","targets":54},{"name":"sig_theta_ts1","targets":55},{"name":"sig_theta_ts1q","targets":56},{"name":"sig_theta_ts2","targets":57},{"name":"sig_theta_ts2q","targets":58},{"name":"bat","targets":59},{"name":"x_miss","targets":60},{"name":"trans_q","targets":61},{"name":"p_h","targets":62},{"name":"p_hq","targets":63},{"name":"spar","targets":64},{"name":"sparq","targets":65},{"name":"par","targets":66},{"name":"parq","targets":67},{"name":"po_t1","targets":68},{"name":"po_t2","targets":69},{"name":"dyn_ht","targets":70},{"name":"sva","targets":71},{"name":"ox_sat1","targets":72},{"name":"ox_sat2","targets":73},{"name":"btl_depth","targets":74},{"name":"btl_temp","targets":75},{"name":"salt_b","targets":76},{"name":"ox_b","targets":77},{"name":"ox_bu_m","targets":78},{"name":"chl_a","targets":79},{"name":"phaeo","targets":80},{"name":"no3","targets":81},{"name":"no2","targets":82},{"name":"nh4","targets":83},{"name":"po4","targets":84},{"name":"sil","targets":85}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="todo" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="todo"><span class="header-section-number">8</span> TODO</h2>
<section id="process-raw-data" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="process-raw-data"><span class="header-section-number">8.1</span> Process raw data</h3>
<p>into usable form:</p>
<ul>
<li><a href="https://software.seabird.com/">Fathom software | Sea-Bird Scientific</a></li>
</ul>
<p>References:</p>
<ul>
<li><p><a href="https://newdata.calcofi.com/index.php/ctd-data">CTD Data | CalCOFI archives</a></p>
<blockquote class="blockquote">
<p><strong>Cast Files</strong>. Files are created by SeaBird’s Seasave program during each CalCOFI station. These data are unaltered and may contain errors (e.g., incorrect header information) or be incomplete due to system failure during collection. Two or more files may be available for a single station in the latter case. Each cruise will have a single cast data file. This file is a compressed .zip containing .zip files for each cast of the cruise, yymm_CTDCast.zip and yymm_llllssss_###.zip respectively. Each station .zip should contain the following: .bl, .con, .hdr, .hex, .mrk, and .prn files.</p>
</blockquote></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>CalCOFI CTD System
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>A Sea-Bird Electronics 911plus V2 CTD collects vertical profile data at every CalCOFI station.</li>
<li>In addition to being a dual TCO (temperature, conductivity, and oxygen) system, the CTD also interfaces with a transmissometer, fluorometer, PAR/SPAR meters, altimeter, nitrate, and pH sensor.</li>
<li>Connected to a shipboard data-acquisition computer through an electronically-conductive winch wire, sensor data are collected and displayed real-time using Seasave V7.</li>
<li>The CTD is normally lowered to terminal depth of 515 m, bottom-depth permitting, but is routinely deployed within meters from the seafloor at nearshore SCCOOS and basin stations.</li>
<li>To ensure high resolution sampling in areas with significant hydrological and biological gradients a speed of ~30 m/min is used for the first 100 m then ~60 m/min to depth without stopping.</li>
<li>During retrieval, the CTD is paused for at least 20 seconds at target bottle depths to adequately flush each 10 liter sample bottle prior to closure. Seawater samples are analyzed onboard (e.g., salinity, oxygen, nutrients, chl) and are used to correct measured CTD values.</li>
</ul>
</div>
</div>
</div>
<ul>
<li>Mahmoud &amp; Mas (2022) <a href="https://repository.oceanbestpractices.org/handle/11329/2081">Standard Operating Procedure: CTD data pre-processing</a>. <em>Ocean Best Practices</em></li>
</ul>
<!-- -->
<ul>
<li></li>
</ul>
<pre><code>@article{mohamed2022standard,
  title={Standard Operating Procedure: CTD data pre-processing.},
  author={Mohamed Mahmoud, Mohamed and Munoz Mas, Cristian},
  year={2022},
  publisher={Institut Mauritanien De Recherches Oc{\'e}anographiques Et De P{\^e}ches (IMROP)}
}</code></pre>
</section>
<section id="check-for-duplicates" class="level3" data-number="8.2">
<h3 data-number="8.2" class="anchored" data-anchor-id="check-for-duplicates"><span class="header-section-number">8.2</span> Check for duplicates</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: look for duplicates by dtime_utc, depth</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>d_dupes <span class="ot">&lt;-</span> d_bind <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(dtime_utc, depth) <span class="sc">|&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="co">#  761,429 × 3</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># get number of distinct dtime_utc, depth</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>n_distinct_dtime_depth <span class="ot">&lt;-</span> d_bind <span class="sc">|&gt;</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dtime_utc, depth) <span class="sc">|&gt;</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">n_distinct</span>() <span class="co"># 5,994,226</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>d_dupes <span class="sc">|&gt;</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, (<span class="fu">n</span>() <span class="sc">-</span> <span class="dv">9</span>)<span class="sc">:</span><span class="fu">n</span>())) <span class="sc">|&gt;</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="fu">glue</span>(</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">"First and last 10 rows of duplicates by dtime_utc, depth (nrows = {format(nrow(d_dupes), big.mark = ',')}; n_distinct_dtime_depth = {format(n_distinct_dtime_depth, big.mark = ',')})"</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-a60af2306131c03e4921" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a60af2306131c03e4921">{"x":{"filter":"none","vertical":false,"caption":"<caption>First and last 10 rows of duplicates by dtime_utc, depth (nrows = 761,429; n_distinct_dtime_depth = 5,994,226)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],["2008-01-19T19:49:19Z","2008-01-21T04:33:29Z","2008-01-24T11:47:37Z","1998-04-06T23:17:17Z","1998-04-08T00:04:17Z","1998-04-13T23:39:36Z","1998-04-13T23:39:37Z","1998-04-17T17:32:16Z","1998-04-17T21:08:44Z","1998-04-20T04:15:26Z","2025-04-12T01:07:55Z","2025-04-13T18:53:00Z","2025-04-13T18:53:00Z","2025-04-13T18:53:00Z","2025-04-13T18:53:00Z","2025-04-13T18:53:00Z","2025-04-13T18:53:00Z","2025-04-14T18:06:29Z","2025-04-18T01:12:00Z","2025-04-18T12:07:38Z"],[515,513,514,519,538,82,81,510,226,508,515,514,515,516,517,518,519,520,519,518],[6,6,6,4,4,4,4,4,4,4,2,2,2,2,2,2,2,2,2,2]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>dtime_utc<\/th>\n      <th>depth<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"dtime_utc","targets":1},{"name":"depth","targets":2},{"name":"n","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="ingest-into-duckdb" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="ingest-into-duckdb"><span class="header-section-number">9</span> Ingest into DuckDB</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write to DuckDB</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(con, <span class="st">"ctd"</span>, d_bind, <span class="at">overwrite =</span> T)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Ingested {nrow(d_bind)} rows into DuckDB table 'ctd'"</span>))</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># write point_geom as geometry column</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">glue</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Adding spatially indexed column point_geom from lon_dec and lat_dec..."</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con, <span class="st">"ALTER TABLE ctd ADD COLUMN point_geom GEOMETRY;"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con, <span class="st">"UPDATE ctd SET point_geom = ST_Point(lon_dec, lat_dec);"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6813712</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  con,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CREATE INDEX idx_ctd_point_geom ON ctd USING RTREE(point_geom);"</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># disconnect</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con, <span class="at">shutdown =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="summary" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="summary"><span class="header-section-number">10</span> Summary</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reconnect to show final table structure</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(duckdb<span class="sc">::</span><span class="fu">duckdb</span>(), <span class="at">dbdir =</span> db_path, <span class="at">read_only =</span> T)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># table info</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dbListTables</span>(con)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ctd"</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># show column names</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl</span>(con, <span class="st">"ctd"</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>() <span class="sc">|&gt;</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "cruise_id"           "source_file"         "data_stage"         
 [4] "cast_dir"            "ord_occ"             "event_num"          
 [7] "cast_id"             "dtime_utc"           "date_time_utc"      
[10] "date_time_pst"       "lat_dec"             "lon_dec"            
[13] "sta_id"              "line"                "sta"                
[16] "depth"               "pressure"            "pr_q"               
[19] "temp1"               "temp1q"              "temp2"              
[22] "temp2q"              "temp_ave"            "salt1"              
[25] "salt1q"              "salt1_corr"          "salt2"              
[28] "salt2q"              "salt2_corr"          "salt_ave_corr"      
[31] "ox1"                 "ox1q"                "ox1_cruise_corr"    
[34] "ox1_sta_corr"        "ox2"                 "ox2q"               
[37] "ox2_cruise_corr"     "ox2_sta_corr"        "ox_ave_sta_corr"    
[40] "ox1u_m"              "ox1u_m_cruise_corr"  "ox1u_m_sta_corr"    
[43] "ox2u_m"              "ox2u_m_cruise_corr"  "ox2u_m_sta_corr"    
[46] "ox_aveu_m_sta_corr"  "fluor_v"             "fluor_q"            
[49] "est_chl_cruise_corr" "est_chl_sta_corr"    "isusv"              
[52] "isusq"               "est_no3_cruise_corr" "est_no3_sta_corr"   
[55] "sig_theta_ts1"       "sig_theta_ts1q"      "sig_theta_ts2"      
[58] "sig_theta_ts2q"      "bat"                 "x_miss"             
[61] "trans_q"             "p_h"                 "p_hq"               
[64] "spar"                "sparq"               "par"                
[67] "parq"                "po_t1"               "po_t2"              
[70] "dyn_ht"              "sva"                 "ox_sat1"            
[73] "ox_sat2"             "btl_depth"           "btl_temp"           
[76] "salt_b"              "ox_b"                "ox_bu_m"            
[79] "chl_a"               "phaeo"               "no3"                
[82] "no2"                 "nh4"                 "po4"                
[85] "sil"                 "point_geom"         </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summary by stage and cast direction</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl</span>(con, <span class="st">"ctd"</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(data_stage, cast_dir) <span class="sc">|&gt;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  data_stage  cast_dir       n
  &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt;
1 final       U        2818276
2 preliminary U         525062
3 final       &lt;NA&gt;      136054
4 preliminary D         525193
5 final       D        2809127</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: why 136,054 rows of cast_dir NA (with final)?</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># preview data</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl</span>(con, <span class="st">"ctd"</span>) <span class="sc">|&gt;</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select(cruise_id, stage, cast_dir, lat_dec, lon_dec) |&gt;</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">20</span>) <span class="sc">|&gt;</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 86
   cruise_id source_file           data_stage cast_dir ord_occ event_num cast_id
   &lt;chr&gt;     &lt;chr&gt;                 &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;  
 1 9802JD    19-9802JD_CTDFinalQC… final      D        001            NA 9802_0…
 2 9802JD    19-9802JD_CTDFinalQC… final      D        001            NA 9802_0…
 3 9802JD    19-9802JD_CTDFinalQC… final      D        001            NA 9802_0…
 4 9802JD    19-9802JD_CTDFinalQC… final      D        001            NA 9802_0…
 5 9802JD    19-9802JD_CTDFinalQC… final      D        001            NA 9802_0…
 6 9802JD    19-9802JD_CTDFinalQC… final      D        001            NA 9802_0…
 7 9802JD    19-9802JD_CTDFinalQC… final      D        001            NA 9802_0…
 8 9802JD    19-9802JD_CTDFinalQC… final      D        001            NA 9802_0…
 9 9802JD    19-9802JD_CTDFinalQC… final      D        001            NA 9802_0…
10 9802JD    19-9802JD_CTDFinalQC… final      D        001            NA 9802_0…
11 9802JD    19-9802JD_CTDFinalQC… final      D        001            NA 9802_0…
12 9802JD    19-9802JD_CTDFinalQC… final      D        001            NA 9802_0…
13 9802JD    19-9802JD_CTDFinalQC… final      D        001            NA 9802_0…
14 9802JD    19-9802JD_CTDFinalQC… final      D        001            NA 9802_0…
15 9802JD    19-9802JD_CTDFinalQC… final      D        001            NA 9802_0…
16 9802JD    19-9802JD_CTDFinalQC… final      D        001            NA 9802_0…
17 9802JD    19-9802JD_CTDFinalQC… final      D        001            NA 9802_0…
18 9802JD    19-9802JD_CTDFinalQC… final      D        001            NA 9802_0…
19 9802JD    19-9802JD_CTDFinalQC… final      D        001            NA 9802_0…
20 9802JD    19-9802JD_CTDFinalQC… final      D        001            NA 9802_0…
# ℹ 79 more variables: dtime_utc &lt;dttm&gt;, date_time_utc &lt;chr&gt;,
#   date_time_pst &lt;chr&gt;, lat_dec &lt;dbl&gt;, lon_dec &lt;dbl&gt;, sta_id &lt;chr&gt;,
#   line &lt;chr&gt;, sta &lt;chr&gt;, depth &lt;dbl&gt;, pressure &lt;dbl&gt;, pr_q &lt;dbl&gt;,
#   temp1 &lt;dbl&gt;, temp1q &lt;dbl&gt;, temp2 &lt;dbl&gt;, temp2q &lt;dbl&gt;, temp_ave &lt;dbl&gt;,
#   salt1 &lt;dbl&gt;, salt1q &lt;dbl&gt;, salt1_corr &lt;dbl&gt;, salt2 &lt;dbl&gt;, salt2q &lt;dbl&gt;,
#   salt2_corr &lt;dbl&gt;, salt_ave_corr &lt;dbl&gt;, ox1 &lt;dbl&gt;, ox1q &lt;dbl&gt;,
#   ox1_cruise_corr &lt;dbl&gt;, ox1_sta_corr &lt;dbl&gt;, ox2 &lt;dbl&gt;, ox2q &lt;dbl&gt;, …</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con, <span class="at">shutdown =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="interactive-gantt-chart" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="interactive-gantt-chart"><span class="header-section-number">11</span> Interactive Gantt Chart</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>librarian<span class="sc">::</span><span class="fu">shelf</span>(plotly, <span class="at">quiet =</span> T)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># reconnect to database</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(duckdb<span class="sc">::</span><span class="fu">duckdb</span>(), <span class="at">dbdir =</span> db_path, <span class="at">read_only =</span> T)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"># tbl(con, "ctd") |&gt;</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(n = n())</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 210,507</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co"># tbl(con, "ctd") |&gt;</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(study == "2301RL") |&gt;</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   distinct(study) |&gt;</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   pull(study) |&gt;</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   sort()</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 20 - 2401</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="co"># RL_CTDBTL_017 - 033</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="co"># U.csv</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="co"># tbl(con, "ctd") |&gt;</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   pull(study) |&gt;</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   table(useNA = "ifany")</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="co">#  9802JD   9804JD</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a><span class="co">#  59,005  151,502</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a><span class="co"># get cruise date spans by cruise and stage</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>cruise_spans <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"ctd"</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rename(data_stage = data_type) |&gt; # DEBUG</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cruise_id, data_stage) <span class="sc">|&gt;</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">beg_date =</span> <span class="fu">min</span>(dtime_utc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> <span class="fu">as.Date</span>(),</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_date =</span> <span class="fu">max</span>(dtime_utc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> <span class="fu">as.Date</span>(),</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>() <span class="sc">|&gt;</span></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(beg_date), <span class="sc">!</span><span class="fu">is.na</span>(end_date))</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Split multi-year cruises into separate rows</span></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>cruise_spans <span class="ot">&lt;-</span> cruise_spans <span class="sc">|&gt;</span></span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">years_spanned =</span> <span class="fu">list</span>(<span class="fu">year</span>(beg_date)<span class="sc">:</span><span class="fu">year</span>(end_date))</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(years_spanned) <span class="sc">|&gt;</span></span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adjust dates for each year segment</span></span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> years_spanned,</span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">adj_beg_date =</span> <span class="fu">if_else</span>(</span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>      years_spanned <span class="sc">==</span> <span class="fu">year</span>(beg_date),</span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>      beg_date,</span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.Date</span>(<span class="fu">paste0</span>(years_spanned, <span class="st">"-01-01"</span>))</span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">adj_end_date =</span> <span class="fu">if_else</span>(</span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>      years_spanned <span class="sc">==</span> <span class="fu">year</span>(end_date),</span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a>      end_date,</span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.Date</span>(<span class="fu">paste0</span>(years_spanned, <span class="st">"-12-31"</span>))</span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">begin_jday =</span> <span class="fu">yday</span>(adj_beg_date),</span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_jday =</span> <span class="fu">yday</span>(adj_end_date),</span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">stage_label =</span> data_stage,</span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">hover_text =</span> <span class="fu">glue</span>(</span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Cruise: {cruise_id}&lt;br&gt;"</span>,</span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Stage: {data_stage}&lt;br&gt;"</span>,</span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Begin: {format(beg_date, '%Y-%m-%d')}&lt;br&gt;"</span>,</span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a>      <span class="st">"End: {format(end_date, '%Y-%m-%d')}&lt;br&gt;"</span>,</span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Duration: {as.numeric(difftime(end_date, beg_date, units = 'days'))} days"</span></span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(adj_beg_date)</span>
<span id="cb31-70"><a href="#cb31-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-71"><a href="#cb31-71" aria-hidden="true" tabindex="-1"></a><span class="co"># create color mapping</span></span>
<span id="cb31-72"><a href="#cb31-72" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"final"</span> <span class="ot">=</span> <span class="st">"#23d355ff"</span>, <span class="st">"preliminary"</span> <span class="ot">=</span> <span class="st">"#A23B72"</span>)</span>
<span id="cb31-73"><a href="#cb31-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-74"><a href="#cb31-74" aria-hidden="true" tabindex="-1"></a><span class="co"># create interactive gantt chart</span></span>
<span id="cb31-75"><a href="#cb31-75" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>()</span>
<span id="cb31-76"><a href="#cb31-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-77"><a href="#cb31-77" aria-hidden="true" tabindex="-1"></a><span class="co"># add traces for each cruise segment</span></span>
<span id="cb31-78"><a href="#cb31-78" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(cruise_spans)) {</span>
<span id="cb31-79"><a href="#cb31-79" aria-hidden="true" tabindex="-1"></a>  row <span class="ot">&lt;-</span> cruise_spans[i, ]</span>
<span id="cb31-80"><a href="#cb31-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-81"><a href="#cb31-81" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p <span class="sc">|&gt;</span></span>
<span id="cb31-82"><a href="#cb31-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_trace</span>(</span>
<span id="cb31-83"><a href="#cb31-83" aria-hidden="true" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">"scatter"</span>,</span>
<span id="cb31-84"><a href="#cb31-84" aria-hidden="true" tabindex="-1"></a>      <span class="at">mode =</span> <span class="st">"lines"</span>,</span>
<span id="cb31-85"><a href="#cb31-85" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">c</span>(row<span class="sc">$</span>begin_jday, row<span class="sc">$</span>end_jday),</span>
<span id="cb31-86"><a href="#cb31-86" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">c</span>(row<span class="sc">$</span>year, row<span class="sc">$</span>year),</span>
<span id="cb31-87"><a href="#cb31-87" aria-hidden="true" tabindex="-1"></a>      <span class="at">line =</span> <span class="fu">list</span>(</span>
<span id="cb31-88"><a href="#cb31-88" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> colors[row<span class="sc">$</span>stage_label],</span>
<span id="cb31-89"><a href="#cb31-89" aria-hidden="true" tabindex="-1"></a>        <span class="at">width =</span> <span class="dv">8</span></span>
<span id="cb31-90"><a href="#cb31-90" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb31-91"><a href="#cb31-91" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> row<span class="sc">$</span>hover_text,</span>
<span id="cb31-92"><a href="#cb31-92" aria-hidden="true" tabindex="-1"></a>      <span class="at">hoverinfo =</span> <span class="st">"text"</span>,</span>
<span id="cb31-93"><a href="#cb31-93" aria-hidden="true" tabindex="-1"></a>      <span class="at">showlegend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-94"><a href="#cb31-94" aria-hidden="true" tabindex="-1"></a>      <span class="at">legendgroup =</span> row<span class="sc">$</span>stage_label</span>
<span id="cb31-95"><a href="#cb31-95" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-96"><a href="#cb31-96" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-97"><a href="#cb31-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-98"><a href="#cb31-98" aria-hidden="true" tabindex="-1"></a><span class="co"># add legend traces</span></span>
<span id="cb31-99"><a href="#cb31-99" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">|&gt;</span></span>
<span id="cb31-100"><a href="#cb31-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(</span>
<span id="cb31-101"><a href="#cb31-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"scatter"</span>,</span>
<span id="cb31-102"><a href="#cb31-102" aria-hidden="true" tabindex="-1"></a>    <span class="at">mode =</span> <span class="st">"lines"</span>,</span>
<span id="cb31-103"><a href="#cb31-103" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb31-104"><a href="#cb31-104" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb31-105"><a href="#cb31-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> colors[<span class="st">"final"</span>], <span class="at">width =</span> <span class="dv">8</span>),</span>
<span id="cb31-106"><a href="#cb31-106" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Final"</span>,</span>
<span id="cb31-107"><a href="#cb31-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">showlegend =</span> <span class="cn">TRUE</span></span>
<span id="cb31-108"><a href="#cb31-108" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb31-109"><a href="#cb31-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(</span>
<span id="cb31-110"><a href="#cb31-110" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"scatter"</span>,</span>
<span id="cb31-111"><a href="#cb31-111" aria-hidden="true" tabindex="-1"></a>    <span class="at">mode =</span> <span class="st">"lines"</span>,</span>
<span id="cb31-112"><a href="#cb31-112" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb31-113"><a href="#cb31-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb31-114"><a href="#cb31-114" aria-hidden="true" tabindex="-1"></a>    <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> colors[<span class="st">"preliminary"</span>], <span class="at">width =</span> <span class="dv">8</span>),</span>
<span id="cb31-115"><a href="#cb31-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Preliminary"</span>,</span>
<span id="cb31-116"><a href="#cb31-116" aria-hidden="true" tabindex="-1"></a>    <span class="at">showlegend =</span> <span class="cn">TRUE</span></span>
<span id="cb31-117"><a href="#cb31-117" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-118"><a href="#cb31-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-119"><a href="#cb31-119" aria-hidden="true" tabindex="-1"></a><span class="co"># customize layout</span></span>
<span id="cb31-120"><a href="#cb31-120" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">|&gt;</span></span>
<span id="cb31-121"><a href="#cb31-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb31-122"><a href="#cb31-122" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"CalCOFI CTD Cruise Timeline"</span>,</span>
<span id="cb31-123"><a href="#cb31-123" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(</span>
<span id="cb31-124"><a href="#cb31-124" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Day of Year"</span>,</span>
<span id="cb31-125"><a href="#cb31-125" aria-hidden="true" tabindex="-1"></a>      <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">365</span>),</span>
<span id="cb31-126"><a href="#cb31-126" aria-hidden="true" tabindex="-1"></a>      <span class="at">dtick =</span> <span class="dv">30</span>,</span>
<span id="cb31-127"><a href="#cb31-127" aria-hidden="true" tabindex="-1"></a>      <span class="at">tickangle =</span> <span class="dv">0</span></span>
<span id="cb31-128"><a href="#cb31-128" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-129"><a href="#cb31-129" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(</span>
<span id="cb31-130"><a href="#cb31-130" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Year"</span>,</span>
<span id="cb31-131"><a href="#cb31-131" aria-hidden="true" tabindex="-1"></a>      <span class="at">autorange =</span> <span class="st">"reversed"</span>,</span>
<span id="cb31-132"><a href="#cb31-132" aria-hidden="true" tabindex="-1"></a>      <span class="at">dtick =</span> <span class="dv">1</span></span>
<span id="cb31-133"><a href="#cb31-133" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-134"><a href="#cb31-134" aria-hidden="true" tabindex="-1"></a>    <span class="at">hovermode =</span> <span class="st">"closest"</span>,</span>
<span id="cb31-135"><a href="#cb31-135" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot_bgcolor =</span> <span class="st">"#f8f9fa"</span>,</span>
<span id="cb31-136"><a href="#cb31-136" aria-hidden="true" tabindex="-1"></a>    <span class="at">paper_bgcolor =</span> <span class="st">"white"</span>,</span>
<span id="cb31-137"><a href="#cb31-137" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend =</span> <span class="fu">list</span>(</span>
<span id="cb31-138"><a href="#cb31-138" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fl">1.02</span>,</span>
<span id="cb31-139"><a href="#cb31-139" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="dv">1</span>,</span>
<span id="cb31-140"><a href="#cb31-140" aria-hidden="true" tabindex="-1"></a>      <span class="at">xanchor =</span> <span class="st">"left"</span>,</span>
<span id="cb31-141"><a href="#cb31-141" aria-hidden="true" tabindex="-1"></a>      <span class="at">yanchor =</span> <span class="st">"top"</span></span>
<span id="cb31-142"><a href="#cb31-142" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-143"><a href="#cb31-143" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-144"><a href="#cb31-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-145"><a href="#cb31-145" aria-hidden="true" tabindex="-1"></a><span class="co"># display chart</span></span>
<span id="cb31-146"><a href="#cb31-146" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-b245592a6c999886327a" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-b245592a6c999886327a">{"x":{"visdat":{"9010165a0854":["function () ","plotlyVisDat"]},"cur_data":"9010165a0854","attrs":{"9010165a0854":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[23,41],"y":[1998,1998],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 9802JD<br>Stage: final<br>Begin: 1998-01-23<br>End: 1998-02-10<br>Duration: 18 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[92,112],"y":[1998,1998],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 9804JD<br>Stage: final<br>Begin: 1998-04-02<br>End: 1998-04-22<br>Duration: 20 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[189,206],"y":[1998,1998],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 9807NH<br>Stage: final<br>Begin: 1998-07-08<br>End: 1998-07-25<br>Duration: 17 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[30,54],"y":[2003,2003],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0302JD<br>Stage: final<br>Begin: 2003-01-30<br>End: 2003-02-23<br>Duration: 24 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[198,211],"y":[2003,2003],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0307NH<br>Stage: final<br>Begin: 2003-07-17<br>End: 2003-07-30<br>Duration: 13 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.5":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[293,307],"y":[2003,2003],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0310NH<br>Stage: final<br>Begin: 2003-10-20<br>End: 2003-11-03<br>Duration: 14 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.6":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[6,27],"y":[2004,2004],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0401JD<br>Stage: final<br>Begin: 2004-01-06<br>End: 2004-01-27<br>Duration: 21 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.7":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[83,99],"y":[2004,2004],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0404NH<br>Stage: final<br>Begin: 2004-03-23<br>End: 2004-04-08<br>Duration: 16 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.8":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[105,113],"y":[2004,2004],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0404JD<br>Stage: final<br>Begin: 2004-04-14<br>End: 2004-04-22<br>Duration: 8 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.9":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[195,210],"y":[2004,2004],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0407JD<br>Stage: final<br>Begin: 2004-07-13<br>End: 2004-07-28<br>Duration: 15 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.10":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[307,324],"y":[2004,2004],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0411RR<br>Stage: final<br>Begin: 2004-11-02<br>End: 2004-11-19<br>Duration: 17 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.11":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[4,20],"y":[2005,2005],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0501NH<br>Stage: final<br>Begin: 2005-01-04<br>End: 2005-01-20<br>Duration: 16 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.12":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[105,120],"y":[2005,2005],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0504NH<br>Stage: final<br>Begin: 2005-04-15<br>End: 2005-04-30<br>Duration: 15 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.13":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[182,197],"y":[2005,2005],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0507NH<br>Stage: final<br>Begin: 2005-07-01<br>End: 2005-07-16<br>Duration: 15 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.14":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[308,324],"y":[2005,2005],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0511NH<br>Stage: final<br>Begin: 2005-11-04<br>End: 2005-11-20<br>Duration: 16 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.15":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[34,56],"y":[2006,2006],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0602JD<br>Stage: final<br>Begin: 2006-02-03<br>End: 2006-02-25<br>Duration: 22 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.16":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[91,107],"y":[2006,2006],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0604NH<br>Stage: final<br>Begin: 2006-04-01<br>End: 2006-04-17<br>Duration: 16 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.17":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[189,204],"y":[2006,2006],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0607NH<br>Stage: final<br>Begin: 2006-07-08<br>End: 2006-07-23<br>Duration: 15 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.18":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[294,309],"y":[2006,2006],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0610RR<br>Stage: final<br>Begin: 2006-10-21<br>End: 2006-11-05<br>Duration: 15 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.19":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[365,365],"y":[2006,2006],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0701JD<br>Stage: final<br>Begin: 2006-12-31<br>End: 2007-02-01<br>Duration: 32 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.20":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[1,32],"y":[2007,2007],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0701JD<br>Stage: final<br>Begin: 2006-12-31<br>End: 2007-02-01<br>Duration: 32 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.21":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[87,119],"y":[2007,2007],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0704JD<br>Stage: final<br>Begin: 2007-03-28<br>End: 2007-04-29<br>Duration: 32 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.22":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[179,194],"y":[2007,2007],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0707NH<br>Stage: final<br>Begin: 2007-06-28<br>End: 2007-07-13<br>Duration: 15 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.23":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[307,322],"y":[2007,2007],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0711NH<br>Stage: final<br>Begin: 2007-11-03<br>End: 2007-11-18<br>Duration: 15 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.24":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[7,25],"y":[2008,2008],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0801JD<br>Stage: final<br>Begin: 2008-01-07<br>End: 2008-01-25<br>Duration: 18 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.25":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[85,121],"y":[2008,2008],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0804JD<br>Stage: final<br>Begin: 2008-03-25<br>End: 2008-04-30<br>Duration: 36 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.26":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[227,242],"y":[2008,2008],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0808NH<br>Stage: final<br>Begin: 2008-08-14<br>End: 2008-08-29<br>Duration: 15 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.27":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[288,304],"y":[2008,2008],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0810NH<br>Stage: final<br>Begin: 2008-10-14<br>End: 2008-10-30<br>Duration: 16 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.28":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[8,23],"y":[2009,2009],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0901NH<br>Stage: final<br>Begin: 2009-01-08<br>End: 2009-01-23<br>Duration: 15 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.29":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[67,81],"y":[2009,2009],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0903JD<br>Stage: final<br>Begin: 2009-03-08<br>End: 2009-03-22<br>Duration: 14 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.30":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[196,215],"y":[2009,2009],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0907M2<br>Stage: final<br>Begin: 2009-07-15<br>End: 2009-08-03<br>Duration: 19 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.31":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[310,327],"y":[2009,2009],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0911NH<br>Stage: final<br>Begin: 2009-11-06<br>End: 2009-11-23<br>Duration: 17 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.32":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[13,35],"y":[2010,2010],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1001NH<br>Stage: final<br>Begin: 2010-01-13<br>End: 2010-02-04<br>Duration: 22 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.33":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[117,137],"y":[2010,2010],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1004MF<br>Stage: final<br>Begin: 2010-04-27<br>End: 2010-05-17<br>Duration: 20 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.34":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[211,228],"y":[2010,2010],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1008NH<br>Stage: final<br>Begin: 2010-07-30<br>End: 2010-08-16<br>Duration: 17 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.35":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[301,316],"y":[2010,2010],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1011NH<br>Stage: final<br>Begin: 2010-10-28<br>End: 2010-11-12<br>Duration: 15 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.36":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[13,35],"y":[2011,2011],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1101NH<br>Stage: final<br>Begin: 2011-01-13<br>End: 2011-02-04<br>Duration: 22 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.37":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[99,116],"y":[2011,2011],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1104SH<br>Stage: final<br>Begin: 2011-04-09<br>End: 2011-04-26<br>Duration: 17 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.38":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[208,224],"y":[2011,2011],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1108NH<br>Stage: final<br>Begin: 2011-07-27<br>End: 2011-08-12<br>Duration: 16 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.39":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[289,305],"y":[2011,2011],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1110NH<br>Stage: final<br>Begin: 2011-10-16<br>End: 2011-11-01<br>Duration: 16 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.40":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[27,43],"y":[2012,2012],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1202NH<br>Stage: final<br>Begin: 2012-01-27<br>End: 2012-02-12<br>Duration: 16 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.41":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[85,97],"y":[2012,2012],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1203SH<br>Stage: final<br>Begin: 2012-03-25<br>End: 2012-04-06<br>Duration: 12 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.42":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[185,208],"y":[2012,2012],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1207OS<br>Stage: final<br>Begin: 2012-07-03<br>End: 2012-07-26<br>Duration: 23 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.43":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[293,310],"y":[2012,2012],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1210NH<br>Stage: final<br>Begin: 2012-10-19<br>End: 2012-11-05<br>Duration: 17 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.44":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[366,366],"y":[2012,2012],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1307NH<br>Stage: final<br>Begin: 2012-12-31<br>End: 2013-07-21<br>Duration: 202 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.45":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[1,202],"y":[2013,2013],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1307NH<br>Stage: final<br>Begin: 2012-12-31<br>End: 2013-07-21<br>Duration: 202 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.46":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[11,31],"y":[2013,2013],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1301SH<br>Stage: final<br>Begin: 2013-01-11<br>End: 2013-01-31<br>Duration: 20 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.47":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[97,120],"y":[2013,2013],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1304SH<br>Stage: final<br>Begin: 2013-04-07<br>End: 2013-04-30<br>Duration: 23 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.48":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[313,329],"y":[2013,2013],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1311NH<br>Stage: final<br>Begin: 2013-11-09<br>End: 2013-11-25<br>Duration: 16 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.49":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[365,365],"y":[2013,2013],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1402SH<br>Stage: final<br>Begin: 2013-12-31<br>End: 2014-02-05<br>Duration: 36 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.50":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[1,36],"y":[2014,2014],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1402SH<br>Stage: final<br>Begin: 2013-12-31<br>End: 2014-02-05<br>Duration: 36 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.51":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[88,107],"y":[2014,2014],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1404OS<br>Stage: final<br>Begin: 2014-03-29<br>End: 2014-04-17<br>Duration: 19 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.52":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[187,202],"y":[2014,2014],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1407NH<br>Stage: final<br>Begin: 2014-07-06<br>End: 2014-07-21<br>Duration: 15 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.53":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[312,327],"y":[2014,2014],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1411NH<br>Stage: final<br>Begin: 2014-11-08<br>End: 2014-11-23<br>Duration: 15 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.54":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[15,36],"y":[2015,2015],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1501NH<br>Stage: final<br>Begin: 2015-01-15<br>End: 2015-02-05<br>Duration: 21 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.55":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[94,109],"y":[2015,2015],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1504NH<br>Stage: final<br>Begin: 2015-04-04<br>End: 2015-04-19<br>Duration: 15 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.56":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[189,205],"y":[2015,2015],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1507OC<br>Stage: final<br>Begin: 2015-07-08<br>End: 2015-07-24<br>Duration: 16 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.57":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[301,317],"y":[2015,2015],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1511OC<br>Stage: final<br>Begin: 2015-10-28<br>End: 2015-11-13<br>Duration: 16 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.58":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[7,29],"y":[2016,2016],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1601RL<br>Stage: final<br>Begin: 2016-01-07<br>End: 2016-01-29<br>Duration: 22 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.59":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[92,113],"y":[2016,2016],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1604SH<br>Stage: final<br>Begin: 2016-04-01<br>End: 2016-04-22<br>Duration: 21 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.60":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[192,208],"y":[2016,2016],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1607OS<br>Stage: final<br>Begin: 2016-07-10<br>End: 2016-07-26<br>Duration: 16 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.61":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[311,326],"y":[2016,2016],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1611SR<br>Stage: final<br>Begin: 2016-11-06<br>End: 2016-11-21<br>Duration: 15 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.62":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[6,28],"y":[2017,2017],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1701RL<br>Stage: final<br>Begin: 2017-01-06<br>End: 2017-01-28<br>Duration: 22 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.63":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[88,110],"y":[2017,2017],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1704SH<br>Stage: final<br>Begin: 2017-03-29<br>End: 2017-04-20<br>Duration: 22 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.64":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[213,228],"y":[2017,2017],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1708SR<br>Stage: final<br>Begin: 2017-08-01<br>End: 2017-08-16<br>Duration: 15 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.65":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[313,328],"y":[2017,2017],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1711SR<br>Stage: final<br>Begin: 2017-11-09<br>End: 2017-11-24<br>Duration: 15 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.66":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[32,41],"y":[2018,2018],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1802SH<br>Stage: final<br>Begin: 2018-02-01<br>End: 2018-02-10<br>Duration: 9 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.67":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[95,116],"y":[2018,2018],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1804SH<br>Stage: final<br>Begin: 2018-04-05<br>End: 2018-04-26<br>Duration: 21 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.68":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[160,175],"y":[2018,2018],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1806SR<br>Stage: final<br>Begin: 2018-06-09<br>End: 2018-06-24<br>Duration: 15 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.69":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[287,302],"y":[2018,2018],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1810SR<br>Stage: final<br>Begin: 2018-10-14<br>End: 2018-10-29<br>Duration: 15 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.70":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[37,43],"y":[2019,2019],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1902RL<br>Stage: final<br>Begin: 2019-02-06<br>End: 2019-02-12<br>Duration: 6 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.71":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[92,107],"y":[2019,2019],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1904RL<br>Stage: final<br>Begin: 2019-04-02<br>End: 2019-04-17<br>Duration: 15 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.72":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[192,207],"y":[2019,2019],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1907BH<br>Stage: final<br>Begin: 2019-07-11<br>End: 2019-07-26<br>Duration: 15 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.73":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[308,322],"y":[2019,2019],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1911OC<br>Stage: final<br>Begin: 2019-11-04<br>End: 2019-11-18<br>Duration: 14 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.74":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[5,26],"y":[2020,2020],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 2001RL<br>Stage: final<br>Begin: 2020-01-05<br>End: 2020-01-26<br>Duration: 21 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.75":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[195,209],"y":[2020,2020],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 2007SR<br>Stage: final<br>Begin: 2020-07-13<br>End: 2020-07-27<br>Duration: 14 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.76":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[285,298],"y":[2020,2020],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 2010SR<br>Stage: final<br>Begin: 2020-10-11<br>End: 2020-10-24<br>Duration: 13 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.77":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[16,34],"y":[2021,2021],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 2101RL<br>Stage: final<br>Begin: 2021-01-16<br>End: 2021-02-03<br>Duration: 18 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.78":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[124,133],"y":[2021,2021],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 2105SH<br>Stage: final<br>Begin: 2021-05-04<br>End: 2021-05-13<br>Duration: 9 days","hoverinfo":"text","showlegend":false,"legendgroup":"final","inherit":true},"9010165a0854.79":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[200,213],"y":[2021,2021],"line":{"color":"#A23B72","width":8},"text":"Cruise: 2107SR<br>Stage: preliminary<br>Begin: 2021-07-19<br>End: 2021-08-01<br>Duration: 13 days","hoverinfo":"text","showlegend":false,"legendgroup":"preliminary","inherit":true},"9010165a0854.80":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[304,318],"y":[2021,2021],"line":{"color":"#A23B72","width":8},"text":"Cruise: 2111SR<br>Stage: preliminary<br>Begin: 2021-10-31<br>End: 2021-11-14<br>Duration: 14 days","hoverinfo":"text","showlegend":false,"legendgroup":"preliminary","inherit":true},"9010165a0854.81":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[97,117],"y":[2022,2022],"line":{"color":"#A23B72","width":8},"text":"Cruise: 2204SH<br>Stage: preliminary<br>Begin: 2022-04-07<br>End: 2022-04-27<br>Duration: 20 days","hoverinfo":"text","showlegend":false,"legendgroup":"preliminary","inherit":true},"9010165a0854.82":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[227,242],"y":[2022,2022],"line":{"color":"#A23B72","width":8},"text":"Cruise: 2208BH<br>Stage: preliminary<br>Begin: 2022-08-15<br>End: 2022-08-30<br>Duration: 15 days","hoverinfo":"text","showlegend":false,"legendgroup":"preliminary","inherit":true},"9010165a0854.83":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[309,324],"y":[2022,2022],"line":{"color":"#A23B72","width":8},"text":"Cruise: 2211SR<br>Stage: preliminary<br>Begin: 2022-11-05<br>End: 2022-11-20<br>Duration: 15 days","hoverinfo":"text","showlegend":false,"legendgroup":"preliminary","inherit":true},"9010165a0854.84":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[7,25],"y":[2023,2023],"line":{"color":"#A23B72","width":8},"text":"Cruise: 2301RL<br>Stage: preliminary<br>Begin: 2023-01-07<br>End: 2023-01-25<br>Duration: 18 days","hoverinfo":"text","showlegend":false,"legendgroup":"preliminary","inherit":true},"9010165a0854.85":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[84,113],"y":[2023,2023],"line":{"color":"#A23B72","width":8},"text":"Cruise: 2304SH<br>Stage: preliminary<br>Begin: 2023-03-25<br>End: 2023-04-23<br>Duration: 29 days","hoverinfo":"text","showlegend":false,"legendgroup":"preliminary","inherit":true},"9010165a0854.86":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[184,199],"y":[2023,2023],"line":{"color":"#A23B72","width":8},"text":"Cruise: 2307SR<br>Stage: preliminary<br>Begin: 2023-07-03<br>End: 2023-07-18<br>Duration: 15 days","hoverinfo":"text","showlegend":false,"legendgroup":"preliminary","inherit":true},"9010165a0854.87":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[308,322],"y":[2023,2023],"line":{"color":"#A23B72","width":8},"text":"Cruise: 2311SR<br>Stage: preliminary<br>Begin: 2023-11-04<br>End: 2023-11-18<br>Duration: 14 days","hoverinfo":"text","showlegend":false,"legendgroup":"preliminary","inherit":true},"9010165a0854.88":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[11,25],"y":[2024,2024],"line":{"color":"#A23B72","width":8},"text":"Cruise: 2401RL<br>Stage: preliminary<br>Begin: 2024-01-11<br>End: 2024-01-25<br>Duration: 14 days","hoverinfo":"text","showlegend":false,"legendgroup":"preliminary","inherit":true},"9010165a0854.89":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[87,110],"y":[2024,2024],"line":{"color":"#A23B72","width":8},"text":"Cruise: 2404SH<br>Stage: preliminary<br>Begin: 2024-03-27<br>End: 2024-04-19<br>Duration: 23 days","hoverinfo":"text","showlegend":false,"legendgroup":"preliminary","inherit":true},"9010165a0854.90":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[209,224],"y":[2024,2024],"line":{"color":"#A23B72","width":8},"text":"Cruise: 2408SR<br>Stage: preliminary<br>Begin: 2024-07-27<br>End: 2024-08-11<br>Duration: 15 days","hoverinfo":"text","showlegend":false,"legendgroup":"preliminary","inherit":true},"9010165a0854.91":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[320,329],"y":[2024,2024],"line":{"color":"#A23B72","width":8},"text":"Cruise: 2411SR<br>Stage: preliminary<br>Begin: 2024-11-15<br>End: 2024-11-24<br>Duration: 9 days","hoverinfo":"text","showlegend":false,"legendgroup":"preliminary","inherit":true},"9010165a0854.92":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[3,29],"y":[2025,2025],"line":{"color":"#A23B72","width":8},"text":"Cruise: 2501RL<br>Stage: preliminary<br>Begin: 2025-01-03<br>End: 2025-01-29<br>Duration: 26 days","hoverinfo":"text","showlegend":false,"legendgroup":"preliminary","inherit":true},"9010165a0854.93":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[19,20],"y":[2025,2025],"line":{"color":"#A23B72","width":8},"text":"Cruise: 2502RL<br>Stage: preliminary<br>Begin: 2025-01-19<br>End: 2025-01-20<br>Duration: 1 days","hoverinfo":"text","showlegend":false,"legendgroup":"preliminary","inherit":true},"9010165a0854.94":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[79,108],"y":[2025,2025],"line":{"color":"#A23B72","width":8},"text":"Cruise: 2504SH<br>Stage: preliminary<br>Begin: 2025-03-20<br>End: 2025-04-18<br>Duration: 29 days","hoverinfo":"text","showlegend":false,"legendgroup":"preliminary","inherit":true},"9010165a0854.95":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[199,210],"y":[2025,2025],"line":{"color":"#A23B72","width":8},"text":"Cruise: 2507SR<br>Stage: preliminary<br>Begin: 2025-07-18<br>End: 2025-07-29<br>Duration: 11 days","hoverinfo":"text","showlegend":false,"legendgroup":"preliminary","inherit":true},"9010165a0854.96":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[null,null],"y":[null,null],"line":{"color":"#23d355ff","width":8},"name":"Final","showlegend":true,"inherit":true},"9010165a0854.97":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[null,null],"y":[null,null],"line":{"color":"#A23B72","width":8},"name":"Preliminary","showlegend":true,"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"CalCOFI CTD Cruise Timeline","xaxis":{"domain":[0,1],"automargin":true,"title":"Day of Year","range":[1,365],"dtick":30,"tickangle":0},"yaxis":{"domain":[0,1],"automargin":true,"title":"Year","autorange":"reversed","dtick":1},"hovermode":"closest","plot_bgcolor":"#f8f9fa","paper_bgcolor":"white","legend":{"x":1.02,"y":1,"xanchor":"left","yanchor":"top"},"showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"type":"scatter","mode":"lines","x":[23,41],"y":[1998,1998],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 9802JD<br>Stage: final<br>Begin: 1998-01-23<br>End: 1998-02-10<br>Duration: 18 days","Cruise: 9802JD<br>Stage: final<br>Begin: 1998-01-23<br>End: 1998-02-10<br>Duration: 18 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[92,112],"y":[1998,1998],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 9804JD<br>Stage: final<br>Begin: 1998-04-02<br>End: 1998-04-22<br>Duration: 20 days","Cruise: 9804JD<br>Stage: final<br>Begin: 1998-04-02<br>End: 1998-04-22<br>Duration: 20 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[189,206],"y":[1998,1998],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 9807NH<br>Stage: final<br>Begin: 1998-07-08<br>End: 1998-07-25<br>Duration: 17 days","Cruise: 9807NH<br>Stage: final<br>Begin: 1998-07-08<br>End: 1998-07-25<br>Duration: 17 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[30,54],"y":[2003,2003],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0302JD<br>Stage: final<br>Begin: 2003-01-30<br>End: 2003-02-23<br>Duration: 24 days","Cruise: 0302JD<br>Stage: final<br>Begin: 2003-01-30<br>End: 2003-02-23<br>Duration: 24 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[198,211],"y":[2003,2003],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0307NH<br>Stage: final<br>Begin: 2003-07-17<br>End: 2003-07-30<br>Duration: 13 days","Cruise: 0307NH<br>Stage: final<br>Begin: 2003-07-17<br>End: 2003-07-30<br>Duration: 13 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[293,307],"y":[2003,2003],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0310NH<br>Stage: final<br>Begin: 2003-10-20<br>End: 2003-11-03<br>Duration: 14 days","Cruise: 0310NH<br>Stage: final<br>Begin: 2003-10-20<br>End: 2003-11-03<br>Duration: 14 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(140,86,75,1)","line":{"color":"rgba(140,86,75,1)"}},"error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[6,27],"y":[2004,2004],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0401JD<br>Stage: final<br>Begin: 2004-01-06<br>End: 2004-01-27<br>Duration: 21 days","Cruise: 0401JD<br>Stage: final<br>Begin: 2004-01-06<br>End: 2004-01-27<br>Duration: 21 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(227,119,194,1)","line":{"color":"rgba(227,119,194,1)"}},"error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[83,99],"y":[2004,2004],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0404NH<br>Stage: final<br>Begin: 2004-03-23<br>End: 2004-04-08<br>Duration: 16 days","Cruise: 0404NH<br>Stage: final<br>Begin: 2004-03-23<br>End: 2004-04-08<br>Duration: 16 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(127,127,127,1)","line":{"color":"rgba(127,127,127,1)"}},"error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[105,113],"y":[2004,2004],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0404JD<br>Stage: final<br>Begin: 2004-04-14<br>End: 2004-04-22<br>Duration: 8 days","Cruise: 0404JD<br>Stage: final<br>Begin: 2004-04-14<br>End: 2004-04-22<br>Duration: 8 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(188,189,34,1)","line":{"color":"rgba(188,189,34,1)"}},"error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[195,210],"y":[2004,2004],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0407JD<br>Stage: final<br>Begin: 2004-07-13<br>End: 2004-07-28<br>Duration: 15 days","Cruise: 0407JD<br>Stage: final<br>Begin: 2004-07-13<br>End: 2004-07-28<br>Duration: 15 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(23,190,207,1)","line":{"color":"rgba(23,190,207,1)"}},"error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[307,324],"y":[2004,2004],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0411RR<br>Stage: final<br>Begin: 2004-11-02<br>End: 2004-11-19<br>Duration: 17 days","Cruise: 0411RR<br>Stage: final<br>Begin: 2004-11-02<br>End: 2004-11-19<br>Duration: 17 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[4,20],"y":[2005,2005],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0501NH<br>Stage: final<br>Begin: 2005-01-04<br>End: 2005-01-20<br>Duration: 16 days","Cruise: 0501NH<br>Stage: final<br>Begin: 2005-01-04<br>End: 2005-01-20<br>Duration: 16 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[105,120],"y":[2005,2005],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0504NH<br>Stage: final<br>Begin: 2005-04-15<br>End: 2005-04-30<br>Duration: 15 days","Cruise: 0504NH<br>Stage: final<br>Begin: 2005-04-15<br>End: 2005-04-30<br>Duration: 15 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[182,197],"y":[2005,2005],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0507NH<br>Stage: final<br>Begin: 2005-07-01<br>End: 2005-07-16<br>Duration: 15 days","Cruise: 0507NH<br>Stage: final<br>Begin: 2005-07-01<br>End: 2005-07-16<br>Duration: 15 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[308,324],"y":[2005,2005],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0511NH<br>Stage: final<br>Begin: 2005-11-04<br>End: 2005-11-20<br>Duration: 16 days","Cruise: 0511NH<br>Stage: final<br>Begin: 2005-11-04<br>End: 2005-11-20<br>Duration: 16 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[34,56],"y":[2006,2006],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0602JD<br>Stage: final<br>Begin: 2006-02-03<br>End: 2006-02-25<br>Duration: 22 days","Cruise: 0602JD<br>Stage: final<br>Begin: 2006-02-03<br>End: 2006-02-25<br>Duration: 22 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(140,86,75,1)","line":{"color":"rgba(140,86,75,1)"}},"error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[91,107],"y":[2006,2006],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0604NH<br>Stage: final<br>Begin: 2006-04-01<br>End: 2006-04-17<br>Duration: 16 days","Cruise: 0604NH<br>Stage: final<br>Begin: 2006-04-01<br>End: 2006-04-17<br>Duration: 16 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(227,119,194,1)","line":{"color":"rgba(227,119,194,1)"}},"error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[189,204],"y":[2006,2006],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0607NH<br>Stage: final<br>Begin: 2006-07-08<br>End: 2006-07-23<br>Duration: 15 days","Cruise: 0607NH<br>Stage: final<br>Begin: 2006-07-08<br>End: 2006-07-23<br>Duration: 15 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(127,127,127,1)","line":{"color":"rgba(127,127,127,1)"}},"error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[294,309],"y":[2006,2006],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0610RR<br>Stage: final<br>Begin: 2006-10-21<br>End: 2006-11-05<br>Duration: 15 days","Cruise: 0610RR<br>Stage: final<br>Begin: 2006-10-21<br>End: 2006-11-05<br>Duration: 15 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(188,189,34,1)","line":{"color":"rgba(188,189,34,1)"}},"error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[365,365],"y":[2006,2006],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0701JD<br>Stage: final<br>Begin: 2006-12-31<br>End: 2007-02-01<br>Duration: 32 days","Cruise: 0701JD<br>Stage: final<br>Begin: 2006-12-31<br>End: 2007-02-01<br>Duration: 32 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(23,190,207,1)","line":{"color":"rgba(23,190,207,1)"}},"error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[1,32],"y":[2007,2007],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0701JD<br>Stage: final<br>Begin: 2006-12-31<br>End: 2007-02-01<br>Duration: 32 days","Cruise: 0701JD<br>Stage: final<br>Begin: 2006-12-31<br>End: 2007-02-01<br>Duration: 32 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[87,119],"y":[2007,2007],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0704JD<br>Stage: final<br>Begin: 2007-03-28<br>End: 2007-04-29<br>Duration: 32 days","Cruise: 0704JD<br>Stage: final<br>Begin: 2007-03-28<br>End: 2007-04-29<br>Duration: 32 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[179,194],"y":[2007,2007],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0707NH<br>Stage: final<br>Begin: 2007-06-28<br>End: 2007-07-13<br>Duration: 15 days","Cruise: 0707NH<br>Stage: final<br>Begin: 2007-06-28<br>End: 2007-07-13<br>Duration: 15 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[307,322],"y":[2007,2007],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0711NH<br>Stage: final<br>Begin: 2007-11-03<br>End: 2007-11-18<br>Duration: 15 days","Cruise: 0711NH<br>Stage: final<br>Begin: 2007-11-03<br>End: 2007-11-18<br>Duration: 15 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[7,25],"y":[2008,2008],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0801JD<br>Stage: final<br>Begin: 2008-01-07<br>End: 2008-01-25<br>Duration: 18 days","Cruise: 0801JD<br>Stage: final<br>Begin: 2008-01-07<br>End: 2008-01-25<br>Duration: 18 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[85,121],"y":[2008,2008],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0804JD<br>Stage: final<br>Begin: 2008-03-25<br>End: 2008-04-30<br>Duration: 36 days","Cruise: 0804JD<br>Stage: final<br>Begin: 2008-03-25<br>End: 2008-04-30<br>Duration: 36 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(140,86,75,1)","line":{"color":"rgba(140,86,75,1)"}},"error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[227,242],"y":[2008,2008],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0808NH<br>Stage: final<br>Begin: 2008-08-14<br>End: 2008-08-29<br>Duration: 15 days","Cruise: 0808NH<br>Stage: final<br>Begin: 2008-08-14<br>End: 2008-08-29<br>Duration: 15 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(227,119,194,1)","line":{"color":"rgba(227,119,194,1)"}},"error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[288,304],"y":[2008,2008],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0810NH<br>Stage: final<br>Begin: 2008-10-14<br>End: 2008-10-30<br>Duration: 16 days","Cruise: 0810NH<br>Stage: final<br>Begin: 2008-10-14<br>End: 2008-10-30<br>Duration: 16 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(127,127,127,1)","line":{"color":"rgba(127,127,127,1)"}},"error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[8,23],"y":[2009,2009],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0901NH<br>Stage: final<br>Begin: 2009-01-08<br>End: 2009-01-23<br>Duration: 15 days","Cruise: 0901NH<br>Stage: final<br>Begin: 2009-01-08<br>End: 2009-01-23<br>Duration: 15 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(188,189,34,1)","line":{"color":"rgba(188,189,34,1)"}},"error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[67,81],"y":[2009,2009],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0903JD<br>Stage: final<br>Begin: 2009-03-08<br>End: 2009-03-22<br>Duration: 14 days","Cruise: 0903JD<br>Stage: final<br>Begin: 2009-03-08<br>End: 2009-03-22<br>Duration: 14 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(23,190,207,1)","line":{"color":"rgba(23,190,207,1)"}},"error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[196,215],"y":[2009,2009],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0907M2<br>Stage: final<br>Begin: 2009-07-15<br>End: 2009-08-03<br>Duration: 19 days","Cruise: 0907M2<br>Stage: final<br>Begin: 2009-07-15<br>End: 2009-08-03<br>Duration: 19 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[310,327],"y":[2009,2009],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0911NH<br>Stage: final<br>Begin: 2009-11-06<br>End: 2009-11-23<br>Duration: 17 days","Cruise: 0911NH<br>Stage: final<br>Begin: 2009-11-06<br>End: 2009-11-23<br>Duration: 17 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[13,35],"y":[2010,2010],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1001NH<br>Stage: final<br>Begin: 2010-01-13<br>End: 2010-02-04<br>Duration: 22 days","Cruise: 1001NH<br>Stage: final<br>Begin: 2010-01-13<br>End: 2010-02-04<br>Duration: 22 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[117,137],"y":[2010,2010],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1004MF<br>Stage: final<br>Begin: 2010-04-27<br>End: 2010-05-17<br>Duration: 20 days","Cruise: 1004MF<br>Stage: final<br>Begin: 2010-04-27<br>End: 2010-05-17<br>Duration: 20 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[211,228],"y":[2010,2010],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1008NH<br>Stage: final<br>Begin: 2010-07-30<br>End: 2010-08-16<br>Duration: 17 days","Cruise: 1008NH<br>Stage: final<br>Begin: 2010-07-30<br>End: 2010-08-16<br>Duration: 17 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[301,316],"y":[2010,2010],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1011NH<br>Stage: final<br>Begin: 2010-10-28<br>End: 2010-11-12<br>Duration: 15 days","Cruise: 1011NH<br>Stage: final<br>Begin: 2010-10-28<br>End: 2010-11-12<br>Duration: 15 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(140,86,75,1)","line":{"color":"rgba(140,86,75,1)"}},"error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[13,35],"y":[2011,2011],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1101NH<br>Stage: final<br>Begin: 2011-01-13<br>End: 2011-02-04<br>Duration: 22 days","Cruise: 1101NH<br>Stage: final<br>Begin: 2011-01-13<br>End: 2011-02-04<br>Duration: 22 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(227,119,194,1)","line":{"color":"rgba(227,119,194,1)"}},"error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[99,116],"y":[2011,2011],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1104SH<br>Stage: final<br>Begin: 2011-04-09<br>End: 2011-04-26<br>Duration: 17 days","Cruise: 1104SH<br>Stage: final<br>Begin: 2011-04-09<br>End: 2011-04-26<br>Duration: 17 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(127,127,127,1)","line":{"color":"rgba(127,127,127,1)"}},"error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[208,224],"y":[2011,2011],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1108NH<br>Stage: final<br>Begin: 2011-07-27<br>End: 2011-08-12<br>Duration: 16 days","Cruise: 1108NH<br>Stage: final<br>Begin: 2011-07-27<br>End: 2011-08-12<br>Duration: 16 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(188,189,34,1)","line":{"color":"rgba(188,189,34,1)"}},"error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[289,305],"y":[2011,2011],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1110NH<br>Stage: final<br>Begin: 2011-10-16<br>End: 2011-11-01<br>Duration: 16 days","Cruise: 1110NH<br>Stage: final<br>Begin: 2011-10-16<br>End: 2011-11-01<br>Duration: 16 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(23,190,207,1)","line":{"color":"rgba(23,190,207,1)"}},"error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[27,43],"y":[2012,2012],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1202NH<br>Stage: final<br>Begin: 2012-01-27<br>End: 2012-02-12<br>Duration: 16 days","Cruise: 1202NH<br>Stage: final<br>Begin: 2012-01-27<br>End: 2012-02-12<br>Duration: 16 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[85,97],"y":[2012,2012],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1203SH<br>Stage: final<br>Begin: 2012-03-25<br>End: 2012-04-06<br>Duration: 12 days","Cruise: 1203SH<br>Stage: final<br>Begin: 2012-03-25<br>End: 2012-04-06<br>Duration: 12 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[185,208],"y":[2012,2012],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1207OS<br>Stage: final<br>Begin: 2012-07-03<br>End: 2012-07-26<br>Duration: 23 days","Cruise: 1207OS<br>Stage: final<br>Begin: 2012-07-03<br>End: 2012-07-26<br>Duration: 23 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[293,310],"y":[2012,2012],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1210NH<br>Stage: final<br>Begin: 2012-10-19<br>End: 2012-11-05<br>Duration: 17 days","Cruise: 1210NH<br>Stage: final<br>Begin: 2012-10-19<br>End: 2012-11-05<br>Duration: 17 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[366,366],"y":[2012,2012],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1307NH<br>Stage: final<br>Begin: 2012-12-31<br>End: 2013-07-21<br>Duration: 202 days","Cruise: 1307NH<br>Stage: final<br>Begin: 2012-12-31<br>End: 2013-07-21<br>Duration: 202 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[1,202],"y":[2013,2013],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1307NH<br>Stage: final<br>Begin: 2012-12-31<br>End: 2013-07-21<br>Duration: 202 days","Cruise: 1307NH<br>Stage: final<br>Begin: 2012-12-31<br>End: 2013-07-21<br>Duration: 202 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(140,86,75,1)","line":{"color":"rgba(140,86,75,1)"}},"error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[11,31],"y":[2013,2013],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1301SH<br>Stage: final<br>Begin: 2013-01-11<br>End: 2013-01-31<br>Duration: 20 days","Cruise: 1301SH<br>Stage: final<br>Begin: 2013-01-11<br>End: 2013-01-31<br>Duration: 20 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(227,119,194,1)","line":{"color":"rgba(227,119,194,1)"}},"error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[97,120],"y":[2013,2013],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1304SH<br>Stage: final<br>Begin: 2013-04-07<br>End: 2013-04-30<br>Duration: 23 days","Cruise: 1304SH<br>Stage: final<br>Begin: 2013-04-07<br>End: 2013-04-30<br>Duration: 23 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(127,127,127,1)","line":{"color":"rgba(127,127,127,1)"}},"error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[313,329],"y":[2013,2013],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1311NH<br>Stage: final<br>Begin: 2013-11-09<br>End: 2013-11-25<br>Duration: 16 days","Cruise: 1311NH<br>Stage: final<br>Begin: 2013-11-09<br>End: 2013-11-25<br>Duration: 16 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(188,189,34,1)","line":{"color":"rgba(188,189,34,1)"}},"error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[365,365],"y":[2013,2013],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1402SH<br>Stage: final<br>Begin: 2013-12-31<br>End: 2014-02-05<br>Duration: 36 days","Cruise: 1402SH<br>Stage: final<br>Begin: 2013-12-31<br>End: 2014-02-05<br>Duration: 36 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(23,190,207,1)","line":{"color":"rgba(23,190,207,1)"}},"error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[1,36],"y":[2014,2014],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1402SH<br>Stage: final<br>Begin: 2013-12-31<br>End: 2014-02-05<br>Duration: 36 days","Cruise: 1402SH<br>Stage: final<br>Begin: 2013-12-31<br>End: 2014-02-05<br>Duration: 36 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[88,107],"y":[2014,2014],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1404OS<br>Stage: final<br>Begin: 2014-03-29<br>End: 2014-04-17<br>Duration: 19 days","Cruise: 1404OS<br>Stage: final<br>Begin: 2014-03-29<br>End: 2014-04-17<br>Duration: 19 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[187,202],"y":[2014,2014],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1407NH<br>Stage: final<br>Begin: 2014-07-06<br>End: 2014-07-21<br>Duration: 15 days","Cruise: 1407NH<br>Stage: final<br>Begin: 2014-07-06<br>End: 2014-07-21<br>Duration: 15 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[312,327],"y":[2014,2014],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1411NH<br>Stage: final<br>Begin: 2014-11-08<br>End: 2014-11-23<br>Duration: 15 days","Cruise: 1411NH<br>Stage: final<br>Begin: 2014-11-08<br>End: 2014-11-23<br>Duration: 15 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[15,36],"y":[2015,2015],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1501NH<br>Stage: final<br>Begin: 2015-01-15<br>End: 2015-02-05<br>Duration: 21 days","Cruise: 1501NH<br>Stage: final<br>Begin: 2015-01-15<br>End: 2015-02-05<br>Duration: 21 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[94,109],"y":[2015,2015],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1504NH<br>Stage: final<br>Begin: 2015-04-04<br>End: 2015-04-19<br>Duration: 15 days","Cruise: 1504NH<br>Stage: final<br>Begin: 2015-04-04<br>End: 2015-04-19<br>Duration: 15 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(140,86,75,1)","line":{"color":"rgba(140,86,75,1)"}},"error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[189,205],"y":[2015,2015],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1507OC<br>Stage: final<br>Begin: 2015-07-08<br>End: 2015-07-24<br>Duration: 16 days","Cruise: 1507OC<br>Stage: final<br>Begin: 2015-07-08<br>End: 2015-07-24<br>Duration: 16 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(227,119,194,1)","line":{"color":"rgba(227,119,194,1)"}},"error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[301,317],"y":[2015,2015],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1511OC<br>Stage: final<br>Begin: 2015-10-28<br>End: 2015-11-13<br>Duration: 16 days","Cruise: 1511OC<br>Stage: final<br>Begin: 2015-10-28<br>End: 2015-11-13<br>Duration: 16 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(127,127,127,1)","line":{"color":"rgba(127,127,127,1)"}},"error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[7,29],"y":[2016,2016],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1601RL<br>Stage: final<br>Begin: 2016-01-07<br>End: 2016-01-29<br>Duration: 22 days","Cruise: 1601RL<br>Stage: final<br>Begin: 2016-01-07<br>End: 2016-01-29<br>Duration: 22 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(188,189,34,1)","line":{"color":"rgba(188,189,34,1)"}},"error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[92,113],"y":[2016,2016],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1604SH<br>Stage: final<br>Begin: 2016-04-01<br>End: 2016-04-22<br>Duration: 21 days","Cruise: 1604SH<br>Stage: final<br>Begin: 2016-04-01<br>End: 2016-04-22<br>Duration: 21 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(23,190,207,1)","line":{"color":"rgba(23,190,207,1)"}},"error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[192,208],"y":[2016,2016],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1607OS<br>Stage: final<br>Begin: 2016-07-10<br>End: 2016-07-26<br>Duration: 16 days","Cruise: 1607OS<br>Stage: final<br>Begin: 2016-07-10<br>End: 2016-07-26<br>Duration: 16 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[311,326],"y":[2016,2016],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1611SR<br>Stage: final<br>Begin: 2016-11-06<br>End: 2016-11-21<br>Duration: 15 days","Cruise: 1611SR<br>Stage: final<br>Begin: 2016-11-06<br>End: 2016-11-21<br>Duration: 15 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[6,28],"y":[2017,2017],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1701RL<br>Stage: final<br>Begin: 2017-01-06<br>End: 2017-01-28<br>Duration: 22 days","Cruise: 1701RL<br>Stage: final<br>Begin: 2017-01-06<br>End: 2017-01-28<br>Duration: 22 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[88,110],"y":[2017,2017],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1704SH<br>Stage: final<br>Begin: 2017-03-29<br>End: 2017-04-20<br>Duration: 22 days","Cruise: 1704SH<br>Stage: final<br>Begin: 2017-03-29<br>End: 2017-04-20<br>Duration: 22 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[213,228],"y":[2017,2017],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1708SR<br>Stage: final<br>Begin: 2017-08-01<br>End: 2017-08-16<br>Duration: 15 days","Cruise: 1708SR<br>Stage: final<br>Begin: 2017-08-01<br>End: 2017-08-16<br>Duration: 15 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[313,328],"y":[2017,2017],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1711SR<br>Stage: final<br>Begin: 2017-11-09<br>End: 2017-11-24<br>Duration: 15 days","Cruise: 1711SR<br>Stage: final<br>Begin: 2017-11-09<br>End: 2017-11-24<br>Duration: 15 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(140,86,75,1)","line":{"color":"rgba(140,86,75,1)"}},"error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[32,41],"y":[2018,2018],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1802SH<br>Stage: final<br>Begin: 2018-02-01<br>End: 2018-02-10<br>Duration: 9 days","Cruise: 1802SH<br>Stage: final<br>Begin: 2018-02-01<br>End: 2018-02-10<br>Duration: 9 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(227,119,194,1)","line":{"color":"rgba(227,119,194,1)"}},"error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[95,116],"y":[2018,2018],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1804SH<br>Stage: final<br>Begin: 2018-04-05<br>End: 2018-04-26<br>Duration: 21 days","Cruise: 1804SH<br>Stage: final<br>Begin: 2018-04-05<br>End: 2018-04-26<br>Duration: 21 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(127,127,127,1)","line":{"color":"rgba(127,127,127,1)"}},"error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[160,175],"y":[2018,2018],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1806SR<br>Stage: final<br>Begin: 2018-06-09<br>End: 2018-06-24<br>Duration: 15 days","Cruise: 1806SR<br>Stage: final<br>Begin: 2018-06-09<br>End: 2018-06-24<br>Duration: 15 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(188,189,34,1)","line":{"color":"rgba(188,189,34,1)"}},"error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[287,302],"y":[2018,2018],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1810SR<br>Stage: final<br>Begin: 2018-10-14<br>End: 2018-10-29<br>Duration: 15 days","Cruise: 1810SR<br>Stage: final<br>Begin: 2018-10-14<br>End: 2018-10-29<br>Duration: 15 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(23,190,207,1)","line":{"color":"rgba(23,190,207,1)"}},"error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[37,43],"y":[2019,2019],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1902RL<br>Stage: final<br>Begin: 2019-02-06<br>End: 2019-02-12<br>Duration: 6 days","Cruise: 1902RL<br>Stage: final<br>Begin: 2019-02-06<br>End: 2019-02-12<br>Duration: 6 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[92,107],"y":[2019,2019],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1904RL<br>Stage: final<br>Begin: 2019-04-02<br>End: 2019-04-17<br>Duration: 15 days","Cruise: 1904RL<br>Stage: final<br>Begin: 2019-04-02<br>End: 2019-04-17<br>Duration: 15 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[192,207],"y":[2019,2019],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1907BH<br>Stage: final<br>Begin: 2019-07-11<br>End: 2019-07-26<br>Duration: 15 days","Cruise: 1907BH<br>Stage: final<br>Begin: 2019-07-11<br>End: 2019-07-26<br>Duration: 15 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[308,322],"y":[2019,2019],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1911OC<br>Stage: final<br>Begin: 2019-11-04<br>End: 2019-11-18<br>Duration: 14 days","Cruise: 1911OC<br>Stage: final<br>Begin: 2019-11-04<br>End: 2019-11-18<br>Duration: 14 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[5,26],"y":[2020,2020],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 2001RL<br>Stage: final<br>Begin: 2020-01-05<br>End: 2020-01-26<br>Duration: 21 days","Cruise: 2001RL<br>Stage: final<br>Begin: 2020-01-05<br>End: 2020-01-26<br>Duration: 21 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[195,209],"y":[2020,2020],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 2007SR<br>Stage: final<br>Begin: 2020-07-13<br>End: 2020-07-27<br>Duration: 14 days","Cruise: 2007SR<br>Stage: final<br>Begin: 2020-07-13<br>End: 2020-07-27<br>Duration: 14 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(140,86,75,1)","line":{"color":"rgba(140,86,75,1)"}},"error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[285,298],"y":[2020,2020],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 2010SR<br>Stage: final<br>Begin: 2020-10-11<br>End: 2020-10-24<br>Duration: 13 days","Cruise: 2010SR<br>Stage: final<br>Begin: 2020-10-11<br>End: 2020-10-24<br>Duration: 13 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(227,119,194,1)","line":{"color":"rgba(227,119,194,1)"}},"error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[16,34],"y":[2021,2021],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 2101RL<br>Stage: final<br>Begin: 2021-01-16<br>End: 2021-02-03<br>Duration: 18 days","Cruise: 2101RL<br>Stage: final<br>Begin: 2021-01-16<br>End: 2021-02-03<br>Duration: 18 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(127,127,127,1)","line":{"color":"rgba(127,127,127,1)"}},"error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[124,133],"y":[2021,2021],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 2105SH<br>Stage: final<br>Begin: 2021-05-04<br>End: 2021-05-13<br>Duration: 9 days","Cruise: 2105SH<br>Stage: final<br>Begin: 2021-05-04<br>End: 2021-05-13<br>Duration: 9 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"final","marker":{"color":"rgba(188,189,34,1)","line":{"color":"rgba(188,189,34,1)"}},"error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[200,213],"y":[2021,2021],"line":{"color":"#A23B72","width":8},"text":["Cruise: 2107SR<br>Stage: preliminary<br>Begin: 2021-07-19<br>End: 2021-08-01<br>Duration: 13 days","Cruise: 2107SR<br>Stage: preliminary<br>Begin: 2021-07-19<br>End: 2021-08-01<br>Duration: 13 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"preliminary","marker":{"color":"rgba(23,190,207,1)","line":{"color":"rgba(23,190,207,1)"}},"error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[304,318],"y":[2021,2021],"line":{"color":"#A23B72","width":8},"text":["Cruise: 2111SR<br>Stage: preliminary<br>Begin: 2021-10-31<br>End: 2021-11-14<br>Duration: 14 days","Cruise: 2111SR<br>Stage: preliminary<br>Begin: 2021-10-31<br>End: 2021-11-14<br>Duration: 14 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"preliminary","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[97,117],"y":[2022,2022],"line":{"color":"#A23B72","width":8},"text":["Cruise: 2204SH<br>Stage: preliminary<br>Begin: 2022-04-07<br>End: 2022-04-27<br>Duration: 20 days","Cruise: 2204SH<br>Stage: preliminary<br>Begin: 2022-04-07<br>End: 2022-04-27<br>Duration: 20 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"preliminary","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[227,242],"y":[2022,2022],"line":{"color":"#A23B72","width":8},"text":["Cruise: 2208BH<br>Stage: preliminary<br>Begin: 2022-08-15<br>End: 2022-08-30<br>Duration: 15 days","Cruise: 2208BH<br>Stage: preliminary<br>Begin: 2022-08-15<br>End: 2022-08-30<br>Duration: 15 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"preliminary","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[309,324],"y":[2022,2022],"line":{"color":"#A23B72","width":8},"text":["Cruise: 2211SR<br>Stage: preliminary<br>Begin: 2022-11-05<br>End: 2022-11-20<br>Duration: 15 days","Cruise: 2211SR<br>Stage: preliminary<br>Begin: 2022-11-05<br>End: 2022-11-20<br>Duration: 15 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"preliminary","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[7,25],"y":[2023,2023],"line":{"color":"#A23B72","width":8},"text":["Cruise: 2301RL<br>Stage: preliminary<br>Begin: 2023-01-07<br>End: 2023-01-25<br>Duration: 18 days","Cruise: 2301RL<br>Stage: preliminary<br>Begin: 2023-01-07<br>End: 2023-01-25<br>Duration: 18 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"preliminary","marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[84,113],"y":[2023,2023],"line":{"color":"#A23B72","width":8},"text":["Cruise: 2304SH<br>Stage: preliminary<br>Begin: 2023-03-25<br>End: 2023-04-23<br>Duration: 29 days","Cruise: 2304SH<br>Stage: preliminary<br>Begin: 2023-03-25<br>End: 2023-04-23<br>Duration: 29 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"preliminary","marker":{"color":"rgba(140,86,75,1)","line":{"color":"rgba(140,86,75,1)"}},"error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[184,199],"y":[2023,2023],"line":{"color":"#A23B72","width":8},"text":["Cruise: 2307SR<br>Stage: preliminary<br>Begin: 2023-07-03<br>End: 2023-07-18<br>Duration: 15 days","Cruise: 2307SR<br>Stage: preliminary<br>Begin: 2023-07-03<br>End: 2023-07-18<br>Duration: 15 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"preliminary","marker":{"color":"rgba(227,119,194,1)","line":{"color":"rgba(227,119,194,1)"}},"error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[308,322],"y":[2023,2023],"line":{"color":"#A23B72","width":8},"text":["Cruise: 2311SR<br>Stage: preliminary<br>Begin: 2023-11-04<br>End: 2023-11-18<br>Duration: 14 days","Cruise: 2311SR<br>Stage: preliminary<br>Begin: 2023-11-04<br>End: 2023-11-18<br>Duration: 14 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"preliminary","marker":{"color":"rgba(127,127,127,1)","line":{"color":"rgba(127,127,127,1)"}},"error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[11,25],"y":[2024,2024],"line":{"color":"#A23B72","width":8},"text":["Cruise: 2401RL<br>Stage: preliminary<br>Begin: 2024-01-11<br>End: 2024-01-25<br>Duration: 14 days","Cruise: 2401RL<br>Stage: preliminary<br>Begin: 2024-01-11<br>End: 2024-01-25<br>Duration: 14 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"preliminary","marker":{"color":"rgba(188,189,34,1)","line":{"color":"rgba(188,189,34,1)"}},"error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[87,110],"y":[2024,2024],"line":{"color":"#A23B72","width":8},"text":["Cruise: 2404SH<br>Stage: preliminary<br>Begin: 2024-03-27<br>End: 2024-04-19<br>Duration: 23 days","Cruise: 2404SH<br>Stage: preliminary<br>Begin: 2024-03-27<br>End: 2024-04-19<br>Duration: 23 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"preliminary","marker":{"color":"rgba(23,190,207,1)","line":{"color":"rgba(23,190,207,1)"}},"error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[209,224],"y":[2024,2024],"line":{"color":"#A23B72","width":8},"text":["Cruise: 2408SR<br>Stage: preliminary<br>Begin: 2024-07-27<br>End: 2024-08-11<br>Duration: 15 days","Cruise: 2408SR<br>Stage: preliminary<br>Begin: 2024-07-27<br>End: 2024-08-11<br>Duration: 15 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"preliminary","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[320,329],"y":[2024,2024],"line":{"color":"#A23B72","width":8},"text":["Cruise: 2411SR<br>Stage: preliminary<br>Begin: 2024-11-15<br>End: 2024-11-24<br>Duration: 9 days","Cruise: 2411SR<br>Stage: preliminary<br>Begin: 2024-11-15<br>End: 2024-11-24<br>Duration: 9 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"preliminary","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[3,29],"y":[2025,2025],"line":{"color":"#A23B72","width":8},"text":["Cruise: 2501RL<br>Stage: preliminary<br>Begin: 2025-01-03<br>End: 2025-01-29<br>Duration: 26 days","Cruise: 2501RL<br>Stage: preliminary<br>Begin: 2025-01-03<br>End: 2025-01-29<br>Duration: 26 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"preliminary","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[19,20],"y":[2025,2025],"line":{"color":"#A23B72","width":8},"text":["Cruise: 2502RL<br>Stage: preliminary<br>Begin: 2025-01-19<br>End: 2025-01-20<br>Duration: 1 days","Cruise: 2502RL<br>Stage: preliminary<br>Begin: 2025-01-19<br>End: 2025-01-20<br>Duration: 1 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"preliminary","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[79,108],"y":[2025,2025],"line":{"color":"#A23B72","width":8},"text":["Cruise: 2504SH<br>Stage: preliminary<br>Begin: 2025-03-20<br>End: 2025-04-18<br>Duration: 29 days","Cruise: 2504SH<br>Stage: preliminary<br>Begin: 2025-03-20<br>End: 2025-04-18<br>Duration: 29 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"preliminary","marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[199,210],"y":[2025,2025],"line":{"color":"#A23B72","width":8},"text":["Cruise: 2507SR<br>Stage: preliminary<br>Begin: 2025-07-18<br>End: 2025-07-29<br>Duration: 11 days","Cruise: 2507SR<br>Stage: preliminary<br>Begin: 2025-07-18<br>End: 2025-07-29<br>Duration: 11 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"preliminary","marker":{"color":"rgba(140,86,75,1)","line":{"color":"rgba(140,86,75,1)"}},"error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","line":{"color":"#23d355ff","width":8},"showlegend":true,"marker":{"color":"rgba(227,119,194,1)","line":{"color":"rgba(227,119,194,1)"}},"error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","line":{"color":"#A23B72","width":8},"showlegend":true,"marker":{"color":"rgba(127,127,127,1)","line":{"color":"rgba(127,127,127,1)"}},"error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># disconnect</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con, <span class="at">shutdown =</span> <span class="cn">TRUE</span>) <span class="co"># get cruise date spans by cruise and stage</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb33" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Scrape &amp; Ingest CalCOFI CTD Data into DuckDB"</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> html</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co">  chunk_output_type: console</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>This notebook scrapes CalCOFI CTD data from <span class="ot">&lt;https://calcofi.org/data/oceanographic-data/ctd-cast-files/&gt;</span>, downloads only **final** and **preliminary** CTD files, and ingests them into a DuckDB database.</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="fu">### Key Features</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Web Scraping**: Scrapes for all CTD .zip download links</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Smart Filtering**:</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Downloads all .zip files for archival completeness</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Only unzips <span class="in">`final`</span> (e.g., 20-2105SH_CTDFinalQC.zip) and <span class="in">`preliminary`</span> (e.g., 20-2507SR_CTDPrelim.zip) files</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Skips unzipping raw/cast/test files to save disk space</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Download &amp; Unzip**: Downloads all zip files to <span class="in">`~/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download`</span> but only extracts final and preliminary data</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Priority-based Selection**:</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>For each cruise (identified by yy-yymm + ship code), selects final if available</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Falls back to preliminary if final not available for that cruise</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Completely excludes raw/test/prodo cast files</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>**Union Strategy**:</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Merges upcast (U) and downcast (D) CSV files into single "ctd" table</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Adds <span class="in">`stage`</span> flag: "F" for final, "P" for preliminary</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Adds <span class="in">`cast_dir`</span> flag: "U" for upcast, "D" for downcast</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a><span class="ss">6.  </span>**Data Standardization**:</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Converts all column names to <span class="in">`lower_snake_case`</span> using <span class="in">`janitor::clean_names()`</span></span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Creates spatial index on <span class="in">`lat_dec`</span> and <span class="in">`lon_dec`</span> fields</span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Preserves <span class="in">`cruise_id`</span> and <span class="in">`source_file`</span> metadata</span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a><span class="fu">### Usage</span></span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>To run the notebook:</span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>quarto<span class="sc">::</span><span class="fu">quarto_render</span>(<span class="st">"scrape_ctd.qmd"</span>)</span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a><span class="fu">### Notes</span></span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>All .zip files are downloaded for archival purposes, but only final/prelim are unzipped</span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Only processes CSV files from final (<span class="in">`db-csvs/*.csv`</span>) and preliminary directories</span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Downloads can be resumed (already-downloaded files are skipped)</span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Both upcast (U) and downcast (D) profiles are included in the database</span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The priority system ensures you only get final data when available, otherwise preliminary</span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Spatial index enables efficient geographic queries on lat_dec and lon_dec</span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a><span class="fu">## Setup</span></span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-64"><a href="#cb33-64" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-65"><a href="#cb33-65" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb33-66"><a href="#cb33-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-67"><a href="#cb33-67" aria-hidden="true" tabindex="-1"></a>librarian<span class="sc">::</span><span class="fu">shelf</span>(</span>
<span id="cb33-68"><a href="#cb33-68" aria-hidden="true" tabindex="-1"></a>  dplyr,</span>
<span id="cb33-69"><a href="#cb33-69" aria-hidden="true" tabindex="-1"></a>  DBI,</span>
<span id="cb33-70"><a href="#cb33-70" aria-hidden="true" tabindex="-1"></a>  DT,</span>
<span id="cb33-71"><a href="#cb33-71" aria-hidden="true" tabindex="-1"></a>  duckdb,</span>
<span id="cb33-72"><a href="#cb33-72" aria-hidden="true" tabindex="-1"></a>  fs,</span>
<span id="cb33-73"><a href="#cb33-73" aria-hidden="true" tabindex="-1"></a>  glue,</span>
<span id="cb33-74"><a href="#cb33-74" aria-hidden="true" tabindex="-1"></a>  here,</span>
<span id="cb33-75"><a href="#cb33-75" aria-hidden="true" tabindex="-1"></a>  httr,</span>
<span id="cb33-76"><a href="#cb33-76" aria-hidden="true" tabindex="-1"></a>  janitor,</span>
<span id="cb33-77"><a href="#cb33-77" aria-hidden="true" tabindex="-1"></a>  lubridate,</span>
<span id="cb33-78"><a href="#cb33-78" aria-hidden="true" tabindex="-1"></a>  purrr,</span>
<span id="cb33-79"><a href="#cb33-79" aria-hidden="true" tabindex="-1"></a>  readr,</span>
<span id="cb33-80"><a href="#cb33-80" aria-hidden="true" tabindex="-1"></a>  rvest,</span>
<span id="cb33-81"><a href="#cb33-81" aria-hidden="true" tabindex="-1"></a>  sf,</span>
<span id="cb33-82"><a href="#cb33-82" aria-hidden="true" tabindex="-1"></a>  stringr,</span>
<span id="cb33-83"><a href="#cb33-83" aria-hidden="true" tabindex="-1"></a>  tibble,</span>
<span id="cb33-84"><a href="#cb33-84" aria-hidden="true" tabindex="-1"></a>  tidyr,</span>
<span id="cb33-85"><a href="#cb33-85" aria-hidden="true" tabindex="-1"></a>  zip,</span>
<span id="cb33-86"><a href="#cb33-86" aria-hidden="true" tabindex="-1"></a>  <span class="at">quiet =</span> T</span>
<span id="cb33-87"><a href="#cb33-87" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-88"><a href="#cb33-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-89"><a href="#cb33-89" aria-hidden="true" tabindex="-1"></a><span class="co"># variables</span></span>
<span id="cb33-90"><a href="#cb33-90" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://calcofi.org/data/oceanographic-data/ctd-cast-files/"</span></span>
<span id="cb33-91"><a href="#cb33-91" aria-hidden="true" tabindex="-1"></a>dir_dl <span class="ot">&lt;-</span> <span class="st">"~/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download"</span></span>
<span id="cb33-92"><a href="#cb33-92" aria-hidden="true" tabindex="-1"></a>dir_dl <span class="ot">&lt;-</span> <span class="fu">path_expand</span>(dir_dl)</span>
<span id="cb33-93"><a href="#cb33-93" aria-hidden="true" tabindex="-1"></a>db_path <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"{dir_dl}/calcofi-ctd.duckdb"</span>)</span>
<span id="cb33-94"><a href="#cb33-94" aria-hidden="true" tabindex="-1"></a>db_redo <span class="ot">&lt;-</span> T <span class="co"># set to TRUE to re-download and re-ingest</span></span>
<span id="cb33-95"><a href="#cb33-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-96"><a href="#cb33-96" aria-hidden="true" tabindex="-1"></a><span class="co"># create directory if it doesn't exist</span></span>
<span id="cb33-97"><a href="#cb33-97" aria-hidden="true" tabindex="-1"></a><span class="fu">dir_create</span>(dir_dl, <span class="at">recurse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb33-98"><a href="#cb33-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-99"><a href="#cb33-99" aria-hidden="true" tabindex="-1"></a><span class="co"># delete if exixsts (for fresh run)</span></span>
<span id="cb33-100"><a href="#cb33-100" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file_exists</span>(db_path) <span class="sc">&amp;</span> db_redo) {</span>
<span id="cb33-101"><a href="#cb33-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file_delete</span>(db_path)</span>
<span id="cb33-102"><a href="#cb33-102" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-103"><a href="#cb33-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-104"><a href="#cb33-104" aria-hidden="true" tabindex="-1"></a><span class="co"># setup duckdb with spatial extension</span></span>
<span id="cb33-105"><a href="#cb33-105" aria-hidden="true" tabindex="-1"></a><span class="co"># dbDisconnect(con, shutdown = TRUE); duckdb_shutdown(duckdb()); rm(con)</span></span>
<span id="cb33-106"><a href="#cb33-106" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(duckdb<span class="sc">::</span><span class="fu">duckdb</span>(<span class="at">read_only =</span> F), <span class="at">dbdir =</span> db_path)</span>
<span id="cb33-107"><a href="#cb33-107" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con, <span class="st">"INSTALL spatial;"</span>)</span>
<span id="cb33-108"><a href="#cb33-108" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con, <span class="st">"LOAD spatial;"</span>)</span>
<span id="cb33-109"><a href="#cb33-109" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-110"><a href="#cb33-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-111"><a href="#cb33-111" aria-hidden="true" tabindex="-1"></a><span class="fu">## Scrape CTD Download Links</span></span>
<span id="cb33-112"><a href="#cb33-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-115"><a href="#cb33-115" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-116"><a href="#cb33-116" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: d_zips</span></span>
<span id="cb33-117"><a href="#cb33-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-118"><a href="#cb33-118" aria-hidden="true" tabindex="-1"></a><span class="co"># read web page, extract all .zip download links</span></span>
<span id="cb33-119"><a href="#cb33-119" aria-hidden="true" tabindex="-1"></a>d_zips <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url) <span class="sc">|&gt;</span></span>
<span id="cb33-120"><a href="#cb33-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">"a[href$='.zip']"</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-121"><a href="#cb33-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_attr</span>(<span class="st">"href"</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-122"><a href="#cb33-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">url =</span> _) <span class="sc">|&gt;</span></span>
<span id="cb33-123"><a href="#cb33-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-124"><a href="#cb33-124" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ensure full URLs</span></span>
<span id="cb33-125"><a href="#cb33-125" aria-hidden="true" tabindex="-1"></a>    <span class="at">url =</span> <span class="fu">if_else</span>(</span>
<span id="cb33-126"><a href="#cb33-126" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_starts</span>(url, <span class="st">"http"</span>),</span>
<span id="cb33-127"><a href="#cb33-127" aria-hidden="true" tabindex="-1"></a>      url,</span>
<span id="cb33-128"><a href="#cb33-128" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"https://calcofi.org"</span>, url)</span>
<span id="cb33-129"><a href="#cb33-129" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb33-130"><a href="#cb33-130" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract file_zip</span></span>
<span id="cb33-131"><a href="#cb33-131" aria-hidden="true" tabindex="-1"></a>    <span class="at">file_zip =</span> <span class="fu">basename</span>(url),</span>
<span id="cb33-132"><a href="#cb33-132" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract year from URL path</span></span>
<span id="cb33-133"><a href="#cb33-133" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">str_extract</span>(url, <span class="st">"/(</span><span class="sc">\\</span><span class="st">d{4})/"</span>, <span class="at">group =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">as.integer</span>(),</span>
<span id="cb33-134"><a href="#cb33-134" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract month from URL path</span></span>
<span id="cb33-135"><a href="#cb33-135" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">str_extract</span>(url, <span class="st">"-</span><span class="sc">\\</span><span class="st">d{2}(</span><span class="sc">\\</span><span class="st">d{2})"</span>, <span class="at">group =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">as.integer</span>(),</span>
<span id="cb33-136"><a href="#cb33-136" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract cruise identifier (yymm + ship code)</span></span>
<span id="cb33-137"><a href="#cb33-137" aria-hidden="true" tabindex="-1"></a>    <span class="at">cruise_id =</span> <span class="fu">str_extract</span>(</span>
<span id="cb33-138"><a href="#cb33-138" aria-hidden="true" tabindex="-1"></a>      file_zip,</span>
<span id="cb33-139"><a href="#cb33-139" aria-hidden="true" tabindex="-1"></a>      <span class="st">"</span><span class="sc">\\</span><span class="st">d{2}-(</span><span class="sc">\\</span><span class="st">d{4}[A-Z0-9]{2,4})"</span>,</span>
<span id="cb33-140"><a href="#cb33-140" aria-hidden="true" tabindex="-1"></a>      <span class="at">group =</span> <span class="dv">1</span></span>
<span id="cb33-141"><a href="#cb33-141" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb33-142"><a href="#cb33-142" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">TODO</span><span class="co">: confirm oddball ship codes (normally 2 letters): 0404NHJD (4 letters),  0907M2 (letter + number)</span></span>
<span id="cb33-143"><a href="#cb33-143" aria-hidden="true" tabindex="-1"></a>    <span class="co"># classify data type based on file_zip patterns</span></span>
<span id="cb33-144"><a href="#cb33-144" aria-hidden="true" tabindex="-1"></a>    <span class="at">zip_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb33-145"><a href="#cb33-145" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(file_zip, <span class="st">"CTDFinal"</span>) <span class="sc">~</span> <span class="st">"final"</span>,</span>
<span id="cb33-146"><a href="#cb33-146" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(file_zip, <span class="st">"CTDPrelim"</span>) <span class="sc">~</span> <span class="st">"preliminary"</span>,</span>
<span id="cb33-147"><a href="#cb33-147" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(file_zip, <span class="st">"CTDCast|CTD_Cast"</span>) <span class="sc">~</span> <span class="st">"raw"</span>,</span>
<span id="cb33-148"><a href="#cb33-148" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(file_zip, <span class="st">"CTDTest"</span>) <span class="sc">~</span> <span class="st">"test"</span>,</span>
<span id="cb33-149"><a href="#cb33-149" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"unknown"</span></span>
<span id="cb33-150"><a href="#cb33-150" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-151"><a href="#cb33-151" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-152"><a href="#cb33-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-153"><a href="#cb33-153" aria-hidden="true" tabindex="-1"></a><span class="co"># stop if other detected</span></span>
<span id="cb33-154"><a href="#cb33-154" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(d_zips<span class="sc">$</span>zip_type <span class="sc">==</span> <span class="st">"unknown"</span>)) {</span>
<span id="cb33-155"><a href="#cb33-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"Unknown zip_type detected in file_zips"</span>)</span>
<span id="cb33-156"><a href="#cb33-156" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-157"><a href="#cb33-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-158"><a href="#cb33-158" aria-hidden="true" tabindex="-1"></a><span class="co"># show summary (all files)</span></span>
<span id="cb33-159"><a href="#cb33-159" aria-hidden="true" tabindex="-1"></a>d_zips <span class="sc">|&gt;</span></span>
<span id="cb33-160"><a href="#cb33-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-161"><a href="#cb33-161" aria-hidden="true" tabindex="-1"></a>    <span class="at">file_zip =</span> <span class="fu">glue</span>(<span class="st">"&lt;a href={url}&gt;{file_zip}&lt;/a&gt;"</span>)</span>
<span id="cb33-162"><a href="#cb33-162" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb33-163"><a href="#cb33-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>url) <span class="sc">|&gt;</span></span>
<span id="cb33-164"><a href="#cb33-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(</span>
<span id="cb33-165"><a href="#cb33-165" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"All zip files to download"</span>,</span>
<span id="cb33-166"><a href="#cb33-166" aria-hidden="true" tabindex="-1"></a>    <span class="at">escape =</span> F</span>
<span id="cb33-167"><a href="#cb33-167" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-168"><a href="#cb33-168" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-169"><a href="#cb33-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-170"><a href="#cb33-170" aria-hidden="true" tabindex="-1"></a><span class="fu">## Download and Unzip Files</span></span>
<span id="cb33-171"><a href="#cb33-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-174"><a href="#cb33-174" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-175"><a href="#cb33-175" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: download_and_unzip</span></span>
<span id="cb33-176"><a href="#cb33-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-177"><a href="#cb33-177" aria-hidden="true" tabindex="-1"></a><span class="co"># function to download and optionally unzip a file</span></span>
<span id="cb33-178"><a href="#cb33-178" aria-hidden="true" tabindex="-1"></a>download_and_unzip <span class="ot">&lt;-</span> <span class="cf">function</span>(url, dest_dir, zip_type, <span class="at">unzip =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb33-179"><a href="#cb33-179" aria-hidden="true" tabindex="-1"></a>  file_zip <span class="ot">&lt;-</span> <span class="fu">basename</span>(url)</span>
<span id="cb33-180"><a href="#cb33-180" aria-hidden="true" tabindex="-1"></a>  dest_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dest_dir, file_zip)</span>
<span id="cb33-181"><a href="#cb33-181" aria-hidden="true" tabindex="-1"></a>  dir_unzip <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dest_dir, <span class="fu">str_remove</span>(file_zip, <span class="st">"</span><span class="sc">\\</span><span class="st">.zip$"</span>))</span>
<span id="cb33-182"><a href="#cb33-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-183"><a href="#cb33-183" aria-hidden="true" tabindex="-1"></a>  <span class="co"># skip if already downloaded</span></span>
<span id="cb33-184"><a href="#cb33-184" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">file_exists</span>(dest_file)) {</span>
<span id="cb33-185"><a href="#cb33-185" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Already exists: {file_zip}"</span>))</span>
<span id="cb33-186"><a href="#cb33-186" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb33-187"><a href="#cb33-187" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Downloading: {file_zip}"</span>))</span>
<span id="cb33-188"><a href="#cb33-188" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download.file</span>(url, dest_file, <span class="at">mode =</span> <span class="st">"wb"</span>)</span>
<span id="cb33-189"><a href="#cb33-189" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-190"><a href="#cb33-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-191"><a href="#cb33-191" aria-hidden="true" tabindex="-1"></a>  <span class="co"># skip if already unzipped</span></span>
<span id="cb33-192"><a href="#cb33-192" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (unzip <span class="sc">&amp;&amp;</span> <span class="fu">dir_exists</span>(dir_unzip)) {</span>
<span id="cb33-193"><a href="#cb33-193" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Already unzipped: {file_zip}"</span>))</span>
<span id="cb33-194"><a href="#cb33-194" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb33-195"><a href="#cb33-195" aria-hidden="true" tabindex="-1"></a>    <span class="co"># only unzip if final or preliminary (case-insensitive)</span></span>
<span id="cb33-196"><a href="#cb33-196" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (zip_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"final"</span>, <span class="st">"preliminary"</span>)) {</span>
<span id="cb33-197"><a href="#cb33-197" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Unzipping: {file_zip}"</span>))</span>
<span id="cb33-198"><a href="#cb33-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-199"><a href="#cb33-199" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dir_create</span>(dir_unzip, <span class="at">recurse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb33-200"><a href="#cb33-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-201"><a href="#cb33-201" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unzip</span>(dest_file, <span class="at">exdir =</span> dir_unzip)</span>
<span id="cb33-202"><a href="#cb33-202" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (unzip) {</span>
<span id="cb33-203"><a href="#cb33-203" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Skipping unzip (not final/preliminary): {file_zip}"</span>))</span>
<span id="cb33-204"><a href="#cb33-204" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-205"><a href="#cb33-205" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-206"><a href="#cb33-206" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-207"><a href="#cb33-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-208"><a href="#cb33-208" aria-hidden="true" tabindex="-1"></a><span class="co"># download all files, but only unzip final and preliminary</span></span>
<span id="cb33-209"><a href="#cb33-209" aria-hidden="true" tabindex="-1"></a>d_zips <span class="sc">|&gt;</span></span>
<span id="cb33-210"><a href="#cb33-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pwalk</span>(<span class="cf">function</span>(url, file_zip, zip_type, ...) {</span>
<span id="cb33-211"><a href="#cb33-211" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download_and_unzip</span>(url, dir_dl, zip_type, <span class="at">unzip =</span> <span class="cn">TRUE</span>)</span>
<span id="cb33-212"><a href="#cb33-212" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb33-213"><a href="#cb33-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-214"><a href="#cb33-214" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Download and extraction complete!"</span>)</span>
<span id="cb33-215"><a href="#cb33-215" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-216"><a href="#cb33-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-217"><a href="#cb33-217" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>2025-Jul:</span>
<span id="cb33-218"><a href="#cb33-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-219"><a href="#cb33-219" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Preliminary CTD 1m-Binned\</span>
<span id="cb33-220"><a href="#cb33-220" aria-hidden="true" tabindex="-1"></a>        <span class="co">[</span><span class="ot">20-2507SR_CTD**Prelim**.zip</span><span class="co">](https://calcofi.org/downloads/2025/20-2507SR_CTDPrelim.zip)</span>\</span>
<span id="cb33-221"><a href="#cb33-221" aria-hidden="true" tabindex="-1"></a>        **Preliminary CTD 1m-Binned**: Raw CTD sensor data that have gone through SBE Data Processing, and obvious bad sensor readings have been flagged during initial QAQC. Bottle data has not yet been merged with the CTD data. CTD Salinity, Oxygen, Fluorescence, and Nitrate profiles have not been corrected to the bottle data. Cruise corrected Nitrate sensor data (EstNO3_CruiseCorr) has been converted from raw voltage using a sensor calibration done before each cruise, but not yet corrected using CTD vs. Bottle regressions.&nbsp;</span>
<span id="cb33-222"><a href="#cb33-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-223"><a href="#cb33-223" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>2021-Jul:</span>
<span id="cb33-224"><a href="#cb33-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-225"><a href="#cb33-225" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>~~Prodo Cast~~ Raw CTD Data\</span>
<span id="cb33-226"><a href="#cb33-226" aria-hidden="true" tabindex="-1"></a>        <span class="co">[</span><span class="ot">20-2107SR_CTD**Cast**.zip</span><span class="co">](https://calcofi.org/downloads/2021/20-2107SR_CTDCast.zip)</span></span>
<span id="cb33-227"><a href="#cb33-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-228"><a href="#cb33-228" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Preliminary CTD &amp; Bottle 1m-Binned\</span>
<span id="cb33-229"><a href="#cb33-229" aria-hidden="true" tabindex="-1"></a>        <span class="co">[</span><span class="ot">20-2107SR_CTD**Prelim**.zip</span><span class="co">](https://calcofi.org/downloads/2021/20-2107SR_CTDPrelim.zip)</span>\</span>
<span id="cb33-230"><a href="#cb33-230" aria-hidden="true" tabindex="-1"></a>        **Preliminary CTD &amp; Bottle 1m-Binned**: Preliminary CTD sensor data that have been merged with QAQC’ed bottle data. CTD Salinity, Oxygen, Fluorescence, and Nitrate profiles have been corrected using CTD vs. bottle regressions.&nbsp;</span>
<span id="cb33-231"><a href="#cb33-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-232"><a href="#cb33-232" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>2021-May:</span>
<span id="cb33-233"><a href="#cb33-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-234"><a href="#cb33-234" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Raw CTD Data\</span>
<span id="cb33-235"><a href="#cb33-235" aria-hidden="true" tabindex="-1"></a>        <span class="co">[</span><span class="ot">20-2105SH_CTD**Cast**.zip</span><span class="co">](https://calcofi.org/downloads/2021/20-2105SH_CTDCast.zip)</span>\</span>
<span id="cb33-236"><a href="#cb33-236" aria-hidden="true" tabindex="-1"></a>        **Raw CTD Data**: Data files (.xmlcon, .hex, .bl, .nav, .prn, .mrk, .hdr) directly from SBE Software (<span class="co">[</span><span class="ot">Sea-Bird Scientific</span><span class="co">](https://www.seabird.com/)</span>) with no processing or corrections applied.</span>
<span id="cb33-237"><a href="#cb33-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-238"><a href="#cb33-238" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Final 1m-Binned\</span>
<span id="cb33-239"><a href="#cb33-239" aria-hidden="true" tabindex="-1"></a>        <span class="co">[</span><span class="ot">20-2105SH_CTD**FinalQC**.zip</span><span class="co">](https://calcofi.org/downloads/2021/20-2105SH_CTDFinalQC.zip)</span>\</span>
<span id="cb33-240"><a href="#cb33-240" aria-hidden="true" tabindex="-1"></a>        **Final 1m-Binned**: CTD data that have passed through the CalCOFI quality control process. After standard Seasoft-processing (Sea-Bird Scientific’s data-processing suite) tuned for our SBE 911plus CTD, the .asc files are processed by SIO-CalCOFI in-house software (BtlVsCTD). Averaged (4-sec or 1-meter bin-averaged) CTD sensor data are matched with corresponding bottle data, then **cruise-corrected** and **station-corrected**. Zipped file includes: metadata and .asc, .hdr, .btl, and upcast &amp; downcast .csvs (“u” and “d”; by station and concatenated).</span>
<span id="cb33-241"><a href="#cb33-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-242"><a href="#cb33-242" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>**Cruise-corrected CTD data**: CTD sensor data that are corrected using regression coefficients derived from 4-sec average sensor data vs bottle data comparisons for the entire cruise, meaning all casts with bottle samples (n=\~1400; fliers omitted; column labels ‘<span class="sc">\_</span>CruiseCorr’).</span>
<span id="cb33-243"><a href="#cb33-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-244"><a href="#cb33-244" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>**Station-corrected CTD data**: CTD sensor data that are corrected using regression coefficients generated dynamically for each cast, 1m bin-averaged sensor data vs bottle data (n=\~20; fliers omitted; column labels ‘<span class="sc">\_</span>StaCorr’).</span>
<span id="cb33-245"><a href="#cb33-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-246"><a href="#cb33-246" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>Since sensor behavior may vary from station to station, station-corrected CTD sensor data for salinity, oxygen, estimated nitrate, and estimated chlorophyll-a are considered the best, particularly for estimated nitrate.</span>
<span id="cb33-247"><a href="#cb33-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-248"><a href="#cb33-248" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>1992-Feb:</span>
<span id="cb33-249"><a href="#cb33-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-250"><a href="#cb33-250" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Prodo Cast\</span>
<span id="cb33-251"><a href="#cb33-251" aria-hidden="true" tabindex="-1"></a>        <span class="co">[</span><span class="ot">19-9202JD_CTD**CastProdoStas**.zip</span><span class="co">](https://calcofi.org/downloads/1992/19-9202JD_CTDCastProdoStas.zip)</span>\</span>
<span id="cb33-252"><a href="#cb33-252" aria-hidden="true" tabindex="-1"></a>        **Test Cast/Prodo Cast**: The Seabird 911plus CTD was first tested in Mar 1990 (9003JD) but is still under development. CTD data from Mar 1990 – 1991 were occasional system &amp; feasibility tests (“**test casts**“). As confidence in data quality improved, the CTD-Rosette began being used for daily primary productivity sample collection casts (“**prodo casts**“) in 1992 (6 depths from one station per day).</span>
<span id="cb33-253"><a href="#cb33-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-254"><a href="#cb33-254" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>1990-Mar:</span>
<span id="cb33-255"><a href="#cb33-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-256"><a href="#cb33-256" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Test Cast\</span>
<span id="cb33-257"><a href="#cb33-257" aria-hidden="true" tabindex="-1"></a>        <span class="co">[</span><span class="ot">19-9003JD_CTD**Test**.zip</span><span class="co">](https://calcofi.org/downloads/1990/19-9003JD_CTDTest.zip)</span></span>
<span id="cb33-258"><a href="#cb33-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-259"><a href="#cb33-259" aria-hidden="true" tabindex="-1"></a><span class="fu">## Find and Prioritize CTD Data Files</span></span>
<span id="cb33-260"><a href="#cb33-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-263"><a href="#cb33-263" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-264"><a href="#cb33-264" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: d_csv</span></span>
<span id="cb33-265"><a href="#cb33-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-266"><a href="#cb33-266" aria-hidden="true" tabindex="-1"></a><span class="co"># create file inventory</span></span>
<span id="cb33-267"><a href="#cb33-267" aria-hidden="true" tabindex="-1"></a>d_csv <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb33-268"><a href="#cb33-268" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="fu">dir_ls</span>(dir_dl, <span class="at">recurse =</span> <span class="cn">TRUE</span>, <span class="at">regexp =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.csv$"</span>)</span>
<span id="cb33-269"><a href="#cb33-269" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb33-270"><a href="#cb33-270" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-271"><a href="#cb33-271" aria-hidden="true" tabindex="-1"></a>    <span class="at">file_csv =</span> <span class="fu">basename</span>(path),</span>
<span id="cb33-272"><a href="#cb33-272" aria-hidden="true" tabindex="-1"></a>    <span class="at">path_unzip =</span> <span class="fu">str_replace</span>(path, <span class="fu">glue</span>(<span class="st">"{dir_dl}/"</span>), <span class="st">""</span>),</span>
<span id="cb33-273"><a href="#cb33-273" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get first directory in path_unzip</span></span>
<span id="cb33-274"><a href="#cb33-274" aria-hidden="true" tabindex="-1"></a>    <span class="at">dir_unzip =</span> <span class="fu">str_extract</span>(path_unzip, <span class="st">"^[^/]+"</span>),</span>
<span id="cb33-275"><a href="#cb33-275" aria-hidden="true" tabindex="-1"></a>    <span class="at">cruise_id =</span> <span class="fu">str_extract</span>(</span>
<span id="cb33-276"><a href="#cb33-276" aria-hidden="true" tabindex="-1"></a>      path_unzip,</span>
<span id="cb33-277"><a href="#cb33-277" aria-hidden="true" tabindex="-1"></a>      <span class="st">"</span><span class="sc">\\</span><span class="st">d{2}-(</span><span class="sc">\\</span><span class="st">d{4}[A-Z0-9]{2,4})_.*"</span>,</span>
<span id="cb33-278"><a href="#cb33-278" aria-hidden="true" tabindex="-1"></a>      <span class="at">group =</span> <span class="dv">1</span></span>
<span id="cb33-279"><a href="#cb33-279" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb33-280"><a href="#cb33-280" aria-hidden="true" tabindex="-1"></a>    <span class="co"># classify data type from parent directory</span></span>
<span id="cb33-281"><a href="#cb33-281" aria-hidden="true" tabindex="-1"></a>    <span class="at">data_stage =</span> <span class="fu">case_when</span>(</span>
<span id="cb33-282"><a href="#cb33-282" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(path_unzip, <span class="st">"Final.*db[_|-]csv"</span>) <span class="sc">~</span> <span class="st">"final"</span>,</span>
<span id="cb33-283"><a href="#cb33-283" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(path_unzip, <span class="st">"Prelim.*db[_|-]csv"</span>) <span class="sc">~</span> <span class="st">"preliminary"</span>,</span>
<span id="cb33-284"><a href="#cb33-284" aria-hidden="true" tabindex="-1"></a>      <span class="co"># </span><span class="al">TODO</span><span class="co">: note these strange exceptions</span></span>
<span id="cb33-285"><a href="#cb33-285" aria-hidden="true" tabindex="-1"></a>      cruise_id <span class="sc">==</span> <span class="st">"2507SR"</span> <span class="sc">&amp;</span></span>
<span id="cb33-286"><a href="#cb33-286" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(path_unzip, <span class="st">"Prelim.*csv"</span>) <span class="sc">~</span> <span class="st">"preliminary"</span>,</span>
<span id="cb33-287"><a href="#cb33-287" aria-hidden="true" tabindex="-1"></a>      cruise_id <span class="sc">==</span> <span class="st">"2111SR"</span> <span class="sc">&amp;</span></span>
<span id="cb33-288"><a href="#cb33-288" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(</span>
<span id="cb33-289"><a href="#cb33-289" aria-hidden="true" tabindex="-1"></a>          path_unzip,</span>
<span id="cb33-290"><a href="#cb33-290" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Prelim.*csvs-plots.*2111SR.*csv"</span></span>
<span id="cb33-291"><a href="#cb33-291" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">~</span> <span class="st">"preliminary"</span>,</span>
<span id="cb33-292"><a href="#cb33-292" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> <span class="cn">NA_character_</span></span>
<span id="cb33-293"><a href="#cb33-293" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb33-294"><a href="#cb33-294" aria-hidden="true" tabindex="-1"></a>    <span class="co"># detect cast direction from file_csv (U=upcast, D=downcast)</span></span>
<span id="cb33-295"><a href="#cb33-295" aria-hidden="true" tabindex="-1"></a>    <span class="at">cast_dir =</span> <span class="fu">case_when</span>(</span>
<span id="cb33-296"><a href="#cb33-296" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(file_csv, <span class="fu">regex</span>(<span class="st">"U</span><span class="sc">\\</span><span class="st">.csv$"</span>, <span class="at">ignore_case =</span> T)) <span class="sc">~</span> <span class="st">"U"</span>,</span>
<span id="cb33-297"><a href="#cb33-297" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(file_csv, <span class="fu">regex</span>(<span class="st">"D</span><span class="sc">\\</span><span class="st">.csv$"</span>, <span class="at">ignore_case =</span> T)) <span class="sc">~</span> <span class="st">"D"</span></span>
<span id="cb33-298"><a href="#cb33-298" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb33-299"><a href="#cb33-299" aria-hidden="true" tabindex="-1"></a>    <span class="co"># prioritize: final=1, preliminary=2</span></span>
<span id="cb33-300"><a href="#cb33-300" aria-hidden="true" tabindex="-1"></a>    <span class="at">priority =</span> <span class="fu">case_when</span>(</span>
<span id="cb33-301"><a href="#cb33-301" aria-hidden="true" tabindex="-1"></a>      data_stage <span class="sc">==</span> <span class="st">"final"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb33-302"><a href="#cb33-302" aria-hidden="true" tabindex="-1"></a>      data_stage <span class="sc">==</span> <span class="st">"preliminary"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb33-303"><a href="#cb33-303" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb33-304"><a href="#cb33-304" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-305"><a href="#cb33-305" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb33-306"><a href="#cb33-306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(cruise_id, path_unzip) <span class="sc">|&gt;</span></span>
<span id="cb33-307"><a href="#cb33-307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(cruise_id, path_unzip) <span class="sc">|&gt;</span></span>
<span id="cb33-308"><a href="#cb33-308" aria-hidden="true" tabindex="-1"></a>  <span class="co"># keep only final and preliminary files</span></span>
<span id="cb33-309"><a href="#cb33-309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(data_stage <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"final"</span>, <span class="st">"preliminary"</span>))</span>
<span id="cb33-310"><a href="#cb33-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-311"><a href="#cb33-311" aria-hidden="true" tabindex="-1"></a><span class="co"># for each cruise, keep only final if available, otherwise preliminary</span></span>
<span id="cb33-312"><a href="#cb33-312" aria-hidden="true" tabindex="-1"></a>d_priority <span class="ot">&lt;-</span> d_csv <span class="sc">|&gt;</span></span>
<span id="cb33-313"><a href="#cb33-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cruise_id) <span class="sc">|&gt;</span></span>
<span id="cb33-314"><a href="#cb33-314" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb33-315"><a href="#cb33-315" aria-hidden="true" tabindex="-1"></a>    <span class="at">best_priority =</span> <span class="fu">min</span>(priority),</span>
<span id="cb33-316"><a href="#cb33-316" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb33-317"><a href="#cb33-317" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-318"><a href="#cb33-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-319"><a href="#cb33-319" aria-hidden="true" tabindex="-1"></a>d_csv <span class="ot">&lt;-</span> d_csv <span class="sc">|&gt;</span></span>
<span id="cb33-320"><a href="#cb33-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(d_priority, <span class="at">by =</span> <span class="st">"cruise_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-321"><a href="#cb33-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(priority <span class="sc">==</span> best_priority) <span class="sc">|&gt;</span></span>
<span id="cb33-322"><a href="#cb33-322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>best_priority)</span>
<span id="cb33-323"><a href="#cb33-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-324"><a href="#cb33-324" aria-hidden="true" tabindex="-1"></a>cruises_csv_notzip <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(</span>
<span id="cb33-325"><a href="#cb33-325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>(d_csv<span class="sc">$</span>cruise_id),</span>
<span id="cb33-326"><a href="#cb33-326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>(d_zips<span class="sc">$</span>cruise_id)</span>
<span id="cb33-327"><a href="#cb33-327" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb33-328"><a href="#cb33-328" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span>
<span id="cb33-329"><a href="#cb33-329" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">length</span>(cruises_csv_notzip) <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb33-330"><a href="#cb33-330" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: cruises_zip_notcsv: find workable form of raw data</span></span>
<span id="cb33-331"><a href="#cb33-331" aria-hidden="true" tabindex="-1"></a>cruises_zip_notcsv <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(</span>
<span id="cb33-332"><a href="#cb33-332" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>(d_zips<span class="sc">$</span>cruise_id),</span>
<span id="cb33-333"><a href="#cb33-333" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>(d_csv<span class="sc">$</span>cruise_id)</span>
<span id="cb33-334"><a href="#cb33-334" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb33-335"><a href="#cb33-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span>
<span id="cb33-336"><a href="#cb33-336" aria-hidden="true" tabindex="-1"></a><span class="co">#  [1] "0001NH" "0004JD" "0007NH" "0010NH" "0101JD" "0104JD" "0107NH" "0110NH" "0201JD" "0204JD" "0207NH"</span></span>
<span id="cb33-337"><a href="#cb33-337" aria-hidden="true" tabindex="-1"></a><span class="co"># [12] "0211NH" "0304RR" "0404NH" "1203NH" "9003JD" "9011NH" "9101JD" "9103JD" "9108JD" "9110NH" "9202JD"</span></span>
<span id="cb33-338"><a href="#cb33-338" aria-hidden="true" tabindex="-1"></a><span class="co"># [23] "9204JD" "9207NH" "9210NH" "9301JD" "9304JD" "9308NH" "9310NH" "9401JD" "9403JD" "9408NH" "9410NH"</span></span>
<span id="cb33-339"><a href="#cb33-339" aria-hidden="true" tabindex="-1"></a><span class="co"># [34] "9501JD" "9504NH" "9507JD" "9510NH" "9602JD" "9604JD" "9608NH" "9610RR" "9702JD" "9704NH" "9707JD"</span></span>
<span id="cb33-340"><a href="#cb33-340" aria-hidden="true" tabindex="-1"></a><span class="co"># [45] "9709NH" "9712SP" "9803SP" "9805SP" "9808SP" "9809NH" "9810SP" "9811SP" "9812SP" "9901RR" "9904JD"</span></span>
<span id="cb33-341"><a href="#cb33-341" aria-hidden="true" tabindex="-1"></a><span class="co"># [56] "9908NH" "9910NH"</span></span>
<span id="cb33-342"><a href="#cb33-342" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: plot(ctdDecimate(ctdTrim(read.ctd("stn123.cnv")))) per [oce](https://dankelley.github.io/oce/articles/B_ctd.html#raw-data)</span></span>
<span id="cb33-343"><a href="#cb33-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-344"><a href="#cb33-344" aria-hidden="true" tabindex="-1"></a><span class="co"># librarian::shelf(oce, quiet = T)</span></span>
<span id="cb33-345"><a href="#cb33-345" aria-hidden="true" tabindex="-1"></a><span class="co"># dir_raw &lt;- "/Users/bbest/Library/CloudStorage/GoogleDrive-ben@ecoquants.com/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/19-9003JD_CTDTest"</span></span>
<span id="cb33-346"><a href="#cb33-346" aria-hidden="true" tabindex="-1"></a><span class="co"># raw_9003JD_dat &lt;- '/STA3-2.DAT'</span></span>
<span id="cb33-347"><a href="#cb33-347" aria-hidden="true" tabindex="-1"></a><span class="co"># d_ctd &lt;- read.ctd(dir_ls(dir_raw)) |&gt; plot(ctdDecimate(ctdTrim(.)))</span></span>
<span id="cb33-348"><a href="#cb33-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-349"><a href="#cb33-349" aria-hidden="true" tabindex="-1"></a><span class="co"># if (length(missing_cruises) &gt; 0) {</span></span>
<span id="cb33-350"><a href="#cb33-350" aria-hidden="true" tabindex="-1"></a><span class="co">#   warning(glue("Warning: Missing cruises with no final/preliminary files: {paste(missing_cruises, collapse = ', ')}"))</span></span>
<span id="cb33-351"><a href="#cb33-351" aria-hidden="true" tabindex="-1"></a><span class="co">#   # 0404JD</span></span>
<span id="cb33-352"><a href="#cb33-352" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb33-353"><a href="#cb33-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-354"><a href="#cb33-354" aria-hidden="true" tabindex="-1"></a><span class="co"># summary</span></span>
<span id="cb33-355"><a href="#cb33-355" aria-hidden="true" tabindex="-1"></a>d_csv <span class="sc">|&gt;</span></span>
<span id="cb33-356"><a href="#cb33-356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>path) <span class="sc">|&gt;</span></span>
<span id="cb33-357"><a href="#cb33-357" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(cruise_id, path_unzip) <span class="sc">|&gt;</span></span>
<span id="cb33-358"><a href="#cb33-358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(cruise_id, path_unzip) <span class="sc">|&gt;</span></span>
<span id="cb33-359"><a href="#cb33-359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(, <span class="at">caption =</span> <span class="st">"Files to Ingest"</span>)</span>
<span id="cb33-360"><a href="#cb33-360" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-361"><a href="#cb33-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-362"><a href="#cb33-362" aria-hidden="true" tabindex="-1"></a><span class="fu">## Read and Standardize CTD Files</span></span>
<span id="cb33-363"><a href="#cb33-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-366"><a href="#cb33-366" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-367"><a href="#cb33-367" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: read_csv</span></span>
<span id="cb33-368"><a href="#cb33-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-369"><a href="#cb33-369" aria-hidden="true" tabindex="-1"></a><span class="co"># read and combine all files (both upcast and downcast)</span></span>
<span id="cb33-370"><a href="#cb33-370" aria-hidden="true" tabindex="-1"></a>d_csv <span class="ot">&lt;-</span> d_csv <span class="sc">|&gt;</span></span>
<span id="cb33-371"><a href="#cb33-371" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">basename</span>(path)) <span class="sc">|&gt;</span></span>
<span id="cb33-372"><a href="#cb33-372" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-373"><a href="#cb33-373" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">map2</span>(path, <span class="fu">seq_along</span>(path), \(path, idx) {</span>
<span id="cb33-374"><a href="#cb33-374" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Reading {idx}/{nrow(d_csv)}: {basename(path)}"</span>))</span>
<span id="cb33-375"><a href="#cb33-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-376"><a href="#cb33-376" aria-hidden="true" tabindex="-1"></a>      <span class="co"># detect repeat header rows and skip them</span></span>
<span id="cb33-377"><a href="#cb33-377" aria-hidden="true" tabindex="-1"></a>      <span class="co"># eg line 69 of '20-0711NH_CTDFinalQC/db-csvs/20-0711_CTDBTL_001-067Dno001b.csv'</span></span>
<span id="cb33-378"><a href="#cb33-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-379"><a href="#cb33-379" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Read all lines to detect repeat headers</span></span>
<span id="cb33-380"><a href="#cb33-380" aria-hidden="true" tabindex="-1"></a>      all_lines <span class="ot">&lt;-</span> <span class="fu">read_lines</span>(path)</span>
<span id="cb33-381"><a href="#cb33-381" aria-hidden="true" tabindex="-1"></a>      header_line <span class="ot">&lt;-</span> all_lines[<span class="dv">1</span>]</span>
<span id="cb33-382"><a href="#cb33-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-383"><a href="#cb33-383" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Find all rows that exactly match the header (excluding the first row)</span></span>
<span id="cb33-384"><a href="#cb33-384" aria-hidden="true" tabindex="-1"></a>      repeat_header_rows <span class="ot">&lt;-</span> <span class="fu">which</span>(all_lines[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">==</span> header_line)</span>
<span id="cb33-385"><a href="#cb33-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-386"><a href="#cb33-386" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(repeat_header_rows) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb33-387"><a href="#cb33-387" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove repeat header rows from the data</span></span>
<span id="cb33-388"><a href="#cb33-388" aria-hidden="true" tabindex="-1"></a>        all_lines <span class="ot">&lt;-</span> all_lines[<span class="sc">-</span>(repeat_header_rows <span class="sc">+</span> <span class="dv">1</span>)]</span>
<span id="cb33-389"><a href="#cb33-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-390"><a href="#cb33-390" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Write cleaned data to temporary file</span></span>
<span id="cb33-391"><a href="#cb33-391" aria-hidden="true" tabindex="-1"></a>        tmp_file <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">".csv"</span>)</span>
<span id="cb33-392"><a href="#cb33-392" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_lines</span>(all_lines, tmp_file)</span>
<span id="cb33-393"><a href="#cb33-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-394"><a href="#cb33-394" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Read from cleaned file</span></span>
<span id="cb33-395"><a href="#cb33-395" aria-hidden="true" tabindex="-1"></a>        data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(tmp_file, <span class="at">guess_max =</span> <span class="cn">Inf</span>, <span class="at">show_col_types =</span> F) <span class="sc">|&gt;</span></span>
<span id="cb33-396"><a href="#cb33-396" aria-hidden="true" tabindex="-1"></a>          <span class="fu">clean_names</span>()</span>
<span id="cb33-397"><a href="#cb33-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-398"><a href="#cb33-398" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Clean up</span></span>
<span id="cb33-399"><a href="#cb33-399" aria-hidden="true" tabindex="-1"></a>        <span class="fu">file_delete</span>(tmp_file)</span>
<span id="cb33-400"><a href="#cb33-400" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb33-401"><a href="#cb33-401" aria-hidden="true" tabindex="-1"></a>        <span class="co"># No repeat headers, read normally</span></span>
<span id="cb33-402"><a href="#cb33-402" aria-hidden="true" tabindex="-1"></a>        data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(path, <span class="at">guess_max =</span> <span class="cn">Inf</span>, <span class="at">show_col_types =</span> F) <span class="sc">|&gt;</span></span>
<span id="cb33-403"><a href="#cb33-403" aria-hidden="true" tabindex="-1"></a>          <span class="fu">clean_names</span>()</span>
<span id="cb33-404"><a href="#cb33-404" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb33-405"><a href="#cb33-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-406"><a href="#cb33-406" aria-hidden="true" tabindex="-1"></a>      data</span>
<span id="cb33-407"><a href="#cb33-407" aria-hidden="true" tabindex="-1"></a>    }),</span>
<span id="cb33-408"><a href="#cb33-408" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add nrows per file to ctd_data</span></span>
<span id="cb33-409"><a href="#cb33-409" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrows =</span> <span class="fu">map_int</span>(data, <span class="sc">~</span> <span class="cf">if</span> (<span class="fu">is.null</span>(.x)) <span class="dv">0</span> <span class="cf">else</span> <span class="fu">nrow</span>(.x))</span>
<span id="cb33-410"><a href="#cb33-410" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-411"><a href="#cb33-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-412"><a href="#cb33-412" aria-hidden="true" tabindex="-1"></a>d_csv <span class="sc">|&gt;</span></span>
<span id="cb33-413"><a href="#cb33-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(cruise_id, file_csv) <span class="sc">|&gt;</span></span>
<span id="cb33-414"><a href="#cb33-414" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cruise_id, file_csv, nrows) <span class="sc">|&gt;</span></span>
<span id="cb33-415"><a href="#cb33-415" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(</span>
<span id="cb33-416"><a href="#cb33-416" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Number of rows read per file"</span></span>
<span id="cb33-417"><a href="#cb33-417" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb33-418"><a href="#cb33-418" aria-hidden="true" tabindex="-1"></a>  <span class="co"># big marks for thousands</span></span>
<span id="cb33-419"><a href="#cb33-419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatCurrency</span>(<span class="st">"nrows"</span>, <span class="at">currency =</span> <span class="st">""</span>, <span class="at">digits =</span> <span class="dv">0</span>, <span class="at">mark =</span> <span class="st">","</span>)</span>
<span id="cb33-420"><a href="#cb33-420" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-421"><a href="#cb33-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-422"><a href="#cb33-422" aria-hidden="true" tabindex="-1"></a><span class="fu">## Transform Data</span></span>
<span id="cb33-423"><a href="#cb33-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-426"><a href="#cb33-426" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-427"><a href="#cb33-427" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: d_bind</span></span>
<span id="cb33-428"><a href="#cb33-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-429"><a href="#cb33-429" aria-hidden="true" tabindex="-1"></a><span class="co"># Detect expected types from the most common type across all files</span></span>
<span id="cb33-430"><a href="#cb33-430" aria-hidden="true" tabindex="-1"></a>d_csv <span class="ot">&lt;-</span> d_csv <span class="sc">|&gt;</span></span>
<span id="cb33-431"><a href="#cb33-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-432"><a href="#cb33-432" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Identify completely empty columns in each data frame</span></span>
<span id="cb33-433"><a href="#cb33-433" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_empties =</span> <span class="fu">map</span>(data, \(x) {</span>
<span id="cb33-434"><a href="#cb33-434" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tibble</span>(</span>
<span id="cb33-435"><a href="#cb33-435" aria-hidden="true" tabindex="-1"></a>        <span class="at">col_name =</span> <span class="fu">names</span>(x),</span>
<span id="cb33-436"><a href="#cb33-436" aria-hidden="true" tabindex="-1"></a>        <span class="at">n_empty =</span> <span class="fu">map_int</span>(x, \(col) <span class="fu">sum</span>(<span class="fu">is.na</span>(col)))</span>
<span id="cb33-437"><a href="#cb33-437" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb33-438"><a href="#cb33-438" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(n_empty <span class="sc">==</span> <span class="fu">nrow</span>(x)) <span class="sc">|&gt;</span></span>
<span id="cb33-439"><a href="#cb33-439" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(col_name)</span>
<span id="cb33-440"><a href="#cb33-440" aria-hidden="true" tabindex="-1"></a>    }),</span>
<span id="cb33-441"><a href="#cb33-441" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract column types from each data frame</span></span>
<span id="cb33-442"><a href="#cb33-442" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_types =</span> <span class="fu">map2</span>(data, col_empties, \(x, y) {</span>
<span id="cb33-443"><a href="#cb33-443" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tibble</span>(</span>
<span id="cb33-444"><a href="#cb33-444" aria-hidden="true" tabindex="-1"></a>        <span class="at">col_name =</span> <span class="fu">names</span>(x),</span>
<span id="cb33-445"><a href="#cb33-445" aria-hidden="true" tabindex="-1"></a>        <span class="at">col_type =</span> <span class="fu">map_chr</span>(x, \(col) <span class="fu">class</span>(col)[<span class="dv">1</span>])</span>
<span id="cb33-446"><a href="#cb33-446" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb33-447"><a href="#cb33-447" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="sc">!</span>col_name <span class="sc">%in%</span> y)</span>
<span id="cb33-448"><a href="#cb33-448" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb33-449"><a href="#cb33-449" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-450"><a href="#cb33-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-451"><a href="#cb33-451" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the most common type for each column across all files</span></span>
<span id="cb33-452"><a href="#cb33-452" aria-hidden="true" tabindex="-1"></a>d_types <span class="ot">&lt;-</span> d_csv <span class="sc">|&gt;</span></span>
<span id="cb33-453"><a href="#cb33-453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(path, col_types) <span class="sc">|&gt;</span></span>
<span id="cb33-454"><a href="#cb33-454" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(col_types) <span class="sc">|&gt;</span></span>
<span id="cb33-455"><a href="#cb33-455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(col_name, col_type) <span class="sc">|&gt;</span></span>
<span id="cb33-456"><a href="#cb33-456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(col_name) <span class="sc">|&gt;</span></span>
<span id="cb33-457"><a href="#cb33-457" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(n, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-458"><a href="#cb33-458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb33-459"><a href="#cb33-459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(col_name, <span class="at">expected_type =</span> col_type)</span>
<span id="cb33-460"><a href="#cb33-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-461"><a href="#cb33-461" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify files with type mismatches</span></span>
<span id="cb33-462"><a href="#cb33-462" aria-hidden="true" tabindex="-1"></a>d_mismatches <span class="ot">&lt;-</span> d_csv <span class="sc">|&gt;</span></span>
<span id="cb33-463"><a href="#cb33-463" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cruise_id, path, col_types) <span class="sc">|&gt;</span></span>
<span id="cb33-464"><a href="#cb33-464" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(col_types) <span class="sc">|&gt;</span></span>
<span id="cb33-465"><a href="#cb33-465" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(d_types, <span class="at">by =</span> <span class="st">"col_name"</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-466"><a href="#cb33-466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(col_type <span class="sc">!=</span> expected_type) <span class="sc">|&gt;</span></span>
<span id="cb33-467"><a href="#cb33-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(col_name, path)</span>
<span id="cb33-468"><a href="#cb33-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-469"><a href="#cb33-469" aria-hidden="true" tabindex="-1"></a><span class="co"># Log mismatches if any exist</span></span>
<span id="cb33-470"><a href="#cb33-470" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(d_mismatches) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb33-471"><a href="#cb33-471" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Type mismatches detected - converting columns..."</span>)</span>
<span id="cb33-472"><a href="#cb33-472" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-473"><a href="#cb33-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-474"><a href="#cb33-474" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind data, converting mismatched columns to expected type</span></span>
<span id="cb33-475"><a href="#cb33-475" aria-hidden="true" tabindex="-1"></a>d_bind <span class="ot">&lt;-</span> d_csv <span class="sc">|&gt;</span></span>
<span id="cb33-476"><a href="#cb33-476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-477"><a href="#cb33-477" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">map2</span>(data, path, \(x, p) {</span>
<span id="cb33-478"><a href="#cb33-478" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Get columns that need type conversion for this file</span></span>
<span id="cb33-479"><a href="#cb33-479" aria-hidden="true" tabindex="-1"></a>      x_mismatches <span class="ot">&lt;-</span> d_mismatches <span class="sc">|&gt;</span></span>
<span id="cb33-480"><a href="#cb33-480" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(path <span class="sc">==</span> p)</span>
<span id="cb33-481"><a href="#cb33-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-482"><a href="#cb33-482" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">nrow</span>(x_mismatches) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb33-483"><a href="#cb33-483" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(x_mismatches)) {</span>
<span id="cb33-484"><a href="#cb33-484" aria-hidden="true" tabindex="-1"></a>          col <span class="ot">&lt;-</span> x_mismatches<span class="sc">$</span>col_name[i]</span>
<span id="cb33-485"><a href="#cb33-485" aria-hidden="true" tabindex="-1"></a>          expected <span class="ot">&lt;-</span> x_mismatches<span class="sc">$</span>expected_type[i]</span>
<span id="cb33-486"><a href="#cb33-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-487"><a href="#cb33-487" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Count NAs before conversion</span></span>
<span id="cb33-488"><a href="#cb33-488" aria-hidden="true" tabindex="-1"></a>          na_before <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(x[[col]]))</span>
<span id="cb33-489"><a href="#cb33-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-490"><a href="#cb33-490" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Convert to expected type</span></span>
<span id="cb33-491"><a href="#cb33-491" aria-hidden="true" tabindex="-1"></a>          <span class="fu">suppressWarnings</span>({</span>
<span id="cb33-492"><a href="#cb33-492" aria-hidden="true" tabindex="-1"></a>            x[[col]] <span class="ot">&lt;-</span> <span class="cf">switch</span>(</span>
<span id="cb33-493"><a href="#cb33-493" aria-hidden="true" tabindex="-1"></a>              expected,</span>
<span id="cb33-494"><a href="#cb33-494" aria-hidden="true" tabindex="-1"></a>              <span class="st">"numeric"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(x[[col]]),</span>
<span id="cb33-495"><a href="#cb33-495" aria-hidden="true" tabindex="-1"></a>              <span class="st">"integer"</span> <span class="ot">=</span> <span class="fu">as.integer</span>(x[[col]]),</span>
<span id="cb33-496"><a href="#cb33-496" aria-hidden="true" tabindex="-1"></a>              <span class="st">"logical"</span> <span class="ot">=</span> <span class="fu">as.logical</span>(x[[col]]),</span>
<span id="cb33-497"><a href="#cb33-497" aria-hidden="true" tabindex="-1"></a>              <span class="st">"character"</span> <span class="ot">=</span> <span class="fu">as.character</span>(x[[col]]),</span>
<span id="cb33-498"><a href="#cb33-498" aria-hidden="true" tabindex="-1"></a>              x[[col]]</span>
<span id="cb33-499"><a href="#cb33-499" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb33-500"><a href="#cb33-500" aria-hidden="true" tabindex="-1"></a>          })</span>
<span id="cb33-501"><a href="#cb33-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-502"><a href="#cb33-502" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Count NAs after conversion</span></span>
<span id="cb33-503"><a href="#cb33-503" aria-hidden="true" tabindex="-1"></a>          na_after <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(x[[col]]))</span>
<span id="cb33-504"><a href="#cb33-504" aria-hidden="true" tabindex="-1"></a>          na_generated <span class="ot">&lt;-</span> na_after <span class="sc">-</span> na_before</span>
<span id="cb33-505"><a href="#cb33-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-506"><a href="#cb33-506" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (na_generated <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb33-507"><a href="#cb33-507" aria-hidden="true" tabindex="-1"></a>            <span class="fu">message</span>(<span class="fu">glue</span>(</span>
<span id="cb33-508"><a href="#cb33-508" aria-hidden="true" tabindex="-1"></a>              <span class="st">"  {basename(p)}: {col} ({x_mismatches$col_type[i]} → {expected}) generated {na_generated} NAs"</span></span>
<span id="cb33-509"><a href="#cb33-509" aria-hidden="true" tabindex="-1"></a>            ))</span>
<span id="cb33-510"><a href="#cb33-510" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb33-511"><a href="#cb33-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-512"><a href="#cb33-512" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Store NA count in d_mismatches for reporting</span></span>
<span id="cb33-513"><a href="#cb33-513" aria-hidden="true" tabindex="-1"></a>          d_mismatches[</span>
<span id="cb33-514"><a href="#cb33-514" aria-hidden="true" tabindex="-1"></a>            d_mismatches<span class="sc">$</span>path <span class="sc">==</span> p <span class="sc">&amp;</span> d_mismatches<span class="sc">$</span>col_name <span class="sc">==</span> col,</span>
<span id="cb33-515"><a href="#cb33-515" aria-hidden="true" tabindex="-1"></a>            <span class="st">"nas_generated"</span></span>
<span id="cb33-516"><a href="#cb33-516" aria-hidden="true" tabindex="-1"></a>          ] <span class="ot">&lt;&lt;-</span> na_generated</span>
<span id="cb33-517"><a href="#cb33-517" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb33-518"><a href="#cb33-518" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb33-519"><a href="#cb33-519" aria-hidden="true" tabindex="-1"></a>      x</span>
<span id="cb33-520"><a href="#cb33-520" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb33-521"><a href="#cb33-521" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb33-522"><a href="#cb33-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(data)</span>
<span id="cb33-523"><a href="#cb33-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-524"><a href="#cb33-524" aria-hidden="true" tabindex="-1"></a><span class="co"># Report on type mismatches with NA generation</span></span>
<span id="cb33-525"><a href="#cb33-525" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(d_mismatches) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb33-526"><a href="#cb33-526" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Summary by column</span></span>
<span id="cb33-527"><a href="#cb33-527" aria-hidden="true" tabindex="-1"></a>  d_mismatches <span class="sc">|&gt;</span></span>
<span id="cb33-528"><a href="#cb33-528" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(col_name, expected_type, col_type) <span class="sc">|&gt;</span></span>
<span id="cb33-529"><a href="#cb33-529" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb33-530"><a href="#cb33-530" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_files =</span> <span class="fu">n</span>(),</span>
<span id="cb33-531"><a href="#cb33-531" aria-hidden="true" tabindex="-1"></a>      <span class="at">total_nas =</span> <span class="fu">sum</span>(nas_generated, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb33-532"><a href="#cb33-532" aria-hidden="true" tabindex="-1"></a>      <span class="at">files =</span> <span class="fu">paste</span>(<span class="fu">basename</span>(path), <span class="at">collapse =</span> <span class="st">"; "</span>),</span>
<span id="cb33-533"><a href="#cb33-533" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb33-534"><a href="#cb33-534" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb33-535"><a href="#cb33-535" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(total_nas)) <span class="sc">|&gt;</span></span>
<span id="cb33-536"><a href="#cb33-536" aria-hidden="true" tabindex="-1"></a>    <span class="fu">datatable</span>(</span>
<span id="cb33-537"><a href="#cb33-537" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Type mismatches by column"</span>,</span>
<span id="cb33-538"><a href="#cb33-538" aria-hidden="true" tabindex="-1"></a>      <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">20</span>)</span>
<span id="cb33-539"><a href="#cb33-539" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb33-540"><a href="#cb33-540" aria-hidden="true" tabindex="-1"></a>    <span class="fu">formatCurrency</span>(</span>
<span id="cb33-541"><a href="#cb33-541" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">"n_files"</span>, <span class="st">"total_nas"</span>),</span>
<span id="cb33-542"><a href="#cb33-542" aria-hidden="true" tabindex="-1"></a>      <span class="at">currency =</span> <span class="st">""</span>,</span>
<span id="cb33-543"><a href="#cb33-543" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">0</span>,</span>
<span id="cb33-544"><a href="#cb33-544" aria-hidden="true" tabindex="-1"></a>      <span class="at">mark =</span> <span class="st">","</span></span>
<span id="cb33-545"><a href="#cb33-545" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-546"><a href="#cb33-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-547"><a href="#cb33-547" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Summary by file</span></span>
<span id="cb33-548"><a href="#cb33-548" aria-hidden="true" tabindex="-1"></a>  d_mismatches <span class="sc">|&gt;</span></span>
<span id="cb33-549"><a href="#cb33-549" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb33-550"><a href="#cb33-550" aria-hidden="true" tabindex="-1"></a>      <span class="at">path_csv =</span> <span class="fu">basename</span>(path),</span>
<span id="cb33-551"><a href="#cb33-551" aria-hidden="true" tabindex="-1"></a>      <span class="at">col_expr =</span> <span class="fu">glue</span>(</span>
<span id="cb33-552"><a href="#cb33-552" aria-hidden="true" tabindex="-1"></a>        <span class="st">"{col_name}: {col_type} → {expected_type} ({nas_generated} NAs)&lt;br&gt;"</span></span>
<span id="cb33-553"><a href="#cb33-553" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb33-554"><a href="#cb33-554" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb33-555"><a href="#cb33-555" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(path_csv, col_name) <span class="sc">|&gt;</span></span>
<span id="cb33-556"><a href="#cb33-556" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(path_csv) <span class="sc">|&gt;</span></span>
<span id="cb33-557"><a href="#cb33-557" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb33-558"><a href="#cb33-558" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_columns =</span> <span class="fu">n</span>(),</span>
<span id="cb33-559"><a href="#cb33-559" aria-hidden="true" tabindex="-1"></a>      <span class="at">total_nas =</span> <span class="fu">sum</span>(nas_generated, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb33-560"><a href="#cb33-560" aria-hidden="true" tabindex="-1"></a>      <span class="at">columns =</span> <span class="fu">paste</span>(col_expr, <span class="at">collapse =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>),</span>
<span id="cb33-561"><a href="#cb33-561" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb33-562"><a href="#cb33-562" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb33-563"><a href="#cb33-563" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(total_nas), path_csv) <span class="sc">|&gt;</span></span>
<span id="cb33-564"><a href="#cb33-564" aria-hidden="true" tabindex="-1"></a>    <span class="fu">datatable</span>(</span>
<span id="cb33-565"><a href="#cb33-565" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Type mismatches by file"</span>,</span>
<span id="cb33-566"><a href="#cb33-566" aria-hidden="true" tabindex="-1"></a>      <span class="at">escape =</span> <span class="cn">FALSE</span>,</span>
<span id="cb33-567"><a href="#cb33-567" aria-hidden="true" tabindex="-1"></a>      <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">20</span>)</span>
<span id="cb33-568"><a href="#cb33-568" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb33-569"><a href="#cb33-569" aria-hidden="true" tabindex="-1"></a>    <span class="fu">formatCurrency</span>(</span>
<span id="cb33-570"><a href="#cb33-570" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">"n_columns"</span>, <span class="st">"total_nas"</span>),</span>
<span id="cb33-571"><a href="#cb33-571" aria-hidden="true" tabindex="-1"></a>      <span class="at">currency =</span> <span class="st">""</span>,</span>
<span id="cb33-572"><a href="#cb33-572" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">0</span>,</span>
<span id="cb33-573"><a href="#cb33-573" aria-hidden="true" tabindex="-1"></a>      <span class="at">mark =</span> <span class="st">","</span></span>
<span id="cb33-574"><a href="#cb33-574" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-575"><a href="#cb33-575" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-576"><a href="#cb33-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-577"><a href="#cb33-577" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: drop study / replace with cruise_id</span></span>
<span id="cb33-578"><a href="#cb33-578" aria-hidden="true" tabindex="-1"></a><span class="co"># d_bind$study |&gt; table(useNA = "ifany")</span></span>
<span id="cb33-579"><a href="#cb33-579" aria-hidden="true" tabindex="-1"></a><span class="co"># d_bind$cruise_id |&gt; table(useNA = "ifany") # NAs: 10,9782</span></span>
<span id="cb33-580"><a href="#cb33-580" aria-hidden="true" tabindex="-1"></a>d_bind <span class="sc">|&gt;</span></span>
<span id="cb33-581"><a href="#cb33-581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb33-582"><a href="#cb33-582" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(study),</span>
<span id="cb33-583"><a href="#cb33-583" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(cruise_id),</span>
<span id="cb33-584"><a href="#cb33-584" aria-hidden="true" tabindex="-1"></a>    cruise_id <span class="sc">!=</span> study</span>
<span id="cb33-585"><a href="#cb33-585" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb33-586"><a href="#cb33-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(study, cruise_id, path_unzip) <span class="sc">|&gt;</span></span>
<span id="cb33-587"><a href="#cb33-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(</span>
<span id="cb33-588"><a href="#cb33-588" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Mismatch between study and cruise_id"</span></span>
<span id="cb33-589"><a href="#cb33-589" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-590"><a href="#cb33-590" aria-hidden="true" tabindex="-1"></a><span class="co">#   study  cruise_id path_unzip</span></span>
<span id="cb33-591"><a href="#cb33-591" aria-hidden="true" tabindex="-1"></a><span class="co">#   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;</span></span>
<span id="cb33-592"><a href="#cb33-592" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 0404JD 0404NHJD  20-0404NHJD_CTDFinalQC/db_csvs/20-0404JD_CTDBTL_067-094ID.csv</span></span>
<span id="cb33-593"><a href="#cb33-593" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 0404JD 0404NHJD  20-0404NHJD_CTDFinalQC/db_csvs/20-0404JD_CTDBTL_067-094IU.csv</span></span>
<span id="cb33-594"><a href="#cb33-594" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 0404NH 0404NHJD  20-0404NHJD_CTDFinalQC/db_csvs/20-0404NH_CTDBTL_001-066ID.csv</span></span>
<span id="cb33-595"><a href="#cb33-595" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 0404NH 0404NHJD  20-0404NHJD_CTDFinalQC/db_csvs/20-0404NH_CTDBTL_001-066IU.csv</span></span>
<span id="cb33-596"><a href="#cb33-596" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 Study  0711NH    20-0711NH_CTDFinalQC/db-csvs/20-0711_CTDBTL_001-067Dno001b.csv</span></span>
<span id="cb33-597"><a href="#cb33-597" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb33-598"><a href="#cb33-598" aria-hidden="true" tabindex="-1"></a><span class="co"># update cruise_id to study where mismatched, except if study is "Study"</span></span>
<span id="cb33-599"><a href="#cb33-599" aria-hidden="true" tabindex="-1"></a>d_bind <span class="ot">&lt;-</span> d_bind <span class="sc">|&gt;</span></span>
<span id="cb33-600"><a href="#cb33-600" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-601"><a href="#cb33-601" aria-hidden="true" tabindex="-1"></a>    <span class="at">cruise_id =</span> <span class="fu">if_else</span>(</span>
<span id="cb33-602"><a href="#cb33-602" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(study) <span class="sc">&amp;</span></span>
<span id="cb33-603"><a href="#cb33-603" aria-hidden="true" tabindex="-1"></a>        cruise_id <span class="sc">!=</span> study <span class="sc">&amp;</span></span>
<span id="cb33-604"><a href="#cb33-604" aria-hidden="true" tabindex="-1"></a>        study <span class="sc">!=</span> <span class="st">"Study"</span>,</span>
<span id="cb33-605"><a href="#cb33-605" aria-hidden="true" tabindex="-1"></a>      study,</span>
<span id="cb33-606"><a href="#cb33-606" aria-hidden="true" tabindex="-1"></a>      cruise_id</span>
<span id="cb33-607"><a href="#cb33-607" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb33-608"><a href="#cb33-608" aria-hidden="true" tabindex="-1"></a>    <span class="at">source_file =</span> path_unzip</span>
<span id="cb33-609"><a href="#cb33-609" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb33-610"><a href="#cb33-610" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(source_file, <span class="at">.after =</span> cruise_id) <span class="sc">|&gt;</span></span>
<span id="cb33-611"><a href="#cb33-611" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb33-612"><a href="#cb33-612" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>path_unzip,</span>
<span id="cb33-613"><a href="#cb33-613" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>path,</span>
<span id="cb33-614"><a href="#cb33-614" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>file_csv,</span>
<span id="cb33-615"><a href="#cb33-615" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>dir_unzip,</span>
<span id="cb33-616"><a href="#cb33-616" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>priority,</span>
<span id="cb33-617"><a href="#cb33-617" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>project,</span>
<span id="cb33-618"><a href="#cb33-618" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>study,</span>
<span id="cb33-619"><a href="#cb33-619" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>nrows,</span>
<span id="cb33-620"><a href="#cb33-620" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>col_empties,</span>
<span id="cb33-621"><a href="#cb33-621" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>col_types</span>
<span id="cb33-622"><a href="#cb33-622" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-623"><a href="#cb33-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-624"><a href="#cb33-624" aria-hidden="true" tabindex="-1"></a><span class="co"># d_bind |&gt;</span></span>
<span id="cb33-625"><a href="#cb33-625" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(is.na(ord_occ)) |&gt;</span></span>
<span id="cb33-626"><a href="#cb33-626" aria-hidden="true" tabindex="-1"></a><span class="co">#   pull(cast_id) |&gt;</span></span>
<span id="cb33-627"><a href="#cb33-627" aria-hidden="true" tabindex="-1"></a><span class="co">#   table()</span></span>
<span id="cb33-628"><a href="#cb33-628" aria-hidden="true" tabindex="-1"></a><span class="co"># 0707_037d 0707_037u 0707_072d 0707_072u 0907_026d 0907_026u 0907_027d 0907_027u</span></span>
<span id="cb33-629"><a href="#cb33-629" aria-hidden="true" tabindex="-1"></a><span class="co">#      1024      1024       460       460       518       518       277       277</span></span>
<span id="cb33-630"><a href="#cb33-630" aria-hidden="true" tabindex="-1"></a><span class="co"># update ord_occ from cast_id where missing</span></span>
<span id="cb33-631"><a href="#cb33-631" aria-hidden="true" tabindex="-1"></a>d_bind <span class="ot">&lt;-</span> d_bind <span class="sc">|&gt;</span></span>
<span id="cb33-632"><a href="#cb33-632" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-633"><a href="#cb33-633" aria-hidden="true" tabindex="-1"></a>    <span class="at">ord_occ =</span> <span class="fu">if_else</span>(</span>
<span id="cb33-634"><a href="#cb33-634" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(ord_occ) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(cast_id),</span>
<span id="cb33-635"><a href="#cb33-635" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_extract</span>(cast_id, <span class="st">"_(</span><span class="sc">\\</span><span class="st">d{3})"</span>, <span class="at">group =</span> <span class="dv">1</span>),</span>
<span id="cb33-636"><a href="#cb33-636" aria-hidden="true" tabindex="-1"></a>      ord_occ</span>
<span id="cb33-637"><a href="#cb33-637" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-638"><a href="#cb33-638" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-639"><a href="#cb33-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-640"><a href="#cb33-640" aria-hidden="true" tabindex="-1"></a><span class="co"># is.na(d_bind$event_num) |&gt; table()</span></span>
<span id="cb33-641"><a href="#cb33-641" aria-hidden="true" tabindex="-1"></a><span class="co">#     FALSE       TRUE</span></span>
<span id="cb33-642"><a href="#cb33-642" aria-hidden="true" tabindex="-1"></a><span class="co"># 3,927,815  2,881,340</span></span>
<span id="cb33-643"><a href="#cb33-643" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: figure out missing ord_occ</span></span>
<span id="cb33-644"><a href="#cb33-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-645"><a href="#cb33-645" aria-hidden="true" tabindex="-1"></a><span class="co"># format date ----</span></span>
<span id="cb33-646"><a href="#cb33-646" aria-hidden="true" tabindex="-1"></a><span class="co"># apply formats depending on pattern</span></span>
<span id="cb33-647"><a href="#cb33-647" aria-hidden="true" tabindex="-1"></a>d_bind <span class="ot">&lt;-</span> d_bind <span class="sc">|&gt;</span></span>
<span id="cb33-648"><a href="#cb33-648" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-649"><a href="#cb33-649" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_time_utc =</span> <span class="fu">trim</span>(date_time_utc),</span>
<span id="cb33-650"><a href="#cb33-650" aria-hidden="true" tabindex="-1"></a>    <span class="at">dtime_utc =</span> <span class="cn">NA</span>, <span class="co"># _POSIXct_, # 163,181 | 6,596,130 failed to parse.</span></span>
<span id="cb33-651"><a href="#cb33-651" aria-hidden="true" tabindex="-1"></a>    <span class="at">dtime_utc =</span> <span class="fu">if_else</span>(</span>
<span id="cb33-652"><a href="#cb33-652" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(</span>
<span id="cb33-653"><a href="#cb33-653" aria-hidden="true" tabindex="-1"></a>        date_time_utc, <span class="co"># eg "23-Jan-1998 17:50:44"  "3-JAN-1998 17:50:44"</span></span>
<span id="cb33-654"><a href="#cb33-654" aria-hidden="true" tabindex="-1"></a>        <span class="st">"^</span><span class="sc">\\</span><span class="st">d{1,2}-[A-z]{3}-</span><span class="sc">\\</span><span class="st">d{4} </span><span class="sc">\\</span><span class="st">d{1,2}:</span><span class="sc">\\</span><span class="st">d{1,2}:</span><span class="sc">\\</span><span class="st">d{1,2}$"</span></span>
<span id="cb33-655"><a href="#cb33-655" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb33-656"><a href="#cb33-656" aria-hidden="true" tabindex="-1"></a>      <span class="fu">suppressWarnings</span>(<span class="fu">dmy_hms</span>(date_time_utc, <span class="at">tz =</span> <span class="st">"UTC"</span>)),</span>
<span id="cb33-657"><a href="#cb33-657" aria-hidden="true" tabindex="-1"></a>      dtime_utc</span>
<span id="cb33-658"><a href="#cb33-658" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb33-659"><a href="#cb33-659" aria-hidden="true" tabindex="-1"></a>    <span class="at">dtime_utc =</span> <span class="fu">if_else</span>(</span>
<span id="cb33-660"><a href="#cb33-660" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(</span>
<span id="cb33-661"><a href="#cb33-661" aria-hidden="true" tabindex="-1"></a>        date_time_utc, <span class="co"># eg "01/01/2015 17:12", "1/01/2015 17:12", "1/1/2015 17:12"</span></span>
<span id="cb33-662"><a href="#cb33-662" aria-hidden="true" tabindex="-1"></a>        <span class="st">"^</span><span class="sc">\\</span><span class="st">d{1,2}/</span><span class="sc">\\</span><span class="st">d{1,2}/</span><span class="sc">\\</span><span class="st">d{4} </span><span class="sc">\\</span><span class="st">d{1,2}:</span><span class="sc">\\</span><span class="st">d{1,2}$"</span></span>
<span id="cb33-663"><a href="#cb33-663" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb33-664"><a href="#cb33-664" aria-hidden="true" tabindex="-1"></a>      <span class="fu">suppressWarnings</span>(<span class="fu">mdy_hm</span>(date_time_utc, <span class="at">tz =</span> <span class="st">"UTC"</span>)),</span>
<span id="cb33-665"><a href="#cb33-665" aria-hidden="true" tabindex="-1"></a>      dtime_utc</span>
<span id="cb33-666"><a href="#cb33-666" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-667"><a href="#cb33-667" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb33-668"><a href="#cb33-668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(dtime_utc, <span class="at">.before =</span> date_time_utc) <span class="sc">|&gt;</span></span>
<span id="cb33-669"><a href="#cb33-669" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select(-date_time_utc, -date_time_pst) |&gt;</span></span>
<span id="cb33-670"><a href="#cb33-670" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(dtime_utc, depth)</span>
<span id="cb33-671"><a href="#cb33-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-672"><a href="#cb33-672" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(d_bind<span class="sc">$</span>dtime_utc)))</span>
<span id="cb33-673"><a href="#cb33-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-674"><a href="#cb33-674" aria-hidden="true" tabindex="-1"></a><span class="co"># fill in missing lon,lat from line,sta ----</span></span>
<span id="cb33-675"><a href="#cb33-675" aria-hidden="true" tabindex="-1"></a>d_bind <span class="ot">&lt;-</span> d_bind <span class="sc">|&gt;</span></span>
<span id="cb33-676"><a href="#cb33-676" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-677"><a href="#cb33-677" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon_dec =</span> <span class="fu">if_else</span>(</span>
<span id="cb33-678"><a href="#cb33-678" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(lon_dec) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(line) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(sta),</span>
<span id="cb33-679"><a href="#cb33-679" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(<span class="fu">sf_project</span>(</span>
<span id="cb33-680"><a href="#cb33-680" aria-hidden="true" tabindex="-1"></a>        <span class="at">from =</span> <span class="st">"+proj=calcofi"</span>,</span>
<span id="cb33-681"><a href="#cb33-681" aria-hidden="true" tabindex="-1"></a>        <span class="at">to =</span> <span class="st">"+proj=longlat +datum=WGS84"</span>,</span>
<span id="cb33-682"><a href="#cb33-682" aria-hidden="true" tabindex="-1"></a>        <span class="at">pts =</span> <span class="fu">cbind</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(line), <span class="at">y =</span> <span class="fu">as.numeric</span>(sta))</span>
<span id="cb33-683"><a href="#cb33-683" aria-hidden="true" tabindex="-1"></a>      )[, <span class="dv">1</span>]),</span>
<span id="cb33-684"><a href="#cb33-684" aria-hidden="true" tabindex="-1"></a>      lon_dec</span>
<span id="cb33-685"><a href="#cb33-685" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb33-686"><a href="#cb33-686" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat_dec =</span> <span class="fu">if_else</span>(</span>
<span id="cb33-687"><a href="#cb33-687" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(lat_dec) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(line) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(sta),</span>
<span id="cb33-688"><a href="#cb33-688" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(<span class="fu">sf_project</span>(</span>
<span id="cb33-689"><a href="#cb33-689" aria-hidden="true" tabindex="-1"></a>        <span class="at">from =</span> <span class="st">"+proj=calcofi"</span>,</span>
<span id="cb33-690"><a href="#cb33-690" aria-hidden="true" tabindex="-1"></a>        <span class="at">to =</span> <span class="st">"+proj=longlat +datum=WGS84"</span>,</span>
<span id="cb33-691"><a href="#cb33-691" aria-hidden="true" tabindex="-1"></a>        <span class="at">pts =</span> <span class="fu">cbind</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(line), <span class="at">y =</span> <span class="fu">as.numeric</span>(sta))</span>
<span id="cb33-692"><a href="#cb33-692" aria-hidden="true" tabindex="-1"></a>      )[, <span class="dv">2</span>]),</span>
<span id="cb33-693"><a href="#cb33-693" aria-hidden="true" tabindex="-1"></a>      lat_dec</span>
<span id="cb33-694"><a href="#cb33-694" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-695"><a href="#cb33-695" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-696"><a href="#cb33-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-697"><a href="#cb33-697" aria-hidden="true" tabindex="-1"></a><span class="co"># show first and last 100 rows</span></span>
<span id="cb33-698"><a href="#cb33-698" aria-hidden="true" tabindex="-1"></a>d_bind <span class="sc">|&gt;</span></span>
<span id="cb33-699"><a href="#cb33-699" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, (<span class="fu">n</span>() <span class="sc">-</span> <span class="dv">9</span>)<span class="sc">:</span><span class="fu">n</span>())) <span class="sc">|&gt;</span></span>
<span id="cb33-700"><a href="#cb33-700" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(</span>
<span id="cb33-701"><a href="#cb33-701" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="fu">glue</span>(</span>
<span id="cb33-702"><a href="#cb33-702" aria-hidden="true" tabindex="-1"></a>      <span class="st">"First and last 10 rows of combined CTD data (nrows: {format(nrow(d_bind), big.mark = ',')})"</span></span>
<span id="cb33-703"><a href="#cb33-703" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-704"><a href="#cb33-704" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-705"><a href="#cb33-705" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-706"><a href="#cb33-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-707"><a href="#cb33-707" aria-hidden="true" tabindex="-1"></a><span class="fu">## TODO</span></span>
<span id="cb33-708"><a href="#cb33-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-709"><a href="#cb33-709" aria-hidden="true" tabindex="-1"></a><span class="fu">### Process raw data</span></span>
<span id="cb33-710"><a href="#cb33-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-711"><a href="#cb33-711" aria-hidden="true" tabindex="-1"></a>into usable form:</span>
<span id="cb33-712"><a href="#cb33-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-713"><a href="#cb33-713" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Fathom software \| Sea-Bird Scientific</span><span class="co">](https://software.seabird.com/)</span></span>
<span id="cb33-714"><a href="#cb33-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-715"><a href="#cb33-715" aria-hidden="true" tabindex="-1"></a>References:</span>
<span id="cb33-716"><a href="#cb33-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-717"><a href="#cb33-717" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">CTD Data \| CalCOFI archives</span><span class="co">](https://newdata.calcofi.com/index.php/ctd-data)</span></span>
<span id="cb33-718"><a href="#cb33-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-719"><a href="#cb33-719" aria-hidden="true" tabindex="-1"></a><span class="at">    &gt; **Cast Files**. Files are created by SeaBird's Seasave program during each CalCOFI station. These data are unaltered and may contain errors (e.g., incorrect header information) or be incomplete due to system failure during collection. Two or more files may be available for a single station in the latter case. Each cruise will have a single cast data file. This file is a compressed .zip containing .zip files for each cast of the cruise, yymm_CTDCast.zip and yymm_llllssss</span><span class="sc">\_</span><span class="at">###.zip respectively. Each station .zip should contain the following: .bl, .con, .hdr, .hex, .mrk, and .prn files.</span></span>
<span id="cb33-720"><a href="#cb33-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-721"><a href="#cb33-721" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb33-722"><a href="#cb33-722" aria-hidden="true" tabindex="-1"></a><span class="fu">#### CalCOFI CTD System</span></span>
<span id="cb33-723"><a href="#cb33-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-724"><a href="#cb33-724" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A Sea-Bird Electronics 911plus V2 CTD collects vertical profile data at every CalCOFI station.</span>
<span id="cb33-725"><a href="#cb33-725" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In addition to being a dual TCO (temperature, conductivity, and oxygen) system, the CTD also interfaces with a transmissometer, fluorometer, PAR/SPAR meters, altimeter, nitrate, and pH sensor.</span>
<span id="cb33-726"><a href="#cb33-726" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Connected to a shipboard data-acquisition computer through an electronically-conductive winch wire, sensor data are collected and displayed real-time using Seasave V7.</span>
<span id="cb33-727"><a href="#cb33-727" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The CTD is normally lowered to terminal depth of 515 m, bottom-depth permitting, but is routinely deployed within meters from the seafloor at nearshore SCCOOS and basin stations.</span>
<span id="cb33-728"><a href="#cb33-728" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>To ensure high resolution sampling in areas with significant hydrological and biological gradients a speed of \~30 m/min is used for the first 100 m then \~60 m/min to depth without stopping.</span>
<span id="cb33-729"><a href="#cb33-729" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>During retrieval, the CTD is paused for at least 20 seconds at target bottle depths to adequately flush each 10 liter sample bottle prior to closure. Seawater samples are analyzed onboard (e.g., salinity, oxygen, nutrients, chl) and are used to correct measured CTD values.</span>
<span id="cb33-730"><a href="#cb33-730" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb33-731"><a href="#cb33-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-732"><a href="#cb33-732" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Mahmoud &amp; Mas (2022) <span class="co">[</span><span class="ot">Standard Operating Procedure: CTD data pre-processing</span><span class="co">](https://repository.oceanbestpractices.org/handle/11329/2081)</span>. *Ocean Best Practices*</span>
<span id="cb33-733"><a href="#cb33-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-734"><a href="#cb33-734" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- --&gt;</span></span>
<span id="cb33-735"><a href="#cb33-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-736"><a href="#cb33-736" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span></span>
<span id="cb33-737"><a href="#cb33-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-738"><a href="#cb33-738" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb33-739"><a href="#cb33-739" aria-hidden="true" tabindex="-1"></a><span class="in">@article{mohamed2022standard,</span></span>
<span id="cb33-740"><a href="#cb33-740" aria-hidden="true" tabindex="-1"></a><span class="in">  title={Standard Operating Procedure: CTD data pre-processing.},</span></span>
<span id="cb33-741"><a href="#cb33-741" aria-hidden="true" tabindex="-1"></a><span class="in">  author={Mohamed Mahmoud, Mohamed and Munoz Mas, Cristian},</span></span>
<span id="cb33-742"><a href="#cb33-742" aria-hidden="true" tabindex="-1"></a><span class="in">  year={2022},</span></span>
<span id="cb33-743"><a href="#cb33-743" aria-hidden="true" tabindex="-1"></a><span class="in">  publisher={Institut Mauritanien De Recherches Oc{\'e}anographiques Et De P{\^e}ches (IMROP)}</span></span>
<span id="cb33-744"><a href="#cb33-744" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb33-745"><a href="#cb33-745" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-746"><a href="#cb33-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-747"><a href="#cb33-747" aria-hidden="true" tabindex="-1"></a><span class="fu">### Check for duplicates</span></span>
<span id="cb33-748"><a href="#cb33-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-751"><a href="#cb33-751" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-752"><a href="#cb33-752" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: check-dupes</span></span>
<span id="cb33-753"><a href="#cb33-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-754"><a href="#cb33-754" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: look for duplicates by dtime_utc, depth</span></span>
<span id="cb33-755"><a href="#cb33-755" aria-hidden="true" tabindex="-1"></a>d_dupes <span class="ot">&lt;-</span> d_bind <span class="sc">|&gt;</span></span>
<span id="cb33-756"><a href="#cb33-756" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(dtime_utc, depth) <span class="sc">|&gt;</span></span>
<span id="cb33-757"><a href="#cb33-757" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-758"><a href="#cb33-758" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-759"><a href="#cb33-759" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="co">#  761,429 × 3</span></span>
<span id="cb33-760"><a href="#cb33-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-761"><a href="#cb33-761" aria-hidden="true" tabindex="-1"></a><span class="co"># get number of distinct dtime_utc, depth</span></span>
<span id="cb33-762"><a href="#cb33-762" aria-hidden="true" tabindex="-1"></a>n_distinct_dtime_depth <span class="ot">&lt;-</span> d_bind <span class="sc">|&gt;</span></span>
<span id="cb33-763"><a href="#cb33-763" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dtime_utc, depth) <span class="sc">|&gt;</span></span>
<span id="cb33-764"><a href="#cb33-764" aria-hidden="true" tabindex="-1"></a>  <span class="fu">n_distinct</span>() <span class="co"># 5,994,226</span></span>
<span id="cb33-765"><a href="#cb33-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-766"><a href="#cb33-766" aria-hidden="true" tabindex="-1"></a>d_dupes <span class="sc">|&gt;</span></span>
<span id="cb33-767"><a href="#cb33-767" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, (<span class="fu">n</span>() <span class="sc">-</span> <span class="dv">9</span>)<span class="sc">:</span><span class="fu">n</span>())) <span class="sc">|&gt;</span></span>
<span id="cb33-768"><a href="#cb33-768" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(</span>
<span id="cb33-769"><a href="#cb33-769" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="fu">glue</span>(</span>
<span id="cb33-770"><a href="#cb33-770" aria-hidden="true" tabindex="-1"></a>      <span class="st">"First and last 10 rows of duplicates by dtime_utc, depth (nrows = {format(nrow(d_dupes), big.mark = ',')}; n_distinct_dtime_depth = {format(n_distinct_dtime_depth, big.mark = ',')})"</span></span>
<span id="cb33-771"><a href="#cb33-771" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-772"><a href="#cb33-772" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-773"><a href="#cb33-773" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-774"><a href="#cb33-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-775"><a href="#cb33-775" aria-hidden="true" tabindex="-1"></a><span class="fu">## Ingest into DuckDB</span></span>
<span id="cb33-776"><a href="#cb33-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-779"><a href="#cb33-779" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-780"><a href="#cb33-780" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ingest-duckdb</span></span>
<span id="cb33-781"><a href="#cb33-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-782"><a href="#cb33-782" aria-hidden="true" tabindex="-1"></a><span class="co"># write to DuckDB</span></span>
<span id="cb33-783"><a href="#cb33-783" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(con, <span class="st">"ctd"</span>, d_bind, <span class="at">overwrite =</span> T)</span>
<span id="cb33-784"><a href="#cb33-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-785"><a href="#cb33-785" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Ingested {nrow(d_bind)} rows into DuckDB table 'ctd'"</span>))</span>
<span id="cb33-786"><a href="#cb33-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-787"><a href="#cb33-787" aria-hidden="true" tabindex="-1"></a><span class="co"># write point_geom as geometry column</span></span>
<span id="cb33-788"><a href="#cb33-788" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">glue</span>(</span>
<span id="cb33-789"><a href="#cb33-789" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Adding spatially indexed column point_geom from lon_dec and lat_dec..."</span></span>
<span id="cb33-790"><a href="#cb33-790" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb33-791"><a href="#cb33-791" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con, <span class="st">"ALTER TABLE ctd ADD COLUMN point_geom GEOMETRY;"</span>)</span>
<span id="cb33-792"><a href="#cb33-792" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con, <span class="st">"UPDATE ctd SET point_geom = ST_Point(lon_dec, lat_dec);"</span>)</span>
<span id="cb33-793"><a href="#cb33-793" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(</span>
<span id="cb33-794"><a href="#cb33-794" aria-hidden="true" tabindex="-1"></a>  con,</span>
<span id="cb33-795"><a href="#cb33-795" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CREATE INDEX idx_ctd_point_geom ON ctd USING RTREE(point_geom);"</span></span>
<span id="cb33-796"><a href="#cb33-796" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-797"><a href="#cb33-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-798"><a href="#cb33-798" aria-hidden="true" tabindex="-1"></a><span class="co"># disconnect</span></span>
<span id="cb33-799"><a href="#cb33-799" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con, <span class="at">shutdown =</span> <span class="cn">TRUE</span>)</span>
<span id="cb33-800"><a href="#cb33-800" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-801"><a href="#cb33-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-802"><a href="#cb33-802" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary</span></span>
<span id="cb33-803"><a href="#cb33-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-806"><a href="#cb33-806" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-807"><a href="#cb33-807" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: summary-duckdb</span></span>
<span id="cb33-808"><a href="#cb33-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-809"><a href="#cb33-809" aria-hidden="true" tabindex="-1"></a><span class="co"># reconnect to show final table structure</span></span>
<span id="cb33-810"><a href="#cb33-810" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(duckdb<span class="sc">::</span><span class="fu">duckdb</span>(), <span class="at">dbdir =</span> db_path, <span class="at">read_only =</span> T)</span>
<span id="cb33-811"><a href="#cb33-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-812"><a href="#cb33-812" aria-hidden="true" tabindex="-1"></a><span class="co"># table info</span></span>
<span id="cb33-813"><a href="#cb33-813" aria-hidden="true" tabindex="-1"></a><span class="fu">dbListTables</span>(con)</span>
<span id="cb33-814"><a href="#cb33-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-815"><a href="#cb33-815" aria-hidden="true" tabindex="-1"></a><span class="co"># show column names</span></span>
<span id="cb33-816"><a href="#cb33-816" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl</span>(con, <span class="st">"ctd"</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-817"><a href="#cb33-817" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-818"><a href="#cb33-818" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>() <span class="sc">|&gt;</span></span>
<span id="cb33-819"><a href="#cb33-819" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>()</span>
<span id="cb33-820"><a href="#cb33-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-821"><a href="#cb33-821" aria-hidden="true" tabindex="-1"></a><span class="co"># summary by stage and cast direction</span></span>
<span id="cb33-822"><a href="#cb33-822" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl</span>(con, <span class="st">"ctd"</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-823"><a href="#cb33-823" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(data_stage, cast_dir) <span class="sc">|&gt;</span></span>
<span id="cb33-824"><a href="#cb33-824" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span>
<span id="cb33-825"><a href="#cb33-825" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: why 136,054 rows of cast_dir NA (with final)?</span></span>
<span id="cb33-826"><a href="#cb33-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-827"><a href="#cb33-827" aria-hidden="true" tabindex="-1"></a><span class="co"># preview data</span></span>
<span id="cb33-828"><a href="#cb33-828" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl</span>(con, <span class="st">"ctd"</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-829"><a href="#cb33-829" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select(cruise_id, stage, cast_dir, lat_dec, lon_dec) |&gt;</span></span>
<span id="cb33-830"><a href="#cb33-830" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">20</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-831"><a href="#cb33-831" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span>
<span id="cb33-832"><a href="#cb33-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-833"><a href="#cb33-833" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con, <span class="at">shutdown =</span> <span class="cn">TRUE</span>)</span>
<span id="cb33-834"><a href="#cb33-834" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-835"><a href="#cb33-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-836"><a href="#cb33-836" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interactive Gantt Chart</span></span>
<span id="cb33-837"><a href="#cb33-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-840"><a href="#cb33-840" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-841"><a href="#cb33-841" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: gantt-chart</span></span>
<span id="cb33-842"><a href="#cb33-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-843"><a href="#cb33-843" aria-hidden="true" tabindex="-1"></a>librarian<span class="sc">::</span><span class="fu">shelf</span>(plotly, <span class="at">quiet =</span> T)</span>
<span id="cb33-844"><a href="#cb33-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-845"><a href="#cb33-845" aria-hidden="true" tabindex="-1"></a><span class="co"># reconnect to database</span></span>
<span id="cb33-846"><a href="#cb33-846" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(duckdb<span class="sc">::</span><span class="fu">duckdb</span>(), <span class="at">dbdir =</span> db_path, <span class="at">read_only =</span> T)</span>
<span id="cb33-847"><a href="#cb33-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-848"><a href="#cb33-848" aria-hidden="true" tabindex="-1"></a><span class="co"># tbl(con, "ctd") |&gt;</span></span>
<span id="cb33-849"><a href="#cb33-849" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(n = n())</span></span>
<span id="cb33-850"><a href="#cb33-850" aria-hidden="true" tabindex="-1"></a><span class="co"># 210,507</span></span>
<span id="cb33-851"><a href="#cb33-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-852"><a href="#cb33-852" aria-hidden="true" tabindex="-1"></a><span class="co"># tbl(con, "ctd") |&gt;</span></span>
<span id="cb33-853"><a href="#cb33-853" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(study == "2301RL") |&gt;</span></span>
<span id="cb33-854"><a href="#cb33-854" aria-hidden="true" tabindex="-1"></a><span class="co">#   distinct(study) |&gt;</span></span>
<span id="cb33-855"><a href="#cb33-855" aria-hidden="true" tabindex="-1"></a><span class="co">#   pull(study) |&gt;</span></span>
<span id="cb33-856"><a href="#cb33-856" aria-hidden="true" tabindex="-1"></a><span class="co">#   sort()</span></span>
<span id="cb33-857"><a href="#cb33-857" aria-hidden="true" tabindex="-1"></a><span class="co"># 20 - 2401</span></span>
<span id="cb33-858"><a href="#cb33-858" aria-hidden="true" tabindex="-1"></a><span class="co"># RL_CTDBTL_017 - 033</span></span>
<span id="cb33-859"><a href="#cb33-859" aria-hidden="true" tabindex="-1"></a><span class="co"># U.csv</span></span>
<span id="cb33-860"><a href="#cb33-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-861"><a href="#cb33-861" aria-hidden="true" tabindex="-1"></a><span class="co"># tbl(con, "ctd") |&gt;</span></span>
<span id="cb33-862"><a href="#cb33-862" aria-hidden="true" tabindex="-1"></a><span class="co">#   pull(study) |&gt;</span></span>
<span id="cb33-863"><a href="#cb33-863" aria-hidden="true" tabindex="-1"></a><span class="co">#   table(useNA = "ifany")</span></span>
<span id="cb33-864"><a href="#cb33-864" aria-hidden="true" tabindex="-1"></a><span class="co">#  9802JD   9804JD</span></span>
<span id="cb33-865"><a href="#cb33-865" aria-hidden="true" tabindex="-1"></a><span class="co">#  59,005  151,502</span></span>
<span id="cb33-866"><a href="#cb33-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-867"><a href="#cb33-867" aria-hidden="true" tabindex="-1"></a><span class="co"># get cruise date spans by cruise and stage</span></span>
<span id="cb33-868"><a href="#cb33-868" aria-hidden="true" tabindex="-1"></a>cruise_spans <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"ctd"</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-869"><a href="#cb33-869" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rename(data_stage = data_type) |&gt; # DEBUG</span></span>
<span id="cb33-870"><a href="#cb33-870" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cruise_id, data_stage) <span class="sc">|&gt;</span></span>
<span id="cb33-871"><a href="#cb33-871" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb33-872"><a href="#cb33-872" aria-hidden="true" tabindex="-1"></a>    <span class="at">beg_date =</span> <span class="fu">min</span>(dtime_utc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> <span class="fu">as.Date</span>(),</span>
<span id="cb33-873"><a href="#cb33-873" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_date =</span> <span class="fu">max</span>(dtime_utc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> <span class="fu">as.Date</span>(),</span>
<span id="cb33-874"><a href="#cb33-874" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb33-875"><a href="#cb33-875" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb33-876"><a href="#cb33-876" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>() <span class="sc">|&gt;</span></span>
<span id="cb33-877"><a href="#cb33-877" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(beg_date), <span class="sc">!</span><span class="fu">is.na</span>(end_date))</span>
<span id="cb33-878"><a href="#cb33-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-879"><a href="#cb33-879" aria-hidden="true" tabindex="-1"></a><span class="co"># Split multi-year cruises into separate rows</span></span>
<span id="cb33-880"><a href="#cb33-880" aria-hidden="true" tabindex="-1"></a>cruise_spans <span class="ot">&lt;-</span> cruise_spans <span class="sc">|&gt;</span></span>
<span id="cb33-881"><a href="#cb33-881" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb33-882"><a href="#cb33-882" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-883"><a href="#cb33-883" aria-hidden="true" tabindex="-1"></a>    <span class="at">years_spanned =</span> <span class="fu">list</span>(<span class="fu">year</span>(beg_date)<span class="sc">:</span><span class="fu">year</span>(end_date))</span>
<span id="cb33-884"><a href="#cb33-884" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb33-885"><a href="#cb33-885" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(years_spanned) <span class="sc">|&gt;</span></span>
<span id="cb33-886"><a href="#cb33-886" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-887"><a href="#cb33-887" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adjust dates for each year segment</span></span>
<span id="cb33-888"><a href="#cb33-888" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> years_spanned,</span>
<span id="cb33-889"><a href="#cb33-889" aria-hidden="true" tabindex="-1"></a>    <span class="at">adj_beg_date =</span> <span class="fu">if_else</span>(</span>
<span id="cb33-890"><a href="#cb33-890" aria-hidden="true" tabindex="-1"></a>      years_spanned <span class="sc">==</span> <span class="fu">year</span>(beg_date),</span>
<span id="cb33-891"><a href="#cb33-891" aria-hidden="true" tabindex="-1"></a>      beg_date,</span>
<span id="cb33-892"><a href="#cb33-892" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.Date</span>(<span class="fu">paste0</span>(years_spanned, <span class="st">"-01-01"</span>))</span>
<span id="cb33-893"><a href="#cb33-893" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb33-894"><a href="#cb33-894" aria-hidden="true" tabindex="-1"></a>    <span class="at">adj_end_date =</span> <span class="fu">if_else</span>(</span>
<span id="cb33-895"><a href="#cb33-895" aria-hidden="true" tabindex="-1"></a>      years_spanned <span class="sc">==</span> <span class="fu">year</span>(end_date),</span>
<span id="cb33-896"><a href="#cb33-896" aria-hidden="true" tabindex="-1"></a>      end_date,</span>
<span id="cb33-897"><a href="#cb33-897" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.Date</span>(<span class="fu">paste0</span>(years_spanned, <span class="st">"-12-31"</span>))</span>
<span id="cb33-898"><a href="#cb33-898" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb33-899"><a href="#cb33-899" aria-hidden="true" tabindex="-1"></a>    <span class="at">begin_jday =</span> <span class="fu">yday</span>(adj_beg_date),</span>
<span id="cb33-900"><a href="#cb33-900" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_jday =</span> <span class="fu">yday</span>(adj_end_date),</span>
<span id="cb33-901"><a href="#cb33-901" aria-hidden="true" tabindex="-1"></a>    <span class="at">stage_label =</span> data_stage,</span>
<span id="cb33-902"><a href="#cb33-902" aria-hidden="true" tabindex="-1"></a>    <span class="at">hover_text =</span> <span class="fu">glue</span>(</span>
<span id="cb33-903"><a href="#cb33-903" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Cruise: {cruise_id}&lt;br&gt;"</span>,</span>
<span id="cb33-904"><a href="#cb33-904" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Stage: {data_stage}&lt;br&gt;"</span>,</span>
<span id="cb33-905"><a href="#cb33-905" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Begin: {format(beg_date, '%Y-%m-%d')}&lt;br&gt;"</span>,</span>
<span id="cb33-906"><a href="#cb33-906" aria-hidden="true" tabindex="-1"></a>      <span class="st">"End: {format(end_date, '%Y-%m-%d')}&lt;br&gt;"</span>,</span>
<span id="cb33-907"><a href="#cb33-907" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Duration: {as.numeric(difftime(end_date, beg_date, units = 'days'))} days"</span></span>
<span id="cb33-908"><a href="#cb33-908" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-909"><a href="#cb33-909" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb33-910"><a href="#cb33-910" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb33-911"><a href="#cb33-911" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(adj_beg_date)</span>
<span id="cb33-912"><a href="#cb33-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-913"><a href="#cb33-913" aria-hidden="true" tabindex="-1"></a><span class="co"># create color mapping</span></span>
<span id="cb33-914"><a href="#cb33-914" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"final"</span> <span class="ot">=</span> <span class="st">"#23d355ff"</span>, <span class="st">"preliminary"</span> <span class="ot">=</span> <span class="st">"#A23B72"</span>)</span>
<span id="cb33-915"><a href="#cb33-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-916"><a href="#cb33-916" aria-hidden="true" tabindex="-1"></a><span class="co"># create interactive gantt chart</span></span>
<span id="cb33-917"><a href="#cb33-917" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>()</span>
<span id="cb33-918"><a href="#cb33-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-919"><a href="#cb33-919" aria-hidden="true" tabindex="-1"></a><span class="co"># add traces for each cruise segment</span></span>
<span id="cb33-920"><a href="#cb33-920" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(cruise_spans)) {</span>
<span id="cb33-921"><a href="#cb33-921" aria-hidden="true" tabindex="-1"></a>  row <span class="ot">&lt;-</span> cruise_spans[i, ]</span>
<span id="cb33-922"><a href="#cb33-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-923"><a href="#cb33-923" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p <span class="sc">|&gt;</span></span>
<span id="cb33-924"><a href="#cb33-924" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_trace</span>(</span>
<span id="cb33-925"><a href="#cb33-925" aria-hidden="true" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">"scatter"</span>,</span>
<span id="cb33-926"><a href="#cb33-926" aria-hidden="true" tabindex="-1"></a>      <span class="at">mode =</span> <span class="st">"lines"</span>,</span>
<span id="cb33-927"><a href="#cb33-927" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">c</span>(row<span class="sc">$</span>begin_jday, row<span class="sc">$</span>end_jday),</span>
<span id="cb33-928"><a href="#cb33-928" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">c</span>(row<span class="sc">$</span>year, row<span class="sc">$</span>year),</span>
<span id="cb33-929"><a href="#cb33-929" aria-hidden="true" tabindex="-1"></a>      <span class="at">line =</span> <span class="fu">list</span>(</span>
<span id="cb33-930"><a href="#cb33-930" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> colors[row<span class="sc">$</span>stage_label],</span>
<span id="cb33-931"><a href="#cb33-931" aria-hidden="true" tabindex="-1"></a>        <span class="at">width =</span> <span class="dv">8</span></span>
<span id="cb33-932"><a href="#cb33-932" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb33-933"><a href="#cb33-933" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> row<span class="sc">$</span>hover_text,</span>
<span id="cb33-934"><a href="#cb33-934" aria-hidden="true" tabindex="-1"></a>      <span class="at">hoverinfo =</span> <span class="st">"text"</span>,</span>
<span id="cb33-935"><a href="#cb33-935" aria-hidden="true" tabindex="-1"></a>      <span class="at">showlegend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb33-936"><a href="#cb33-936" aria-hidden="true" tabindex="-1"></a>      <span class="at">legendgroup =</span> row<span class="sc">$</span>stage_label</span>
<span id="cb33-937"><a href="#cb33-937" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-938"><a href="#cb33-938" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-939"><a href="#cb33-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-940"><a href="#cb33-940" aria-hidden="true" tabindex="-1"></a><span class="co"># add legend traces</span></span>
<span id="cb33-941"><a href="#cb33-941" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">|&gt;</span></span>
<span id="cb33-942"><a href="#cb33-942" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(</span>
<span id="cb33-943"><a href="#cb33-943" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"scatter"</span>,</span>
<span id="cb33-944"><a href="#cb33-944" aria-hidden="true" tabindex="-1"></a>    <span class="at">mode =</span> <span class="st">"lines"</span>,</span>
<span id="cb33-945"><a href="#cb33-945" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb33-946"><a href="#cb33-946" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb33-947"><a href="#cb33-947" aria-hidden="true" tabindex="-1"></a>    <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> colors[<span class="st">"final"</span>], <span class="at">width =</span> <span class="dv">8</span>),</span>
<span id="cb33-948"><a href="#cb33-948" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Final"</span>,</span>
<span id="cb33-949"><a href="#cb33-949" aria-hidden="true" tabindex="-1"></a>    <span class="at">showlegend =</span> <span class="cn">TRUE</span></span>
<span id="cb33-950"><a href="#cb33-950" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb33-951"><a href="#cb33-951" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(</span>
<span id="cb33-952"><a href="#cb33-952" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"scatter"</span>,</span>
<span id="cb33-953"><a href="#cb33-953" aria-hidden="true" tabindex="-1"></a>    <span class="at">mode =</span> <span class="st">"lines"</span>,</span>
<span id="cb33-954"><a href="#cb33-954" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb33-955"><a href="#cb33-955" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb33-956"><a href="#cb33-956" aria-hidden="true" tabindex="-1"></a>    <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> colors[<span class="st">"preliminary"</span>], <span class="at">width =</span> <span class="dv">8</span>),</span>
<span id="cb33-957"><a href="#cb33-957" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Preliminary"</span>,</span>
<span id="cb33-958"><a href="#cb33-958" aria-hidden="true" tabindex="-1"></a>    <span class="at">showlegend =</span> <span class="cn">TRUE</span></span>
<span id="cb33-959"><a href="#cb33-959" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-960"><a href="#cb33-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-961"><a href="#cb33-961" aria-hidden="true" tabindex="-1"></a><span class="co"># customize layout</span></span>
<span id="cb33-962"><a href="#cb33-962" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">|&gt;</span></span>
<span id="cb33-963"><a href="#cb33-963" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb33-964"><a href="#cb33-964" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"CalCOFI CTD Cruise Timeline"</span>,</span>
<span id="cb33-965"><a href="#cb33-965" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(</span>
<span id="cb33-966"><a href="#cb33-966" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Day of Year"</span>,</span>
<span id="cb33-967"><a href="#cb33-967" aria-hidden="true" tabindex="-1"></a>      <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">365</span>),</span>
<span id="cb33-968"><a href="#cb33-968" aria-hidden="true" tabindex="-1"></a>      <span class="at">dtick =</span> <span class="dv">30</span>,</span>
<span id="cb33-969"><a href="#cb33-969" aria-hidden="true" tabindex="-1"></a>      <span class="at">tickangle =</span> <span class="dv">0</span></span>
<span id="cb33-970"><a href="#cb33-970" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb33-971"><a href="#cb33-971" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(</span>
<span id="cb33-972"><a href="#cb33-972" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Year"</span>,</span>
<span id="cb33-973"><a href="#cb33-973" aria-hidden="true" tabindex="-1"></a>      <span class="at">autorange =</span> <span class="st">"reversed"</span>,</span>
<span id="cb33-974"><a href="#cb33-974" aria-hidden="true" tabindex="-1"></a>      <span class="at">dtick =</span> <span class="dv">1</span></span>
<span id="cb33-975"><a href="#cb33-975" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb33-976"><a href="#cb33-976" aria-hidden="true" tabindex="-1"></a>    <span class="at">hovermode =</span> <span class="st">"closest"</span>,</span>
<span id="cb33-977"><a href="#cb33-977" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot_bgcolor =</span> <span class="st">"#f8f9fa"</span>,</span>
<span id="cb33-978"><a href="#cb33-978" aria-hidden="true" tabindex="-1"></a>    <span class="at">paper_bgcolor =</span> <span class="st">"white"</span>,</span>
<span id="cb33-979"><a href="#cb33-979" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend =</span> <span class="fu">list</span>(</span>
<span id="cb33-980"><a href="#cb33-980" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fl">1.02</span>,</span>
<span id="cb33-981"><a href="#cb33-981" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="dv">1</span>,</span>
<span id="cb33-982"><a href="#cb33-982" aria-hidden="true" tabindex="-1"></a>      <span class="at">xanchor =</span> <span class="st">"left"</span>,</span>
<span id="cb33-983"><a href="#cb33-983" aria-hidden="true" tabindex="-1"></a>      <span class="at">yanchor =</span> <span class="st">"top"</span></span>
<span id="cb33-984"><a href="#cb33-984" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-985"><a href="#cb33-985" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-986"><a href="#cb33-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-987"><a href="#cb33-987" aria-hidden="true" tabindex="-1"></a><span class="co"># display chart</span></span>
<span id="cb33-988"><a href="#cb33-988" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb33-989"><a href="#cb33-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-990"><a href="#cb33-990" aria-hidden="true" tabindex="-1"></a><span class="co"># disconnect</span></span>
<span id="cb33-991"><a href="#cb33-991" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con, <span class="at">shutdown =</span> <span class="cn">TRUE</span>) <span class="co"># get cruise date spans by cruise and stage</span></span>
<span id="cb33-992"><a href="#cb33-992" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>