<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-10-16">

<title>Scrape &amp; Ingest CalCOFI CTD Data into DuckDB</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="scrape_ctd_files/libs/clipboard/clipboard.min.js"></script>
<script src="scrape_ctd_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="scrape_ctd_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="scrape_ctd_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="scrape_ctd_files/libs/quarto-html/popper.min.js"></script>
<script src="scrape_ctd_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="scrape_ctd_files/libs/quarto-html/anchor.min.js"></script>
<link href="scrape_ctd_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="scrape_ctd_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="scrape_ctd_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="scrape_ctd_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="scrape_ctd_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="scrape_ctd_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="scrape_ctd_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="scrape_ctd_files/libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="scrape_ctd_files/libs/datatables-binding-0.34.0/datatables.js"></script>
<script src="scrape_ctd_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="scrape_ctd_files/libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="scrape_ctd_files/libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="scrape_ctd_files/libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="scrape_ctd_files/libs/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet">
<script src="scrape_ctd_files/libs/crosstalk-1.2.2/js/crosstalk.min.js"></script>
<script src="scrape_ctd_files/libs/plotly-binding-4.11.0/plotly.js"></script>
<script src="scrape_ctd_files/libs/typedarray-0.1/typedarray.min.js"></script>
<link href="scrape_ctd_files/libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="scrape_ctd_files/libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><span class="header-section-number">1</span> Overview</a>
  <ul class="collapse">
  <li><a href="#key-features" id="toc-key-features" class="nav-link" data-scroll-target="#key-features"><span class="header-section-number">1.1</span> Key Features</a></li>
  <li><a href="#usage" id="toc-usage" class="nav-link" data-scroll-target="#usage"><span class="header-section-number">1.2</span> Usage</a></li>
  <li><a href="#notes" id="toc-notes" class="nav-link" data-scroll-target="#notes"><span class="header-section-number">1.3</span> Notes</a></li>
  </ul></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup"><span class="header-section-number">2</span> Setup</a></li>
  <li><a href="#scrape-ctd-download-links" id="toc-scrape-ctd-download-links" class="nav-link" data-scroll-target="#scrape-ctd-download-links"><span class="header-section-number">3</span> Scrape CTD Download Links</a></li>
  <li><a href="#download-and-unzip-files" id="toc-download-and-unzip-files" class="nav-link" data-scroll-target="#download-and-unzip-files"><span class="header-section-number">4</span> Download and Unzip Files</a></li>
  <li><a href="#find-and-prioritize-ctd-data-files" id="toc-find-and-prioritize-ctd-data-files" class="nav-link" data-scroll-target="#find-and-prioritize-ctd-data-files"><span class="header-section-number">5</span> Find and Prioritize CTD Data Files</a></li>
  <li><a href="#read-and-standardize-ctd-files" id="toc-read-and-standardize-ctd-files" class="nav-link" data-scroll-target="#read-and-standardize-ctd-files"><span class="header-section-number">6</span> Read and Standardize CTD Files</a></li>
  <li><a href="#transform-data" id="toc-transform-data" class="nav-link" data-scroll-target="#transform-data"><span class="header-section-number">7</span> Transform Data</a></li>
  <li><a href="#todo-check-for-duplicates" id="toc-todo-check-for-duplicates" class="nav-link" data-scroll-target="#todo-check-for-duplicates"><span class="header-section-number">8</span> TODO: Check for duplicates</a></li>
  <li><a href="#ingest-into-duckdb" id="toc-ingest-into-duckdb" class="nav-link" data-scroll-target="#ingest-into-duckdb"><span class="header-section-number">9</span> Ingest into DuckDB</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">10</span> Summary</a></li>
  <li><a href="#interactive-gantt-chart" id="toc-interactive-gantt-chart" class="nav-link" data-scroll-target="#interactive-gantt-chart"><span class="header-section-number">11</span> Interactive Gantt Chart</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Scrape &amp; Ingest CalCOFI CTD Data into DuckDB</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2025-10-16</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="overview" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="overview"><span class="header-section-number">1</span> Overview</h2>
<p>This notebook scrapes CalCOFI CTD data from <a href="https://calcofi.org/data/oceanographic-data/ctd-cast-files/" class="uri">https://calcofi.org/data/oceanographic-data/ctd-cast-files/</a>, downloads only <strong>final</strong> and <strong>preliminary</strong> CTD files, and ingests them into a DuckDB database.</p>
<section id="key-features" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="key-features"><span class="header-section-number">1.1</span> Key Features</h3>
<ol type="1">
<li><p><strong>Web Scraping</strong>: Scrapes for all CTD .zip download links</p></li>
<li><p><strong>Smart Filtering</strong>:</p>
<ul>
<li>Downloads all .zip files for archival completeness</li>
<li>Only unzips <code>final</code> (e.g., 20-2105SH_CTDFinalQC.zip) and <code>preliminary</code> (e.g., 20-2507SR_CTDPrelim.zip) files</li>
<li>Skips unzipping raw/cast/test files to save disk space</li>
</ul></li>
<li><p><strong>Download &amp; Unzip</strong>: Downloads all zip files to <code>~/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download</code> but only extracts final and preliminary data</p></li>
<li><p><strong>Priority-based Selection</strong>:</p>
<ul>
<li>For each cruise (identified by yy-yymm + ship code), selects final if available</li>
<li>Falls back to preliminary if final not available for that cruise</li>
<li>Completely excludes raw/test/prodo cast files</li>
</ul></li>
<li><p><strong>Union Strategy</strong>:</p>
<ul>
<li>Merges upcast (U) and downcast (D) CSV files into single “ctd” table</li>
<li>Adds <code>stage</code> flag: “F” for final, “P” for preliminary</li>
<li>Adds <code>cast_dir</code> flag: “U” for upcast, “D” for downcast</li>
</ul></li>
<li><p><strong>Data Standardization</strong>:</p>
<ul>
<li>Converts all column names to <code>lower_snake_case</code> using <code>janitor::clean_names()</code></li>
<li>Creates spatial index on <code>lat_dec</code> and <code>lon_dec</code> fields</li>
<li>Preserves <code>cruise_id</code> and <code>source_file</code> metadata</li>
</ul></li>
</ol>
</section>
<section id="usage" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="usage"><span class="header-section-number">1.2</span> Usage</h3>
<p>To run the notebook:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>quarto<span class="sc">::</span><span class="fu">quarto_render</span>(<span class="st">"scrape_ctd.qmd"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="notes" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="notes"><span class="header-section-number">1.3</span> Notes</h3>
<ul>
<li>All .zip files are downloaded for archival purposes, but only final/prelim are unzipped</li>
<li>Only processes CSV files from final (<code>db-csvs/*.csv</code>) and preliminary directories</li>
<li>Downloads can be resumed (already-downloaded files are skipped)</li>
<li>Both upcast (U) and downcast (D) profiles are included in the database</li>
<li>The priority system ensures you only get final data when available, otherwise preliminary</li>
<li>Spatial index enables efficient geographic queries on lat_dec and lon_dec</li>
</ul>
</section>
</section>
<section id="setup" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="setup"><span class="header-section-number">2</span> Setup</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>librarian<span class="sc">::</span><span class="fu">shelf</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  dplyr, DBI, DT, duckdb, fs, glue, here, httr, janitor, lubridate, purrr, readr, rvest, sf, stringr, tibble, tidyr, zip,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">quiet =</span> T)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># set download directory</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>dir_dl  <span class="ot">&lt;-</span> <span class="st">"~/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download"</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>dir_dl  <span class="ot">&lt;-</span> <span class="fu">path_expand</span>(dir_dl)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>db_path <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"{dir_dl}/calcofi-ctd.duckdb"</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>db_redo <span class="ot">&lt;-</span> T  <span class="co"># set to TRUE to re-download and re-ingest</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># create directory if it doesn't exist</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">dir_create</span>(dir_dl, <span class="at">recurse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># delete if exixsts (for fresh run)</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file_exists</span>(db_path) <span class="sc">&amp;</span> db_redo)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file_delete</span>(db_path)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># setup duckdb with spatial extension</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># dbDisconnect(con, shutdown = TRUE)</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(duckdb<span class="sc">::</span><span class="fu">duckdb</span>(), <span class="at">dbdir =</span> db_path)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con, <span class="st">"INSTALL spatial;"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con, <span class="st">"LOAD spatial;"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
</section>
<section id="scrape-ctd-download-links" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="scrape-ctd-download-links"><span class="header-section-number">3</span> Scrape CTD Download Links</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://calcofi.org/data/oceanographic-data/ctd-cast-files/"</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># read the web page</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>page <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># extract all .zip download links</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>zip_links <span class="ot">&lt;-</span> page <span class="sc">|&gt;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">"a[href$='.zip']"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_attr</span>(<span class="st">"href"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">url =</span> _) <span class="sc">|&gt;</span> </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ensure full URLs</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">url       =</span> <span class="fu">if_else</span>(</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_starts</span>(url, <span class="st">"http"</span>),</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>      url,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"https://calcofi.org"</span>, url)),</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract filename</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename  =</span> <span class="fu">basename</span>(url),</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract year from URL path</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">year      =</span> <span class="fu">str_extract</span>(url, <span class="st">"/(</span><span class="sc">\\</span><span class="st">d{4})/"</span>, <span class="at">group =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">as.integer</span>(),</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract month from URL path</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">month     =</span> <span class="fu">str_match</span>(url, <span class="st">"-</span><span class="sc">\\</span><span class="st">d{2}(</span><span class="sc">\\</span><span class="st">d{2})"</span>)[,<span class="dv">2</span>] <span class="sc">|&gt;</span> <span class="fu">as.integer</span>(),</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract cruise identifier (yymm + ship code)</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">cruise_id =</span> <span class="fu">str_extract</span>(filename, <span class="st">"</span><span class="sc">\\</span><span class="st">d{2}-(</span><span class="sc">\\</span><span class="st">d{4}[A-Z]{2})"</span>, <span class="at">group =</span> <span class="dv">1</span>),</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># classify data type based on filename patterns</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">data_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(filename, <span class="st">"CTDFinal"</span>)         <span class="sc">~</span> <span class="st">"final"</span>,</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(filename, <span class="st">"CTDPrelim"</span>)        <span class="sc">~</span> <span class="st">"preliminary"</span>,</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(filename, <span class="st">"CTDCast|CTD_Cast"</span>) <span class="sc">~</span> <span class="st">"raw"</span>,</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(filename, <span class="st">"CTDTest"</span>)          <span class="sc">~</span> <span class="st">"test"</span>,</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span>                                     <span class="sc">~</span> <span class="st">"other"</span>))</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="co"># stop if other detected</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(zip_links<span class="sc">$</span>data_type <span class="sc">==</span> <span class="st">"other"</span>)) {</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"Unknown data_type detected in filenames"</span>)</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="co"># show summary (all files)</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>zip_links <span class="sc">|&gt;</span> </span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="fu">glue</span>(<span class="st">"&lt;a href={url}&gt;{filename}&lt;/a&gt;"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>url) <span class="sc">|&gt;</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"All zip links to download"</span>,</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">escape  =</span> F)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-d4afbf27582bebed1884" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d4afbf27582bebed1884">{"x":{"filter":"none","vertical":false,"caption":"<caption>All zip links to download<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239"],["<a href=https://calcofi.org/downloads/2025/20-2501RL_CTDCast.zip>20-2501RL_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2025/20-2501RL_CTDPrelim.zip>20-2501RL_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2025/20-2502RL_CTDCast.zip>20-2502RL_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2025/20-2502RL_CTDPrelim.zip>20-2502RL_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2025/20-2504SH_CTDCast.zip>20-2504SH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2025/20-2504SH_CTDPrelim.zip>20-2504SH_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2025/20-2507SR_CTDPrelim.zip>20-2507SR_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2024/20-2401RL_CTDCast.zip>20-2401RL_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2024/20-2401RL_CTDPrelim.zip>20-2401RL_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2024/20-2404SH_CTDCast.zip>20-2404SH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2024/20-2404SH_CTDPrelim.zip>20-2404SH_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2024/20-2408SR_CTDCast.zip>20-2408SR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2024/20-2408SR_CTDPrelim.zip>20-2408SR_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2024/20-2411SR_CTDCast.zip>20-2411SR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2024/20-2411SR_CTDPrelim.zip>20-2411SR_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2023/20-2301RL_CTDCast.zip>20-2301RL_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2023/20-2301RL_CTDPrelim.zip>20-2301RL_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2023/20-2304SH_CTDCast.zip>20-2304SH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2023/20-2304SH_CTDPrelim.zip>20-2304SH_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2023/20-2307SR_CTDCast.zip>20-2307SR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2023/20-2307SR_CTDPrelim.zip>20-2307SR_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2023/20-2311SR_CTDCast.zip>20-2311SR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2023/20-2311SR_CTDPrelim.zip>20-2311SR_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2022/20-2204SH_CTDCast.zip>20-2204SH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2022/20-2204SH_CTDPrelim.zip>20-2204SH_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2022/20-2208BH_CTDCast.zip>20-2208BH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2022/20-2208BH_CTDPrelim.zip>20-2208BH_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2022/20-2211SR_CTDCast.zip>20-2211SR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2022/20-2211SR_CTDPrelim.zip>20-2211SR_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2021/20-2101RL_CTDCast.zip>20-2101RL_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2021/20-2101RL_CTDFinalQC.zip>20-2101RL_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2021/20-2105SH_CTDCast.zip>20-2105SH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2021/20-2105SH_CTDFinalQC.zip>20-2105SH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2021/20-2107SR_CTDCast.zip>20-2107SR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2021/20-2107SR_CTDPrelim.zip>20-2107SR_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2021/20-2111SR_CTDCast.zip>20-2111SR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2021/20-2111SR_CTDPrelim.zip>20-2111SR_CTDPrelim.zip<\/a>","<a href=https://calcofi.org/downloads/2020/20-2001RL_CTDCast.zip>20-2001RL_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2020/20-2001RL_CTDFinalQC.zip>20-2001RL_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2020/20-2007SR_CTD_Cast.zip>20-2007SR_CTD_Cast.zip<\/a>","<a href=https://calcofi.org/downloads/2020/20-2007SR_CTDFinalQC.zip>20-2007SR_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2020/20-2010SR_CTD_Cast.zip>20-2010SR_CTD_Cast.zip<\/a>","<a href=https://calcofi.org/downloads/2020/20-2010SR_CTDFinalQC.zip>20-2010SR_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2019/20-1902RL_CTDCast.zip>20-1902RL_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2019/20-1902RL_CTDFinalQC.zip>20-1902RL_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2019/20-1904RL_CTDCast.zip>20-1904RL_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2019/20-1904RL_CTDFinalQC.zip>20-1904RL_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2019/20-1907BH_CTDCast.zip>20-1907BH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2019/20-1907BH_CTDFinalQC.zip>20-1907BH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2019/20-1911OC_CTDCast.zip>20-1911OC_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2019/20-1911OC_CTDFinalQC.zip>20-1911OC_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2018/20-1802SH_CTDCast.zip>20-1802SH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2018/20-1802SH_CTDFinalQC.zip>20-1802SH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2018/20-1804SH_CTDCast.zip>20-1804SH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2018/20-1804SH_CTDFinalQC.zip>20-1804SH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2018/20-1806SR_CTDCast.zip>20-1806SR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2018/20-1806SR_CTDFinalQC.zip>20-1806SR_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2018/20-1810SR_CTDCast.zip>20-1810SR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2018/20-1810SR_CTDFinalQC.zip>20-1810SR_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2017/20-1701RL_CTDCast.zip>20-1701RL_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2017/20-1701RL_CTDFinalQC.zip>20-1701RL_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2017/20-1704SH_CTDCast.zip>20-1704SH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2017/20-1704SH_CTDFinalQC.zip>20-1704SH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2017/20-1708SR_CTDCast.zip>20-1708SR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2017/20-1708SR_CTDFinalQC.zip>20-1708SR_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2017/20-1711SR_CTDCast.zip>20-1711SR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2017/20-1711SR_CTDFinalQC.zip>20-1711SR_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2016/20-1601RL_CTDCast.zip>20-1601RL_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2016/20-1601RL_CTDFinalQC.zip>20-1601RL_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2016/20-1604SH_CTDCast.zip>20-1604SH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2016/20-1604SH_CTDFinalQC.zip>20-1604SH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2016/20-1607OS_CTDCast.zip>20-1607OS_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2016/20-1607OS_CTDFinalQC.zip>20-1607OS_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2016/20-1611SR_CTDCast.zip>20-1611SR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2016/20-1611SR_CTDFinalQC.zip>20-1611SR_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2015/20-1501NH_CTDCast.zip>20-1501NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2015/20-1501NH_CTDFinalQC.zip>20-1501NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2015/20-1504NH_CTDCast.zip>20-1504NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2015/20-1504NH_CTDFinalQC.zip>20-1504NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2015/20-1507OC_CTDCast.zip>20-1507OC_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2015/20-1507OC_CTDFinalQC.zip>20-1507OC_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2015/20-1511OC_CTDCast.zip>20-1511OC_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2015/20-1511OC_CTDFinalQC.zip>20-1511OC_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2014/20-1402SH_CTDCast.zip>20-1402SH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2014/20-1402SH_CTDFinalQC.zip>20-1402SH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2014/20-1404OS_CTDCast.zip>20-1404OS_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2014/20-1404OS_CTDFinalQC.zip>20-1404OS_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2014/20-1407NH_CTDCast.zip>20-1407NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2014/20-1407NH_CTDFinalQC.zip>20-1407NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2014/20-1411NH_CTDCast.zip>20-1411NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2014/20-1411NH_CTDFinalQC.zip>20-1411NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2013/20-1301SH_CTDCast.zip>20-1301SH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2013/20-1301SH_CTDFinalQC.zip>20-1301SH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2013/20-1304SH_CTDCast.zip>20-1304SH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2013/20-1304SH_CTDFinalQC.zip>20-1304SH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2013/20-1307NH_CTDCast.zip>20-1307NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2013/20-1307NH_CTDFinalQC.zip>20-1307NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2013/20-1311NH_CTDCast.zip>20-1311NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2013/20-1311NH_CTDFinalQC.zip>20-1311NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2012/20-1202NH_CTDCast.zip>20-1202NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2012/20-1202NH_CTDFinalQC.zip>20-1202NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2012/20-1203NH_CTDCast.zip>20-1203NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2012/20-1203SH_CTDFinalQC.zip>20-1203SH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2012/20-1207OS_CTDCast.zip>20-1207OS_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2012/20-1207OS_CTDFinalQC.zip>20-1207OS_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2012/20-1210NH_CTDCast.zip>20-1210NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2012/20-1210NH_CTDFinalQC.zip>20-1210NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2011/20-1101NH_CTDCast.zip>20-1101NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2011/20-1101NH_CTDFinalQC.zip>20-1101NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2011/20-1104SH_CTDCast.zip>20-1104SH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2011/20-1104SH_CTDFinalQC.zip>20-1104SH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2011/20-1108NH_CTDCast.zip>20-1108NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2011/20-1108NH_CTDFinalQC.zip>20-1108NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2011/20-1110NH_CTDCast.zip>20-1110NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2011/20-1110NH_CTDFinalQC.zip>20-1110NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2010/20-1001NH_CTDCast.zip>20-1001NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2010/20-1001NH_CTDFinalQC.zip>20-1001NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2010/20-1004MF_CTDCast.zip>20-1004MF_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2010/20-1004MF_CTDFinalQC.zip>20-1004MF_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2010/20-1008NH_CTDCast.zip>20-1008NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2010/20-1008NH_CTDFinalQC.zip>20-1008NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2010/20-1011NH_CTDCast.zip>20-1011NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2010/20-1011NH_CTDFinalQC.zip>20-1011NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2009/20-0901NH_CTDCast.zip>20-0901NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2009/20-0901NH_CTDFinalQC.zip>20-0901NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2009/20-0903JD_CTDCast.zip>20-0903JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2009/20-0903JD_CTDFinalQC.zip>20-0903JD_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2009/20-0907M2_CTDCast.zip>20-0907M2_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2009/20-0907M2_CTDFinalQC.zip>20-0907M2_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2009/20-0911NH_CTDCast.zip>20-0911NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2009/20-0911NH_CTDFinalQC.zip>20-0911NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2008/20-0801JD_CTDCast.zip>20-0801JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2008/20-0801JD_CTDFinalQC.zip>20-0801JD_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2008/20-0804JD_CTDCast.zip>20-0804JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2008/20-0804JD_CTDFinalQC.zip>20-0804JD_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2008/20-0808NH_CTDCast.zip>20-0808NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2008/20-0808NH_CTDFinalQC.zip>20-0808NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2008/20-0810NH_CTDCast.zip>20-0810NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2008/20-0810NH_CTDFinalQC.zip>20-0810NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2007/20-0701JD_CTDCast.zip>20-0701JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2007/20-0701JD_CTDFinalQC.zip>20-0701JD_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2007/20-0704JD_CTDCast.zip>20-0704JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2007/20-0704JD_CTDFinalQC.zip>20-0704JD_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2007/20-0707NH_CTDCast.zip>20-0707NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2007/20-0707NH_CTDFinalQC.zip>20-0707NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2007/20-0711NH_CTDCast.zip>20-0711NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2007/20-0711NH_CTDFinalQC.zip>20-0711NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2006/20-0602JD_CTDCast.zip>20-0602JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2006/20-0602JD_CTDFinalQC.zip>20-0602JD_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2006/20-0604NH_CTDCast.zip>20-0604NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2006/20-0604NH_CTDFinalQC.zip>20-0604NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2006/20-0607NH_CTDCast.zip>20-0607NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2006/20-0607NH_CTDFinalQC.zip>20-0607NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2006/20-0610RR_CTDCast.zip>20-0610RR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2006/20-0610RR_CTDFinalQC.zip>20-0610RR_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2005/20-0501NH_CTDCast.zip>20-0501NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2005/20-0501NH_CTDFinalQC.zip>20-0501NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2005/20-0504NH_CTDCast.zip>20-0504NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2005/20-0504NH_CTDFinalQC.zip>20-0504NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2005/20-0507NH_CTDCast.zip>20-0507NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2005/20-0507NH_CTDFinalQC.zip>20-0507NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2005/20-0511NH_CTDCast.zip>20-0511NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2005/20-0511NH_CTDFinalQC.zip>20-0511NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2004/20-0401JD_CTDCast.zip>20-0401JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2004/20-0401JD_CTDFinalQC.zip>20-0401JD_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2004/20-0404NH_CTDCast.zip>20-0404NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2004/20-0404NHJD_CTDFinalQC.zip>20-0404NHJD_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2004/20-0407JD_CTDCast.zip>20-0407JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2004/20-0407JD_CTDFinalQC.zip>20-0407JD_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2004/20-0411RR_CTDCast.zip>20-0411RR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2004/20-0411RR_CTDFinalQC.zip>20-0411RR_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2003/20-0302JD_CTDCast.zip>20-0302JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2003/20-0302JD_CTDFinalQC.zip>20-0302JD_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2003/20-0304RR_CTDCast.zip>20-0304RR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2003/20-0307NH_CTDCast.zip>20-0307NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2003/20-0307NH_CTDFinalQC.zip>20-0307NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2003/20-0310NH_CTDCast.zip>20-0310NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2003/20-0310NH_CTDFinalQC.zip>20-0310NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/2002/20-0201JD_CTDCast.zip>20-0201JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2002/20-0204JD_CTDCast.zip>20-0204JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2002/20-0207NH_CTDCast.zip>20-0207NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2002/20-0211NH_CTDCast.zip>20-0211NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2001/20-0101JD_CTDCast.zip>20-0101JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2001/20-0104JD_CTDCast.zip>20-0104JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2001/20-0107NH_CTDCast.zip>20-0107NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2001/20-0110NH_CTDCast.zip>20-0110NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2000/20-0001NH_CTDCast.zip>20-0001NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2000/20-0004JD_CTDCast.zip>20-0004JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2000/20-0007NH_CTDCast.zip>20-0007NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/2000/20-0010NH_CTDCast.zip>20-0010NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1999/19-9901RR_CTDCast.zip>19-9901RR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1999/19-9904JD_CTDCast.zip>19-9904JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1999/19-9908NH_CTDCast.zip>19-9908NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1999/19-9910NH_CTDCast.zip>19-9910NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1998/19-9802JD_CTDCast.zip>19-9802JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1998/19-9802JD_CTDFinalQC.zip>19-9802JD_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/1998/19-9803SP_CTDCast.zip>19-9803SP_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1998/19-9804JD_CTDCast.zip>19-9804JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1998/19-9804JD_CTDFinalQC.zip>19-9804JD_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/1998/19-9805SP_CTDCast.zip>19-9805SP_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1998/19-9807NH_CTDCast.zip>19-9807NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1998/19-9807NH_CTDFinalQC.zip>19-9807NH_CTDFinalQC.zip<\/a>","<a href=https://calcofi.org/downloads/1998/19-9808SP_CTDCast.zip>19-9808SP_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1998/19-9809NH_CTDCast.zip>19-9809NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1998/19-9810SP_CTDCast.zip>19-9810SP_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1998/19-9811SP_CTDCast.zip>19-9811SP_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1998/19-9812SP_CTDCast.zip>19-9812SP_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1997/19-9702JD_CTDCast.zip>19-9702JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1997/19-9704NH_CTDCast.zip>19-9704NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1997/19-9707JD_CTDCast.zip>19-9707JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1997/19-9709NH_CTDCast.zip>19-9709NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1997/19-9712SP_CTDCast.zip>19-9712SP_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1996/19-9602JD_CTDCast.zip>19-9602JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1996/19-9604JD_CTDCast.zip>19-9604JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1996/19-9608NH_CTDCast.zip>19-9608NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1996/19-9610RR_CTDCast.zip>19-9610RR_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1995/19-9501JD_CTDCast.zip>19-9501JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1995/19-9504NH_CTDCast.zip>19-9504NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1995/19-9507JD_CTDCast.zip>19-9507JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1995/19-9510NH_CTDCast.zip>19-9510NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1994/19-9401JD_CTDCast.zip>19-9401JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1994/19-9403JD_CTDCast.zip>19-9403JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1994/19-9408NH_CTDCast.zip>19-9408NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1994/19-9410NH_CTDCast.zip>19-9410NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1993/19-9301JD_CTDTest.zip>19-9301JD_CTDTest.zip<\/a>","<a href=https://calcofi.org/downloads/1993/19-9304JD_CTDTest.zip>19-9304JD_CTDTest.zip<\/a>","<a href=https://calcofi.org/downloads/1993/19-9308NH_CTDCast.zip>19-9308NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1993/19-9310NH_CTDCast.zip>19-9310NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1992/19-9202JD_CTDCastProdoStas.zip>19-9202JD_CTDCastProdoStas.zip<\/a>","<a href=https://calcofi.org/downloads/1992/19-9204JD_CTDTest01.zip>19-9204JD_CTDTest01.zip<\/a>","<a href=https://calcofi.org/downloads/1992/19-9207NH_CTDCastProdoStas.zip>19-9207NH_CTDCastProdoStas.zip<\/a>","<a href=https://calcofi.org/downloads/1992/19-9210NH_CTDCastProdoStas.zip>19-9210NH_CTDCastProdoStas.zip<\/a>","<a href=https://calcofi.org/downloads/1992/19-9210NH_CTDTest.zip>19-9210NH_CTDTest.zip<\/a>","<a href=https://calcofi.org/downloads/1991/19-9101JD_CTDTest.zip>19-9101JD_CTDTest.zip<\/a>","<a href=https://calcofi.org/downloads/1991/19-9103JD_CTDTest.zip>19-9103JD_CTDTest.zip<\/a>","<a href=https://calcofi.org/downloads/1991/19-9108JD_CTDCast.zip>19-9108JD_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1991/19-9110NH_CTDCast.zip>19-9110NH_CTDCast.zip<\/a>","<a href=https://calcofi.org/downloads/1990/19-9003JD_CTDTest.zip>19-9003JD_CTDTest.zip<\/a>","<a href=https://calcofi.org/downloads/1990/19-9011NH_CTDTest.zip>19-9011NH_CTDTest.zip<\/a>"],[2025,2025,2025,2025,2025,2025,2025,2024,2024,2024,2024,2024,2024,2024,2024,2023,2023,2023,2023,2023,2023,2023,2023,2022,2022,2022,2022,2022,2022,2021,2021,2021,2021,2021,2021,2021,2021,2020,2020,2020,2020,2020,2020,2019,2019,2019,2019,2019,2019,2019,2019,2018,2018,2018,2018,2018,2018,2018,2018,2017,2017,2017,2017,2017,2017,2017,2017,2016,2016,2016,2016,2016,2016,2016,2016,2015,2015,2015,2015,2015,2015,2015,2015,2014,2014,2014,2014,2014,2014,2014,2014,2013,2013,2013,2013,2013,2013,2013,2013,2012,2012,2012,2012,2012,2012,2012,2012,2011,2011,2011,2011,2011,2011,2011,2011,2010,2010,2010,2010,2010,2010,2010,2010,2009,2009,2009,2009,2009,2009,2009,2009,2008,2008,2008,2008,2008,2008,2008,2008,2007,2007,2007,2007,2007,2007,2007,2007,2006,2006,2006,2006,2006,2006,2006,2006,2005,2005,2005,2005,2005,2005,2005,2005,2004,2004,2004,2004,2004,2004,2004,2004,2003,2003,2003,2003,2003,2003,2003,2002,2002,2002,2002,2001,2001,2001,2001,2000,2000,2000,2000,1999,1999,1999,1999,1998,1998,1998,1998,1998,1998,1998,1998,1998,1998,1998,1998,1998,1997,1997,1997,1997,1997,1996,1996,1996,1996,1995,1995,1995,1995,1994,1994,1994,1994,1993,1993,1993,1993,1992,1992,1992,1992,1992,1991,1991,1991,1991,1990,1990],[1,1,2,2,4,4,7,1,1,4,4,8,8,11,11,1,1,4,4,7,7,11,11,4,4,8,8,11,11,1,1,5,5,7,7,11,11,1,1,7,7,10,10,2,2,4,4,7,7,11,11,2,2,4,4,6,6,10,10,1,1,4,4,8,8,11,11,1,1,4,4,7,7,11,11,1,1,4,4,7,7,11,11,2,2,4,4,7,7,11,11,1,1,4,4,7,7,11,11,2,2,3,3,7,7,10,10,1,1,4,4,8,8,10,10,1,1,4,4,8,8,11,11,1,1,3,3,7,7,11,11,1,1,4,4,8,8,10,10,1,1,4,4,7,7,11,11,2,2,4,4,7,7,10,10,1,1,4,4,7,7,11,11,1,1,4,4,7,7,11,11,2,2,4,7,7,10,10,1,4,7,11,1,4,7,10,1,4,7,10,1,4,8,10,2,2,3,4,4,5,7,7,8,9,10,11,12,2,4,7,9,12,2,4,8,10,1,4,7,10,1,3,8,10,1,4,8,10,2,4,7,10,10,1,3,8,10,3,11],["2501RL","2501RL","2502RL","2502RL","2504SH","2504SH","2507SR","2401RL","2401RL","2404SH","2404SH","2408SR","2408SR","2411SR","2411SR","2301RL","2301RL","2304SH","2304SH","2307SR","2307SR","2311SR","2311SR","2204SH","2204SH","2208BH","2208BH","2211SR","2211SR","2101RL","2101RL","2105SH","2105SH","2107SR","2107SR","2111SR","2111SR","2001RL","2001RL","2007SR","2007SR","2010SR","2010SR","1902RL","1902RL","1904RL","1904RL","1907BH","1907BH","1911OC","1911OC","1802SH","1802SH","1804SH","1804SH","1806SR","1806SR","1810SR","1810SR","1701RL","1701RL","1704SH","1704SH","1708SR","1708SR","1711SR","1711SR","1601RL","1601RL","1604SH","1604SH","1607OS","1607OS","1611SR","1611SR","1501NH","1501NH","1504NH","1504NH","1507OC","1507OC","1511OC","1511OC","1402SH","1402SH","1404OS","1404OS","1407NH","1407NH","1411NH","1411NH","1301SH","1301SH","1304SH","1304SH","1307NH","1307NH","1311NH","1311NH","1202NH","1202NH","1203NH","1203SH","1207OS","1207OS","1210NH","1210NH","1101NH","1101NH","1104SH","1104SH","1108NH","1108NH","1110NH","1110NH","1001NH","1001NH","1004MF","1004MF","1008NH","1008NH","1011NH","1011NH","0901NH","0901NH","0903JD","0903JD",null,null,"0911NH","0911NH","0801JD","0801JD","0804JD","0804JD","0808NH","0808NH","0810NH","0810NH","0701JD","0701JD","0704JD","0704JD","0707NH","0707NH","0711NH","0711NH","0602JD","0602JD","0604NH","0604NH","0607NH","0607NH","0610RR","0610RR","0501NH","0501NH","0504NH","0504NH","0507NH","0507NH","0511NH","0511NH","0401JD","0401JD","0404NH","0404NH","0407JD","0407JD","0411RR","0411RR","0302JD","0302JD","0304RR","0307NH","0307NH","0310NH","0310NH","0201JD","0204JD","0207NH","0211NH","0101JD","0104JD","0107NH","0110NH","0001NH","0004JD","0007NH","0010NH","9901RR","9904JD","9908NH","9910NH","9802JD","9802JD","9803SP","9804JD","9804JD","9805SP","9807NH","9807NH","9808SP","9809NH","9810SP","9811SP","9812SP","9702JD","9704NH","9707JD","9709NH","9712SP","9602JD","9604JD","9608NH","9610RR","9501JD","9504NH","9507JD","9510NH","9401JD","9403JD","9408NH","9410NH","9301JD","9304JD","9308NH","9310NH","9202JD","9204JD","9207NH","9210NH","9210NH","9101JD","9103JD","9108JD","9110NH","9003JD","9011NH"],["raw","preliminary","raw","preliminary","raw","preliminary","preliminary","raw","preliminary","raw","preliminary","raw","preliminary","raw","preliminary","raw","preliminary","raw","preliminary","raw","preliminary","raw","preliminary","raw","preliminary","raw","preliminary","raw","preliminary","raw","final","raw","final","raw","preliminary","raw","preliminary","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","final","raw","raw","final","raw","final","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","final","raw","raw","final","raw","raw","final","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","raw","test","test","raw","raw","raw","test","raw","raw","test","test","test","raw","raw","test","test"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>filename<\/th>\n      <th>year<\/th>\n      <th>month<\/th>\n      <th>cruise_id<\/th>\n      <th>data_type<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"filename","targets":1},{"name":"year","targets":2},{"name":"month","targets":3},{"name":"cruise_id","targets":4},{"name":"data_type","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="download-and-unzip-files" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="download-and-unzip-files"><span class="header-section-number">4</span> Download and Unzip Files</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># function to download and optionally unzip a file</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>download_and_unzip <span class="ot">&lt;-</span> <span class="cf">function</span>(url, dest_dir, filename, data_type, <span class="at">unzip =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  dest_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dest_dir, filename)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  dir_unzip <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dest_dir, <span class="fu">str_remove</span>(filename, <span class="st">"</span><span class="sc">\\</span><span class="st">.zip$"</span>))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># skip if already downloaded</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">file_exists</span>(dest_file)) {</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Already exists: {filename}"</span>))</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Downloading: {filename}"</span>))</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download.file</span>(url, dest_file, <span class="at">mode =</span> <span class="st">"wb"</span>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># skip if already unzipped</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (unzip <span class="sc">&amp;&amp;</span> <span class="fu">dir_exists</span>(dir_unzip)) {</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Already unzipped: {filename}"</span>))</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># only unzip if final or preliminary (case-insensitive)</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (unzip <span class="sc">&amp;&amp;</span> <span class="fu">str_detect</span>(filename, <span class="fu">regex</span>(<span class="st">"(final|prelim)"</span>, <span class="at">ignore_case =</span> T))) {</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Unzipping: {filename}"</span>))</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dir_create</span>(dir_unzip, <span class="at">recurse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unzip</span>(dest_file, <span class="at">exdir =</span> dir_unzip)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (unzip) {</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Skipping unzip (not final/prelim): {filename}"</span>))</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="co"># download all files, but only unzip final and preliminary</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>zip_links <span class="sc">|&gt;</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pwalk</span>(<span class="cf">function</span>(url, filename, data_type, ...) {</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download_and_unzip</span>(url, dir_dl, filename, data_type, <span class="at">unzip =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Download and extraction complete!"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<ul>
<li><p>2025-Jul:</p>
<ul>
<li>Preliminary CTD 1m-Binned<br>
<a href="https://calcofi.org/downloads/2025/20-2507SR_CTDPrelim.zip">20-2507SR_CTD<strong>Prelim</strong>.zip</a><br>
<strong>Preliminary CTD 1m-Binned</strong>: Raw CTD sensor data that have gone through SBE Data Processing, and obvious bad sensor readings have been flagged during initial QAQC. Bottle data has not yet been merged with the CTD data. CTD Salinity, Oxygen, Fluorescence, and Nitrate profiles have not been corrected to the bottle data. Cruise corrected Nitrate sensor data (EstNO3_CruiseCorr) has been converted from raw voltage using a sensor calibration done before each cruise, but not yet corrected using CTD vs.&nbsp;Bottle regressions.&nbsp;</li>
</ul></li>
<li><p>2021-Jul:</p>
<ul>
<li><p><del>Prodo Cast</del> Raw CTD Data<br>
<a href="https://calcofi.org/downloads/2021/20-2107SR_CTDCast.zip">20-2107SR_CTD<strong>Cast</strong>.zip</a></p></li>
<li><p>Preliminary CTD &amp; Bottle 1m-Binned<br>
<a href="https://calcofi.org/downloads/2021/20-2107SR_CTDPrelim.zip">20-2107SR_CTD<strong>Prelim</strong>.zip</a><br>
<strong>Preliminary CTD &amp; Bottle 1m-Binned</strong>: Preliminary CTD sensor data that have been merged with QAQC’ed bottle data. CTD Salinity, Oxygen, Fluorescence, and Nitrate profiles have been corrected using CTD vs.&nbsp;bottle regressions.&nbsp;</p></li>
</ul></li>
<li><p>2021-May:</p>
<ul>
<li><p>Raw CTD Data<br>
<a href="https://calcofi.org/downloads/2021/20-2105SH_CTDCast.zip">20-2105SH_CTD<strong>Cast</strong>.zip</a><br>
<strong>Raw CTD Data</strong>: Data files (.xmlcon, .hex, .bl, .nav, .prn, .mrk, .hdr) directly from SBE Software (<a href="https://www.seabird.com/">Sea-Bird Scientific</a>) with no processing or corrections applied.</p></li>
<li><p>Final 1m-Binned<br>
<a href="https://calcofi.org/downloads/2021/20-2105SH_CTDFinalQC.zip">20-2105SH_CTD<strong>FinalQC</strong>.zip</a><br>
<strong>Final 1m-Binned</strong>: CTD data that have passed through the CalCOFI quality control process. After standard Seasoft-processing (Sea-Bird Scientific’s data-processing suite) tuned for our SBE 911plus CTD, the .asc files are processed by SIO-CalCOFI in-house software (BtlVsCTD). Averaged (4-sec or 1-meter bin-averaged) CTD sensor data are matched with corresponding bottle data, then <strong>cruise-corrected</strong>&nbsp;and&nbsp;<strong>station-corrected</strong>. Zipped file includes: metadata and .asc, .hdr, .btl, and upcast &amp; downcast .csvs (“u” and “d”; by station and concatenated).</p>
<ul>
<li><p><strong>Cruise-corrected CTD data</strong>: CTD sensor data that are corrected using regression coefficients derived from 4-sec average sensor data vs bottle data comparisons for the entire&nbsp;cruise<strong>,</strong> meaning all casts with bottle samples (n=~1400; fliers omitted; column labels ‘_CruiseCorr’).</p></li>
<li><p><strong>Station-corrected CTD data</strong>: CTD sensor data that are corrected using regression coefficients generated dynamically for each cast, 1m bin-averaged sensor data vs bottle data (n=~20; fliers omitted; column labels ‘_StaCorr’).</p>
<ul>
<li>Since sensor behavior may vary from station to station, station-corrected CTD sensor data for salinity, oxygen, estimated nitrate, and estimated chlorophyll-a are considered the best, particularly for estimated nitrate.</li>
</ul></li>
</ul></li>
</ul></li>
<li><p>1992-Feb:</p>
<ul>
<li>Prodo Cast<br>
<a href="https://calcofi.org/downloads/1992/19-9202JD_CTDCastProdoStas.zip">19-9202JD_CTD<strong>CastProdoStas</strong>.zip</a><br>
<strong>Test Cast/Prodo Cast</strong>: The Seabird 911plus CTD was first tested in Mar 1990 (9003JD) but is still under development. CTD data from Mar 1990 – 1991 were occasional system &amp; feasibility tests (“<strong>test casts</strong>“). As confidence in data quality improved, the CTD-Rosette began being used for daily primary productivity sample collection casts (“<strong>prodo casts</strong>“) in 1992 (6 depths from one station per day).</li>
</ul></li>
<li><p>1990-Mar:</p>
<ul>
<li>Test Cast<br>
<a href="https://calcofi.org/downloads/1990/19-9003JD_CTDTest.zip">19-9003JD_CTD<strong>Test</strong>.zip</a></li>
</ul></li>
</ul>
</section>
<section id="find-and-prioritize-ctd-data-files" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="find-and-prioritize-ctd-data-files"><span class="header-section-number">5</span> Find and Prioritize CTD Data Files</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># find all extracted CTD CSV files</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>all_files <span class="ot">&lt;-</span> <span class="fu">dir_ls</span>(dir_dl, <span class="at">recurse =</span> <span class="cn">TRUE</span>, <span class="at">regexp =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.csv$"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create file inventory</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>file_inventory <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">path =</span> all_files) <span class="sc">|&gt;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename     =</span> <span class="fu">basename</span>(path),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># parent_dir   = basename(dirname(path)),</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># classify data type from parent directory</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(path, <span class="st">"Final.*db_csv"</span>)  <span class="sc">~</span> <span class="st">"final"</span>,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(path, <span class="st">"Prelim.*db_csv"</span>) <span class="sc">~</span> <span class="st">"preliminary"</span>,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> <span class="cn">NA_character_</span>),</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract cruise identifier (yymm + ship code)</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">cruise_id =</span> <span class="fu">str_extract</span>(path, <span class="st">"download/</span><span class="sc">\\</span><span class="st">d{2}-(</span><span class="sc">\\</span><span class="st">d{4}[A-Z]{2})"</span>, <span class="at">group =</span> <span class="dv">1</span>),</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># detect cast direction from filename (U=upcast, D=downcast)</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">cast_dir =</span> <span class="fu">case_when</span>(</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(filename, <span class="fu">regex</span>(<span class="st">"U</span><span class="sc">\\</span><span class="st">.csv$"</span>, <span class="at">ignore_case =</span> T)) <span class="sc">~</span> <span class="st">"U"</span>,</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(filename, <span class="fu">regex</span>(<span class="st">"D</span><span class="sc">\\</span><span class="st">.csv$"</span>, <span class="at">ignore_case =</span> T)) <span class="sc">~</span> <span class="st">"D"</span>),</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># prioritize: final=1, preliminary=2</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">priority =</span> <span class="fu">case_when</span>(</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>      data_type <span class="sc">==</span> <span class="st">"final"</span>        <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>      data_type <span class="sc">==</span> <span class="st">"preliminary"</span>  <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span>                        <span class="sc">~</span> <span class="dv">3</span>))</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="co"># keep only final and preliminary files</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>file_inventory <span class="ot">&lt;-</span> file_inventory <span class="sc">|&gt;</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(data_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"final"</span>, <span class="st">"preliminary"</span>))</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="co"># for each cruise, keep only final if available, otherwise preliminary</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>cruise_priority <span class="ot">&lt;-</span> file_inventory <span class="sc">|&gt;</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cruise_id) <span class="sc">|&gt;</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">best_priority =</span> <span class="fu">min</span>(priority), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>files_to_ingest <span class="ot">&lt;-</span> file_inventory <span class="sc">|&gt;</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(cruise_priority, <span class="at">by =</span> <span class="st">"cruise_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(priority <span class="sc">==</span> best_priority) <span class="sc">|&gt;</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>best_priority)</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="co"># check for any cruises without selected files</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>missing_cruises <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">unique</span>(file_inventory<span class="sc">$</span>cruise_id), <span class="fu">unique</span>(files_to_ingest<span class="sc">$</span>cruise_id))</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(missing_cruises) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">warning</span>(<span class="fu">glue</span>(<span class="st">"Warning: Missing cruises with no final/preliminary files: {paste(missing_cruises, collapse = ', ')}"</span>))</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a><span class="co"># summary</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(files_to_ingest, <span class="at">caption =</span> <span class="st">"Files to Ingest"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-1f7f3e42ddc5013700de" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1f7f3e42ddc5013700de">{"x":{"filter":"none","vertical":false,"caption":"<caption>Files to Ingest<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162"],["/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/19-9802JD_CTDFinalQC/db_csv/19-9802JD_CTDBTL_001-066D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/19-9802JD_CTDFinalQC/db_csv/19-9802JD_CTDBTL_001-066U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/19-9804JD_CTDFinalQC/db_csv/19-9804JD_CTDBTL_001-085D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/19-9804JD_CTDFinalQC/db_csv/19-9804JD_CTDBTL_001-085U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/19-9804JD_CTDFinalQC/db_csv/separate/20-9804JD_CTDBTL_001-050D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/19-9804JD_CTDFinalQC/db_csv/separate/20-9804JD_CTDBTL_001-050U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/19-9804JD_CTDFinalQC/db_csv/separate/20-9804JD_CTDBTL_051-085D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/19-9804JD_CTDFinalQC/db_csv/separate/20-9804JD_CTDBTL_051-085U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/19-9807NH_CTDFinalQC/db_csv/20-9807NH_CTDBTL_001-070D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/19-9807NH_CTDFinalQC/db_csv/20-9807NH_CTDBTL_001-070U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0302JD_CTDFinalQC/db_csvs/20-0302JD_CTDBTL_001-100D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0302JD_CTDFinalQC/db_csvs/20-0302JD_CTDBTL_001-100U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0302JD_CTDFinalQC/db_csvs/south-north/20-0302JD_CTDBTL_001-073ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0302JD_CTDFinalQC/db_csvs/south-north/20-0302JD_CTDBTL_001-073IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0302JD_CTDFinalQC/db_csvs/south-north/20-0302JD_CTDBTL_074-100ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0302JD_CTDFinalQC/db_csvs/south-north/20-0302JD_CTDBTL_074-100IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0307NH_CTDFinalQC/db_csvs/20-0307NH_CTDBTL_001-526ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0307NH_CTDFinalQC/db_csvs/20-0307NH_CTDBTL_001-526IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0307NH_CTDFinalQC/db_csvs/20-0307NH_CTDBTL_044-060ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0307NH_CTDFinalQC/db_csvs/20-0307NH_CTDBTL_044-060IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0310NH_CTDFinalQC/db_csvs/20-0310NH_CTDBTL_001-066D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0310NH_CTDFinalQC/db_csvs/20-0310NH_CTDBTL_001-066U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0401JD_CTDFinalQC/db_csvs/20-0401JD_CTDBTL_001-098ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0401JD_CTDFinalQC/db_csvs/20-0401JD_CTDBTL_001-098IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0404NHJD_CTDFinalQC/db_csvs/20-0404JD_CTDBTL_067-094ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0404NHJD_CTDFinalQC/db_csvs/20-0404JD_CTDBTL_067-094IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0404NHJD_CTDFinalQC/db_csvs/20-0404NH_CTDBTL_001-066ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0404NHJD_CTDFinalQC/db_csvs/20-0404NH_CTDBTL_001-066IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0407JD_CTDFinalQC/db_csvs/20-0407JD_CTDBTL_001-012ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0407JD_CTDFinalQC/db_csvs/20-0407JD_CTDBTL_001-012IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0407JD_CTDFinalQC/db_csvs/20-0407JD_CTDBTL_013-074ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0407JD_CTDFinalQC/db_csvs/20-0407JD_CTDBTL_013-074IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0407JD_CTDFinalQC/db_csvs/pieces/20-0407JD_CTDBTL_001-002ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0407JD_CTDFinalQC/db_csvs/pieces/20-0407JD_CTDBTL_001-002IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0407JD_CTDFinalQC/db_csvs/pieces/20-0407JD_CTDBTL_003-012ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0407JD_CTDFinalQC/db_csvs/pieces/20-0407JD_CTDBTL_003-012IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0407JD_CTDFinalQC/db_csvs/pieces/20-0407JD_CTDBTL_013-028ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0407JD_CTDFinalQC/db_csvs/pieces/20-0407JD_CTDBTL_013-028IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0407JD_CTDFinalQC/db_csvs/pieces/20-0407JD_CTDBTL_029-039ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0407JD_CTDFinalQC/db_csvs/pieces/20-0407JD_CTDBTL_029-039IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0407JD_CTDFinalQC/db_csvs/pieces/20-0407JD_CTDBTL_040-074ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0407JD_CTDFinalQC/db_csvs/pieces/20-0407JD_CTDBTL_040-074IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0411RR_CTDFinalQC/db_csvs/20-0411RR_CTDBTL_001-965ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0411RR_CTDFinalQC/db_csvs/20-0411RR_CTDBTL_001-965IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0501NH_CTDFinalQC/db_csvs/20-0501NH_CTDBTL_001-075D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0501NH_CTDFinalQC/db_csvs/20-0501NH_CTDBTL_001-075U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0504NH_CTDFinalQC/db_csvs/20-0504NH_CTDBTL_001-075D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0504NH_CTDFinalQC/db_csvs/20-0504NH_CTDBTL_001-075U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0507NH_CTDFinalQC/db_csvs/20-0507NH_CTDBTL_001-075D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0507NH_CTDFinalQC/db_csvs/20-0507NH_CTDBTL_001-075U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0511NH_CTDFinalQC/db_csvs/20-0511NH_CTDBTL_001-072D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0511NH_CTDFinalQC/db_csvs/20-0511NH_CTDBTL_001-072U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0602JD_CTDFinalQC/db_csvs/20-0602JD_CTDBTL_001-096D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0602JD_CTDFinalQC/db_csvs/20-0602JD_CTDBTL_001-096U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0604NH_CTDFinalQC/db_csvs/20-0604NH_CTDBTL_001-563ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0604NH_CTDFinalQC/db_csvs/20-0604NH_CTDBTL_001-563IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0607NH_CTDFinalQC/db_csvs/20-0607NH_CTDBTL_001-074ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0607NH_CTDFinalQC/db_csvs/20-0607NH_CTDBTL_001-074IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0701JD_CTDFinalQC/db_csvs/20-0701JD_CTDBTL_001-084D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0701JD_CTDFinalQC/db_csvs/20-0701JD_CTDBTL_001-084IDnoQC.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0701JD_CTDFinalQC/db_csvs/20-0701JD_CTDBTL_001-084IUnoQC.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0701JD_CTDFinalQC/db_csvs/20-0701JD_CTDBTL_001-084U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0907M2_CTDFinalQC/db_csvs/20-0907M2_CTDBTL_001-961ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0907M2_CTDFinalQC/db_csvs/20-0907M2_CTDBTL_001-961IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0911NH_CTDFinalQC/db_csvs/20-0911NH_CTDBTL_001-075ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-0911NH_CTDFinalQC/db_csvs/20-0911NH_CTDBTL_001-075IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1001NH_CTDFinalQC/db_csvs/20-1001NH_CTDBTL_001-093D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1001NH_CTDFinalQC/db_csvs/20-1001NH_CTDBTL_001-093U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1004MF_CTDFinalQC/db_csvs/20-1004MF_CTDBTL_123-682ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1004MF_CTDFinalQC/db_csvs/20-1004MF_CTDBTL_123-682IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1008NH_CTDFinalQC/db_csvs/20-1008NH_CTDBTL_001-075ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1008NH_CTDFinalQC/db_csvs/20-1008NH_CTDBTL_001-075IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1011NH_CTDFinalQC/db_csvs/20-1011NH_CTDBTL_001-067ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1011NH_CTDFinalQC/db_csvs/20-1011NH_CTDBTL_001-067IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1101NH_CTDFinalQC/db_csvs/20-1101NH_CTDBTL_001-106D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1101NH_CTDFinalQC/db_csvs/20-1101NH_CTDBTL_001-106U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1104SH_CTDFinalQC/db_csvs/20-1104SH_CTDBTL_037-114ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1104SH_CTDFinalQC/db_csvs/20-1104SH_CTDBTL_037-114IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1104SH_CTDFinalQC/db_csvs/separate_runs/20-1104SH_CTDBTL_031-035ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1104SH_CTDFinalQC/db_csvs/separate_runs/20-1104SH_CTDBTL_031-035IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1104SH_CTDFinalQC/db_csvs/separate_runs/20-1104SH_CTDBTL_031-114ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1104SH_CTDFinalQC/db_csvs/separate_runs/20-1104SH_CTDBTL_031-114IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1104SH_CTDFinalQC/db_csvs/separate_runs/20-1104SH_CTDBTL_036-036ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1104SH_CTDFinalQC/db_csvs/separate_runs/20-1104SH_CTDBTL_036-036IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1108NH_CTDFinalQC/db_csvs/20-1108NH_CTDBTL_001-072ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1108NH_CTDFinalQC/db_csvs/20-1108NH_CTDBTL_001-072IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1110NH_CTDFinalQC/db_csv/20-1110NH_CTDBTL_001-666ID.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1110NH_CTDFinalQC/db_csv/20-1110NH_CTDBTL_001-666IU.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1202NH_CTDFinalQC/db_csvs/20-1202NH_CTDBTL_001-075D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1202NH_CTDFinalQC/db_csvs/20-1202NH_CTDBTL_001-075U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1203SH_CTDFinalQC/db_csvs/20-1203SH_CTDBTL_001-057D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1203SH_CTDFinalQC/db_csvs/20-1203SH_CTDBTL_001-057U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1207OS_CTDFinalQC/db_csvs/20-1207OS_CTDBTL_001-075D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1207OS_CTDFinalQC/db_csvs/20-1207OS_CTDBTL_001-075U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1210NH_CTDFinalQC/db_csv/20-1210NH_CTDBTL_001-075D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1210NH_CTDFinalQC/db_csv/20-1210NH_CTDBTL_001-075U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1301SH_CTDFinalQC/db_csvs/20-1301SH_CTDBTL_001-090D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1301SH_CTDFinalQC/db_csvs/20-1301SH_CTDBTL_001-090U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1304SH_CTDFinalQC/db_csv/20-1304SH_CTDBTL_001-109D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1304SH_CTDFinalQC/db_csv/20-1304SH_CTDBTL_001-109U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1307NH_CTDFinalQC/db_csv/20-1307NH_CTDBTL_001-074D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1307NH_CTDFinalQC/db_csv/20-1307NH_CTDBTL_001-074U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1311NH_CTDFinalQC/db_csv/20-1311NH_CTDBTL_001-521D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1311NH_CTDFinalQC/db_csv/20-1311NH_CTDBTL_001-521U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1402SH_CTDFinalQC/db_csv/20-1402SH_CTDBTL_001-036D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1402SH_CTDFinalQC/db_csv/20-1402SH_CTDBTL_001-036U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1404OS_CTDFinalQC/db_csv/20-1404OS_CTDBTL_001-070D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1404OS_CTDFinalQC/db_csv/20-1404OS_CTDBTL_001-070U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1407NH_CTDFinalQC/db_csv/20-1407NH_CTDBTL_001-075D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1407NH_CTDFinalQC/db_csv/20-1407NH_CTDBTL_001-075U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1411NH_CTDFinalQC/db_csv/20-1411NH_CTDBTL_001-076D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1411NH_CTDFinalQC/db_csv/20-1411NH_CTDBTL_001-076U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1501NH_CTDFinalQC/db_csv/20-1501NH_CTDBTL_001-100D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1501NH_CTDFinalQC/db_csv/20-1501NH_CTDBTL_001-100U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1501NH_CTDFinalQC/db_csv/dualTCO/20-1501NH_CTDBTL_001-064D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1501NH_CTDFinalQC/db_csv/dualTCO/20-1501NH_CTDBTL_001-064U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1501NH_CTDFinalQC/db_csv/singleTCO/20-1501NH_CTDBTL_004-100D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1501NH_CTDFinalQC/db_csv/singleTCO/20-1501NH_CTDBTL_004-100U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1504NH_CTDFinalQC/db_csvs/20-1504NH_CTDBTL_001-070D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1504NH_CTDFinalQC/db_csvs/20-1504NH_CTDBTL_001-070U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1507OC_CTDFinalQC/db_csv/20-1507OC_CTDBTL_001-071D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1507OC_CTDFinalQC/db_csv/20-1507OC_CTDBTL_001-071U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1511OC_CTDFinalQC/db_csvs/20-1511OC_CTDBTL_001-070D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1511OC_CTDFinalQC/db_csvs/20-1511OC_CTDBTL_001-070U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1601RL_CTDFinalQC/db_csvs/20-1601RL_CTDBTL_001-104D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1601RL_CTDFinalQC/db_csvs/20-1601RL_CTDBTL_001-104U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1604SH_CTDFinalQC/db_csvs/20-1604SH_CTDBTL_001-101D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1604SH_CTDFinalQC/db_csvs/20-1604SH_CTDBTL_001-101U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1607OS_CTDFinalQC/db_csvs/20-1607OS_CTDBTL_001-068D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1607OS_CTDFinalQC/db_csvs/20-1607OS_CTDBTL_001-068U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1611SR_CTDFinalQC/db_csvs/20-1611SR_CTDBTL_001-075D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1611SR_CTDFinalQC/db_csvs/20-1611SR_CTDBTL_001-075U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1701RL_CTDFinalQC/db_csvs/20-1701RL_CTDBTL_001-083D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1701RL_CTDFinalQC/db_csvs/20-1701RL_CTDBTL_001-083U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1701RL_CTDFinalQC/db_csvs/ISUS_separateRuns/20-1701RL_CTDBTL_001-020D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1701RL_CTDFinalQC/db_csvs/ISUS_separateRuns/20-1701RL_CTDBTL_001-020U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1701RL_CTDFinalQC/db_csvs/ISUS_separateRuns/20-1701RL_CTDBTL_021-083D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1701RL_CTDFinalQC/db_csvs/ISUS_separateRuns/20-1701RL_CTDBTL_021-083U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1704SH_CTDFinalQC/db_csvs/20-1704SH_CTDBTL_001-104D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1704SH_CTDFinalQC/db_csvs/20-1704SH_CTDBTL_001-104U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1704SH_CTDFinalQC/db_csvs/separatelyProcessed/20-1704SH_CTDBTL_001-040D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1704SH_CTDFinalQC/db_csvs/separatelyProcessed/20-1704SH_CTDBTL_001-040U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1704SH_CTDFinalQC/db_csvs/separatelyProcessed/20-1704SH_CTDBTL_041-104D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1704SH_CTDFinalQC/db_csvs/separatelyProcessed/20-1704SH_CTDBTL_041-104U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1708SR_CTDFinalQC/db_csvs/20-1708SR_CTDBTL_001-073D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1708SR_CTDFinalQC/db_csvs/20-1708SR_CTDBTL_001-073U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1802SH_CTDFinalQC/db_csvs/20-1802SH_CTDBTL_001-045D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1802SH_CTDFinalQC/db_csvs/20-1802SH_CTDBTL_001-045U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1804SH_CTDFinalQC/db_csvs/20-1804SH_CTDBTL_001-103D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1804SH_CTDFinalQC/db_csvs/20-1804SH_CTDBTL_001-103U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1806SR_CTDFinalQC/db_csvs/20-1806SR_CTDBTL_001-072D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1806SR_CTDFinalQC/db_csvs/20-1806SR_CTDBTL_001-072U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1810SR_CTDFinalQC/db_csvs/20-1810SR_CTDBTL_001-074D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1810SR_CTDFinalQC/db_csvs/20-1810SR_CTDBTL_001-074U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1902RL_CTDFinalQC/db_csvs/20-1902RL_CTDBTL_001-029D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1902RL_CTDFinalQC/db_csvs/20-1902RL_CTDBTL_001-029U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1904RL_CTDFinalQC/20-1904RL_FinalCTD/db_csvs/20-1904RL_CTDBTL_001-069D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-1904RL_CTDFinalQC/20-1904RL_FinalCTD/db_csvs/20-1904RL_CTDBTL_001-069U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-2401RL_CTDPrelim/20-2401RL_CTDPrelim/db_csvs/20-2401RL_CTDBTL_001-016D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-2401RL_CTDPrelim/20-2401RL_CTDPrelim/db_csvs/20-2401RL_CTDBTL_001-016U.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-2401RL_CTDPrelim/20-2401RL_CTDPrelim/db_csvs/20-2401RL_CTDBTL_017-033D.csv","/Users/bbest/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download/20-2401RL_CTDPrelim/20-2401RL_CTDPrelim/db_csvs/20-2401RL_CTDBTL_017-033U.csv"],["19-9802JD_CTDBTL_001-066D.csv","19-9802JD_CTDBTL_001-066U.csv","19-9804JD_CTDBTL_001-085D.csv","19-9804JD_CTDBTL_001-085U.csv","20-9804JD_CTDBTL_001-050D.csv","20-9804JD_CTDBTL_001-050U.csv","20-9804JD_CTDBTL_051-085D.csv","20-9804JD_CTDBTL_051-085U.csv","20-9807NH_CTDBTL_001-070D.csv","20-9807NH_CTDBTL_001-070U.csv","20-0302JD_CTDBTL_001-100D.csv","20-0302JD_CTDBTL_001-100U.csv","20-0302JD_CTDBTL_001-073ID.csv","20-0302JD_CTDBTL_001-073IU.csv","20-0302JD_CTDBTL_074-100ID.csv","20-0302JD_CTDBTL_074-100IU.csv","20-0307NH_CTDBTL_001-526ID.csv","20-0307NH_CTDBTL_001-526IU.csv","20-0307NH_CTDBTL_044-060ID.csv","20-0307NH_CTDBTL_044-060IU.csv","20-0310NH_CTDBTL_001-066D.csv","20-0310NH_CTDBTL_001-066U.csv","20-0401JD_CTDBTL_001-098ID.csv","20-0401JD_CTDBTL_001-098IU.csv","20-0404JD_CTDBTL_067-094ID.csv","20-0404JD_CTDBTL_067-094IU.csv","20-0404NH_CTDBTL_001-066ID.csv","20-0404NH_CTDBTL_001-066IU.csv","20-0407JD_CTDBTL_001-012ID.csv","20-0407JD_CTDBTL_001-012IU.csv","20-0407JD_CTDBTL_013-074ID.csv","20-0407JD_CTDBTL_013-074IU.csv","20-0407JD_CTDBTL_001-002ID.csv","20-0407JD_CTDBTL_001-002IU.csv","20-0407JD_CTDBTL_003-012ID.csv","20-0407JD_CTDBTL_003-012IU.csv","20-0407JD_CTDBTL_013-028ID.csv","20-0407JD_CTDBTL_013-028IU.csv","20-0407JD_CTDBTL_029-039ID.csv","20-0407JD_CTDBTL_029-039IU.csv","20-0407JD_CTDBTL_040-074ID.csv","20-0407JD_CTDBTL_040-074IU.csv","20-0411RR_CTDBTL_001-965ID.csv","20-0411RR_CTDBTL_001-965IU.csv","20-0501NH_CTDBTL_001-075D.csv","20-0501NH_CTDBTL_001-075U.csv","20-0504NH_CTDBTL_001-075D.csv","20-0504NH_CTDBTL_001-075U.csv","20-0507NH_CTDBTL_001-075D.csv","20-0507NH_CTDBTL_001-075U.csv","20-0511NH_CTDBTL_001-072D.csv","20-0511NH_CTDBTL_001-072U.csv","20-0602JD_CTDBTL_001-096D.csv","20-0602JD_CTDBTL_001-096U.csv","20-0604NH_CTDBTL_001-563ID.csv","20-0604NH_CTDBTL_001-563IU.csv","20-0607NH_CTDBTL_001-074ID.csv","20-0607NH_CTDBTL_001-074IU.csv","20-0701JD_CTDBTL_001-084D.csv","20-0701JD_CTDBTL_001-084IDnoQC.csv","20-0701JD_CTDBTL_001-084IUnoQC.csv","20-0701JD_CTDBTL_001-084U.csv","20-0907M2_CTDBTL_001-961ID.csv","20-0907M2_CTDBTL_001-961IU.csv","20-0911NH_CTDBTL_001-075ID.csv","20-0911NH_CTDBTL_001-075IU.csv","20-1001NH_CTDBTL_001-093D.csv","20-1001NH_CTDBTL_001-093U.csv","20-1004MF_CTDBTL_123-682ID.csv","20-1004MF_CTDBTL_123-682IU.csv","20-1008NH_CTDBTL_001-075ID.csv","20-1008NH_CTDBTL_001-075IU.csv","20-1011NH_CTDBTL_001-067ID.csv","20-1011NH_CTDBTL_001-067IU.csv","20-1101NH_CTDBTL_001-106D.csv","20-1101NH_CTDBTL_001-106U.csv","20-1104SH_CTDBTL_037-114ID.csv","20-1104SH_CTDBTL_037-114IU.csv","20-1104SH_CTDBTL_031-035ID.csv","20-1104SH_CTDBTL_031-035IU.csv","20-1104SH_CTDBTL_031-114ID.csv","20-1104SH_CTDBTL_031-114IU.csv","20-1104SH_CTDBTL_036-036ID.csv","20-1104SH_CTDBTL_036-036IU.csv","20-1108NH_CTDBTL_001-072ID.csv","20-1108NH_CTDBTL_001-072IU.csv","20-1110NH_CTDBTL_001-666ID.csv","20-1110NH_CTDBTL_001-666IU.csv","20-1202NH_CTDBTL_001-075D.csv","20-1202NH_CTDBTL_001-075U.csv","20-1203SH_CTDBTL_001-057D.csv","20-1203SH_CTDBTL_001-057U.csv","20-1207OS_CTDBTL_001-075D.csv","20-1207OS_CTDBTL_001-075U.csv","20-1210NH_CTDBTL_001-075D.csv","20-1210NH_CTDBTL_001-075U.csv","20-1301SH_CTDBTL_001-090D.csv","20-1301SH_CTDBTL_001-090U.csv","20-1304SH_CTDBTL_001-109D.csv","20-1304SH_CTDBTL_001-109U.csv","20-1307NH_CTDBTL_001-074D.csv","20-1307NH_CTDBTL_001-074U.csv","20-1311NH_CTDBTL_001-521D.csv","20-1311NH_CTDBTL_001-521U.csv","20-1402SH_CTDBTL_001-036D.csv","20-1402SH_CTDBTL_001-036U.csv","20-1404OS_CTDBTL_001-070D.csv","20-1404OS_CTDBTL_001-070U.csv","20-1407NH_CTDBTL_001-075D.csv","20-1407NH_CTDBTL_001-075U.csv","20-1411NH_CTDBTL_001-076D.csv","20-1411NH_CTDBTL_001-076U.csv","20-1501NH_CTDBTL_001-100D.csv","20-1501NH_CTDBTL_001-100U.csv","20-1501NH_CTDBTL_001-064D.csv","20-1501NH_CTDBTL_001-064U.csv","20-1501NH_CTDBTL_004-100D.csv","20-1501NH_CTDBTL_004-100U.csv","20-1504NH_CTDBTL_001-070D.csv","20-1504NH_CTDBTL_001-070U.csv","20-1507OC_CTDBTL_001-071D.csv","20-1507OC_CTDBTL_001-071U.csv","20-1511OC_CTDBTL_001-070D.csv","20-1511OC_CTDBTL_001-070U.csv","20-1601RL_CTDBTL_001-104D.csv","20-1601RL_CTDBTL_001-104U.csv","20-1604SH_CTDBTL_001-101D.csv","20-1604SH_CTDBTL_001-101U.csv","20-1607OS_CTDBTL_001-068D.csv","20-1607OS_CTDBTL_001-068U.csv","20-1611SR_CTDBTL_001-075D.csv","20-1611SR_CTDBTL_001-075U.csv","20-1701RL_CTDBTL_001-083D.csv","20-1701RL_CTDBTL_001-083U.csv","20-1701RL_CTDBTL_001-020D.csv","20-1701RL_CTDBTL_001-020U.csv","20-1701RL_CTDBTL_021-083D.csv","20-1701RL_CTDBTL_021-083U.csv","20-1704SH_CTDBTL_001-104D.csv","20-1704SH_CTDBTL_001-104U.csv","20-1704SH_CTDBTL_001-040D.csv","20-1704SH_CTDBTL_001-040U.csv","20-1704SH_CTDBTL_041-104D.csv","20-1704SH_CTDBTL_041-104U.csv","20-1708SR_CTDBTL_001-073D.csv","20-1708SR_CTDBTL_001-073U.csv","20-1802SH_CTDBTL_001-045D.csv","20-1802SH_CTDBTL_001-045U.csv","20-1804SH_CTDBTL_001-103D.csv","20-1804SH_CTDBTL_001-103U.csv","20-1806SR_CTDBTL_001-072D.csv","20-1806SR_CTDBTL_001-072U.csv","20-1810SR_CTDBTL_001-074D.csv","20-1810SR_CTDBTL_001-074U.csv","20-1902RL_CTDBTL_001-029D.csv","20-1902RL_CTDBTL_001-029U.csv","20-1904RL_CTDBTL_001-069D.csv","20-1904RL_CTDBTL_001-069U.csv","20-2401RL_CTDBTL_001-016D.csv","20-2401RL_CTDBTL_001-016U.csv","20-2401RL_CTDBTL_017-033D.csv","20-2401RL_CTDBTL_017-033U.csv"],["final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","final","preliminary","preliminary","preliminary","preliminary"],["9802JD","9802JD","9804JD","9804JD","9804JD","9804JD","9804JD","9804JD","9807NH","9807NH","0302JD","0302JD","0302JD","0302JD","0302JD","0302JD","0307NH","0307NH","0307NH","0307NH","0310NH","0310NH","0401JD","0401JD","0404NH","0404NH","0404NH","0404NH","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0407JD","0411RR","0411RR","0501NH","0501NH","0504NH","0504NH","0507NH","0507NH","0511NH","0511NH","0602JD","0602JD","0604NH","0604NH","0607NH","0607NH","0701JD","0701JD","0701JD","0701JD",null,null,"0911NH","0911NH","1001NH","1001NH","1004MF","1004MF","1008NH","1008NH","1011NH","1011NH","1101NH","1101NH","1104SH","1104SH","1104SH","1104SH","1104SH","1104SH","1104SH","1104SH","1108NH","1108NH","1110NH","1110NH","1202NH","1202NH","1203SH","1203SH","1207OS","1207OS","1210NH","1210NH","1301SH","1301SH","1304SH","1304SH","1307NH","1307NH","1311NH","1311NH","1402SH","1402SH","1404OS","1404OS","1407NH","1407NH","1411NH","1411NH","1501NH","1501NH","1501NH","1501NH","1501NH","1501NH","1504NH","1504NH","1507OC","1507OC","1511OC","1511OC","1601RL","1601RL","1604SH","1604SH","1607OS","1607OS","1611SR","1611SR","1701RL","1701RL","1701RL","1701RL","1701RL","1701RL","1704SH","1704SH","1704SH","1704SH","1704SH","1704SH","1708SR","1708SR","1802SH","1802SH","1804SH","1804SH","1806SR","1806SR","1810SR","1810SR","1902RL","1902RL","1904RL","1904RL","2401RL","2401RL","2401RL","2401RL"],["D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D",null,null,"U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U","D","U"],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>path<\/th>\n      <th>filename<\/th>\n      <th>data_type<\/th>\n      <th>cruise_id<\/th>\n      <th>cast_dir<\/th>\n      <th>priority<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":6},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"path","targets":1},{"name":"filename","targets":2},{"name":"data_type","targets":3},{"name":"cruise_id","targets":4},{"name":"cast_dir","targets":5},{"name":"priority","targets":6}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="read-and-standardize-ctd-files" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="read-and-standardize-ctd-files"><span class="header-section-number">6</span> Read and Standardize CTD Files</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># function to read and standardize CTD file</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>read_ctd_file <span class="ot">&lt;-</span> <span class="cf">function</span>(file_path, cruise_id, data_type, cast_dir) {</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># read CSV file</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>      file_path,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">guess_max      =</span> <span class="cn">Inf</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">show_col_types =</span> F)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert column names to snake_case</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> <span class="fu">clean_names</span>()</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add metadata columns and ensure event_num is character for consistency</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    df <span class="sc">|&gt;</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">cruise_id   =</span> cruise_id,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">stage       =</span> <span class="fu">if_else</span>(data_type <span class="sc">==</span> <span class="st">"final"</span>, <span class="st">"F"</span>, <span class="st">"P"</span>),</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">cast_dir    =</span> cast_dir,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">source_file =</span> <span class="fu">basename</span>(file_path))</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Error reading {basename(file_path)}: {e$message}"</span>))</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="co"># read and combine all files (both upcast and downcast)</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>ctd_data <span class="ot">&lt;-</span> files_to_ingest <span class="sc">|&gt;</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pmap</span>(<span class="cf">function</span>(path, cruise_id, data_type, cast_dir, ...) {</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Reading: {basename(path)}"</span>))</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_ctd_file</span>(path, cruise_id, data_type, cast_dir)</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="co"># add nrows per file to ctd_data</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>d_fread <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="fu">basename</span>(<span class="fu">names</span>(ctd_data))) <span class="sc">|&gt;</span> </span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrows =</span> <span class="fu">map_int</span>(ctd_data, <span class="sc">~</span> <span class="cf">if</span> (<span class="fu">is.null</span>(.x)) <span class="dv">0</span> <span class="cf">else</span> <span class="fu">nrow</span>(.x))) <span class="sc">%&gt;%</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="st">"_TOTAL_"</span>,</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrows    =</span> <span class="fu">sum</span>(.<span class="sc">$</span>nrows) ) ) <span class="sc">|&gt;</span> </span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(filename))</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: fix duplicates</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Reading: 20-0701JD_CTDBTL_001-084D.csv</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Reading: 20-0701JD_CTDBTL_001-084IDnoQC.csv</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Reading: 20-0701JD_CTDBTL_001-084IUnoQC.csv</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Reading: 20-0701JD_CTDBTL_001-084U.csv</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>d_fread <span class="sc">|&gt;</span> </span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Number of rows read per file"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># big marks for thousands</span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatCurrency</span>(<span class="st">"nrows"</span>, <span class="at">currency =</span> <span class="st">""</span>, <span class="at">digits =</span> <span class="dv">0</span>, <span class="at">mark =</span> <span class="st">","</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-74e8f4c8b922142ff5b5" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-74e8f4c8b922142ff5b5">{"x":{"filter":"none","vertical":false,"caption":"<caption>Number of rows read per file<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163"],["_TOTAL_","20-9807NH_CTDBTL_001-070U.csv","20-9807NH_CTDBTL_001-070D.csv","20-9804JD_CTDBTL_051-085U.csv","20-9804JD_CTDBTL_051-085D.csv","20-9804JD_CTDBTL_001-050U.csv","20-9804JD_CTDBTL_001-050D.csv","20-2401RL_CTDBTL_017-033U.csv","20-2401RL_CTDBTL_017-033D.csv","20-2401RL_CTDBTL_001-016U.csv","20-2401RL_CTDBTL_001-016D.csv","20-1904RL_CTDBTL_001-069U.csv","20-1904RL_CTDBTL_001-069D.csv","20-1902RL_CTDBTL_001-029U.csv","20-1902RL_CTDBTL_001-029D.csv","20-1810SR_CTDBTL_001-074U.csv","20-1810SR_CTDBTL_001-074D.csv","20-1806SR_CTDBTL_001-072U.csv","20-1806SR_CTDBTL_001-072D.csv","20-1804SH_CTDBTL_001-103U.csv","20-1804SH_CTDBTL_001-103D.csv","20-1802SH_CTDBTL_001-045U.csv","20-1802SH_CTDBTL_001-045D.csv","20-1708SR_CTDBTL_001-073U.csv","20-1708SR_CTDBTL_001-073D.csv","20-1704SH_CTDBTL_041-104U.csv","20-1704SH_CTDBTL_041-104D.csv","20-1704SH_CTDBTL_001-104U.csv","20-1704SH_CTDBTL_001-104D.csv","20-1704SH_CTDBTL_001-040U.csv","20-1704SH_CTDBTL_001-040D.csv","20-1701RL_CTDBTL_021-083U.csv","20-1701RL_CTDBTL_021-083D.csv","20-1701RL_CTDBTL_001-083U.csv","20-1701RL_CTDBTL_001-083D.csv","20-1701RL_CTDBTL_001-020U.csv","20-1701RL_CTDBTL_001-020D.csv","20-1611SR_CTDBTL_001-075U.csv","20-1611SR_CTDBTL_001-075D.csv","20-1607OS_CTDBTL_001-068U.csv","20-1607OS_CTDBTL_001-068D.csv","20-1604SH_CTDBTL_001-101U.csv","20-1604SH_CTDBTL_001-101D.csv","20-1601RL_CTDBTL_001-104U.csv","20-1601RL_CTDBTL_001-104D.csv","20-1511OC_CTDBTL_001-070U.csv","20-1511OC_CTDBTL_001-070D.csv","20-1507OC_CTDBTL_001-071U.csv","20-1507OC_CTDBTL_001-071D.csv","20-1504NH_CTDBTL_001-070U.csv","20-1504NH_CTDBTL_001-070D.csv","20-1501NH_CTDBTL_004-100U.csv","20-1501NH_CTDBTL_004-100D.csv","20-1501NH_CTDBTL_001-100U.csv","20-1501NH_CTDBTL_001-100D.csv","20-1501NH_CTDBTL_001-064U.csv","20-1501NH_CTDBTL_001-064D.csv","20-1411NH_CTDBTL_001-076U.csv","20-1411NH_CTDBTL_001-076D.csv","20-1407NH_CTDBTL_001-075U.csv","20-1407NH_CTDBTL_001-075D.csv","20-1404OS_CTDBTL_001-070U.csv","20-1404OS_CTDBTL_001-070D.csv","20-1402SH_CTDBTL_001-036U.csv","20-1402SH_CTDBTL_001-036D.csv","20-1311NH_CTDBTL_001-521U.csv","20-1311NH_CTDBTL_001-521D.csv","20-1307NH_CTDBTL_001-074U.csv","20-1307NH_CTDBTL_001-074D.csv","20-1304SH_CTDBTL_001-109U.csv","20-1304SH_CTDBTL_001-109D.csv","20-1301SH_CTDBTL_001-090U.csv","20-1301SH_CTDBTL_001-090D.csv","20-1210NH_CTDBTL_001-075U.csv","20-1210NH_CTDBTL_001-075D.csv","20-1207OS_CTDBTL_001-075U.csv","20-1207OS_CTDBTL_001-075D.csv","20-1203SH_CTDBTL_001-057U.csv","20-1203SH_CTDBTL_001-057D.csv","20-1202NH_CTDBTL_001-075U.csv","20-1202NH_CTDBTL_001-075D.csv","20-1110NH_CTDBTL_001-666IU.csv","20-1110NH_CTDBTL_001-666ID.csv","20-1108NH_CTDBTL_001-072IU.csv","20-1108NH_CTDBTL_001-072ID.csv","20-1104SH_CTDBTL_037-114IU.csv","20-1104SH_CTDBTL_037-114ID.csv","20-1104SH_CTDBTL_036-036IU.csv","20-1104SH_CTDBTL_036-036ID.csv","20-1104SH_CTDBTL_031-114IU.csv","20-1104SH_CTDBTL_031-114ID.csv","20-1104SH_CTDBTL_031-035IU.csv","20-1104SH_CTDBTL_031-035ID.csv","20-1101NH_CTDBTL_001-106U.csv","20-1101NH_CTDBTL_001-106D.csv","20-1011NH_CTDBTL_001-067IU.csv","20-1011NH_CTDBTL_001-067ID.csv","20-1008NH_CTDBTL_001-075IU.csv","20-1008NH_CTDBTL_001-075ID.csv","20-1004MF_CTDBTL_123-682IU.csv","20-1004MF_CTDBTL_123-682ID.csv","20-1001NH_CTDBTL_001-093U.csv","20-1001NH_CTDBTL_001-093D.csv","20-0911NH_CTDBTL_001-075IU.csv","20-0911NH_CTDBTL_001-075ID.csv","20-0907M2_CTDBTL_001-961IU.csv","20-0907M2_CTDBTL_001-961ID.csv","20-0701JD_CTDBTL_001-084U.csv","20-0701JD_CTDBTL_001-084IUnoQC.csv","20-0701JD_CTDBTL_001-084IDnoQC.csv","20-0701JD_CTDBTL_001-084D.csv","20-0607NH_CTDBTL_001-074IU.csv","20-0607NH_CTDBTL_001-074ID.csv","20-0604NH_CTDBTL_001-563IU.csv","20-0604NH_CTDBTL_001-563ID.csv","20-0602JD_CTDBTL_001-096U.csv","20-0602JD_CTDBTL_001-096D.csv","20-0511NH_CTDBTL_001-072U.csv","20-0511NH_CTDBTL_001-072D.csv","20-0507NH_CTDBTL_001-075U.csv","20-0507NH_CTDBTL_001-075D.csv","20-0504NH_CTDBTL_001-075U.csv","20-0504NH_CTDBTL_001-075D.csv","20-0501NH_CTDBTL_001-075U.csv","20-0501NH_CTDBTL_001-075D.csv","20-0411RR_CTDBTL_001-965IU.csv","20-0411RR_CTDBTL_001-965ID.csv","20-0407JD_CTDBTL_040-074IU.csv","20-0407JD_CTDBTL_040-074ID.csv","20-0407JD_CTDBTL_029-039IU.csv","20-0407JD_CTDBTL_029-039ID.csv","20-0407JD_CTDBTL_013-074IU.csv","20-0407JD_CTDBTL_013-074ID.csv","20-0407JD_CTDBTL_013-028IU.csv","20-0407JD_CTDBTL_013-028ID.csv","20-0407JD_CTDBTL_003-012IU.csv","20-0407JD_CTDBTL_003-012ID.csv","20-0407JD_CTDBTL_001-012IU.csv","20-0407JD_CTDBTL_001-012ID.csv","20-0407JD_CTDBTL_001-002IU.csv","20-0407JD_CTDBTL_001-002ID.csv","20-0404NH_CTDBTL_001-066IU.csv","20-0404NH_CTDBTL_001-066ID.csv","20-0404JD_CTDBTL_067-094IU.csv","20-0404JD_CTDBTL_067-094ID.csv","20-0401JD_CTDBTL_001-098IU.csv","20-0401JD_CTDBTL_001-098ID.csv","20-0310NH_CTDBTL_001-066U.csv","20-0310NH_CTDBTL_001-066D.csv","20-0307NH_CTDBTL_044-060IU.csv","20-0307NH_CTDBTL_044-060ID.csv","20-0307NH_CTDBTL_001-526IU.csv","20-0307NH_CTDBTL_001-526ID.csv","20-0302JD_CTDBTL_074-100IU.csv","20-0302JD_CTDBTL_074-100ID.csv","20-0302JD_CTDBTL_001-100U.csv","20-0302JD_CTDBTL_001-100D.csv","20-0302JD_CTDBTL_001-073IU.csv","20-0302JD_CTDBTL_001-073ID.csv","19-9804JD_CTDBTL_001-085U.csv","19-9804JD_CTDBTL_001-085D.csv","19-9802JD_CTDBTL_001-066U.csv","19-9802JD_CTDBTL_001-066D.csv"],[4448219,32130,32087,15646,15611,22275,22219,6190,6167,7285,7263,26919,26826,11881,11844,29958,29863,30008,29930,42394,42284,19438,19394,29414,29321,27096,27004,42934,42787,15838,15783,23173,23100,32064,31986,8891,8886,32844,32761,27363,27305,41511,41393,43072,42972,31337,30736,28408,28323,27378,27300,19813,19760,41823,41713,22010,21953,33180,33089,33498,33412,27330,27264,14676,14637,36142,36067,32969,32892,33125,33031,41625,41523,33200,33114,30104,30002,25428,25367,33498,33413,36280,36196,33093,33007,26640,26151,520,519,28271,27775,1111,1105,53969,52510,33357,33302,36141,36066,28495,28900,48884,48764,36099,35989,54961,54821,39371,39372,39356,39356,30075,30066,29854,29764,44101,43972,28313,28204,30048,30008,29969,29920,29862,29827,32661,32648,13048,13024,3297,3289,24366,24325,8021,8012,5133,5125,5206,5196,73,71,29629,29572,15730,15696,47405,46804,29780,29723,1132,1128,26544,26697,10879,10866,42901,42856,32022,31990,37921,37830,29543,29462]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>filename<\/th>\n      <th>nrows<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatCurrency(data, \"\", 0, 3, \",\", \".\", true, null);\n  }"},{"className":"dt-right","targets":2},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"filename","targets":1},{"name":"nrows","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="transform-data" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="transform-data"><span class="header-section-number">7</span> Transform Data</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ctd_bound <span class="ot">&lt;-</span> ctd_data <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert any mismatched types to character</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ! Can't combine `..1$event_num` &lt;double&gt;     and `..59$event_num` &lt;character&gt;.</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ! Can't combine `..1$ord_occ` &lt;character&gt;    and `..69$ord_occ` &lt;double&gt;.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ! Can't combine `..1$ox_bu_m` &lt;double&gt;       and `..95$ox_bu_m` &lt;character&gt;.</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ! Can't combine `..1$line` &lt;character&gt;       and `..113$line` &lt;double&gt;.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ! Can't combine `..1$sta` &lt;character&gt;        and `..113$sta` &lt;double&gt;.</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ! Can't combine `..1$salt_ave_corr` &lt;double&gt; and `..160$salt_ave_corr` &lt;character&gt;.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># </span><span class="al">TODO</span><span class="co">: sort fixes for named files, eg event_num 59:</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   names(ctd_data)[59] # 20-0701JD_CTDFinalQC/db_csvs/20-0701JD_CTDBTL_001-084D.csv</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> .x <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    event_num, ord_occ, ox_bu_m, line, sta, salt_ave_corr, phaeo, salt1_corr, salt2_corr),</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">TODO</span><span class="co">: fix these columns to proper types, since probably supposed to be numeric</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    as.character))) <span class="sc">|&gt;</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list_rbind</span>() <span class="co">#</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co"># nrow(ctd_bound) # 4,448,219</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: drop cruise_id or replace with study?</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co"># ctd_bound$study |&gt; table(useNA = "ifany")</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co"># ctd_bound$cruise_id |&gt; table(useNA = "ifany")</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="co"># ctd_bound |&gt; </span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(cruise_id)) |&gt;</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="co">#     is_study = cruise_id == study) |&gt; </span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   pull(is_study) |&gt; </span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   table(useNA = "ifany")</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   FALSE    TRUE </span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   31426 4307011</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="co"># format date ----</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="co"># apply formats depending on pattern</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>ctd_bound <span class="ot">&lt;-</span> ctd_bound <span class="sc">|&gt;</span> </span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_time_utc =</span> <span class="fu">trim</span>(date_time_utc),</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">dtime_utc =</span> <span class="cn">NA</span>, <span class="co"># _POSIXct_,</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">dtime_utc =</span> <span class="fu">if_else</span>(</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(date_time_utc, <span class="st">"^</span><span class="sc">\\</span><span class="st">d{2}-[A-Z][a-z]{2}-</span><span class="sc">\\</span><span class="st">d{4} </span><span class="sc">\\</span><span class="st">d{2}:</span><span class="sc">\\</span><span class="st">d{2}:</span><span class="sc">\\</span><span class="st">d{2}$"</span>), <span class="co"># eg "23-Jan-1998 17:50:44"</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dmy_hms</span>(date_time_utc, <span class="at">tz =</span> <span class="st">"UTC"</span>),</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>      dtime_utc),</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">dtime_utc =</span> <span class="fu">if_else</span>(</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(date_time_utc, <span class="st">"^</span><span class="sc">\\</span><span class="st">d{2}/</span><span class="sc">\\</span><span class="st">d{2}/</span><span class="sc">\\</span><span class="st">d{4} </span><span class="sc">\\</span><span class="st">d{2}:</span><span class="sc">\\</span><span class="st">d{2}$"</span>),               <span class="co"># eg "01/16/2015 17:12"</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mdy_hm</span>(date_time_utc, <span class="at">tz=</span> <span class="st">"UTC"</span>),</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>      dtime_utc)) <span class="sc">|&gt;</span> </span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(dtime_utc, <span class="at">.before =</span> date_time_utc) <span class="sc">|&gt;</span> </span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>date_time_utc, <span class="sc">-</span>date_time_pst) <span class="sc">|&gt;</span> </span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(dtime_utc, depth)</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(ctd_bound<span class="sc">$</span>dtime_utc)))</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a><span class="co"># fill in missing lon,lat from line,sta ----</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>ctd_bound <span class="ot">&lt;-</span> ctd_bound <span class="sc">|&gt;</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon_dec =</span> <span class="fu">if_else</span>(</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(lon_dec) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(line) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(sta),</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(<span class="fu">sf_project</span>(</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">from  =</span> <span class="st">"+proj=calcofi"</span>,</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">to    =</span> <span class="st">"+proj=longlat +datum=WGS84"</span>,</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">pts   =</span> <span class="fu">cbind</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(line), <span class="at">y =</span> <span class="fu">as.numeric</span>(sta)) )[,<span class="dv">1</span>]),</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>      lon_dec),</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat_dec =</span> <span class="fu">if_else</span>(</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(lat_dec) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(line) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(sta),</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(<span class="fu">sf_project</span>(</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>        <span class="at">from  =</span> <span class="st">"+proj=calcofi"</span>,</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>        <span class="at">to    =</span> <span class="st">"+proj=longlat +datum=WGS84"</span>,</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>        <span class="at">pts   =</span> <span class="fu">cbind</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(line), <span class="at">y =</span> <span class="fu">as.numeric</span>(sta)) )[,<span class="dv">2</span>]),</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>      lat_dec) )</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a><span class="co"># show first and last 100 rows</span></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>ctd_bound <span class="sc">|&gt;</span> </span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, (<span class="fu">n</span>()<span class="sc">-</span><span class="dv">9</span>)<span class="sc">:</span><span class="fu">n</span>())) <span class="sc">|&gt;</span></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(<span class="at">caption =</span> <span class="fu">glue</span>(</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>    <span class="st">"First and last 10 rows of combined CTD data (nrows={format(nrow(ctd_bound), big.mark = ',')})"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-113b7d2beca31b03dbcf" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-113b7d2beca31b03dbcf">{"x":{"filter":"none","vertical":false,"caption":"<caption>First and last 10 rows of combined CTD data (nrows=4,448,219)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],["CalCOFI","CalCOFI","CalCOFI","CalCOFI","CalCOFI","CalCOFI","CalCOFI","CalCOFI","CalCOFI","CalCOFI","CalCOFI","CalCOFI","CalCOFI","CalCOFI","CalCOFI","CalCOFI","CalCOFI","CalCOFI","CalCOFI","CalCOFI"],["9802JD","9802JD","9802JD","9802JD","9802JD","9802JD","9802JD","9802JD","9802JD","9802JD","2401RL","2401RL","2401RL","2401RL","2401RL","2401RL","2401RL","2401RL","2401RL","2401RL"],["001","001","001","001","001","001","001","001","001","001","033","033","033","033","033","033","033","033","033","033"],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],["9802_001d","9802_001d","9802_001d","9802_001d","9802_001d","9802_001d","9802_001d","9802_001d","9802_001d","9802_001d","2401_033u","2401_033u","2401_033u","2401_033u","2401_033u","2401_033u","2401_033u","2401_033u","2401_033u","2401_033u"],["1998-01-23T11:14:25Z","1998-01-23T11:14:50Z","1998-01-23T11:14:50Z","1998-01-23T11:14:52Z","1998-01-23T11:14:54Z","1998-01-23T11:14:57Z","1998-01-23T11:14:58Z","1998-01-23T11:15:00Z","1998-01-23T11:15:03Z","1998-01-23T11:15:04Z","2024-01-25T13:26:48Z","2024-01-25T13:26:53Z","2024-01-25T13:26:58Z","2024-01-25T13:27:41Z","2024-01-25T13:28:01Z","2024-01-25T13:28:06Z","2024-01-25T13:28:11Z","2024-01-25T13:28:14Z","2024-01-25T13:28:19Z","2024-01-25T13:28:32Z"],[32.9563724259334,32.9563724259334,32.9563724259334,32.9563724259334,32.9563724259334,32.9563724259334,32.9563724259334,32.9563724259334,32.9563724259334,32.9563724259334,33.83012,33.83014,33.83015,33.83029,33.83036,33.83037,33.83038,33.83039,33.8304,33.83045],[-117.3052132775284,-117.3052132775284,-117.3052132775284,-117.3052132775284,-117.3052132775284,-117.3052132775284,-117.3052132775284,-117.3052132775284,-117.3052132775284,-117.3052132775284,-118.63523,-118.63524,-118.63524,-118.63528,-118.63531,-118.6353,-118.63532,-118.63532,-118.63532,-118.63534],["093.3 026.7","093.3 026.7","093.3 026.7","093.3 026.7","093.3 026.7","093.3 026.7","093.3 026.7","093.3 026.7","093.3 026.7","093.3 026.7","086.7 035.0","086.7 035.0","086.7 035.0","086.7 035.0","086.7 035.0","086.7 035.0","086.7 035.0","086.7 035.0","086.7 035.0","086.7 035.0"],["093.3","093.3","093.3","093.3","093.3","093.3","093.3","093.3","093.3","093.3","086.7","086.7","086.7","086.7","086.7","086.7","086.7","086.7","086.7","086.7"],["026.7","026.7","026.7","026.7","026.7","026.7","026.7","026.7","026.7","026.7","035.0","035.0","035.0","035.0","035.0","035.0","035.0","035.0","035.0","035.0"],[2,3,4,5,6,7,8,9,10,11,14,13,12,11,10,9,8,7,6,5],[2.014,3.021,4.028,5.035,6.042,7.049,8.055999999999999,9.063000000000001,10.07,11.077,14.101,13.094,12.086,11.079,10.072,9.065,8.058,7.05,6.043,5.036],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[17.915,17.9442,17.9709,17.9473,17.8728,17.8677,17.8647,17.8635,17.8623,17.8608,15.5734,15.5776,15.5799,15.584,15.5848,15.5852,15.5847,15.5844,15.5844,15.5822],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,15.5652,15.5777,15.5812,15.5834,15.5845,15.5849,15.5849,15.584,15.5841,15.5822],[9,9,9,9,9,9,9,9,9,9,null,null,null,null,null,null,null,null,null,null],[17.915,17.9442,17.9709,17.9473,17.8728,17.8677,17.8647,17.8635,17.8623,17.8608,15.5693,15.5777,15.5806,15.5837,15.5847,15.5851,15.5848,15.5842,15.5843,15.5822],[34.0512,34.0512,34.0518,34.0506,34.0512,34.0509,34.0511,34.0512,34.051,34.051,33.1968,33.2018,33.2008,33.1971,33.1975,33.1974,33.1976,33.1974,33.1976,33.1978],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],["34.0506","34.0506","34.0512","34.05","34.0506","34.0503","34.0505","34.0506","34.0504","34.0504","33.2001","33.2051","33.2041","33.2004","33.2008","33.2007","33.2009","33.2007","33.2009","33.2011"],[null,null,null,null,null,null,null,null,null,null,33.2126,33.2051,33.202,33.2005,33.2004,33.2003,33.1999,33.2005,33.2005,33.1994],[9,9,9,9,9,9,9,9,9,9,null,null,null,null,null,null,null,null,null,null],["NaN","NaN","NaN","NaN","NaN","NaN","NaN","NaN","NaN","NaN","33.2162","33.2087","33.2056","33.2041","33.204","33.2039","33.2035","33.2041","33.2041","33.203"],["34.0506","34.0506","34.0512","34.05","34.0506","34.0503","34.0505","34.0506","34.0504","34.0504","33.2082","33.2069","33.2049","33.2023","33.2024","33.2023","33.2022","33.2024","33.2025","33.2021"],[5.30874,5.32249,5.30606,5.30639,5.3194,5.32372,5.3307,5.32715,5.32599,5.32407,5.6137,5.6188,5.6087,5.6123,5.6115,5.6221,5.6145,5.6149,5.5974,5.6244],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[5.2155,5.2289,5.2129,5.2132,5.2259,5.2301,5.2368,5.2334,5.2323,5.2304,5.8274,5.8326,5.8223,5.826,5.8251,5.836,5.8282,5.8286,5.8107,5.8384],[5.2781,5.2919,5.2755,5.2758,5.2888,5.2932,5.3002,5.2966,5.2954,5.2935,5.8546,5.8598,5.8494,5.8531,5.8523,5.8633,5.8554,5.8558,5.8377,5.8657],[null,null,null,null,null,null,null,null,null,null,5.594,5.5898,5.5893,5.5901,5.5941,5.5947,5.596,5.5881,5.5879,5.5869],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,5.8114,5.8071,5.8066,5.8074,5.8115,5.8121,5.8135,5.8053,5.8051,5.8041],[null,null,null,null,null,null,null,null,null,null,5.8433,5.8389,5.8384,5.8393,5.8434,5.844,5.8454,5.8372,5.837,5.8359],[null,null,null,null,null,null,null,null,null,null,5.849,5.8494,5.8439,5.8462,5.8479,5.8537,5.8504,5.8465,5.8374,5.8508],[231.40354,232.00435,231.28987,231.30292,231.86579,232.05418,232.35788,232.20327,232.15244,232.06898,244.724,244.945,244.502,244.663,244.628,245.087,244.757,244.775,244.013,245.191],[224.844,225.4276,224.7336,224.7463,225.293,225.476,225.771,225.6209,225.5715,225.4904,254.4688,254.6958,254.2408,254.4061,254.3702,254.8417,254.5027,254.5212,253.7385,254.9485],[null,null,null,null,null,null,null,null,null,null,118.0514,118.1427,117.9598,118.0262,118.0118,118.2013,118.065,118.0725,117.7578,118.2442],[null,null,null,null,null,null,null,null,null,null,243.861,243.681,243.657,243.692,243.866,243.895,243.953,243.607,243.596,243.555],[null,null,null,null,null,null,null,null,null,null,264.6736,264.9075,264.4386,264.609,264.572,265.0578,264.7085,264.7276,263.921,265.1679],[null,null,null,null,null,null,null,null,null,null,118.143,118.068,118.058,118.0725,118.1451,118.1572,118.1813,118.0371,118.0325,118.0155],[null,null,null,null,null,null,null,null,null,null,118.0972,118.1054,118.0089,118.0494,118.0785,118.1793,118.1232,118.0548,117.8952,118.1299],[0.7999000000000001,0.7154,0.7064,0.6955,0.7378,0.9851,0.9497,0.864,0.7982,0.8547,0.0629,0.0604,0.0624,0.0606,0.0596,0.0601,0.0623,0.064,0.0605,0.0595],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[0.4737,0.4094,0.4025,0.3942,0.4264,0.6146,0.5876,0.5224,0.4724,0.5154,0.2274,0.21,0.2239,0.2114,0.2045,0.2079,0.2232,0.2351,0.2107,0.2038],[0.6777,0.6127,0.6045,0.5943000000000001,0.632,0.7453,0.7403999999999999,0.7128,0.6766,0.7085,0.1468,0.1316,0.1437,0.1328,0.127,0.1299,0.1431,0.1538,0.1322,0.1264],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[24.5663,24.5593,24.5532,24.5581,24.5769,24.5778,24.5788,24.5792,24.5794,24.5798,24.4569,24.4597,24.4584,24.4546,24.4547,24.4545,24.4548,24.4546,24.4547,24.4554],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,24.4708,24.4623,24.4591,24.4574,24.457,24.4568,24.4565,24.4571,24.457,24.4566],[9,9,9,9,9,9,9,9,9,9,null,null,null,null,null,null,null,null,null,null],[0.6929999999999999,0.6909999999999999,0.6879999999999999,0.696,0.704,0.701,0.699,0.698,0.697,0.699,0.5231,0.4157,0.4153,0.4235,0.4037,0.4096,0.4023,0.4226,0.3991,0.4532],[84.1014,84.1461,84.20189999999999,84.0337,83.8725,83.91930000000001,83.9602,83.98650000000001,83.9958,83.9718,87.7456,90.131,90.1396,89.9568,90.40000000000001,90.2677,90.43210000000001,89.97620000000001,90.5051,89.2878],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,8.085000000000001,8.085000000000001,8.085000000000001,8.09,8.09,8.09,8.090999999999999,8.092000000000001,8.092000000000001,8.095000000000001],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,5.7128,6.6073,7.5164,6.9016,7.5923,7.6171,7.6171,6.4995,7.7346,7.4408],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[9999,9999,9999,9999,9999,9999,9999,9999,9999,9999,0.11044,0.11022,0.11135,0.10952,0.11169,0.11474,0.12114,0.12853,0.14984,0.16363],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[17.9147,17.9437,17.9702,17.9465,17.8717,17.8665,17.8634,17.8619,17.8606,17.859,15.5712,15.5756,15.5781,15.5824,15.5832,15.5838,15.5835,15.5833,15.5834,15.5815],[null,null,null,null,null,null,null,null,null,null,15.5631,15.5757,15.5794,15.5817,15.583,15.5835,15.5836,15.583,15.5832,15.5815],[0.0029,0.008500000000000001,0.0116,0.015,0.0184,0.0218,0.0252,0.0286,0.0319,0.0353,1.1882,1.1882,1.1882,1.1963,1.203,1.2034,1.2034,1.2034,1.2034,1.2066],[336.138,336.845,337.461,337.029,335.276,335.218,335.164,335.16,335.179,335.173,null,null,null,null,null,null,null,null,null,null],[5.40233,5.3993,5.39653,5.399,5.40671,5.40725,5.40755,5.40767,5.4078,5.40795,98.646,98.746,98.571,98.642,98.629,98.815,98.681,98.688,98.381,98.851],[null,null,null,null,null,null,null,null,null,null,98.292,98.239,98.23399999999999,98.251,98.32299999999999,98.336,98.35899999999999,98.218,98.214,98.193],[1,null,null,null,null,null,null,null,null,11,null,null,null,11,null,null,null,null,6,null],[17.95,null,null,null,null,null,null,null,null,17.85,null,null,null,null,null,null,null,null,null,null],[34.049,null,null,null,null,null,null,null,null,34.047,null,null,null,null,null,null,null,null,33.2019,null],[5.3,null,null,null,null,null,null,null,null,5.3,null,null,null,null,null,null,null,null,5.824,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"254.16",null],[0.8,null,null,null,null,null,null,null,null,0.68,null,null,null,null,null,null,null,null,0.141,null],[".26",null,null,null,null,null,null,null,null,".29",null,null,null,null,null,null,null,null,"0.076",null],[0.5,null,null,null,null,null,null,null,null,0.5,null,null,null,0,null,null,null,null,0,null],[0.32,null,null,null,null,null,null,null,null,0.32,null,null,null,0,null,null,null,null,0,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,0,null,null,null,null,0.01,null],[0.4,null,null,null,null,null,null,null,null,0.4,null,null,null,0.28,null,null,null,null,0.28,null],[2.1,null,null,null,null,null,null,null,null,2.1,null,null,null,1.27,null,null,null,null,1.24,null],["9802JD","9802JD","9802JD","9802JD","9802JD","9802JD","9802JD","9802JD","9802JD","9802JD","2401RL","2401RL","2401RL","2401RL","2401RL","2401RL","2401RL","2401RL","2401RL","2401RL"],["F","F","F","F","F","F","F","F","F","F","P","P","P","P","P","P","P","P","P","P"],["D","D","D","D","D","D","D","D","D","D","U","U","U","U","U","U","U","U","U","U"],["19-9802JD_CTDBTL_001-066D.csv","19-9802JD_CTDBTL_001-066D.csv","19-9802JD_CTDBTL_001-066D.csv","19-9802JD_CTDBTL_001-066D.csv","19-9802JD_CTDBTL_001-066D.csv","19-9802JD_CTDBTL_001-066D.csv","19-9802JD_CTDBTL_001-066D.csv","19-9802JD_CTDBTL_001-066D.csv","19-9802JD_CTDBTL_001-066D.csv","19-9802JD_CTDBTL_001-066D.csv","20-2401RL_CTDBTL_017-033U.csv","20-2401RL_CTDBTL_017-033U.csv","20-2401RL_CTDBTL_017-033U.csv","20-2401RL_CTDBTL_017-033U.csv","20-2401RL_CTDBTL_017-033U.csv","20-2401RL_CTDBTL_017-033U.csv","20-2401RL_CTDBTL_017-033U.csv","20-2401RL_CTDBTL_017-033U.csv","20-2401RL_CTDBTL_017-033U.csv","20-2401RL_CTDBTL_017-033U.csv"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>project<\/th>\n      <th>study<\/th>\n      <th>ord_occ<\/th>\n      <th>event_num<\/th>\n      <th>cast_id<\/th>\n      <th>dtime_utc<\/th>\n      <th>lat_dec<\/th>\n      <th>lon_dec<\/th>\n      <th>sta_id<\/th>\n      <th>line<\/th>\n      <th>sta<\/th>\n      <th>depth<\/th>\n      <th>pressure<\/th>\n      <th>pr_q<\/th>\n      <th>temp1<\/th>\n      <th>temp1q<\/th>\n      <th>temp2<\/th>\n      <th>temp2q<\/th>\n      <th>temp_ave<\/th>\n      <th>salt1<\/th>\n      <th>salt1q<\/th>\n      <th>salt1_corr<\/th>\n      <th>salt2<\/th>\n      <th>salt2q<\/th>\n      <th>salt2_corr<\/th>\n      <th>salt_ave_corr<\/th>\n      <th>ox1<\/th>\n      <th>ox1q<\/th>\n      <th>ox1_cruise_corr<\/th>\n      <th>ox1_sta_corr<\/th>\n      <th>ox2<\/th>\n      <th>ox2q<\/th>\n      <th>ox2_cruise_corr<\/th>\n      <th>ox2_sta_corr<\/th>\n      <th>ox_ave_sta_corr<\/th>\n      <th>ox1u_m<\/th>\n      <th>ox1u_m_cruise_corr<\/th>\n      <th>ox1u_m_sta_corr<\/th>\n      <th>ox2u_m<\/th>\n      <th>ox2u_m_cruise_corr<\/th>\n      <th>ox2u_m_sta_corr<\/th>\n      <th>ox_aveu_m_sta_corr<\/th>\n      <th>fluor_v<\/th>\n      <th>fluor_q<\/th>\n      <th>est_chl_cruise_corr<\/th>\n      <th>est_chl_sta_corr<\/th>\n      <th>isusv<\/th>\n      <th>isusq<\/th>\n      <th>est_no3_cruise_corr<\/th>\n      <th>est_no3_sta_corr<\/th>\n      <th>sig_theta_ts1<\/th>\n      <th>sig_theta_ts1q<\/th>\n      <th>sig_theta_ts2<\/th>\n      <th>sig_theta_ts2q<\/th>\n      <th>bat<\/th>\n      <th>x_miss<\/th>\n      <th>trans_q<\/th>\n      <th>p_h<\/th>\n      <th>p_hq<\/th>\n      <th>spar<\/th>\n      <th>sparq<\/th>\n      <th>par<\/th>\n      <th>parq<\/th>\n      <th>po_t1<\/th>\n      <th>po_t2<\/th>\n      <th>dyn_ht<\/th>\n      <th>sva<\/th>\n      <th>ox_sat1<\/th>\n      <th>ox_sat2<\/th>\n      <th>btl_depth<\/th>\n      <th>btl_temp<\/th>\n      <th>salt_b<\/th>\n      <th>ox_b<\/th>\n      <th>ox_bu_m<\/th>\n      <th>chl_a<\/th>\n      <th>phaeo<\/th>\n      <th>no3<\/th>\n      <th>no2<\/th>\n      <th>nh4<\/th>\n      <th>po4<\/th>\n      <th>sil<\/th>\n      <th>cruise_id<\/th>\n      <th>stage<\/th>\n      <th>cast_dir<\/th>\n      <th>source_file<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[7,8,12,13,14,15,16,17,18,19,20,21,23,24,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,75,77,78,79,80,81]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"project","targets":1},{"name":"study","targets":2},{"name":"ord_occ","targets":3},{"name":"event_num","targets":4},{"name":"cast_id","targets":5},{"name":"dtime_utc","targets":6},{"name":"lat_dec","targets":7},{"name":"lon_dec","targets":8},{"name":"sta_id","targets":9},{"name":"line","targets":10},{"name":"sta","targets":11},{"name":"depth","targets":12},{"name":"pressure","targets":13},{"name":"pr_q","targets":14},{"name":"temp1","targets":15},{"name":"temp1q","targets":16},{"name":"temp2","targets":17},{"name":"temp2q","targets":18},{"name":"temp_ave","targets":19},{"name":"salt1","targets":20},{"name":"salt1q","targets":21},{"name":"salt1_corr","targets":22},{"name":"salt2","targets":23},{"name":"salt2q","targets":24},{"name":"salt2_corr","targets":25},{"name":"salt_ave_corr","targets":26},{"name":"ox1","targets":27},{"name":"ox1q","targets":28},{"name":"ox1_cruise_corr","targets":29},{"name":"ox1_sta_corr","targets":30},{"name":"ox2","targets":31},{"name":"ox2q","targets":32},{"name":"ox2_cruise_corr","targets":33},{"name":"ox2_sta_corr","targets":34},{"name":"ox_ave_sta_corr","targets":35},{"name":"ox1u_m","targets":36},{"name":"ox1u_m_cruise_corr","targets":37},{"name":"ox1u_m_sta_corr","targets":38},{"name":"ox2u_m","targets":39},{"name":"ox2u_m_cruise_corr","targets":40},{"name":"ox2u_m_sta_corr","targets":41},{"name":"ox_aveu_m_sta_corr","targets":42},{"name":"fluor_v","targets":43},{"name":"fluor_q","targets":44},{"name":"est_chl_cruise_corr","targets":45},{"name":"est_chl_sta_corr","targets":46},{"name":"isusv","targets":47},{"name":"isusq","targets":48},{"name":"est_no3_cruise_corr","targets":49},{"name":"est_no3_sta_corr","targets":50},{"name":"sig_theta_ts1","targets":51},{"name":"sig_theta_ts1q","targets":52},{"name":"sig_theta_ts2","targets":53},{"name":"sig_theta_ts2q","targets":54},{"name":"bat","targets":55},{"name":"x_miss","targets":56},{"name":"trans_q","targets":57},{"name":"p_h","targets":58},{"name":"p_hq","targets":59},{"name":"spar","targets":60},{"name":"sparq","targets":61},{"name":"par","targets":62},{"name":"parq","targets":63},{"name":"po_t1","targets":64},{"name":"po_t2","targets":65},{"name":"dyn_ht","targets":66},{"name":"sva","targets":67},{"name":"ox_sat1","targets":68},{"name":"ox_sat2","targets":69},{"name":"btl_depth","targets":70},{"name":"btl_temp","targets":71},{"name":"salt_b","targets":72},{"name":"ox_b","targets":73},{"name":"ox_bu_m","targets":74},{"name":"chl_a","targets":75},{"name":"phaeo","targets":76},{"name":"no3","targets":77},{"name":"no2","targets":78},{"name":"nh4","targets":79},{"name":"po4","targets":80},{"name":"sil","targets":81},{"name":"cruise_id","targets":82},{"name":"stage","targets":83},{"name":"cast_dir","targets":84},{"name":"source_file","targets":85}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="todo-check-for-duplicates" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="todo-check-for-duplicates"><span class="header-section-number">8</span> TODO: Check for duplicates</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: look for duplicates by dtime_utc, depth</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>d_dupes <span class="ot">&lt;-</span> ctd_bound <span class="sc">|&gt;</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(dtime_utc, depth) <span class="sc">|&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))  <span class="co">#  547,247 x 3</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># get number of distinct dtime_utc, depth</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>n_distinct_dtime_depth <span class="ot">&lt;-</span> ctd_bound <span class="sc">|&gt;</span> </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dtime_utc, depth) <span class="sc">|&gt;</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">n_distinct</span>()      <span class="co"># 3,900,792</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>d_dupes <span class="sc">|&gt;</span> </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, (<span class="fu">n</span>()<span class="sc">-</span><span class="dv">9</span>)<span class="sc">:</span><span class="fu">n</span>())) <span class="sc">|&gt;</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(<span class="at">caption =</span> <span class="fu">glue</span>(</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"First and last 10 rows of duplicates by dtime_utc, depth (nrows = {format(nrow(d_dupes), big.mark = ',')}; n_distinct_dtime_depth = {format(n_distinct_dtime_depth, big.mark = ',')})"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-3c206ce5e30f6e0280a5" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3c206ce5e30f6e0280a5">{"x":{"filter":"none","vertical":false,"caption":"<caption>First and last 10 rows of duplicates by dtime_utc, depth (nrows = 547,247; n_distinct_dtime_depth = 3,900,792)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],["1998-04-06T23:17:17Z","1998-04-08T00:04:17Z","1998-04-13T23:39:36Z","1998-04-13T23:39:37Z","1998-04-17T17:32:16Z","1998-04-17T21:08:44Z","1998-04-20T04:15:26Z","2003-02-01T18:29:53Z","2003-02-02T23:54:57Z","2003-02-05T18:37:18Z","2018-10-28T12:31:00Z","2018-10-28T14:17:00Z","2018-10-28T14:17:00Z","2018-10-28T14:17:00Z","2018-10-28T17:53:00Z","2018-10-29T01:19:00Z","2018-10-29T03:00:00Z","2019-02-10T04:00:12Z","2019-04-10T05:16:00Z","2019-04-14T19:15:00Z"],[519,538,82,81,510,226,508,513,517,290,70,14,15,16,568,25,125,517,10,517],[4,4,4,4,4,4,4,4,4,4,2,2,2,2,2,2,2,2,2,2]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>dtime_utc<\/th>\n      <th>depth<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"dtime_utc","targets":1},{"name":"depth","targets":2},{"name":"n","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="ingest-into-duckdb" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="ingest-into-duckdb"><span class="header-section-number">9</span> Ingest into DuckDB</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write to DuckDB</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(con, <span class="st">"ctd"</span>, ctd_bound, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Ingested {nrow(ctd_bound)} rows into DuckDB table 'ctd'"</span>))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># write point_geom as geometry column</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Adding spatially indexed column point_geom from lon_dec and lat_dec..."</span>))</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con, <span class="st">"ALTER TABLE ctd ADD COLUMN point_geom GEOMETRY;"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con, <span class="st">"UPDATE ctd SET point_geom = ST_Point(lon_dec, lat_dec);"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4448219</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con, <span class="st">"CREATE INDEX idx_ctd_point_geom ON ctd USING RTREE(point_geom);"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># show summary statistics</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl</span>(con, <span class="st">"ctd"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(stage, cast_dir) <span class="sc">|&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  stage cast_dir       n
  &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;
1 F     &lt;NA&gt;       78728
2 F     D        2167488
3 F     U        2175098
4 P     D          13430
5 P     U          13475</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># disconnect</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con, <span class="at">shutdown =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="summary" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="summary"><span class="header-section-number">10</span> Summary</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reconnect to show final table structure</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(duckdb<span class="sc">::</span><span class="fu">duckdb</span>(), <span class="at">dbdir =</span> db_path, <span class="at">read_only =</span> T)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># table info</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dbListTables</span>(con)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ctd"</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># show column names</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl</span>(con, <span class="st">"ctd"</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>() <span class="sc">|&gt;</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "project"             "study"               "ord_occ"            
 [4] "event_num"           "cast_id"             "dtime_utc"          
 [7] "lat_dec"             "lon_dec"             "sta_id"             
[10] "line"                "sta"                 "depth"              
[13] "pressure"            "pr_q"                "temp1"              
[16] "temp1q"              "temp2"               "temp2q"             
[19] "temp_ave"            "salt1"               "salt1q"             
[22] "salt1_corr"          "salt2"               "salt2q"             
[25] "salt2_corr"          "salt_ave_corr"       "ox1"                
[28] "ox1q"                "ox1_cruise_corr"     "ox1_sta_corr"       
[31] "ox2"                 "ox2q"                "ox2_cruise_corr"    
[34] "ox2_sta_corr"        "ox_ave_sta_corr"     "ox1u_m"             
[37] "ox1u_m_cruise_corr"  "ox1u_m_sta_corr"     "ox2u_m"             
[40] "ox2u_m_cruise_corr"  "ox2u_m_sta_corr"     "ox_aveu_m_sta_corr" 
[43] "fluor_v"             "fluor_q"             "est_chl_cruise_corr"
[46] "est_chl_sta_corr"    "isusv"               "isusq"              
[49] "est_no3_cruise_corr" "est_no3_sta_corr"    "sig_theta_ts1"      
[52] "sig_theta_ts1q"      "sig_theta_ts2"       "sig_theta_ts2q"     
[55] "bat"                 "x_miss"              "trans_q"            
[58] "p_h"                 "p_hq"                "spar"               
[61] "sparq"               "par"                 "parq"               
[64] "po_t1"               "po_t2"               "dyn_ht"             
[67] "sva"                 "ox_sat1"             "ox_sat2"            
[70] "btl_depth"           "btl_temp"            "salt_b"             
[73] "ox_b"                "ox_bu_m"             "chl_a"              
[76] "phaeo"               "no3"                 "no2"                
[79] "nh4"                 "po4"                 "sil"                
[82] "cruise_id"           "stage"               "cast_dir"           
[85] "source_file"         "point_geom"         </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summary by stage and cast direction</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl</span>(con, <span class="st">"ctd"</span>) <span class="sc">|&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(stage, cast_dir) <span class="sc">|&gt;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  stage cast_dir       n
  &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;
1 F     &lt;NA&gt;       78728
2 F     D        2167488
3 F     U        2175098
4 P     D          13430
5 P     U          13475</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># preview data</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl</span>(con, <span class="st">"ctd"</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cruise_id, stage, cast_dir, lat_dec, lon_dec) <span class="sc">|&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">20</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 5
   cruise_id stage cast_dir lat_dec lon_dec
   &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;
 1 9802JD    F     D           33.0   -117.
 2 9802JD    F     D           33.0   -117.
 3 9802JD    F     D           33.0   -117.
 4 9802JD    F     D           33.0   -117.
 5 9802JD    F     D           33.0   -117.
 6 9802JD    F     D           33.0   -117.
 7 9802JD    F     D           33.0   -117.
 8 9802JD    F     D           33.0   -117.
 9 9802JD    F     D           33.0   -117.
10 9802JD    F     D           33.0   -117.
11 9802JD    F     D           33.0   -117.
12 9802JD    F     D           33.0   -117.
13 9802JD    F     D           33.0   -117.
14 9802JD    F     D           33.0   -117.
15 9802JD    F     D           33.0   -117.
16 9802JD    F     D           33.0   -117.
17 9802JD    F     D           33.0   -117.
18 9802JD    F     D           33.0   -117.
19 9802JD    F     D           33.0   -117.
20 9802JD    F     D           33.0   -117.</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con, <span class="at">shutdown =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="interactive-gantt-chart" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="interactive-gantt-chart"><span class="header-section-number">11</span> Interactive Gantt Chart</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>librarian<span class="sc">::</span><span class="fu">shelf</span>(plotly, <span class="at">quiet =</span> T)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># reconnect to database</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(duckdb<span class="sc">::</span><span class="fu">duckdb</span>(), <span class="at">dbdir =</span> db_path, <span class="at">read_only =</span> T)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># tbl(con, "ctd") |&gt; </span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(n = n())</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 210,507</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl</span>(con, <span class="st">"ctd"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(study) <span class="sc">|&gt;</span> </span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(study) <span class="sc">|&gt;</span> </span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "0302JD" "0307NH" "0310NH" "0401JD" "0404JD" "0404NH" "0407JD" "0411RR"
 [9] "0501NH" "0504NH" "0507NH" "0511NH" "0602JD" "0604NH" "0607NH" "0701JD"
[17] "0907M2" "0911NH" "1001NH" "1004MF" "1008NH" "1011NH" "1101NH" "1104SH"
[25] "1108NH" "1110NH" "1202NH" "1203SH" "1207OS" "1210NH" "1301SH" "1304SH"
[33] "1307NH" "1311NH" "1402SH" "1404OS" "1407NH" "1411NH" "1501NH" "1504NH"
[41] "1507OC" "1511OC" "1601RL" "1604SH" "1607OS" "1611SR" "1701RL" "1704SH"
[49] "1708SR" "1802SH" "1804SH" "1806SR" "1810SR" "1902RL" "1904RL" "2401RL"
[57] "9802JD" "9804JD" "9807NH"</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tbl(con, "ctd") |&gt; </span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   pull(study) |&gt;</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   table(useNA = "ifany")</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  9802JD   9804JD </span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  59,005  151,502</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co"># get cruise date spans by study and stage</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>cruise_spans <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"ctd"</span>) <span class="sc">|&gt;</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(study, stage) <span class="sc">|&gt;</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">begin_date =</span> <span class="fu">min</span>(dtime_utc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_date   =</span> <span class="fu">max</span>(dtime_utc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups    =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>() <span class="sc">|&gt;</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(begin_date), <span class="sc">!</span><span class="fu">is.na</span>(end_date)) <span class="sc">|&gt;</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">year        =</span> <span class="fu">year</span>(begin_date),</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">begin_jday  =</span> <span class="fu">yday</span>(begin_date),</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_jday    =</span> <span class="fu">yday</span>(end_date),</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">stage_label =</span> <span class="fu">if_else</span>(stage <span class="sc">==</span> <span class="st">"F"</span>, <span class="st">"Final"</span>, <span class="st">"Preliminary"</span>),</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create hover text</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">hover_text =</span> <span class="fu">glue</span>(</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Cruise: {study}&lt;br&gt;"</span>,</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Stage: {stage_label}&lt;br&gt;"</span>,</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Begin: {format(begin_date, '%Y-%m-%d')}&lt;br&gt;"</span>,</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>      <span class="st">"End: {format(end_date, '%Y-%m-%d')}&lt;br&gt;"</span>,</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Duration: {as.numeric(difftime(end_date, begin_date, units = 'days'))} days"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(begin_date)</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a><span class="co"># create color mapping</span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Final"</span> <span class="ot">=</span> <span class="st">"#23d355ff"</span>, <span class="st">"Preliminary"</span> <span class="ot">=</span> <span class="st">"#A23B72"</span>)</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a><span class="co"># create interactive gantt chart</span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>()</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a><span class="co"># add traces for each cruise</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(cruise_spans)) {</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>  row <span class="ot">&lt;-</span> cruise_spans[i, ]</span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p <span class="sc">|&gt;</span></span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_trace</span>(</span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">"scatter"</span>,</span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">mode =</span> <span class="st">"lines"</span>,</span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">c</span>(row<span class="sc">$</span>begin_jday, row<span class="sc">$</span>end_jday),</span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">c</span>(row<span class="sc">$</span>year, row<span class="sc">$</span>year),</span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">line =</span> <span class="fu">list</span>(</span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> colors[row<span class="sc">$</span>stage_label],</span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>        <span class="at">width =</span> <span class="dv">8</span>),</span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> row<span class="sc">$</span>hover_text,</span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">hoverinfo =</span> <span class="st">"text"</span>,</span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">showlegend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">legendgroup =</span> row<span class="sc">$</span>stage_label)</span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a><span class="co"># add legend traces</span></span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">|&gt;</span></span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(</span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"scatter"</span>,</span>
<span id="cb32-59"><a href="#cb32-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">mode =</span> <span class="st">"lines"</span>,</span>
<span id="cb32-60"><a href="#cb32-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb32-61"><a href="#cb32-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb32-62"><a href="#cb32-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> colors[<span class="st">"Final"</span>], <span class="at">width =</span> <span class="dv">8</span>),</span>
<span id="cb32-63"><a href="#cb32-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Final"</span>,</span>
<span id="cb32-64"><a href="#cb32-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">showlegend =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb32-65"><a href="#cb32-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(</span>
<span id="cb32-66"><a href="#cb32-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"scatter"</span>,</span>
<span id="cb32-67"><a href="#cb32-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">mode =</span> <span class="st">"lines"</span>,</span>
<span id="cb32-68"><a href="#cb32-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb32-69"><a href="#cb32-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb32-70"><a href="#cb32-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> colors[<span class="st">"Preliminary"</span>], <span class="at">width =</span> <span class="dv">8</span>),</span>
<span id="cb32-71"><a href="#cb32-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Preliminary"</span>,</span>
<span id="cb32-72"><a href="#cb32-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">showlegend =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-73"><a href="#cb32-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-74"><a href="#cb32-74" aria-hidden="true" tabindex="-1"></a><span class="co"># customize layout</span></span>
<span id="cb32-75"><a href="#cb32-75" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">|&gt;</span></span>
<span id="cb32-76"><a href="#cb32-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb32-77"><a href="#cb32-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"CalCOFI CTD Cruise Timeline"</span>,</span>
<span id="cb32-78"><a href="#cb32-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(</span>
<span id="cb32-79"><a href="#cb32-79" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Day of Year"</span>,</span>
<span id="cb32-80"><a href="#cb32-80" aria-hidden="true" tabindex="-1"></a>      <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">365</span>),</span>
<span id="cb32-81"><a href="#cb32-81" aria-hidden="true" tabindex="-1"></a>      <span class="at">dtick =</span> <span class="dv">30</span>,</span>
<span id="cb32-82"><a href="#cb32-82" aria-hidden="true" tabindex="-1"></a>      <span class="at">tickangle =</span> <span class="dv">0</span>),</span>
<span id="cb32-83"><a href="#cb32-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(</span>
<span id="cb32-84"><a href="#cb32-84" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Year"</span>,</span>
<span id="cb32-85"><a href="#cb32-85" aria-hidden="true" tabindex="-1"></a>      <span class="at">autorange =</span> <span class="st">"reversed"</span>,</span>
<span id="cb32-86"><a href="#cb32-86" aria-hidden="true" tabindex="-1"></a>      <span class="at">dtick =</span> <span class="dv">1</span>),</span>
<span id="cb32-87"><a href="#cb32-87" aria-hidden="true" tabindex="-1"></a>    <span class="at">hovermode =</span> <span class="st">"closest"</span>,</span>
<span id="cb32-88"><a href="#cb32-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot_bgcolor =</span> <span class="st">"#f8f9fa"</span>,</span>
<span id="cb32-89"><a href="#cb32-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">paper_bgcolor =</span> <span class="st">"white"</span>,</span>
<span id="cb32-90"><a href="#cb32-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend =</span> <span class="fu">list</span>(</span>
<span id="cb32-91"><a href="#cb32-91" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fl">1.02</span>,</span>
<span id="cb32-92"><a href="#cb32-92" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="dv">1</span>,</span>
<span id="cb32-93"><a href="#cb32-93" aria-hidden="true" tabindex="-1"></a>      <span class="at">xanchor =</span> <span class="st">"left"</span>,</span>
<span id="cb32-94"><a href="#cb32-94" aria-hidden="true" tabindex="-1"></a>      <span class="at">yanchor =</span> <span class="st">"top"</span>))</span>
<span id="cb32-95"><a href="#cb32-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-96"><a href="#cb32-96" aria-hidden="true" tabindex="-1"></a><span class="co"># display chart</span></span>
<span id="cb32-97"><a href="#cb32-97" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-61767e55b4cbc94e50f7" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-61767e55b4cbc94e50f7">{"x":{"visdat":{"73ad6933e0e6":["function () ","plotlyVisDat"]},"cur_data":"73ad6933e0e6","attrs":{"73ad6933e0e6":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[23,41],"y":[1998,1998],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 9802JD<br>Stage: Final<br>Begin: 1998-01-23<br>End: 1998-02-10<br>Duration: 18.240787037037 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[92,112],"y":[1998,1998],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 9804JD<br>Stage: Final<br>Begin: 1998-04-02<br>End: 1998-04-22<br>Duration: 19.5483333333333 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[189,206],"y":[1998,1998],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 9807NH<br>Stage: Final<br>Begin: 1998-07-08<br>End: 1998-07-25<br>Duration: 17.4026041666667 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[30,54],"y":[2003,2003],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0302JD<br>Stage: Final<br>Begin: 2003-01-30<br>End: 2003-02-23<br>Duration: 23.8202662037037 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[198,211],"y":[2003,2003],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0307NH<br>Stage: Final<br>Begin: 2003-07-17<br>End: 2003-07-30<br>Duration: 12.2792361111111 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.5":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[293,307],"y":[2003,2003],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0310NH<br>Stage: Final<br>Begin: 2003-10-20<br>End: 2003-11-03<br>Duration: 13.9723611111111 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.6":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[6,27],"y":[2004,2004],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0401JD<br>Stage: Final<br>Begin: 2004-01-06<br>End: 2004-01-27<br>Duration: 21.5689814814815 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.7":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[83,99],"y":[2004,2004],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0404NH<br>Stage: Final<br>Begin: 2004-03-23<br>End: 2004-04-08<br>Duration: 15.9398958333333 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.8":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[105,113],"y":[2004,2004],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0404JD<br>Stage: Final<br>Begin: 2004-04-14<br>End: 2004-04-22<br>Duration: 7.41434027777778 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.9":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[195,210],"y":[2004,2004],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0407JD<br>Stage: Final<br>Begin: 2004-07-13<br>End: 2004-07-28<br>Duration: 15.3805439814815 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.10":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[307,324],"y":[2004,2004],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0411RR<br>Stage: Final<br>Begin: 2004-11-02<br>End: 2004-11-19<br>Duration: 16.8430902777778 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.11":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[4,20],"y":[2005,2005],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0501NH<br>Stage: Final<br>Begin: 2005-01-04<br>End: 2005-01-20<br>Duration: 15.6535300925926 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.12":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[105,120],"y":[2005,2005],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0504NH<br>Stage: Final<br>Begin: 2005-04-15<br>End: 2005-04-30<br>Duration: 15.3725347222222 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.13":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[182,197],"y":[2005,2005],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0507NH<br>Stage: Final<br>Begin: 2005-07-01<br>End: 2005-07-16<br>Duration: 15.3012962962963 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.14":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[308,324],"y":[2005,2005],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0511NH<br>Stage: Final<br>Begin: 2005-11-04<br>End: 2005-11-20<br>Duration: 16.2527893518519 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.15":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[34,56],"y":[2006,2006],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0602JD<br>Stage: Final<br>Begin: 2006-02-03<br>End: 2006-02-25<br>Duration: 21.8065046296296 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.16":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[91,107],"y":[2006,2006],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0604NH<br>Stage: Final<br>Begin: 2006-04-01<br>End: 2006-04-17<br>Duration: 16.2932638888889 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.17":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[189,204],"y":[2006,2006],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0607NH<br>Stage: Final<br>Begin: 2006-07-08<br>End: 2006-07-23<br>Duration: 15.380625 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.18":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[365,32],"y":[2006,2006],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0701JD<br>Stage: Final<br>Begin: 2006-12-31<br>End: 2007-02-01<br>Duration: 32.6781365740741 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.19":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[196,215],"y":[2009,2009],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0907M2<br>Stage: Final<br>Begin: 2009-07-15<br>End: 2009-08-03<br>Duration: 19.5550347222222 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.20":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[310,327],"y":[2009,2009],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 0911NH<br>Stage: Final<br>Begin: 2009-11-06<br>End: 2009-11-23<br>Duration: 16.2391087962963 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.21":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[13,35],"y":[2010,2010],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1001NH<br>Stage: Final<br>Begin: 2010-01-13<br>End: 2010-02-04<br>Duration: 22.7894907407407 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.22":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[117,137],"y":[2010,2010],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1004MF<br>Stage: Final<br>Begin: 2010-04-27<br>End: 2010-05-17<br>Duration: 20.2548958333333 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.23":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[211,228],"y":[2010,2010],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1008NH<br>Stage: Final<br>Begin: 2010-07-30<br>End: 2010-08-16<br>Duration: 16.3578356481481 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.24":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[301,316],"y":[2010,2010],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1011NH<br>Stage: Final<br>Begin: 2010-10-28<br>End: 2010-11-12<br>Duration: 14.6583796296296 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.25":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[13,35],"y":[2011,2011],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1101NH<br>Stage: Final<br>Begin: 2011-01-13<br>End: 2011-02-04<br>Duration: 22.8871759259259 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.26":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[99,116],"y":[2011,2011],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1104SH<br>Stage: Final<br>Begin: 2011-04-09<br>End: 2011-04-26<br>Duration: 16.2359722222222 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.27":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[208,224],"y":[2011,2011],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1108NH<br>Stage: Final<br>Begin: 2011-07-27<br>End: 2011-08-12<br>Duration: 15.9949537037037 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.28":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[289,305],"y":[2011,2011],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1110NH<br>Stage: Final<br>Begin: 2011-10-16<br>End: 2011-11-01<br>Duration: 15.8317013888889 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.29":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[27,43],"y":[2012,2012],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1202NH<br>Stage: Final<br>Begin: 2012-01-27<br>End: 2012-02-12<br>Duration: 15.1750462962963 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.30":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[85,97],"y":[2012,2012],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1203SH<br>Stage: Final<br>Begin: 2012-03-25<br>End: 2012-04-06<br>Duration: 12.6214814814815 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.31":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[185,208],"y":[2012,2012],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1207OS<br>Stage: Final<br>Begin: 2012-07-03<br>End: 2012-07-26<br>Duration: 22.6871875 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.32":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[293,310],"y":[2012,2012],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1210NH<br>Stage: Final<br>Begin: 2012-10-19<br>End: 2012-11-05<br>Duration: 16.2696990740741 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.33":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[366,202],"y":[2012,2012],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1307NH<br>Stage: Final<br>Begin: 2012-12-31<br>End: 2013-07-21<br>Duration: 202.929224537037 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.34":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[11,31],"y":[2013,2013],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1301SH<br>Stage: Final<br>Begin: 2013-01-11<br>End: 2013-01-31<br>Duration: 19.7567939814815 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.35":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[97,120],"y":[2013,2013],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1304SH<br>Stage: Final<br>Begin: 2013-04-07<br>End: 2013-04-30<br>Duration: 23.0080092592593 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.36":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[313,329],"y":[2013,2013],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1311NH<br>Stage: Final<br>Begin: 2013-11-09<br>End: 2013-11-25<br>Duration: 15.2674537037037 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.37":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[365,36],"y":[2013,2013],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1402SH<br>Stage: Final<br>Begin: 2013-12-31<br>End: 2014-02-05<br>Duration: 36.4493402777778 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.38":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[88,107],"y":[2014,2014],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1404OS<br>Stage: Final<br>Begin: 2014-03-29<br>End: 2014-04-17<br>Duration: 19.3900231481481 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.39":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[187,202],"y":[2014,2014],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1407NH<br>Stage: Final<br>Begin: 2014-07-06<br>End: 2014-07-21<br>Duration: 15.1643171296296 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.40":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[312,327],"y":[2014,2014],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1411NH<br>Stage: Final<br>Begin: 2014-11-08<br>End: 2014-11-23<br>Duration: 14.268587962963 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.41":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[15,36],"y":[2015,2015],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1501NH<br>Stage: Final<br>Begin: 2015-01-15<br>End: 2015-02-05<br>Duration: 20.7472222222222 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.42":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[94,109],"y":[2015,2015],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1504NH<br>Stage: Final<br>Begin: 2015-04-04<br>End: 2015-04-19<br>Duration: 14.9570023148148 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.43":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[189,205],"y":[2015,2015],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1507OC<br>Stage: Final<br>Begin: 2015-07-08<br>End: 2015-07-24<br>Duration: 16.0650462962963 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.44":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[301,317],"y":[2015,2015],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1511OC<br>Stage: Final<br>Begin: 2015-10-28<br>End: 2015-11-13<br>Duration: 15.0984143518519 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.45":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[7,29],"y":[2016,2016],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1601RL<br>Stage: Final<br>Begin: 2016-01-07<br>End: 2016-01-29<br>Duration: 22.0266898148148 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.46":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[92,113],"y":[2016,2016],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1604SH<br>Stage: Final<br>Begin: 2016-04-01<br>End: 2016-04-22<br>Duration: 20.8438425925926 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.47":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[192,208],"y":[2016,2016],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1607OS<br>Stage: Final<br>Begin: 2016-07-10<br>End: 2016-07-26<br>Duration: 15.3417708333333 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.48":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[311,326],"y":[2016,2016],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1611SR<br>Stage: Final<br>Begin: 2016-11-06<br>End: 2016-11-21<br>Duration: 14.5020023148148 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.49":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[6,28],"y":[2017,2017],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1701RL<br>Stage: Final<br>Begin: 2017-01-06<br>End: 2017-01-28<br>Duration: 21.9387615740741 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.50":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[88,110],"y":[2017,2017],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1704SH<br>Stage: Final<br>Begin: 2017-03-29<br>End: 2017-04-20<br>Duration: 22.1558680555556 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.51":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[213,228],"y":[2017,2017],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1708SR<br>Stage: Final<br>Begin: 2017-08-01<br>End: 2017-08-16<br>Duration: 14.2652777777778 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.52":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[32,41],"y":[2018,2018],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1802SH<br>Stage: Final<br>Begin: 2018-02-01<br>End: 2018-02-10<br>Duration: 8.41327546296296 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.53":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[95,116],"y":[2018,2018],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1804SH<br>Stage: Final<br>Begin: 2018-04-05<br>End: 2018-04-26<br>Duration: 20.9833796296296 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.54":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[160,175],"y":[2018,2018],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1806SR<br>Stage: Final<br>Begin: 2018-06-09<br>End: 2018-06-24<br>Duration: 14.4402083333333 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.55":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[287,302],"y":[2018,2018],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1810SR<br>Stage: Final<br>Begin: 2018-10-14<br>End: 2018-10-29<br>Duration: 14.3861111111111 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.56":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[37,43],"y":[2019,2019],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1902RL<br>Stage: Final<br>Begin: 2019-02-06<br>End: 2019-02-12<br>Duration: 5.99841435185185 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.57":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[92,107],"y":[2019,2019],"line":{"color":"#23d355ff","width":8},"text":"Cruise: 1904RL<br>Stage: Final<br>Begin: 2019-04-02<br>End: 2019-04-17<br>Duration: 14.8991666666667 days","hoverinfo":"text","showlegend":false,"legendgroup":"Final","inherit":true},"73ad6933e0e6.58":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[11,25],"y":[2024,2024],"line":{"color":"#A23B72","width":8},"text":"Cruise: 2401RL<br>Stage: Preliminary<br>Begin: 2024-01-11<br>End: 2024-01-25<br>Duration: 14.1817592592593 days","hoverinfo":"text","showlegend":false,"legendgroup":"Preliminary","inherit":true},"73ad6933e0e6.59":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[null,null],"y":[null,null],"line":{"color":"#23d355ff","width":8},"name":"Final","showlegend":true,"inherit":true},"73ad6933e0e6.60":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","x":[null,null],"y":[null,null],"line":{"color":"#A23B72","width":8},"name":"Preliminary","showlegend":true,"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"CalCOFI CTD Cruise Timeline","xaxis":{"domain":[0,1],"automargin":true,"title":"Day of Year","range":[1,365],"dtick":30,"tickangle":0},"yaxis":{"domain":[0,1],"automargin":true,"title":"Year","autorange":"reversed","dtick":1},"hovermode":"closest","plot_bgcolor":"#f8f9fa","paper_bgcolor":"white","legend":{"x":1.02,"y":1,"xanchor":"left","yanchor":"top"},"showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"type":"scatter","mode":"lines","x":[23,41],"y":[1998,1998],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 9802JD<br>Stage: Final<br>Begin: 1998-01-23<br>End: 1998-02-10<br>Duration: 18.240787037037 days","Cruise: 9802JD<br>Stage: Final<br>Begin: 1998-01-23<br>End: 1998-02-10<br>Duration: 18.240787037037 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[92,112],"y":[1998,1998],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 9804JD<br>Stage: Final<br>Begin: 1998-04-02<br>End: 1998-04-22<br>Duration: 19.5483333333333 days","Cruise: 9804JD<br>Stage: Final<br>Begin: 1998-04-02<br>End: 1998-04-22<br>Duration: 19.5483333333333 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[189,206],"y":[1998,1998],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 9807NH<br>Stage: Final<br>Begin: 1998-07-08<br>End: 1998-07-25<br>Duration: 17.4026041666667 days","Cruise: 9807NH<br>Stage: Final<br>Begin: 1998-07-08<br>End: 1998-07-25<br>Duration: 17.4026041666667 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[30,54],"y":[2003,2003],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0302JD<br>Stage: Final<br>Begin: 2003-01-30<br>End: 2003-02-23<br>Duration: 23.8202662037037 days","Cruise: 0302JD<br>Stage: Final<br>Begin: 2003-01-30<br>End: 2003-02-23<br>Duration: 23.8202662037037 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[198,211],"y":[2003,2003],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0307NH<br>Stage: Final<br>Begin: 2003-07-17<br>End: 2003-07-30<br>Duration: 12.2792361111111 days","Cruise: 0307NH<br>Stage: Final<br>Begin: 2003-07-17<br>End: 2003-07-30<br>Duration: 12.2792361111111 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[293,307],"y":[2003,2003],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0310NH<br>Stage: Final<br>Begin: 2003-10-20<br>End: 2003-11-03<br>Duration: 13.9723611111111 days","Cruise: 0310NH<br>Stage: Final<br>Begin: 2003-10-20<br>End: 2003-11-03<br>Duration: 13.9723611111111 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(140,86,75,1)","line":{"color":"rgba(140,86,75,1)"}},"error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[6,27],"y":[2004,2004],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0401JD<br>Stage: Final<br>Begin: 2004-01-06<br>End: 2004-01-27<br>Duration: 21.5689814814815 days","Cruise: 0401JD<br>Stage: Final<br>Begin: 2004-01-06<br>End: 2004-01-27<br>Duration: 21.5689814814815 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(227,119,194,1)","line":{"color":"rgba(227,119,194,1)"}},"error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[83,99],"y":[2004,2004],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0404NH<br>Stage: Final<br>Begin: 2004-03-23<br>End: 2004-04-08<br>Duration: 15.9398958333333 days","Cruise: 0404NH<br>Stage: Final<br>Begin: 2004-03-23<br>End: 2004-04-08<br>Duration: 15.9398958333333 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(127,127,127,1)","line":{"color":"rgba(127,127,127,1)"}},"error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[105,113],"y":[2004,2004],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0404JD<br>Stage: Final<br>Begin: 2004-04-14<br>End: 2004-04-22<br>Duration: 7.41434027777778 days","Cruise: 0404JD<br>Stage: Final<br>Begin: 2004-04-14<br>End: 2004-04-22<br>Duration: 7.41434027777778 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(188,189,34,1)","line":{"color":"rgba(188,189,34,1)"}},"error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[195,210],"y":[2004,2004],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0407JD<br>Stage: Final<br>Begin: 2004-07-13<br>End: 2004-07-28<br>Duration: 15.3805439814815 days","Cruise: 0407JD<br>Stage: Final<br>Begin: 2004-07-13<br>End: 2004-07-28<br>Duration: 15.3805439814815 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(23,190,207,1)","line":{"color":"rgba(23,190,207,1)"}},"error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[307,324],"y":[2004,2004],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0411RR<br>Stage: Final<br>Begin: 2004-11-02<br>End: 2004-11-19<br>Duration: 16.8430902777778 days","Cruise: 0411RR<br>Stage: Final<br>Begin: 2004-11-02<br>End: 2004-11-19<br>Duration: 16.8430902777778 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[4,20],"y":[2005,2005],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0501NH<br>Stage: Final<br>Begin: 2005-01-04<br>End: 2005-01-20<br>Duration: 15.6535300925926 days","Cruise: 0501NH<br>Stage: Final<br>Begin: 2005-01-04<br>End: 2005-01-20<br>Duration: 15.6535300925926 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[105,120],"y":[2005,2005],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0504NH<br>Stage: Final<br>Begin: 2005-04-15<br>End: 2005-04-30<br>Duration: 15.3725347222222 days","Cruise: 0504NH<br>Stage: Final<br>Begin: 2005-04-15<br>End: 2005-04-30<br>Duration: 15.3725347222222 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[182,197],"y":[2005,2005],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0507NH<br>Stage: Final<br>Begin: 2005-07-01<br>End: 2005-07-16<br>Duration: 15.3012962962963 days","Cruise: 0507NH<br>Stage: Final<br>Begin: 2005-07-01<br>End: 2005-07-16<br>Duration: 15.3012962962963 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[308,324],"y":[2005,2005],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0511NH<br>Stage: Final<br>Begin: 2005-11-04<br>End: 2005-11-20<br>Duration: 16.2527893518519 days","Cruise: 0511NH<br>Stage: Final<br>Begin: 2005-11-04<br>End: 2005-11-20<br>Duration: 16.2527893518519 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[34,56],"y":[2006,2006],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0602JD<br>Stage: Final<br>Begin: 2006-02-03<br>End: 2006-02-25<br>Duration: 21.8065046296296 days","Cruise: 0602JD<br>Stage: Final<br>Begin: 2006-02-03<br>End: 2006-02-25<br>Duration: 21.8065046296296 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(140,86,75,1)","line":{"color":"rgba(140,86,75,1)"}},"error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[91,107],"y":[2006,2006],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0604NH<br>Stage: Final<br>Begin: 2006-04-01<br>End: 2006-04-17<br>Duration: 16.2932638888889 days","Cruise: 0604NH<br>Stage: Final<br>Begin: 2006-04-01<br>End: 2006-04-17<br>Duration: 16.2932638888889 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(227,119,194,1)","line":{"color":"rgba(227,119,194,1)"}},"error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[189,204],"y":[2006,2006],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0607NH<br>Stage: Final<br>Begin: 2006-07-08<br>End: 2006-07-23<br>Duration: 15.380625 days","Cruise: 0607NH<br>Stage: Final<br>Begin: 2006-07-08<br>End: 2006-07-23<br>Duration: 15.380625 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(127,127,127,1)","line":{"color":"rgba(127,127,127,1)"}},"error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[365,32],"y":[2006,2006],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0701JD<br>Stage: Final<br>Begin: 2006-12-31<br>End: 2007-02-01<br>Duration: 32.6781365740741 days","Cruise: 0701JD<br>Stage: Final<br>Begin: 2006-12-31<br>End: 2007-02-01<br>Duration: 32.6781365740741 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(188,189,34,1)","line":{"color":"rgba(188,189,34,1)"}},"error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[196,215],"y":[2009,2009],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0907M2<br>Stage: Final<br>Begin: 2009-07-15<br>End: 2009-08-03<br>Duration: 19.5550347222222 days","Cruise: 0907M2<br>Stage: Final<br>Begin: 2009-07-15<br>End: 2009-08-03<br>Duration: 19.5550347222222 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(23,190,207,1)","line":{"color":"rgba(23,190,207,1)"}},"error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[310,327],"y":[2009,2009],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 0911NH<br>Stage: Final<br>Begin: 2009-11-06<br>End: 2009-11-23<br>Duration: 16.2391087962963 days","Cruise: 0911NH<br>Stage: Final<br>Begin: 2009-11-06<br>End: 2009-11-23<br>Duration: 16.2391087962963 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[13,35],"y":[2010,2010],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1001NH<br>Stage: Final<br>Begin: 2010-01-13<br>End: 2010-02-04<br>Duration: 22.7894907407407 days","Cruise: 1001NH<br>Stage: Final<br>Begin: 2010-01-13<br>End: 2010-02-04<br>Duration: 22.7894907407407 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[117,137],"y":[2010,2010],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1004MF<br>Stage: Final<br>Begin: 2010-04-27<br>End: 2010-05-17<br>Duration: 20.2548958333333 days","Cruise: 1004MF<br>Stage: Final<br>Begin: 2010-04-27<br>End: 2010-05-17<br>Duration: 20.2548958333333 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[211,228],"y":[2010,2010],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1008NH<br>Stage: Final<br>Begin: 2010-07-30<br>End: 2010-08-16<br>Duration: 16.3578356481481 days","Cruise: 1008NH<br>Stage: Final<br>Begin: 2010-07-30<br>End: 2010-08-16<br>Duration: 16.3578356481481 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[301,316],"y":[2010,2010],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1011NH<br>Stage: Final<br>Begin: 2010-10-28<br>End: 2010-11-12<br>Duration: 14.6583796296296 days","Cruise: 1011NH<br>Stage: Final<br>Begin: 2010-10-28<br>End: 2010-11-12<br>Duration: 14.6583796296296 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[13,35],"y":[2011,2011],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1101NH<br>Stage: Final<br>Begin: 2011-01-13<br>End: 2011-02-04<br>Duration: 22.8871759259259 days","Cruise: 1101NH<br>Stage: Final<br>Begin: 2011-01-13<br>End: 2011-02-04<br>Duration: 22.8871759259259 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(140,86,75,1)","line":{"color":"rgba(140,86,75,1)"}},"error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[99,116],"y":[2011,2011],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1104SH<br>Stage: Final<br>Begin: 2011-04-09<br>End: 2011-04-26<br>Duration: 16.2359722222222 days","Cruise: 1104SH<br>Stage: Final<br>Begin: 2011-04-09<br>End: 2011-04-26<br>Duration: 16.2359722222222 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(227,119,194,1)","line":{"color":"rgba(227,119,194,1)"}},"error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[208,224],"y":[2011,2011],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1108NH<br>Stage: Final<br>Begin: 2011-07-27<br>End: 2011-08-12<br>Duration: 15.9949537037037 days","Cruise: 1108NH<br>Stage: Final<br>Begin: 2011-07-27<br>End: 2011-08-12<br>Duration: 15.9949537037037 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(127,127,127,1)","line":{"color":"rgba(127,127,127,1)"}},"error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[289,305],"y":[2011,2011],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1110NH<br>Stage: Final<br>Begin: 2011-10-16<br>End: 2011-11-01<br>Duration: 15.8317013888889 days","Cruise: 1110NH<br>Stage: Final<br>Begin: 2011-10-16<br>End: 2011-11-01<br>Duration: 15.8317013888889 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(188,189,34,1)","line":{"color":"rgba(188,189,34,1)"}},"error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[27,43],"y":[2012,2012],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1202NH<br>Stage: Final<br>Begin: 2012-01-27<br>End: 2012-02-12<br>Duration: 15.1750462962963 days","Cruise: 1202NH<br>Stage: Final<br>Begin: 2012-01-27<br>End: 2012-02-12<br>Duration: 15.1750462962963 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(23,190,207,1)","line":{"color":"rgba(23,190,207,1)"}},"error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[85,97],"y":[2012,2012],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1203SH<br>Stage: Final<br>Begin: 2012-03-25<br>End: 2012-04-06<br>Duration: 12.6214814814815 days","Cruise: 1203SH<br>Stage: Final<br>Begin: 2012-03-25<br>End: 2012-04-06<br>Duration: 12.6214814814815 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[185,208],"y":[2012,2012],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1207OS<br>Stage: Final<br>Begin: 2012-07-03<br>End: 2012-07-26<br>Duration: 22.6871875 days","Cruise: 1207OS<br>Stage: Final<br>Begin: 2012-07-03<br>End: 2012-07-26<br>Duration: 22.6871875 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[293,310],"y":[2012,2012],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1210NH<br>Stage: Final<br>Begin: 2012-10-19<br>End: 2012-11-05<br>Duration: 16.2696990740741 days","Cruise: 1210NH<br>Stage: Final<br>Begin: 2012-10-19<br>End: 2012-11-05<br>Duration: 16.2696990740741 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[366,202],"y":[2012,2012],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1307NH<br>Stage: Final<br>Begin: 2012-12-31<br>End: 2013-07-21<br>Duration: 202.929224537037 days","Cruise: 1307NH<br>Stage: Final<br>Begin: 2012-12-31<br>End: 2013-07-21<br>Duration: 202.929224537037 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[11,31],"y":[2013,2013],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1301SH<br>Stage: Final<br>Begin: 2013-01-11<br>End: 2013-01-31<br>Duration: 19.7567939814815 days","Cruise: 1301SH<br>Stage: Final<br>Begin: 2013-01-11<br>End: 2013-01-31<br>Duration: 19.7567939814815 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[97,120],"y":[2013,2013],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1304SH<br>Stage: Final<br>Begin: 2013-04-07<br>End: 2013-04-30<br>Duration: 23.0080092592593 days","Cruise: 1304SH<br>Stage: Final<br>Begin: 2013-04-07<br>End: 2013-04-30<br>Duration: 23.0080092592593 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(140,86,75,1)","line":{"color":"rgba(140,86,75,1)"}},"error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[313,329],"y":[2013,2013],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1311NH<br>Stage: Final<br>Begin: 2013-11-09<br>End: 2013-11-25<br>Duration: 15.2674537037037 days","Cruise: 1311NH<br>Stage: Final<br>Begin: 2013-11-09<br>End: 2013-11-25<br>Duration: 15.2674537037037 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(227,119,194,1)","line":{"color":"rgba(227,119,194,1)"}},"error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[365,36],"y":[2013,2013],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1402SH<br>Stage: Final<br>Begin: 2013-12-31<br>End: 2014-02-05<br>Duration: 36.4493402777778 days","Cruise: 1402SH<br>Stage: Final<br>Begin: 2013-12-31<br>End: 2014-02-05<br>Duration: 36.4493402777778 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(127,127,127,1)","line":{"color":"rgba(127,127,127,1)"}},"error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[88,107],"y":[2014,2014],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1404OS<br>Stage: Final<br>Begin: 2014-03-29<br>End: 2014-04-17<br>Duration: 19.3900231481481 days","Cruise: 1404OS<br>Stage: Final<br>Begin: 2014-03-29<br>End: 2014-04-17<br>Duration: 19.3900231481481 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(188,189,34,1)","line":{"color":"rgba(188,189,34,1)"}},"error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[187,202],"y":[2014,2014],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1407NH<br>Stage: Final<br>Begin: 2014-07-06<br>End: 2014-07-21<br>Duration: 15.1643171296296 days","Cruise: 1407NH<br>Stage: Final<br>Begin: 2014-07-06<br>End: 2014-07-21<br>Duration: 15.1643171296296 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(23,190,207,1)","line":{"color":"rgba(23,190,207,1)"}},"error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[312,327],"y":[2014,2014],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1411NH<br>Stage: Final<br>Begin: 2014-11-08<br>End: 2014-11-23<br>Duration: 14.268587962963 days","Cruise: 1411NH<br>Stage: Final<br>Begin: 2014-11-08<br>End: 2014-11-23<br>Duration: 14.268587962963 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[15,36],"y":[2015,2015],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1501NH<br>Stage: Final<br>Begin: 2015-01-15<br>End: 2015-02-05<br>Duration: 20.7472222222222 days","Cruise: 1501NH<br>Stage: Final<br>Begin: 2015-01-15<br>End: 2015-02-05<br>Duration: 20.7472222222222 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[94,109],"y":[2015,2015],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1504NH<br>Stage: Final<br>Begin: 2015-04-04<br>End: 2015-04-19<br>Duration: 14.9570023148148 days","Cruise: 1504NH<br>Stage: Final<br>Begin: 2015-04-04<br>End: 2015-04-19<br>Duration: 14.9570023148148 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[189,205],"y":[2015,2015],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1507OC<br>Stage: Final<br>Begin: 2015-07-08<br>End: 2015-07-24<br>Duration: 16.0650462962963 days","Cruise: 1507OC<br>Stage: Final<br>Begin: 2015-07-08<br>End: 2015-07-24<br>Duration: 16.0650462962963 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[301,317],"y":[2015,2015],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1511OC<br>Stage: Final<br>Begin: 2015-10-28<br>End: 2015-11-13<br>Duration: 15.0984143518519 days","Cruise: 1511OC<br>Stage: Final<br>Begin: 2015-10-28<br>End: 2015-11-13<br>Duration: 15.0984143518519 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[7,29],"y":[2016,2016],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1601RL<br>Stage: Final<br>Begin: 2016-01-07<br>End: 2016-01-29<br>Duration: 22.0266898148148 days","Cruise: 1601RL<br>Stage: Final<br>Begin: 2016-01-07<br>End: 2016-01-29<br>Duration: 22.0266898148148 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(140,86,75,1)","line":{"color":"rgba(140,86,75,1)"}},"error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[92,113],"y":[2016,2016],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1604SH<br>Stage: Final<br>Begin: 2016-04-01<br>End: 2016-04-22<br>Duration: 20.8438425925926 days","Cruise: 1604SH<br>Stage: Final<br>Begin: 2016-04-01<br>End: 2016-04-22<br>Duration: 20.8438425925926 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(227,119,194,1)","line":{"color":"rgba(227,119,194,1)"}},"error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[192,208],"y":[2016,2016],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1607OS<br>Stage: Final<br>Begin: 2016-07-10<br>End: 2016-07-26<br>Duration: 15.3417708333333 days","Cruise: 1607OS<br>Stage: Final<br>Begin: 2016-07-10<br>End: 2016-07-26<br>Duration: 15.3417708333333 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(127,127,127,1)","line":{"color":"rgba(127,127,127,1)"}},"error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[311,326],"y":[2016,2016],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1611SR<br>Stage: Final<br>Begin: 2016-11-06<br>End: 2016-11-21<br>Duration: 14.5020023148148 days","Cruise: 1611SR<br>Stage: Final<br>Begin: 2016-11-06<br>End: 2016-11-21<br>Duration: 14.5020023148148 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(188,189,34,1)","line":{"color":"rgba(188,189,34,1)"}},"error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[6,28],"y":[2017,2017],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1701RL<br>Stage: Final<br>Begin: 2017-01-06<br>End: 2017-01-28<br>Duration: 21.9387615740741 days","Cruise: 1701RL<br>Stage: Final<br>Begin: 2017-01-06<br>End: 2017-01-28<br>Duration: 21.9387615740741 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(23,190,207,1)","line":{"color":"rgba(23,190,207,1)"}},"error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[88,110],"y":[2017,2017],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1704SH<br>Stage: Final<br>Begin: 2017-03-29<br>End: 2017-04-20<br>Duration: 22.1558680555556 days","Cruise: 1704SH<br>Stage: Final<br>Begin: 2017-03-29<br>End: 2017-04-20<br>Duration: 22.1558680555556 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[213,228],"y":[2017,2017],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1708SR<br>Stage: Final<br>Begin: 2017-08-01<br>End: 2017-08-16<br>Duration: 14.2652777777778 days","Cruise: 1708SR<br>Stage: Final<br>Begin: 2017-08-01<br>End: 2017-08-16<br>Duration: 14.2652777777778 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[32,41],"y":[2018,2018],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1802SH<br>Stage: Final<br>Begin: 2018-02-01<br>End: 2018-02-10<br>Duration: 8.41327546296296 days","Cruise: 1802SH<br>Stage: Final<br>Begin: 2018-02-01<br>End: 2018-02-10<br>Duration: 8.41327546296296 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[95,116],"y":[2018,2018],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1804SH<br>Stage: Final<br>Begin: 2018-04-05<br>End: 2018-04-26<br>Duration: 20.9833796296296 days","Cruise: 1804SH<br>Stage: Final<br>Begin: 2018-04-05<br>End: 2018-04-26<br>Duration: 20.9833796296296 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[160,175],"y":[2018,2018],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1806SR<br>Stage: Final<br>Begin: 2018-06-09<br>End: 2018-06-24<br>Duration: 14.4402083333333 days","Cruise: 1806SR<br>Stage: Final<br>Begin: 2018-06-09<br>End: 2018-06-24<br>Duration: 14.4402083333333 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[287,302],"y":[2018,2018],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1810SR<br>Stage: Final<br>Begin: 2018-10-14<br>End: 2018-10-29<br>Duration: 14.3861111111111 days","Cruise: 1810SR<br>Stage: Final<br>Begin: 2018-10-14<br>End: 2018-10-29<br>Duration: 14.3861111111111 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(140,86,75,1)","line":{"color":"rgba(140,86,75,1)"}},"error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[37,43],"y":[2019,2019],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1902RL<br>Stage: Final<br>Begin: 2019-02-06<br>End: 2019-02-12<br>Duration: 5.99841435185185 days","Cruise: 1902RL<br>Stage: Final<br>Begin: 2019-02-06<br>End: 2019-02-12<br>Duration: 5.99841435185185 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(227,119,194,1)","line":{"color":"rgba(227,119,194,1)"}},"error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[92,107],"y":[2019,2019],"line":{"color":"#23d355ff","width":8},"text":["Cruise: 1904RL<br>Stage: Final<br>Begin: 2019-04-02<br>End: 2019-04-17<br>Duration: 14.8991666666667 days","Cruise: 1904RL<br>Stage: Final<br>Begin: 2019-04-02<br>End: 2019-04-17<br>Duration: 14.8991666666667 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Final","marker":{"color":"rgba(127,127,127,1)","line":{"color":"rgba(127,127,127,1)"}},"error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","x":[11,25],"y":[2024,2024],"line":{"color":"#A23B72","width":8},"text":["Cruise: 2401RL<br>Stage: Preliminary<br>Begin: 2024-01-11<br>End: 2024-01-25<br>Duration: 14.1817592592593 days","Cruise: 2401RL<br>Stage: Preliminary<br>Begin: 2024-01-11<br>End: 2024-01-25<br>Duration: 14.1817592592593 days"],"hoverinfo":["text","text"],"showlegend":false,"legendgroup":"Preliminary","marker":{"color":"rgba(188,189,34,1)","line":{"color":"rgba(188,189,34,1)"}},"error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","line":{"color":"#23d355ff","width":8},"showlegend":true,"marker":{"color":"rgba(23,190,207,1)","line":{"color":"rgba(23,190,207,1)"}},"error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","mode":"lines","line":{"color":"#A23B72","width":8},"showlegend":true,"marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># disconnect</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con, <span class="at">shutdown =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb34" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Scrape &amp; Ingest CalCOFI CTD Data into DuckDB"</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> html</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>This notebook scrapes CalCOFI CTD data from <span class="ot">&lt;https://calcofi.org/data/oceanographic-data/ctd-cast-files/&gt;</span>, downloads only **final** and **preliminary** CTD files, and ingests them into a DuckDB database.</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="fu">### Key Features</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Web Scraping**: Scrapes for all CTD .zip download links</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Smart Filtering**:</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Downloads all .zip files for archival completeness</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Only unzips <span class="in">`final`</span> (e.g., 20-2105SH_CTDFinalQC.zip) and <span class="in">`preliminary`</span> (e.g., 20-2507SR_CTDPrelim.zip) files</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Skips unzipping raw/cast/test files to save disk space</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Download &amp; Unzip**: Downloads all zip files to <span class="in">`~/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download`</span> but only extracts final and preliminary data</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Priority-based Selection**:</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>For each cruise (identified by yy-yymm + ship code), selects final if available</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Falls back to preliminary if final not available for that cruise</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Completely excludes raw/test/prodo cast files</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>**Union Strategy**:</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Merges upcast (U) and downcast (D) CSV files into single "ctd" table</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Adds <span class="in">`stage`</span> flag: "F" for final, "P" for preliminary</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Adds <span class="in">`cast_dir`</span> flag: "U" for upcast, "D" for downcast</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a><span class="ss">6.  </span>**Data Standardization**:</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Converts all column names to <span class="in">`lower_snake_case`</span> using <span class="in">`janitor::clean_names()`</span></span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Creates spatial index on <span class="in">`lat_dec`</span> and <span class="in">`lon_dec`</span> fields</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Preserves <span class="in">`cruise_id`</span> and <span class="in">`source_file`</span> metadata</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a><span class="fu">### Usage</span></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>To run the notebook:</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>quarto<span class="sc">::</span><span class="fu">quarto_render</span>(<span class="st">"scrape_ctd.qmd"</span>)</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a><span class="fu">### Notes</span></span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>All .zip files are downloaded for archival purposes, but only final/prelim are unzipped</span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Only processes CSV files from final (<span class="in">`db-csvs/*.csv`</span>) and preliminary directories</span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Downloads can be resumed (already-downloaded files are skipped)</span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Both upcast (U) and downcast (D) profiles are included in the database</span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The priority system ensures you only get final data when available, otherwise preliminary</span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Spatial index enables efficient geographic queries on lat_dec and lon_dec</span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a><span class="fu">## Setup</span></span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-60"><a href="#cb34-60" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup}</span></span>
<span id="cb34-61"><a href="#cb34-61" aria-hidden="true" tabindex="-1"></a>librarian<span class="sc">::</span><span class="fu">shelf</span>(</span>
<span id="cb34-62"><a href="#cb34-62" aria-hidden="true" tabindex="-1"></a>  dplyr, DBI, DT, duckdb, fs, glue, here, httr, janitor, lubridate, purrr, readr, rvest, sf, stringr, tibble, tidyr, zip,</span>
<span id="cb34-63"><a href="#cb34-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">quiet =</span> T)</span>
<span id="cb34-64"><a href="#cb34-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-65"><a href="#cb34-65" aria-hidden="true" tabindex="-1"></a><span class="co"># set download directory</span></span>
<span id="cb34-66"><a href="#cb34-66" aria-hidden="true" tabindex="-1"></a>dir_dl  <span class="ot">&lt;-</span> <span class="st">"~/My Drive/projects/calcofi/data/calcofi.org/ctd-cast/download"</span></span>
<span id="cb34-67"><a href="#cb34-67" aria-hidden="true" tabindex="-1"></a>dir_dl  <span class="ot">&lt;-</span> <span class="fu">path_expand</span>(dir_dl)</span>
<span id="cb34-68"><a href="#cb34-68" aria-hidden="true" tabindex="-1"></a>db_path <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"{dir_dl}/calcofi-ctd.duckdb"</span>)</span>
<span id="cb34-69"><a href="#cb34-69" aria-hidden="true" tabindex="-1"></a>db_redo <span class="ot">&lt;-</span> T  <span class="co"># set to TRUE to re-download and re-ingest</span></span>
<span id="cb34-70"><a href="#cb34-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-71"><a href="#cb34-71" aria-hidden="true" tabindex="-1"></a><span class="co"># create directory if it doesn't exist</span></span>
<span id="cb34-72"><a href="#cb34-72" aria-hidden="true" tabindex="-1"></a><span class="fu">dir_create</span>(dir_dl, <span class="at">recurse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-73"><a href="#cb34-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-74"><a href="#cb34-74" aria-hidden="true" tabindex="-1"></a><span class="co"># delete if exixsts (for fresh run)</span></span>
<span id="cb34-75"><a href="#cb34-75" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file_exists</span>(db_path) <span class="sc">&amp;</span> db_redo)</span>
<span id="cb34-76"><a href="#cb34-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file_delete</span>(db_path)</span>
<span id="cb34-77"><a href="#cb34-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-78"><a href="#cb34-78" aria-hidden="true" tabindex="-1"></a><span class="co"># setup duckdb with spatial extension</span></span>
<span id="cb34-79"><a href="#cb34-79" aria-hidden="true" tabindex="-1"></a><span class="co"># dbDisconnect(con, shutdown = TRUE)</span></span>
<span id="cb34-80"><a href="#cb34-80" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(duckdb<span class="sc">::</span><span class="fu">duckdb</span>(), <span class="at">dbdir =</span> db_path)</span>
<span id="cb34-81"><a href="#cb34-81" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con, <span class="st">"INSTALL spatial;"</span>)</span>
<span id="cb34-82"><a href="#cb34-82" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con, <span class="st">"LOAD spatial;"</span>)</span>
<span id="cb34-83"><a href="#cb34-83" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-84"><a href="#cb34-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-85"><a href="#cb34-85" aria-hidden="true" tabindex="-1"></a><span class="fu">## Scrape CTD Download Links</span></span>
<span id="cb34-86"><a href="#cb34-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-87"><a href="#cb34-87" aria-hidden="true" tabindex="-1"></a><span class="in">```{r scrape-links}</span></span>
<span id="cb34-88"><a href="#cb34-88" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://calcofi.org/data/oceanographic-data/ctd-cast-files/"</span></span>
<span id="cb34-89"><a href="#cb34-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-90"><a href="#cb34-90" aria-hidden="true" tabindex="-1"></a><span class="co"># read the web page</span></span>
<span id="cb34-91"><a href="#cb34-91" aria-hidden="true" tabindex="-1"></a>page <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url)</span>
<span id="cb34-92"><a href="#cb34-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-93"><a href="#cb34-93" aria-hidden="true" tabindex="-1"></a><span class="co"># extract all .zip download links</span></span>
<span id="cb34-94"><a href="#cb34-94" aria-hidden="true" tabindex="-1"></a>zip_links <span class="ot">&lt;-</span> page <span class="sc">|&gt;</span></span>
<span id="cb34-95"><a href="#cb34-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">"a[href$='.zip']"</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-96"><a href="#cb34-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_attr</span>(<span class="st">"href"</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-97"><a href="#cb34-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">url =</span> _) <span class="sc">|&gt;</span> </span>
<span id="cb34-98"><a href="#cb34-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-99"><a href="#cb34-99" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ensure full URLs</span></span>
<span id="cb34-100"><a href="#cb34-100" aria-hidden="true" tabindex="-1"></a>    <span class="at">url       =</span> <span class="fu">if_else</span>(</span>
<span id="cb34-101"><a href="#cb34-101" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_starts</span>(url, <span class="st">"http"</span>),</span>
<span id="cb34-102"><a href="#cb34-102" aria-hidden="true" tabindex="-1"></a>      url,</span>
<span id="cb34-103"><a href="#cb34-103" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"https://calcofi.org"</span>, url)),</span>
<span id="cb34-104"><a href="#cb34-104" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract filename</span></span>
<span id="cb34-105"><a href="#cb34-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename  =</span> <span class="fu">basename</span>(url),</span>
<span id="cb34-106"><a href="#cb34-106" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract year from URL path</span></span>
<span id="cb34-107"><a href="#cb34-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">year      =</span> <span class="fu">str_extract</span>(url, <span class="st">"/(</span><span class="sc">\\</span><span class="st">d{4})/"</span>, <span class="at">group =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">as.integer</span>(),</span>
<span id="cb34-108"><a href="#cb34-108" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract month from URL path</span></span>
<span id="cb34-109"><a href="#cb34-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">month     =</span> <span class="fu">str_match</span>(url, <span class="st">"-</span><span class="sc">\\</span><span class="st">d{2}(</span><span class="sc">\\</span><span class="st">d{2})"</span>)[,<span class="dv">2</span>] <span class="sc">|&gt;</span> <span class="fu">as.integer</span>(),</span>
<span id="cb34-110"><a href="#cb34-110" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract cruise identifier (yymm + ship code)</span></span>
<span id="cb34-111"><a href="#cb34-111" aria-hidden="true" tabindex="-1"></a>    <span class="at">cruise_id =</span> <span class="fu">str_extract</span>(filename, <span class="st">"</span><span class="sc">\\</span><span class="st">d{2}-(</span><span class="sc">\\</span><span class="st">d{4}[A-Z]{2})"</span>, <span class="at">group =</span> <span class="dv">1</span>),</span>
<span id="cb34-112"><a href="#cb34-112" aria-hidden="true" tabindex="-1"></a>    <span class="co"># classify data type based on filename patterns</span></span>
<span id="cb34-113"><a href="#cb34-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">data_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb34-114"><a href="#cb34-114" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(filename, <span class="st">"CTDFinal"</span>)         <span class="sc">~</span> <span class="st">"final"</span>,</span>
<span id="cb34-115"><a href="#cb34-115" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(filename, <span class="st">"CTDPrelim"</span>)        <span class="sc">~</span> <span class="st">"preliminary"</span>,</span>
<span id="cb34-116"><a href="#cb34-116" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(filename, <span class="st">"CTDCast|CTD_Cast"</span>) <span class="sc">~</span> <span class="st">"raw"</span>,</span>
<span id="cb34-117"><a href="#cb34-117" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(filename, <span class="st">"CTDTest"</span>)          <span class="sc">~</span> <span class="st">"test"</span>,</span>
<span id="cb34-118"><a href="#cb34-118" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span>                                     <span class="sc">~</span> <span class="st">"other"</span>))</span>
<span id="cb34-119"><a href="#cb34-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-120"><a href="#cb34-120" aria-hidden="true" tabindex="-1"></a><span class="co"># stop if other detected</span></span>
<span id="cb34-121"><a href="#cb34-121" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(zip_links<span class="sc">$</span>data_type <span class="sc">==</span> <span class="st">"other"</span>)) {</span>
<span id="cb34-122"><a href="#cb34-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"Unknown data_type detected in filenames"</span>)</span>
<span id="cb34-123"><a href="#cb34-123" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-124"><a href="#cb34-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-125"><a href="#cb34-125" aria-hidden="true" tabindex="-1"></a><span class="co"># show summary (all files)</span></span>
<span id="cb34-126"><a href="#cb34-126" aria-hidden="true" tabindex="-1"></a>zip_links <span class="sc">|&gt;</span> </span>
<span id="cb34-127"><a href="#cb34-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-128"><a href="#cb34-128" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="fu">glue</span>(<span class="st">"&lt;a href={url}&gt;{filename}&lt;/a&gt;"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb34-129"><a href="#cb34-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>url) <span class="sc">|&gt;</span></span>
<span id="cb34-130"><a href="#cb34-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(</span>
<span id="cb34-131"><a href="#cb34-131" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"All zip links to download"</span>,</span>
<span id="cb34-132"><a href="#cb34-132" aria-hidden="true" tabindex="-1"></a>    <span class="at">escape  =</span> F)</span>
<span id="cb34-133"><a href="#cb34-133" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-134"><a href="#cb34-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-135"><a href="#cb34-135" aria-hidden="true" tabindex="-1"></a><span class="fu">## Download and Unzip Files</span></span>
<span id="cb34-136"><a href="#cb34-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-137"><a href="#cb34-137" aria-hidden="true" tabindex="-1"></a><span class="in">```{r download-unzip}</span></span>
<span id="cb34-138"><a href="#cb34-138" aria-hidden="true" tabindex="-1"></a><span class="co"># function to download and optionally unzip a file</span></span>
<span id="cb34-139"><a href="#cb34-139" aria-hidden="true" tabindex="-1"></a>download_and_unzip <span class="ot">&lt;-</span> <span class="cf">function</span>(url, dest_dir, filename, data_type, <span class="at">unzip =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb34-140"><a href="#cb34-140" aria-hidden="true" tabindex="-1"></a>  dest_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dest_dir, filename)</span>
<span id="cb34-141"><a href="#cb34-141" aria-hidden="true" tabindex="-1"></a>  dir_unzip <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dest_dir, <span class="fu">str_remove</span>(filename, <span class="st">"</span><span class="sc">\\</span><span class="st">.zip$"</span>))</span>
<span id="cb34-142"><a href="#cb34-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-143"><a href="#cb34-143" aria-hidden="true" tabindex="-1"></a>  <span class="co"># skip if already downloaded</span></span>
<span id="cb34-144"><a href="#cb34-144" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">file_exists</span>(dest_file)) {</span>
<span id="cb34-145"><a href="#cb34-145" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Already exists: {filename}"</span>))</span>
<span id="cb34-146"><a href="#cb34-146" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb34-147"><a href="#cb34-147" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Downloading: {filename}"</span>))</span>
<span id="cb34-148"><a href="#cb34-148" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download.file</span>(url, dest_file, <span class="at">mode =</span> <span class="st">"wb"</span>)</span>
<span id="cb34-149"><a href="#cb34-149" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-150"><a href="#cb34-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-151"><a href="#cb34-151" aria-hidden="true" tabindex="-1"></a>  <span class="co"># skip if already unzipped</span></span>
<span id="cb34-152"><a href="#cb34-152" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (unzip <span class="sc">&amp;&amp;</span> <span class="fu">dir_exists</span>(dir_unzip)) {</span>
<span id="cb34-153"><a href="#cb34-153" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Already unzipped: {filename}"</span>))</span>
<span id="cb34-154"><a href="#cb34-154" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb34-155"><a href="#cb34-155" aria-hidden="true" tabindex="-1"></a>    <span class="co"># only unzip if final or preliminary (case-insensitive)</span></span>
<span id="cb34-156"><a href="#cb34-156" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (unzip <span class="sc">&amp;&amp;</span> <span class="fu">str_detect</span>(filename, <span class="fu">regex</span>(<span class="st">"(final|prelim)"</span>, <span class="at">ignore_case =</span> T))) {</span>
<span id="cb34-157"><a href="#cb34-157" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Unzipping: {filename}"</span>))</span>
<span id="cb34-158"><a href="#cb34-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-159"><a href="#cb34-159" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dir_create</span>(dir_unzip, <span class="at">recurse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-160"><a href="#cb34-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-161"><a href="#cb34-161" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unzip</span>(dest_file, <span class="at">exdir =</span> dir_unzip)</span>
<span id="cb34-162"><a href="#cb34-162" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (unzip) {</span>
<span id="cb34-163"><a href="#cb34-163" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Skipping unzip (not final/prelim): {filename}"</span>))</span>
<span id="cb34-164"><a href="#cb34-164" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-165"><a href="#cb34-165" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-166"><a href="#cb34-166" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-167"><a href="#cb34-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-168"><a href="#cb34-168" aria-hidden="true" tabindex="-1"></a><span class="co"># download all files, but only unzip final and preliminary</span></span>
<span id="cb34-169"><a href="#cb34-169" aria-hidden="true" tabindex="-1"></a>zip_links <span class="sc">|&gt;</span></span>
<span id="cb34-170"><a href="#cb34-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pwalk</span>(<span class="cf">function</span>(url, filename, data_type, ...) {</span>
<span id="cb34-171"><a href="#cb34-171" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download_and_unzip</span>(url, dir_dl, filename, data_type, <span class="at">unzip =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-172"><a href="#cb34-172" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb34-173"><a href="#cb34-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-174"><a href="#cb34-174" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Download and extraction complete!"</span>)</span>
<span id="cb34-175"><a href="#cb34-175" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-176"><a href="#cb34-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-177"><a href="#cb34-177" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>2025-Jul:</span>
<span id="cb34-178"><a href="#cb34-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-179"><a href="#cb34-179" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Preliminary CTD 1m-Binned\</span>
<span id="cb34-180"><a href="#cb34-180" aria-hidden="true" tabindex="-1"></a>        <span class="co">[</span><span class="ot">20-2507SR_CTD**Prelim**.zip</span><span class="co">](https://calcofi.org/downloads/2025/20-2507SR_CTDPrelim.zip)</span>\</span>
<span id="cb34-181"><a href="#cb34-181" aria-hidden="true" tabindex="-1"></a>        **Preliminary CTD 1m-Binned**: Raw CTD sensor data that have gone through SBE Data Processing, and obvious bad sensor readings have been flagged during initial QAQC. Bottle data has not yet been merged with the CTD data. CTD Salinity, Oxygen, Fluorescence, and Nitrate profiles have not been corrected to the bottle data. Cruise corrected Nitrate sensor data (EstNO3_CruiseCorr) has been converted from raw voltage using a sensor calibration done before each cruise, but not yet corrected using CTD vs. Bottle regressions.&nbsp;</span>
<span id="cb34-182"><a href="#cb34-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-183"><a href="#cb34-183" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>2021-Jul:</span>
<span id="cb34-184"><a href="#cb34-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-185"><a href="#cb34-185" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>~~Prodo Cast~~ Raw CTD Data\</span>
<span id="cb34-186"><a href="#cb34-186" aria-hidden="true" tabindex="-1"></a>        <span class="co">[</span><span class="ot">20-2107SR_CTD**Cast**.zip</span><span class="co">](https://calcofi.org/downloads/2021/20-2107SR_CTDCast.zip)</span></span>
<span id="cb34-187"><a href="#cb34-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-188"><a href="#cb34-188" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Preliminary CTD &amp; Bottle 1m-Binned\</span>
<span id="cb34-189"><a href="#cb34-189" aria-hidden="true" tabindex="-1"></a>        <span class="co">[</span><span class="ot">20-2107SR_CTD**Prelim**.zip</span><span class="co">](https://calcofi.org/downloads/2021/20-2107SR_CTDPrelim.zip)</span>\</span>
<span id="cb34-190"><a href="#cb34-190" aria-hidden="true" tabindex="-1"></a>        **Preliminary CTD &amp; Bottle 1m-Binned**: Preliminary CTD sensor data that have been merged with QAQC’ed bottle data. CTD Salinity, Oxygen, Fluorescence, and Nitrate profiles have been corrected using CTD vs. bottle regressions.&nbsp;</span>
<span id="cb34-191"><a href="#cb34-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-192"><a href="#cb34-192" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>2021-May:</span>
<span id="cb34-193"><a href="#cb34-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-194"><a href="#cb34-194" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Raw CTD Data\</span>
<span id="cb34-195"><a href="#cb34-195" aria-hidden="true" tabindex="-1"></a>        <span class="co">[</span><span class="ot">20-2105SH_CTD**Cast**.zip</span><span class="co">](https://calcofi.org/downloads/2021/20-2105SH_CTDCast.zip)</span>\</span>
<span id="cb34-196"><a href="#cb34-196" aria-hidden="true" tabindex="-1"></a>        **Raw CTD Data**: Data files (.xmlcon, .hex, .bl, .nav, .prn, .mrk, .hdr) directly from SBE Software (<span class="co">[</span><span class="ot">Sea-Bird Scientific</span><span class="co">](https://www.seabird.com/)</span>) with no processing or corrections applied.</span>
<span id="cb34-197"><a href="#cb34-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-198"><a href="#cb34-198" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Final 1m-Binned\</span>
<span id="cb34-199"><a href="#cb34-199" aria-hidden="true" tabindex="-1"></a>        <span class="co">[</span><span class="ot">20-2105SH_CTD**FinalQC**.zip</span><span class="co">](https://calcofi.org/downloads/2021/20-2105SH_CTDFinalQC.zip)</span>\</span>
<span id="cb34-200"><a href="#cb34-200" aria-hidden="true" tabindex="-1"></a>        **Final 1m-Binned**: CTD data that have passed through the CalCOFI quality control process. After standard Seasoft-processing (Sea-Bird Scientific’s data-processing suite) tuned for our SBE 911plus CTD, the .asc files are processed by SIO-CalCOFI in-house software (BtlVsCTD). Averaged (4-sec or 1-meter bin-averaged) CTD sensor data are matched with corresponding bottle data, then **cruise-corrected**&nbsp;and&nbsp;**station-corrected**. Zipped file includes: metadata and .asc, .hdr, .btl, and upcast &amp; downcast .csvs (“u” and “d”; by station and concatenated).</span>
<span id="cb34-201"><a href="#cb34-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-202"><a href="#cb34-202" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>**Cruise-corrected CTD data**: CTD sensor data that are corrected using regression coefficients derived from 4-sec average sensor data vs bottle data comparisons for the entire&nbsp;cruise**,** meaning all casts with bottle samples (n=\~1400; fliers omitted; column labels ‘<span class="sc">\_</span>CruiseCorr’).</span>
<span id="cb34-203"><a href="#cb34-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-204"><a href="#cb34-204" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>**Station-corrected CTD data**: CTD sensor data that are corrected using regression coefficients generated dynamically for each cast, 1m bin-averaged sensor data vs bottle data (n=\~20; fliers omitted; column labels ‘<span class="sc">\_</span>StaCorr’).</span>
<span id="cb34-205"><a href="#cb34-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-206"><a href="#cb34-206" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>Since sensor behavior may vary from station to station, station-corrected CTD sensor data for salinity, oxygen, estimated nitrate, and estimated chlorophyll-a are considered the best, particularly for estimated nitrate.</span>
<span id="cb34-207"><a href="#cb34-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-208"><a href="#cb34-208" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>1992-Feb:</span>
<span id="cb34-209"><a href="#cb34-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-210"><a href="#cb34-210" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Prodo Cast\</span>
<span id="cb34-211"><a href="#cb34-211" aria-hidden="true" tabindex="-1"></a>        <span class="co">[</span><span class="ot">19-9202JD_CTD**CastProdoStas**.zip</span><span class="co">](https://calcofi.org/downloads/1992/19-9202JD_CTDCastProdoStas.zip)</span>\</span>
<span id="cb34-212"><a href="#cb34-212" aria-hidden="true" tabindex="-1"></a>        **Test Cast/Prodo Cast**: The Seabird 911plus CTD was first tested in Mar 1990 (9003JD) but is still under development. CTD data from Mar 1990 – 1991 were occasional system &amp; feasibility tests (“**test casts**“). As confidence in data quality improved, the CTD-Rosette began being used for daily primary productivity sample collection casts (“**prodo casts**“) in 1992 (6 depths from one station per day).</span>
<span id="cb34-213"><a href="#cb34-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-214"><a href="#cb34-214" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>1990-Mar:</span>
<span id="cb34-215"><a href="#cb34-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-216"><a href="#cb34-216" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Test Cast\</span>
<span id="cb34-217"><a href="#cb34-217" aria-hidden="true" tabindex="-1"></a>        <span class="co">[</span><span class="ot">19-9003JD_CTD**Test**.zip</span><span class="co">](https://calcofi.org/downloads/1990/19-9003JD_CTDTest.zip)</span></span>
<span id="cb34-218"><a href="#cb34-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-219"><a href="#cb34-219" aria-hidden="true" tabindex="-1"></a><span class="fu">## Find and Prioritize CTD Data Files</span></span>
<span id="cb34-220"><a href="#cb34-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-221"><a href="#cb34-221" aria-hidden="true" tabindex="-1"></a><span class="in">```{r find-files}</span></span>
<span id="cb34-222"><a href="#cb34-222" aria-hidden="true" tabindex="-1"></a><span class="co"># find all extracted CTD CSV files</span></span>
<span id="cb34-223"><a href="#cb34-223" aria-hidden="true" tabindex="-1"></a>all_files <span class="ot">&lt;-</span> <span class="fu">dir_ls</span>(dir_dl, <span class="at">recurse =</span> <span class="cn">TRUE</span>, <span class="at">regexp =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.csv$"</span>)</span>
<span id="cb34-224"><a href="#cb34-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-225"><a href="#cb34-225" aria-hidden="true" tabindex="-1"></a><span class="co"># create file inventory</span></span>
<span id="cb34-226"><a href="#cb34-226" aria-hidden="true" tabindex="-1"></a>file_inventory <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">path =</span> all_files) <span class="sc">|&gt;</span></span>
<span id="cb34-227"><a href="#cb34-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-228"><a href="#cb34-228" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename     =</span> <span class="fu">basename</span>(path),</span>
<span id="cb34-229"><a href="#cb34-229" aria-hidden="true" tabindex="-1"></a>    <span class="co"># parent_dir   = basename(dirname(path)),</span></span>
<span id="cb34-230"><a href="#cb34-230" aria-hidden="true" tabindex="-1"></a>    <span class="co"># classify data type from parent directory</span></span>
<span id="cb34-231"><a href="#cb34-231" aria-hidden="true" tabindex="-1"></a>    <span class="at">data_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb34-232"><a href="#cb34-232" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(path, <span class="st">"Final.*db_csv"</span>)  <span class="sc">~</span> <span class="st">"final"</span>,</span>
<span id="cb34-233"><a href="#cb34-233" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(path, <span class="st">"Prelim.*db_csv"</span>) <span class="sc">~</span> <span class="st">"preliminary"</span>,</span>
<span id="cb34-234"><a href="#cb34-234" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> <span class="cn">NA_character_</span>),</span>
<span id="cb34-235"><a href="#cb34-235" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract cruise identifier (yymm + ship code)</span></span>
<span id="cb34-236"><a href="#cb34-236" aria-hidden="true" tabindex="-1"></a>    <span class="at">cruise_id =</span> <span class="fu">str_extract</span>(path, <span class="st">"download/</span><span class="sc">\\</span><span class="st">d{2}-(</span><span class="sc">\\</span><span class="st">d{4}[A-Z]{2})"</span>, <span class="at">group =</span> <span class="dv">1</span>),</span>
<span id="cb34-237"><a href="#cb34-237" aria-hidden="true" tabindex="-1"></a>    <span class="co"># detect cast direction from filename (U=upcast, D=downcast)</span></span>
<span id="cb34-238"><a href="#cb34-238" aria-hidden="true" tabindex="-1"></a>    <span class="at">cast_dir =</span> <span class="fu">case_when</span>(</span>
<span id="cb34-239"><a href="#cb34-239" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(filename, <span class="fu">regex</span>(<span class="st">"U</span><span class="sc">\\</span><span class="st">.csv$"</span>, <span class="at">ignore_case =</span> T)) <span class="sc">~</span> <span class="st">"U"</span>,</span>
<span id="cb34-240"><a href="#cb34-240" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(filename, <span class="fu">regex</span>(<span class="st">"D</span><span class="sc">\\</span><span class="st">.csv$"</span>, <span class="at">ignore_case =</span> T)) <span class="sc">~</span> <span class="st">"D"</span>),</span>
<span id="cb34-241"><a href="#cb34-241" aria-hidden="true" tabindex="-1"></a>    <span class="co"># prioritize: final=1, preliminary=2</span></span>
<span id="cb34-242"><a href="#cb34-242" aria-hidden="true" tabindex="-1"></a>    <span class="at">priority =</span> <span class="fu">case_when</span>(</span>
<span id="cb34-243"><a href="#cb34-243" aria-hidden="true" tabindex="-1"></a>      data_type <span class="sc">==</span> <span class="st">"final"</span>        <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb34-244"><a href="#cb34-244" aria-hidden="true" tabindex="-1"></a>      data_type <span class="sc">==</span> <span class="st">"preliminary"</span>  <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb34-245"><a href="#cb34-245" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span>                        <span class="sc">~</span> <span class="dv">3</span>))</span>
<span id="cb34-246"><a href="#cb34-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-247"><a href="#cb34-247" aria-hidden="true" tabindex="-1"></a><span class="co"># keep only final and preliminary files</span></span>
<span id="cb34-248"><a href="#cb34-248" aria-hidden="true" tabindex="-1"></a>file_inventory <span class="ot">&lt;-</span> file_inventory <span class="sc">|&gt;</span></span>
<span id="cb34-249"><a href="#cb34-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(data_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"final"</span>, <span class="st">"preliminary"</span>))</span>
<span id="cb34-250"><a href="#cb34-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-251"><a href="#cb34-251" aria-hidden="true" tabindex="-1"></a><span class="co"># for each cruise, keep only final if available, otherwise preliminary</span></span>
<span id="cb34-252"><a href="#cb34-252" aria-hidden="true" tabindex="-1"></a>cruise_priority <span class="ot">&lt;-</span> file_inventory <span class="sc">|&gt;</span></span>
<span id="cb34-253"><a href="#cb34-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cruise_id) <span class="sc">|&gt;</span></span>
<span id="cb34-254"><a href="#cb34-254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">best_priority =</span> <span class="fu">min</span>(priority), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb34-255"><a href="#cb34-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-256"><a href="#cb34-256" aria-hidden="true" tabindex="-1"></a>files_to_ingest <span class="ot">&lt;-</span> file_inventory <span class="sc">|&gt;</span></span>
<span id="cb34-257"><a href="#cb34-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(cruise_priority, <span class="at">by =</span> <span class="st">"cruise_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-258"><a href="#cb34-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(priority <span class="sc">==</span> best_priority) <span class="sc">|&gt;</span></span>
<span id="cb34-259"><a href="#cb34-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>best_priority)</span>
<span id="cb34-260"><a href="#cb34-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-261"><a href="#cb34-261" aria-hidden="true" tabindex="-1"></a><span class="co"># check for any cruises without selected files</span></span>
<span id="cb34-262"><a href="#cb34-262" aria-hidden="true" tabindex="-1"></a>missing_cruises <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">unique</span>(file_inventory<span class="sc">$</span>cruise_id), <span class="fu">unique</span>(files_to_ingest<span class="sc">$</span>cruise_id))</span>
<span id="cb34-263"><a href="#cb34-263" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(missing_cruises) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb34-264"><a href="#cb34-264" aria-hidden="true" tabindex="-1"></a>  <span class="fu">warning</span>(<span class="fu">glue</span>(<span class="st">"Warning: Missing cruises with no final/preliminary files: {paste(missing_cruises, collapse = ', ')}"</span>))</span>
<span id="cb34-265"><a href="#cb34-265" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-266"><a href="#cb34-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-267"><a href="#cb34-267" aria-hidden="true" tabindex="-1"></a><span class="co"># summary</span></span>
<span id="cb34-268"><a href="#cb34-268" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(files_to_ingest, <span class="at">caption =</span> <span class="st">"Files to Ingest"</span>)</span>
<span id="cb34-269"><a href="#cb34-269" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-270"><a href="#cb34-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-271"><a href="#cb34-271" aria-hidden="true" tabindex="-1"></a><span class="fu">## Read and Standardize CTD Files</span></span>
<span id="cb34-272"><a href="#cb34-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-273"><a href="#cb34-273" aria-hidden="true" tabindex="-1"></a><span class="in">```{r read-files}</span></span>
<span id="cb34-274"><a href="#cb34-274" aria-hidden="true" tabindex="-1"></a><span class="co"># function to read and standardize CTD file</span></span>
<span id="cb34-275"><a href="#cb34-275" aria-hidden="true" tabindex="-1"></a>read_ctd_file <span class="ot">&lt;-</span> <span class="cf">function</span>(file_path, cruise_id, data_type, cast_dir) {</span>
<span id="cb34-276"><a href="#cb34-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb34-277"><a href="#cb34-277" aria-hidden="true" tabindex="-1"></a>    <span class="co"># read CSV file</span></span>
<span id="cb34-278"><a href="#cb34-278" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb34-279"><a href="#cb34-279" aria-hidden="true" tabindex="-1"></a>      file_path,</span>
<span id="cb34-280"><a href="#cb34-280" aria-hidden="true" tabindex="-1"></a>      <span class="at">guess_max      =</span> <span class="cn">Inf</span>,</span>
<span id="cb34-281"><a href="#cb34-281" aria-hidden="true" tabindex="-1"></a>      <span class="at">show_col_types =</span> F)</span>
<span id="cb34-282"><a href="#cb34-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-283"><a href="#cb34-283" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert column names to snake_case</span></span>
<span id="cb34-284"><a href="#cb34-284" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> <span class="fu">clean_names</span>()</span>
<span id="cb34-285"><a href="#cb34-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-286"><a href="#cb34-286" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add metadata columns and ensure event_num is character for consistency</span></span>
<span id="cb34-287"><a href="#cb34-287" aria-hidden="true" tabindex="-1"></a>    df <span class="sc">|&gt;</span></span>
<span id="cb34-288"><a href="#cb34-288" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb34-289"><a href="#cb34-289" aria-hidden="true" tabindex="-1"></a>        <span class="at">cruise_id   =</span> cruise_id,</span>
<span id="cb34-290"><a href="#cb34-290" aria-hidden="true" tabindex="-1"></a>        <span class="at">stage       =</span> <span class="fu">if_else</span>(data_type <span class="sc">==</span> <span class="st">"final"</span>, <span class="st">"F"</span>, <span class="st">"P"</span>),</span>
<span id="cb34-291"><a href="#cb34-291" aria-hidden="true" tabindex="-1"></a>        <span class="at">cast_dir    =</span> cast_dir,</span>
<span id="cb34-292"><a href="#cb34-292" aria-hidden="true" tabindex="-1"></a>        <span class="at">source_file =</span> <span class="fu">basename</span>(file_path))</span>
<span id="cb34-293"><a href="#cb34-293" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb34-294"><a href="#cb34-294" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Error reading {basename(file_path)}: {e$message}"</span>))</span>
<span id="cb34-295"><a href="#cb34-295" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb34-296"><a href="#cb34-296" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb34-297"><a href="#cb34-297" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-298"><a href="#cb34-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-299"><a href="#cb34-299" aria-hidden="true" tabindex="-1"></a><span class="co"># read and combine all files (both upcast and downcast)</span></span>
<span id="cb34-300"><a href="#cb34-300" aria-hidden="true" tabindex="-1"></a>ctd_data <span class="ot">&lt;-</span> files_to_ingest <span class="sc">|&gt;</span></span>
<span id="cb34-301"><a href="#cb34-301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pmap</span>(<span class="cf">function</span>(path, cruise_id, data_type, cast_dir, ...) {</span>
<span id="cb34-302"><a href="#cb34-302" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Reading: {basename(path)}"</span>))</span>
<span id="cb34-303"><a href="#cb34-303" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_ctd_file</span>(path, cruise_id, data_type, cast_dir)</span>
<span id="cb34-304"><a href="#cb34-304" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb34-305"><a href="#cb34-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-306"><a href="#cb34-306" aria-hidden="true" tabindex="-1"></a><span class="co"># add nrows per file to ctd_data</span></span>
<span id="cb34-307"><a href="#cb34-307" aria-hidden="true" tabindex="-1"></a>d_fread <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb34-308"><a href="#cb34-308" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="fu">basename</span>(<span class="fu">names</span>(ctd_data))) <span class="sc">|&gt;</span> </span>
<span id="cb34-309"><a href="#cb34-309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-310"><a href="#cb34-310" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrows =</span> <span class="fu">map_int</span>(ctd_data, <span class="sc">~</span> <span class="cf">if</span> (<span class="fu">is.null</span>(.x)) <span class="dv">0</span> <span class="cf">else</span> <span class="fu">nrow</span>(.x))) <span class="sc">%&gt;%</span></span>
<span id="cb34-311"><a href="#cb34-311" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(</span>
<span id="cb34-312"><a href="#cb34-312" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="st">"_TOTAL_"</span>,</span>
<span id="cb34-313"><a href="#cb34-313" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrows    =</span> <span class="fu">sum</span>(.<span class="sc">$</span>nrows) ) ) <span class="sc">|&gt;</span> </span>
<span id="cb34-314"><a href="#cb34-314" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(filename))</span>
<span id="cb34-315"><a href="#cb34-315" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-316"><a href="#cb34-316" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: fix duplicates</span></span>
<span id="cb34-317"><a href="#cb34-317" aria-hidden="true" tabindex="-1"></a><span class="co"># Reading: 20-0701JD_CTDBTL_001-084D.csv</span></span>
<span id="cb34-318"><a href="#cb34-318" aria-hidden="true" tabindex="-1"></a><span class="co"># Reading: 20-0701JD_CTDBTL_001-084IDnoQC.csv</span></span>
<span id="cb34-319"><a href="#cb34-319" aria-hidden="true" tabindex="-1"></a><span class="co"># Reading: 20-0701JD_CTDBTL_001-084IUnoQC.csv</span></span>
<span id="cb34-320"><a href="#cb34-320" aria-hidden="true" tabindex="-1"></a><span class="co"># Reading: 20-0701JD_CTDBTL_001-084U.csv</span></span>
<span id="cb34-321"><a href="#cb34-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-322"><a href="#cb34-322" aria-hidden="true" tabindex="-1"></a>d_fread <span class="sc">|&gt;</span> </span>
<span id="cb34-323"><a href="#cb34-323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(</span>
<span id="cb34-324"><a href="#cb34-324" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Number of rows read per file"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb34-325"><a href="#cb34-325" aria-hidden="true" tabindex="-1"></a>  <span class="co"># big marks for thousands</span></span>
<span id="cb34-326"><a href="#cb34-326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatCurrency</span>(<span class="st">"nrows"</span>, <span class="at">currency =</span> <span class="st">""</span>, <span class="at">digits =</span> <span class="dv">0</span>, <span class="at">mark =</span> <span class="st">","</span>)</span>
<span id="cb34-327"><a href="#cb34-327" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-328"><a href="#cb34-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-329"><a href="#cb34-329" aria-hidden="true" tabindex="-1"></a><span class="fu">## Transform Data</span></span>
<span id="cb34-330"><a href="#cb34-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-331"><a href="#cb34-331" aria-hidden="true" tabindex="-1"></a><span class="in">```{r transform-data}</span></span>
<span id="cb34-332"><a href="#cb34-332" aria-hidden="true" tabindex="-1"></a>ctd_bound <span class="ot">&lt;-</span> ctd_data <span class="sc">|&gt;</span></span>
<span id="cb34-333"><a href="#cb34-333" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert any mismatched types to character</span></span>
<span id="cb34-334"><a href="#cb34-334" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ! Can't combine `..1$event_num` &lt;double&gt;     and `..59$event_num` &lt;character&gt;.</span></span>
<span id="cb34-335"><a href="#cb34-335" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ! Can't combine `..1$ord_occ` &lt;character&gt;    and `..69$ord_occ` &lt;double&gt;.</span></span>
<span id="cb34-336"><a href="#cb34-336" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ! Can't combine `..1$ox_bu_m` &lt;double&gt;       and `..95$ox_bu_m` &lt;character&gt;.</span></span>
<span id="cb34-337"><a href="#cb34-337" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ! Can't combine `..1$line` &lt;character&gt;       and `..113$line` &lt;double&gt;.</span></span>
<span id="cb34-338"><a href="#cb34-338" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ! Can't combine `..1$sta` &lt;character&gt;        and `..113$sta` &lt;double&gt;.</span></span>
<span id="cb34-339"><a href="#cb34-339" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ! Can't combine `..1$salt_ave_corr` &lt;double&gt; and `..160$salt_ave_corr` &lt;character&gt;.</span></span>
<span id="cb34-340"><a href="#cb34-340" aria-hidden="true" tabindex="-1"></a>  <span class="co"># </span><span class="al">TODO</span><span class="co">: sort fixes for named files, eg event_num 59:</span></span>
<span id="cb34-341"><a href="#cb34-341" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   names(ctd_data)[59] # 20-0701JD_CTDFinalQC/db_csvs/20-0701JD_CTDBTL_001-084D.csv</span></span>
<span id="cb34-342"><a href="#cb34-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> .x <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(</span>
<span id="cb34-343"><a href="#cb34-343" aria-hidden="true" tabindex="-1"></a>    event_num, ord_occ, ox_bu_m, line, sta, salt_ave_corr, phaeo, salt1_corr, salt2_corr),</span>
<span id="cb34-344"><a href="#cb34-344" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">TODO</span><span class="co">: fix these columns to proper types, since probably supposed to be numeric</span></span>
<span id="cb34-345"><a href="#cb34-345" aria-hidden="true" tabindex="-1"></a>    as.character))) <span class="sc">|&gt;</span></span>
<span id="cb34-346"><a href="#cb34-346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list_rbind</span>() <span class="co">#</span></span>
<span id="cb34-347"><a href="#cb34-347" aria-hidden="true" tabindex="-1"></a><span class="co"># nrow(ctd_bound) # 4,448,219</span></span>
<span id="cb34-348"><a href="#cb34-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-349"><a href="#cb34-349" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: drop cruise_id or replace with study?</span></span>
<span id="cb34-350"><a href="#cb34-350" aria-hidden="true" tabindex="-1"></a><span class="co"># ctd_bound$study |&gt; table(useNA = "ifany")</span></span>
<span id="cb34-351"><a href="#cb34-351" aria-hidden="true" tabindex="-1"></a><span class="co"># ctd_bound$cruise_id |&gt; table(useNA = "ifany")</span></span>
<span id="cb34-352"><a href="#cb34-352" aria-hidden="true" tabindex="-1"></a><span class="co"># ctd_bound |&gt; </span></span>
<span id="cb34-353"><a href="#cb34-353" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(cruise_id)) |&gt;</span></span>
<span id="cb34-354"><a href="#cb34-354" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb34-355"><a href="#cb34-355" aria-hidden="true" tabindex="-1"></a><span class="co">#     is_study = cruise_id == study) |&gt; </span></span>
<span id="cb34-356"><a href="#cb34-356" aria-hidden="true" tabindex="-1"></a><span class="co">#   pull(is_study) |&gt; </span></span>
<span id="cb34-357"><a href="#cb34-357" aria-hidden="true" tabindex="-1"></a><span class="co">#   table(useNA = "ifany")</span></span>
<span id="cb34-358"><a href="#cb34-358" aria-hidden="true" tabindex="-1"></a><span class="co">#   FALSE    TRUE </span></span>
<span id="cb34-359"><a href="#cb34-359" aria-hidden="true" tabindex="-1"></a><span class="co">#   31426 4307011</span></span>
<span id="cb34-360"><a href="#cb34-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-361"><a href="#cb34-361" aria-hidden="true" tabindex="-1"></a><span class="co"># format date ----</span></span>
<span id="cb34-362"><a href="#cb34-362" aria-hidden="true" tabindex="-1"></a><span class="co"># apply formats depending on pattern</span></span>
<span id="cb34-363"><a href="#cb34-363" aria-hidden="true" tabindex="-1"></a>ctd_bound <span class="ot">&lt;-</span> ctd_bound <span class="sc">|&gt;</span> </span>
<span id="cb34-364"><a href="#cb34-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-365"><a href="#cb34-365" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_time_utc =</span> <span class="fu">trim</span>(date_time_utc),</span>
<span id="cb34-366"><a href="#cb34-366" aria-hidden="true" tabindex="-1"></a>    <span class="at">dtime_utc =</span> <span class="cn">NA</span>, <span class="co"># _POSIXct_,</span></span>
<span id="cb34-367"><a href="#cb34-367" aria-hidden="true" tabindex="-1"></a>    <span class="at">dtime_utc =</span> <span class="fu">if_else</span>(</span>
<span id="cb34-368"><a href="#cb34-368" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(date_time_utc, <span class="st">"^</span><span class="sc">\\</span><span class="st">d{2}-[A-Z][a-z]{2}-</span><span class="sc">\\</span><span class="st">d{4} </span><span class="sc">\\</span><span class="st">d{2}:</span><span class="sc">\\</span><span class="st">d{2}:</span><span class="sc">\\</span><span class="st">d{2}$"</span>), <span class="co"># eg "23-Jan-1998 17:50:44"</span></span>
<span id="cb34-369"><a href="#cb34-369" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dmy_hms</span>(date_time_utc, <span class="at">tz =</span> <span class="st">"UTC"</span>),</span>
<span id="cb34-370"><a href="#cb34-370" aria-hidden="true" tabindex="-1"></a>      dtime_utc),</span>
<span id="cb34-371"><a href="#cb34-371" aria-hidden="true" tabindex="-1"></a>    <span class="at">dtime_utc =</span> <span class="fu">if_else</span>(</span>
<span id="cb34-372"><a href="#cb34-372" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(date_time_utc, <span class="st">"^</span><span class="sc">\\</span><span class="st">d{2}/</span><span class="sc">\\</span><span class="st">d{2}/</span><span class="sc">\\</span><span class="st">d{4} </span><span class="sc">\\</span><span class="st">d{2}:</span><span class="sc">\\</span><span class="st">d{2}$"</span>),               <span class="co"># eg "01/16/2015 17:12"</span></span>
<span id="cb34-373"><a href="#cb34-373" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mdy_hm</span>(date_time_utc, <span class="at">tz=</span> <span class="st">"UTC"</span>),</span>
<span id="cb34-374"><a href="#cb34-374" aria-hidden="true" tabindex="-1"></a>      dtime_utc)) <span class="sc">|&gt;</span> </span>
<span id="cb34-375"><a href="#cb34-375" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(dtime_utc, <span class="at">.before =</span> date_time_utc) <span class="sc">|&gt;</span> </span>
<span id="cb34-376"><a href="#cb34-376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>date_time_utc, <span class="sc">-</span>date_time_pst) <span class="sc">|&gt;</span> </span>
<span id="cb34-377"><a href="#cb34-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(dtime_utc, depth)</span>
<span id="cb34-378"><a href="#cb34-378" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(ctd_bound<span class="sc">$</span>dtime_utc)))</span>
<span id="cb34-379"><a href="#cb34-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-380"><a href="#cb34-380" aria-hidden="true" tabindex="-1"></a><span class="co"># fill in missing lon,lat from line,sta ----</span></span>
<span id="cb34-381"><a href="#cb34-381" aria-hidden="true" tabindex="-1"></a>ctd_bound <span class="ot">&lt;-</span> ctd_bound <span class="sc">|&gt;</span></span>
<span id="cb34-382"><a href="#cb34-382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-383"><a href="#cb34-383" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon_dec =</span> <span class="fu">if_else</span>(</span>
<span id="cb34-384"><a href="#cb34-384" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(lon_dec) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(line) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(sta),</span>
<span id="cb34-385"><a href="#cb34-385" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(<span class="fu">sf_project</span>(</span>
<span id="cb34-386"><a href="#cb34-386" aria-hidden="true" tabindex="-1"></a>        <span class="at">from  =</span> <span class="st">"+proj=calcofi"</span>,</span>
<span id="cb34-387"><a href="#cb34-387" aria-hidden="true" tabindex="-1"></a>        <span class="at">to    =</span> <span class="st">"+proj=longlat +datum=WGS84"</span>,</span>
<span id="cb34-388"><a href="#cb34-388" aria-hidden="true" tabindex="-1"></a>        <span class="at">pts   =</span> <span class="fu">cbind</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(line), <span class="at">y =</span> <span class="fu">as.numeric</span>(sta)) )[,<span class="dv">1</span>]),</span>
<span id="cb34-389"><a href="#cb34-389" aria-hidden="true" tabindex="-1"></a>      lon_dec),</span>
<span id="cb34-390"><a href="#cb34-390" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat_dec =</span> <span class="fu">if_else</span>(</span>
<span id="cb34-391"><a href="#cb34-391" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(lat_dec) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(line) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(sta),</span>
<span id="cb34-392"><a href="#cb34-392" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(<span class="fu">sf_project</span>(</span>
<span id="cb34-393"><a href="#cb34-393" aria-hidden="true" tabindex="-1"></a>        <span class="at">from  =</span> <span class="st">"+proj=calcofi"</span>,</span>
<span id="cb34-394"><a href="#cb34-394" aria-hidden="true" tabindex="-1"></a>        <span class="at">to    =</span> <span class="st">"+proj=longlat +datum=WGS84"</span>,</span>
<span id="cb34-395"><a href="#cb34-395" aria-hidden="true" tabindex="-1"></a>        <span class="at">pts   =</span> <span class="fu">cbind</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(line), <span class="at">y =</span> <span class="fu">as.numeric</span>(sta)) )[,<span class="dv">2</span>]),</span>
<span id="cb34-396"><a href="#cb34-396" aria-hidden="true" tabindex="-1"></a>      lat_dec) )</span>
<span id="cb34-397"><a href="#cb34-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-398"><a href="#cb34-398" aria-hidden="true" tabindex="-1"></a><span class="co"># show first and last 100 rows</span></span>
<span id="cb34-399"><a href="#cb34-399" aria-hidden="true" tabindex="-1"></a>ctd_bound <span class="sc">|&gt;</span> </span>
<span id="cb34-400"><a href="#cb34-400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, (<span class="fu">n</span>()<span class="sc">-</span><span class="dv">9</span>)<span class="sc">:</span><span class="fu">n</span>())) <span class="sc">|&gt;</span></span>
<span id="cb34-401"><a href="#cb34-401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(<span class="at">caption =</span> <span class="fu">glue</span>(</span>
<span id="cb34-402"><a href="#cb34-402" aria-hidden="true" tabindex="-1"></a>    <span class="st">"First and last 10 rows of combined CTD data (nrows={format(nrow(ctd_bound), big.mark = ',')})"</span>))</span>
<span id="cb34-403"><a href="#cb34-403" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-404"><a href="#cb34-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-405"><a href="#cb34-405" aria-hidden="true" tabindex="-1"></a><span class="fu">## TODO: Check for duplicates</span></span>
<span id="cb34-406"><a href="#cb34-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-407"><a href="#cb34-407" aria-hidden="true" tabindex="-1"></a><span class="in">```{r check-dupes}</span></span>
<span id="cb34-408"><a href="#cb34-408" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: look for duplicates by dtime_utc, depth</span></span>
<span id="cb34-409"><a href="#cb34-409" aria-hidden="true" tabindex="-1"></a>d_dupes <span class="ot">&lt;-</span> ctd_bound <span class="sc">|&gt;</span> </span>
<span id="cb34-410"><a href="#cb34-410" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(dtime_utc, depth) <span class="sc">|&gt;</span></span>
<span id="cb34-411"><a href="#cb34-411" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-412"><a href="#cb34-412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-413"><a href="#cb34-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))  <span class="co">#  547,247 x 3</span></span>
<span id="cb34-414"><a href="#cb34-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-415"><a href="#cb34-415" aria-hidden="true" tabindex="-1"></a><span class="co"># get number of distinct dtime_utc, depth</span></span>
<span id="cb34-416"><a href="#cb34-416" aria-hidden="true" tabindex="-1"></a>n_distinct_dtime_depth <span class="ot">&lt;-</span> ctd_bound <span class="sc">|&gt;</span> </span>
<span id="cb34-417"><a href="#cb34-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dtime_utc, depth) <span class="sc">|&gt;</span></span>
<span id="cb34-418"><a href="#cb34-418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">n_distinct</span>()      <span class="co"># 3,900,792</span></span>
<span id="cb34-419"><a href="#cb34-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-420"><a href="#cb34-420" aria-hidden="true" tabindex="-1"></a>d_dupes <span class="sc">|&gt;</span> </span>
<span id="cb34-421"><a href="#cb34-421" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, (<span class="fu">n</span>()<span class="sc">-</span><span class="dv">9</span>)<span class="sc">:</span><span class="fu">n</span>())) <span class="sc">|&gt;</span></span>
<span id="cb34-422"><a href="#cb34-422" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(<span class="at">caption =</span> <span class="fu">glue</span>(</span>
<span id="cb34-423"><a href="#cb34-423" aria-hidden="true" tabindex="-1"></a>    <span class="st">"First and last 10 rows of duplicates by dtime_utc, depth (nrows = {format(nrow(d_dupes), big.mark = ',')}; n_distinct_dtime_depth = {format(n_distinct_dtime_depth, big.mark = ',')})"</span>))</span>
<span id="cb34-424"><a href="#cb34-424" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-425"><a href="#cb34-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-426"><a href="#cb34-426" aria-hidden="true" tabindex="-1"></a><span class="fu">## Ingest into DuckDB</span></span>
<span id="cb34-427"><a href="#cb34-427" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ingest-duckdb}</span></span>
<span id="cb34-428"><a href="#cb34-428" aria-hidden="true" tabindex="-1"></a><span class="co"># write to DuckDB</span></span>
<span id="cb34-429"><a href="#cb34-429" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(con, <span class="st">"ctd"</span>, ctd_bound, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-430"><a href="#cb34-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-431"><a href="#cb34-431" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Ingested {nrow(ctd_bound)} rows into DuckDB table 'ctd'"</span>))</span>
<span id="cb34-432"><a href="#cb34-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-433"><a href="#cb34-433" aria-hidden="true" tabindex="-1"></a><span class="co"># write point_geom as geometry column</span></span>
<span id="cb34-434"><a href="#cb34-434" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">glue</span>(<span class="st">"Adding spatially indexed column point_geom from lon_dec and lat_dec..."</span>))</span>
<span id="cb34-435"><a href="#cb34-435" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con, <span class="st">"ALTER TABLE ctd ADD COLUMN point_geom GEOMETRY;"</span>)</span>
<span id="cb34-436"><a href="#cb34-436" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con, <span class="st">"UPDATE ctd SET point_geom = ST_Point(lon_dec, lat_dec);"</span>)</span>
<span id="cb34-437"><a href="#cb34-437" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con, <span class="st">"CREATE INDEX idx_ctd_point_geom ON ctd USING RTREE(point_geom);"</span>)</span>
<span id="cb34-438"><a href="#cb34-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-439"><a href="#cb34-439" aria-hidden="true" tabindex="-1"></a><span class="co"># show summary statistics</span></span>
<span id="cb34-440"><a href="#cb34-440" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl</span>(con, <span class="st">"ctd"</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-441"><a href="#cb34-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(stage, cast_dir) <span class="sc">|&gt;</span></span>
<span id="cb34-442"><a href="#cb34-442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span>
<span id="cb34-443"><a href="#cb34-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-444"><a href="#cb34-444" aria-hidden="true" tabindex="-1"></a><span class="co"># disconnect</span></span>
<span id="cb34-445"><a href="#cb34-445" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con, <span class="at">shutdown =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-446"><a href="#cb34-446" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-447"><a href="#cb34-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-448"><a href="#cb34-448" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary</span></span>
<span id="cb34-449"><a href="#cb34-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-450"><a href="#cb34-450" aria-hidden="true" tabindex="-1"></a><span class="in">```{r summary}</span></span>
<span id="cb34-451"><a href="#cb34-451" aria-hidden="true" tabindex="-1"></a><span class="co"># reconnect to show final table structure</span></span>
<span id="cb34-452"><a href="#cb34-452" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(duckdb<span class="sc">::</span><span class="fu">duckdb</span>(), <span class="at">dbdir =</span> db_path, <span class="at">read_only =</span> T)</span>
<span id="cb34-453"><a href="#cb34-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-454"><a href="#cb34-454" aria-hidden="true" tabindex="-1"></a><span class="co"># table info</span></span>
<span id="cb34-455"><a href="#cb34-455" aria-hidden="true" tabindex="-1"></a><span class="fu">dbListTables</span>(con)</span>
<span id="cb34-456"><a href="#cb34-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-457"><a href="#cb34-457" aria-hidden="true" tabindex="-1"></a><span class="co"># show column names</span></span>
<span id="cb34-458"><a href="#cb34-458" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl</span>(con, <span class="st">"ctd"</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-459"><a href="#cb34-459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-460"><a href="#cb34-460" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>() <span class="sc">|&gt;</span></span>
<span id="cb34-461"><a href="#cb34-461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>()</span>
<span id="cb34-462"><a href="#cb34-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-463"><a href="#cb34-463" aria-hidden="true" tabindex="-1"></a><span class="co"># summary by stage and cast direction</span></span>
<span id="cb34-464"><a href="#cb34-464" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl</span>(con, <span class="st">"ctd"</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-465"><a href="#cb34-465" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(stage, cast_dir) <span class="sc">|&gt;</span></span>
<span id="cb34-466"><a href="#cb34-466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span>
<span id="cb34-467"><a href="#cb34-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-468"><a href="#cb34-468" aria-hidden="true" tabindex="-1"></a><span class="co"># preview data</span></span>
<span id="cb34-469"><a href="#cb34-469" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl</span>(con, <span class="st">"ctd"</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-470"><a href="#cb34-470" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cruise_id, stage, cast_dir, lat_dec, lon_dec) <span class="sc">|&gt;</span></span>
<span id="cb34-471"><a href="#cb34-471" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">20</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-472"><a href="#cb34-472" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span>
<span id="cb34-473"><a href="#cb34-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-474"><a href="#cb34-474" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con, <span class="at">shutdown =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-475"><a href="#cb34-475" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-476"><a href="#cb34-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-477"><a href="#cb34-477" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interactive Gantt Chart</span></span>
<span id="cb34-478"><a href="#cb34-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-479"><a href="#cb34-479" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gantt-chart}</span></span>
<span id="cb34-480"><a href="#cb34-480" aria-hidden="true" tabindex="-1"></a>librarian<span class="sc">::</span><span class="fu">shelf</span>(plotly, <span class="at">quiet =</span> T)</span>
<span id="cb34-481"><a href="#cb34-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-482"><a href="#cb34-482" aria-hidden="true" tabindex="-1"></a><span class="co"># reconnect to database</span></span>
<span id="cb34-483"><a href="#cb34-483" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(duckdb<span class="sc">::</span><span class="fu">duckdb</span>(), <span class="at">dbdir =</span> db_path, <span class="at">read_only =</span> T)</span>
<span id="cb34-484"><a href="#cb34-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-485"><a href="#cb34-485" aria-hidden="true" tabindex="-1"></a><span class="co"># tbl(con, "ctd") |&gt; </span></span>
<span id="cb34-486"><a href="#cb34-486" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(n = n())</span></span>
<span id="cb34-487"><a href="#cb34-487" aria-hidden="true" tabindex="-1"></a><span class="co"># 210,507</span></span>
<span id="cb34-488"><a href="#cb34-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-489"><a href="#cb34-489" aria-hidden="true" tabindex="-1"></a><span class="co"># tbl(con, "ctd") |&gt; </span></span>
<span id="cb34-490"><a href="#cb34-490" aria-hidden="true" tabindex="-1"></a><span class="co">#   distinct(study) |&gt; </span></span>
<span id="cb34-491"><a href="#cb34-491" aria-hidden="true" tabindex="-1"></a><span class="co">#   pull(study) |&gt; </span></span>
<span id="cb34-492"><a href="#cb34-492" aria-hidden="true" tabindex="-1"></a><span class="co">#   sort()</span></span>
<span id="cb34-493"><a href="#cb34-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-494"><a href="#cb34-494" aria-hidden="true" tabindex="-1"></a><span class="co"># tbl(con, "ctd") |&gt; </span></span>
<span id="cb34-495"><a href="#cb34-495" aria-hidden="true" tabindex="-1"></a><span class="co">#   pull(study) |&gt;</span></span>
<span id="cb34-496"><a href="#cb34-496" aria-hidden="true" tabindex="-1"></a><span class="co">#   table(useNA = "ifany")</span></span>
<span id="cb34-497"><a href="#cb34-497" aria-hidden="true" tabindex="-1"></a><span class="co">#  9802JD   9804JD </span></span>
<span id="cb34-498"><a href="#cb34-498" aria-hidden="true" tabindex="-1"></a><span class="co">#  59,005  151,502</span></span>
<span id="cb34-499"><a href="#cb34-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-500"><a href="#cb34-500" aria-hidden="true" tabindex="-1"></a><span class="co"># get cruise date spans by study and stage</span></span>
<span id="cb34-501"><a href="#cb34-501" aria-hidden="true" tabindex="-1"></a>cruise_spans <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"ctd"</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-502"><a href="#cb34-502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(study, stage) <span class="sc">|&gt;</span></span>
<span id="cb34-503"><a href="#cb34-503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb34-504"><a href="#cb34-504" aria-hidden="true" tabindex="-1"></a>    <span class="at">begin_date =</span> <span class="fu">min</span>(dtime_utc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb34-505"><a href="#cb34-505" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_date   =</span> <span class="fu">max</span>(dtime_utc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb34-506"><a href="#cb34-506" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups    =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-507"><a href="#cb34-507" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>() <span class="sc">|&gt;</span></span>
<span id="cb34-508"><a href="#cb34-508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(begin_date), <span class="sc">!</span><span class="fu">is.na</span>(end_date)) <span class="sc">|&gt;</span></span>
<span id="cb34-509"><a href="#cb34-509" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-510"><a href="#cb34-510" aria-hidden="true" tabindex="-1"></a>    <span class="at">year        =</span> <span class="fu">year</span>(begin_date),</span>
<span id="cb34-511"><a href="#cb34-511" aria-hidden="true" tabindex="-1"></a>    <span class="at">begin_jday  =</span> <span class="fu">yday</span>(begin_date),</span>
<span id="cb34-512"><a href="#cb34-512" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_jday    =</span> <span class="fu">yday</span>(end_date),</span>
<span id="cb34-513"><a href="#cb34-513" aria-hidden="true" tabindex="-1"></a>    <span class="at">stage_label =</span> <span class="fu">if_else</span>(stage <span class="sc">==</span> <span class="st">"F"</span>, <span class="st">"Final"</span>, <span class="st">"Preliminary"</span>),</span>
<span id="cb34-514"><a href="#cb34-514" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create hover text</span></span>
<span id="cb34-515"><a href="#cb34-515" aria-hidden="true" tabindex="-1"></a>    <span class="at">hover_text =</span> <span class="fu">glue</span>(</span>
<span id="cb34-516"><a href="#cb34-516" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Cruise: {study}&lt;br&gt;"</span>,</span>
<span id="cb34-517"><a href="#cb34-517" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Stage: {stage_label}&lt;br&gt;"</span>,</span>
<span id="cb34-518"><a href="#cb34-518" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Begin: {format(begin_date, '%Y-%m-%d')}&lt;br&gt;"</span>,</span>
<span id="cb34-519"><a href="#cb34-519" aria-hidden="true" tabindex="-1"></a>      <span class="st">"End: {format(end_date, '%Y-%m-%d')}&lt;br&gt;"</span>,</span>
<span id="cb34-520"><a href="#cb34-520" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Duration: {as.numeric(difftime(end_date, begin_date, units = 'days'))} days"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb34-521"><a href="#cb34-521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(begin_date)</span>
<span id="cb34-522"><a href="#cb34-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-523"><a href="#cb34-523" aria-hidden="true" tabindex="-1"></a><span class="co"># create color mapping</span></span>
<span id="cb34-524"><a href="#cb34-524" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Final"</span> <span class="ot">=</span> <span class="st">"#23d355ff"</span>, <span class="st">"Preliminary"</span> <span class="ot">=</span> <span class="st">"#A23B72"</span>)</span>
<span id="cb34-525"><a href="#cb34-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-526"><a href="#cb34-526" aria-hidden="true" tabindex="-1"></a><span class="co"># create interactive gantt chart</span></span>
<span id="cb34-527"><a href="#cb34-527" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>()</span>
<span id="cb34-528"><a href="#cb34-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-529"><a href="#cb34-529" aria-hidden="true" tabindex="-1"></a><span class="co"># add traces for each cruise</span></span>
<span id="cb34-530"><a href="#cb34-530" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(cruise_spans)) {</span>
<span id="cb34-531"><a href="#cb34-531" aria-hidden="true" tabindex="-1"></a>  row <span class="ot">&lt;-</span> cruise_spans[i, ]</span>
<span id="cb34-532"><a href="#cb34-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-533"><a href="#cb34-533" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p <span class="sc">|&gt;</span></span>
<span id="cb34-534"><a href="#cb34-534" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_trace</span>(</span>
<span id="cb34-535"><a href="#cb34-535" aria-hidden="true" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">"scatter"</span>,</span>
<span id="cb34-536"><a href="#cb34-536" aria-hidden="true" tabindex="-1"></a>      <span class="at">mode =</span> <span class="st">"lines"</span>,</span>
<span id="cb34-537"><a href="#cb34-537" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">c</span>(row<span class="sc">$</span>begin_jday, row<span class="sc">$</span>end_jday),</span>
<span id="cb34-538"><a href="#cb34-538" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">c</span>(row<span class="sc">$</span>year, row<span class="sc">$</span>year),</span>
<span id="cb34-539"><a href="#cb34-539" aria-hidden="true" tabindex="-1"></a>      <span class="at">line =</span> <span class="fu">list</span>(</span>
<span id="cb34-540"><a href="#cb34-540" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> colors[row<span class="sc">$</span>stage_label],</span>
<span id="cb34-541"><a href="#cb34-541" aria-hidden="true" tabindex="-1"></a>        <span class="at">width =</span> <span class="dv">8</span>),</span>
<span id="cb34-542"><a href="#cb34-542" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> row<span class="sc">$</span>hover_text,</span>
<span id="cb34-543"><a href="#cb34-543" aria-hidden="true" tabindex="-1"></a>      <span class="at">hoverinfo =</span> <span class="st">"text"</span>,</span>
<span id="cb34-544"><a href="#cb34-544" aria-hidden="true" tabindex="-1"></a>      <span class="at">showlegend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb34-545"><a href="#cb34-545" aria-hidden="true" tabindex="-1"></a>      <span class="at">legendgroup =</span> row<span class="sc">$</span>stage_label)</span>
<span id="cb34-546"><a href="#cb34-546" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-547"><a href="#cb34-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-548"><a href="#cb34-548" aria-hidden="true" tabindex="-1"></a><span class="co"># add legend traces</span></span>
<span id="cb34-549"><a href="#cb34-549" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">|&gt;</span></span>
<span id="cb34-550"><a href="#cb34-550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(</span>
<span id="cb34-551"><a href="#cb34-551" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"scatter"</span>,</span>
<span id="cb34-552"><a href="#cb34-552" aria-hidden="true" tabindex="-1"></a>    <span class="at">mode =</span> <span class="st">"lines"</span>,</span>
<span id="cb34-553"><a href="#cb34-553" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb34-554"><a href="#cb34-554" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb34-555"><a href="#cb34-555" aria-hidden="true" tabindex="-1"></a>    <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> colors[<span class="st">"Final"</span>], <span class="at">width =</span> <span class="dv">8</span>),</span>
<span id="cb34-556"><a href="#cb34-556" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Final"</span>,</span>
<span id="cb34-557"><a href="#cb34-557" aria-hidden="true" tabindex="-1"></a>    <span class="at">showlegend =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-558"><a href="#cb34-558" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(</span>
<span id="cb34-559"><a href="#cb34-559" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"scatter"</span>,</span>
<span id="cb34-560"><a href="#cb34-560" aria-hidden="true" tabindex="-1"></a>    <span class="at">mode =</span> <span class="st">"lines"</span>,</span>
<span id="cb34-561"><a href="#cb34-561" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb34-562"><a href="#cb34-562" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb34-563"><a href="#cb34-563" aria-hidden="true" tabindex="-1"></a>    <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> colors[<span class="st">"Preliminary"</span>], <span class="at">width =</span> <span class="dv">8</span>),</span>
<span id="cb34-564"><a href="#cb34-564" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Preliminary"</span>,</span>
<span id="cb34-565"><a href="#cb34-565" aria-hidden="true" tabindex="-1"></a>    <span class="at">showlegend =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-566"><a href="#cb34-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-567"><a href="#cb34-567" aria-hidden="true" tabindex="-1"></a><span class="co"># customize layout</span></span>
<span id="cb34-568"><a href="#cb34-568" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">|&gt;</span></span>
<span id="cb34-569"><a href="#cb34-569" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb34-570"><a href="#cb34-570" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"CalCOFI CTD Cruise Timeline"</span>,</span>
<span id="cb34-571"><a href="#cb34-571" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(</span>
<span id="cb34-572"><a href="#cb34-572" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Day of Year"</span>,</span>
<span id="cb34-573"><a href="#cb34-573" aria-hidden="true" tabindex="-1"></a>      <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">365</span>),</span>
<span id="cb34-574"><a href="#cb34-574" aria-hidden="true" tabindex="-1"></a>      <span class="at">dtick =</span> <span class="dv">30</span>,</span>
<span id="cb34-575"><a href="#cb34-575" aria-hidden="true" tabindex="-1"></a>      <span class="at">tickangle =</span> <span class="dv">0</span>),</span>
<span id="cb34-576"><a href="#cb34-576" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(</span>
<span id="cb34-577"><a href="#cb34-577" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Year"</span>,</span>
<span id="cb34-578"><a href="#cb34-578" aria-hidden="true" tabindex="-1"></a>      <span class="at">autorange =</span> <span class="st">"reversed"</span>,</span>
<span id="cb34-579"><a href="#cb34-579" aria-hidden="true" tabindex="-1"></a>      <span class="at">dtick =</span> <span class="dv">1</span>),</span>
<span id="cb34-580"><a href="#cb34-580" aria-hidden="true" tabindex="-1"></a>    <span class="at">hovermode =</span> <span class="st">"closest"</span>,</span>
<span id="cb34-581"><a href="#cb34-581" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot_bgcolor =</span> <span class="st">"#f8f9fa"</span>,</span>
<span id="cb34-582"><a href="#cb34-582" aria-hidden="true" tabindex="-1"></a>    <span class="at">paper_bgcolor =</span> <span class="st">"white"</span>,</span>
<span id="cb34-583"><a href="#cb34-583" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend =</span> <span class="fu">list</span>(</span>
<span id="cb34-584"><a href="#cb34-584" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fl">1.02</span>,</span>
<span id="cb34-585"><a href="#cb34-585" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="dv">1</span>,</span>
<span id="cb34-586"><a href="#cb34-586" aria-hidden="true" tabindex="-1"></a>      <span class="at">xanchor =</span> <span class="st">"left"</span>,</span>
<span id="cb34-587"><a href="#cb34-587" aria-hidden="true" tabindex="-1"></a>      <span class="at">yanchor =</span> <span class="st">"top"</span>))</span>
<span id="cb34-588"><a href="#cb34-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-589"><a href="#cb34-589" aria-hidden="true" tabindex="-1"></a><span class="co"># display chart</span></span>
<span id="cb34-590"><a href="#cb34-590" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb34-591"><a href="#cb34-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-592"><a href="#cb34-592" aria-hidden="true" tabindex="-1"></a><span class="co"># disconnect</span></span>
<span id="cb34-593"><a href="#cb34-593" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con, <span class="at">shutdown =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-594"><a href="#cb34-594" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>