<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ingest_coastwatch.pfeg.noaa.gov-erdCalCOFIlrvsiz</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="ingest_coastwatch.pfeg.noaa.gov-erdCalCOFIlrvsiz_files/libs/clipboard/clipboard.min.js"></script>
<script src="ingest_coastwatch.pfeg.noaa.gov-erdCalCOFIlrvsiz_files/libs/quarto-html/quarto.js"></script>
<script src="ingest_coastwatch.pfeg.noaa.gov-erdCalCOFIlrvsiz_files/libs/quarto-html/popper.min.js"></script>
<script src="ingest_coastwatch.pfeg.noaa.gov-erdCalCOFIlrvsiz_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ingest_coastwatch.pfeg.noaa.gov-erdCalCOFIlrvsiz_files/libs/quarto-html/anchor.min.js"></script>
<link href="ingest_coastwatch.pfeg.noaa.gov-erdCalCOFIlrvsiz_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ingest_coastwatch.pfeg.noaa.gov-erdCalCOFIlrvsiz_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ingest_coastwatch.pfeg.noaa.gov-erdCalCOFIlrvsiz_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ingest_coastwatch.pfeg.noaa.gov-erdCalCOFIlrvsiz_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ingest_coastwatch.pfeg.noaa.gov-erdCalCOFIlrvsiz_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="ingest_coastwatch.pfeg.noaa.gov-erdCalCOFIlrvsiz_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="ingest_coastwatch.pfeg.noaa.gov-erdCalCOFIlrvsiz_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="ingest_coastwatch.pfeg.noaa.gov-erdCalCOFIlrvsiz_files/libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="ingest_coastwatch.pfeg.noaa.gov-erdCalCOFIlrvsiz_files/libs/datatables-binding-0.33/datatables.js"></script>
<script src="ingest_coastwatch.pfeg.noaa.gov-erdCalCOFIlrvsiz_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="ingest_coastwatch.pfeg.noaa.gov-erdCalCOFIlrvsiz_files/libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="ingest_coastwatch.pfeg.noaa.gov-erdCalCOFIlrvsiz_files/libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="ingest_coastwatch.pfeg.noaa.gov-erdCalCOFIlrvsiz_files/libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="ingest_coastwatch.pfeg.noaa.gov-erdCalCOFIlrvsiz_files/libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="ingest_coastwatch.pfeg.noaa.gov-erdCalCOFIlrvsiz_files/libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#calcofi-noaa-fish-larvae-sizes-on-erddap" id="toc-calcofi-noaa-fish-larvae-sizes-on-erddap" class="nav-link active" data-scroll-target="#calcofi-noaa-fish-larvae-sizes-on-erddap"><span class="header-section-number">1</span> CalCOFI NOAA Fish Larvae Sizes on ERDDAP</a>
  <ul class="collapse">
  <li><a href="#read-and-write-the-tabledap-dataset" id="toc-read-and-write-the-tabledap-dataset" class="nav-link" data-scroll-target="#read-and-write-the-tabledap-dataset"><span class="header-section-number">1.1</span> Read and write the tabledap dataset</a></li>
  <li><a href="#todo-extract-metadata-from-the-dataset" id="toc-todo-extract-metadata-from-the-dataset" class="nav-link" data-scroll-target="#todo-extract-metadata-from-the-dataset"><span class="header-section-number">1.2</span> TODO: Extract metadata from the dataset</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">ingest_coastwatch.pfeg.noaa.gov-erdCalCOFIlrvsiz</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="calcofi-noaa-fish-larvae-sizes-on-erddap" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> CalCOFI NOAA Fish Larvae Sizes on ERDDAP</h1>
<section id="read-and-write-the-tabledap-dataset" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="read-and-write-the-tabledap-dataset"><span class="header-section-number">1.1</span> Read and write the tabledap dataset</h2>
<p><strong>Goal</strong>: Read in the NOAA CalCOFI Fish Larvae Sizes dataset from ERDDAP and write to Google Drive <code>calcofi/data/{dataset}</code>.</p>
<ul>
<li><a href="https://coastwatch.pfeg.noaa.gov/erddap/tabledap/erdCalCOFIlrvsiz.html">erdCalCOFIlrvsiz.html</a></li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>librarian<span class="sc">::</span><span class="fu">shelf</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  DT, glue, here, readr, rerddap, stringr, tibble)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># variables</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>dir_data     <span class="ot">&lt;-</span> <span class="st">"/Users/bbest/Library/CloudStorage/GoogleDrive-ben@ecoquants.com/My Drive/projects/calcofi/data"</span> </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: change data to {provider}/{dataset}</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>dir_provider <span class="ot">&lt;-</span> <span class="st">"coastwatch.pfeg.noaa.gov"</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>ds_url       <span class="ot">&lt;-</span> <span class="st">"https://coastwatch.pfeg.noaa.gov/erddap/tabledap/erdCalCOFIlrvsiz.html"</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># extract ERDDAP url and dataset ID from the dataset URL</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>ed_pattern  <span class="ot">&lt;-</span> <span class="st">"(https://.*)/tabledap/([A-Za-z0-9]+)</span><span class="sc">\\</span><span class="st">.html"</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>ed_url      <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(ds_url, ed_pattern, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>) <span class="co"># "erdCalCOFIlrvsiz"</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>ed_id       <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(ds_url, ed_pattern, <span class="st">"</span><span class="sc">\\</span><span class="st">2"</span>) <span class="co"># "https://coastwatch.pfeg.noaa.gov/erddap"</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>dir_dataset <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"{dir_data}/{dir_provider}"</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>d_csv       <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"{dir_dataset}/{ed_id}.csv"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(dir_dataset))</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(dir_dataset)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>ed_info <span class="ot">&lt;-</span> <span class="fu">info</span>(ed_id, <span class="at">url =</span> ed_url)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>ed_info</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;ERDDAP info&gt; erdCalCOFIlrvsiz 
 Base URL: https://coastwatch.pfeg.noaa.gov/erddap 
 Dataset Type: tabledap 
 Variables:  
     calcofi_species_code: 
         Range: 19, 946 
     common_name: 
     cruise: 
     itis_tsn: 
         Range: 161729, 636877 
     larvae_100m3: 
         Range: 0.001925557, 1525.219 
         Units: Larvae 100/M^3 
     larvae_10m2: 
         Range: 0.1, 68225.23 
         Units: Larvae 10/M^2 
     larvae_count: 
         Range: 1, 7368 
     larvae_size: 
         Range: 1.0, 932.0 
         Units: millimeters 
     latitude: 
         Range: 5.948333, 51.05 
         Units: degrees_north 
     line: 
         Range: -11.1, 306.2 
     longitude: 
         Range: -139.0, -78.49333 
         Units: degrees_east 
     net_location: 
     order_occupied: 
         Range: 1, 999 
     proportion_sorted: 
         Range: 0.06, 1.0 
     scientific_name: 
     ship: 
     ship_code: 
     standard_haul_factor: 
         Range: 0.01, 835.58 
     station: 
         Range: -269.1, 274.6 
     time: 
         Range: -5.988252E8, 1.67463186E9 
         Units: seconds since 1970-01-01T00:00:00Z 
     tow_number: 
         Range: 1, 48 
     tow_type: 
     volume_sampled: 
         Range: 0.3, 51933.0 
         Units: meters^3 </code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(d_csv)){</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> <span class="fu">tabledap</span>(ed_info)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(d, d_csv)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(d_csv)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 242645     23</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d) <span class="sc">|&gt;</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-edbe6652ce51e1d1b257" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-edbe6652ce51e1d1b257">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6"],[195101,195101,195101,195101,195101,195101],["SCOFIELD","SCOFIELD","SCOFIELD","SCOFIELD","SCOFIELD","SCOFIELD"],["47","47","47","47","47","47"],[1,1,1,1,1,1],["C1","C1","C1","C1","C1","C1"],[1,1,1,1,1,1],["S","S","S","S","S","S"],["1951-01-19T07:25:00Z","1951-01-19T07:25:00Z","1951-01-19T07:25:00Z","1951-01-19T07:25:00Z","1951-01-19T07:25:00Z","1951-01-19T07:25:00Z"],[33.833332,33.833332,33.833332,33.833332,33.833332,33.833332],[-118.625,-118.625,-118.625,-118.625,-118.625,-118.625],[86.7,86.7,86.7,86.7,86.7,86.7],[35,35,35,35,35,35],[1.65,1.65,1.65,1.65,1.65,1.65],[892.6,892.6,892.6,892.6,892.6,892.6],[1,1,1,1,1,1],["Engraulis mordax","Engraulis mordax","Engraulis mordax","Engraulis mordax","Engraulis mordax","Engraulis mordax"],["Northern anchovy","Northern anchovy","Northern anchovy","Northern anchovy","Northern anchovy","Northern anchovy"],[161828,161828,161828,161828,161828,161828],[31,31,31,31,31,31],[3.8,4.8,5.8,6.8,7.8,8.800000000000001],[6,17,33,25,13,9],[9.9,28.05,54.45,41.25,21.45,14.85],[null,null,null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>cruise<\/th>\n      <th>ship<\/th>\n      <th>ship_code<\/th>\n      <th>order_occupied<\/th>\n      <th>tow_type<\/th>\n      <th>tow_number<\/th>\n      <th>net_location<\/th>\n      <th>time<\/th>\n      <th>latitude<\/th>\n      <th>longitude<\/th>\n      <th>line<\/th>\n      <th>station<\/th>\n      <th>standard_haul_factor<\/th>\n      <th>volume_sampled<\/th>\n      <th>proportion_sorted<\/th>\n      <th>scientific_name<\/th>\n      <th>common_name<\/th>\n      <th>itis_tsn<\/th>\n      <th>calcofi_species_code<\/th>\n      <th>larvae_size<\/th>\n      <th>larvae_count<\/th>\n      <th>larvae_10m2<\/th>\n      <th>larvae_100m3<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,4,6,9,10,11,12,13,14,15,18,19,20,21,22,23]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"cruise","targets":1},{"name":"ship","targets":2},{"name":"ship_code","targets":3},{"name":"order_occupied","targets":4},{"name":"tow_type","targets":5},{"name":"tow_number","targets":6},{"name":"net_location","targets":7},{"name":"time","targets":8},{"name":"latitude","targets":9},{"name":"longitude","targets":10},{"name":"line","targets":11},{"name":"station","targets":12},{"name":"standard_haul_factor","targets":13},{"name":"volume_sampled","targets":14},{"name":"proportion_sorted","targets":15},{"name":"scientific_name","targets":16},{"name":"common_name","targets":17},{"name":"itis_tsn","targets":18},{"name":"calcofi_species_code","targets":19},{"name":"larvae_size","targets":20},{"name":"larvae_count","targets":21},{"name":"larvae_10m2","targets":22},{"name":"larvae_100m3","targets":23}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="todo-extract-metadata-from-the-dataset" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="todo-extract-metadata-from-the-dataset"><span class="header-section-number">1.2</span> TODO: Extract metadata from the dataset</h2>
<ul>
<li><a href="https://coastwatch.pfeg.noaa.gov/erddap/info/erdCalCOFIlrvsiz/index.html">ERDDAP - Information about CalCOFI NOAA Fish Larvae Sizes, from NOAA SWFSC</a></li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ed_info<span class="sc">$</span>alldata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$NC_GLOBAL
    row_type variable_name           attribute_name data_type
1  attribute     NC_GLOBAL            cdm_data_type    String
2  attribute     NC_GLOBAL              Conventions    String
3  attribute     NC_GLOBAL        defaultGraphQuery    String
4  attribute     NC_GLOBAL      Easternmost_Easting    double
5  attribute     NC_GLOBAL       geospatial_lat_max    double
6  attribute     NC_GLOBAL       geospatial_lat_min    double
7  attribute     NC_GLOBAL     geospatial_lat_units    String
8  attribute     NC_GLOBAL       geospatial_lon_max    double
9  attribute     NC_GLOBAL       geospatial_lon_min    double
10 attribute     NC_GLOBAL     geospatial_lon_units    String
11 attribute     NC_GLOBAL                  infoUrl    String
12 attribute     NC_GLOBAL              institution    String
13 attribute     NC_GLOBAL                  license    String
14 attribute     NC_GLOBAL    Northernmost_Northing    double
15 attribute     NC_GLOBAL          publisher_email    String
16 attribute     NC_GLOBAL           publisher_name    String
17 attribute     NC_GLOBAL                sourceUrl    String
18 attribute     NC_GLOBAL    Southernmost_Northing    double
19 attribute     NC_GLOBAL standard_name_vocabulary    String
20 attribute     NC_GLOBAL          subsetVariables    String
21 attribute     NC_GLOBAL                  summary    String
22 attribute     NC_GLOBAL        time_coverage_end    String
23 attribute     NC_GLOBAL      time_coverage_start    String
24 attribute     NC_GLOBAL                    title    String
25 attribute     NC_GLOBAL      Westernmost_Easting    double
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        value
1                                                                                                                                                                                                                                                                                                                                                                                                                                                                       Other
2                                                                                                                                                                                                                                                                                                                                                                                                                                         COARDS, CF-1.6, ACDD-1.3, NCCSV-1.2
3                                                                                                                                                                                                                                                                                                                                                                                                                              longitude,latitude,larvae_size&amp;cruise="202301"
4                                                                                                                                                                                                                                                                                                                                                                                                                                                                   -78.49333
5                                                                                                                                                                                                                                                                                                                                                                                                                                                                       51.05
6                                                                                                                                                                                                                                                                                                                                                                                                                                                                    5.948333
7                                                                                                                                                                                                                                                                                                                                                                                                                                                               degrees_north
8                                                                                                                                                                                                                                                                                                                                                                                                                                                                   -78.49333
9                                                                                                                                                                                                                                                                                                                                                                                                                                                                      -139.0
10                                                                                                                                                                                                                                                                                                                                                                                                                                                               degrees_east
11                                                                                                                                                                                                                                                                                                                                                                                                                  https://oceanview.pfeg.noaa.gov/CalCOFI/calcofi_info.html
12                                                                                                                                                                                                                                                                                                                                                                                                                                                                 NOAA SWFSC
13 The data may be used and redistributed for free but is not intended\nfor legal use, since it may contain inaccuracies. Neither the data\nContributor, ERD, NOAA, nor the United States Government, nor any\nof their employees or contractors, makes any warranty, express or\nimplied, including warranties of merchantability and fitness for a\nparticular purpose, or assumes any legal liability for the accuracy,\ncompleteness, or usefulness, of this information.
14                                                                                                                                                                                                                                                                                                                                                                                                                                                                      51.05
15                                                                                                                                                                                                                                                                                                                                                                                                                                                          ed.weber@noaa.gov
16                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Ed Weber
17                                                                                                                                                                                                                                                                                                                                                                                                                                                              (local files)
18                                                                                                                                                                                                                                                                                                                                                                                                                                                                   5.948333
19                                                                                                                                                                                                                                                                                                                                                                                                                                                                      CF-12
20                                                                                                                                                                                                                                                                                                                                                                 cruise, station, line, tow_type,net_location, tow_number, calcofi_species_code,common_name,scientific_name
21                                                                                                                                                                                                                                                                                          Size data for selected larval fish captured in CalCOFI icthyoplankton nets (Generally Northern Anchovy, Pacific Sardine, Jack Mackerel, Pacific Mackerel, and Hake are measured).
22                                                                                                                                                                                                                                                                                                                                                                                                                                                       2023-01-25T07:31:00Z
23                                                                                                                                                                                                                                                                                                                                                                                                                                                       1951-01-10T03:40:00Z
24                                                                                                                                                                                                                                                                                                                                                                                                                                             CalCOFI NOAA Fish Larvae Sizes
25                                                                                                                                                                                                                                                                                                                                                                                                                                                                     -139.0

$cruise
   row_type variable_name attribute_name data_type
1  variable        cruise                   String
2 attribute        cruise    description    String
3 attribute        cruise  ioos_category    String
4 attribute        cruise      long_name    String
                           value
1                               
2 Six-digit cruise code (YYYYMM)
3                     Identifier
4                         Cruise

$ship
   row_type variable_name attribute_name data_type      value
1  variable          ship                   String           
2 attribute          ship    description    String  Ship name
3 attribute          ship  ioos_category    String Identifier
4 attribute          ship      long_name    String  Ship Name

$ship_code
   row_type variable_name attribute_name data_type                       value
1  variable     ship_code                   String                            
2 attribute     ship_code    description    String Two-digit CalCOFI ship code
3 attribute     ship_code  ioos_category    String                  Identifier
4 attribute     ship_code      long_name    String                   Ship Code

$order_occupied
   row_type  variable_name attribute_name data_type
1  variable order_occupied                      int
2 attribute order_occupied   actual_range       int
3 attribute order_occupied    description    String
4 attribute order_occupied  ioos_category    String
5 attribute order_occupied      long_name    String
                                                                    value
1                                                                        
2                                                                  1, 999
3 Ordinal number in which the station was sampled for the cruise and ship
4                                                              Identifier
5                                                          Order Occupied

$tow_type
   row_type variable_name attribute_name data_type
1  variable      tow_type                   String
2 attribute      tow_type    description    String
3 attribute      tow_type  ioos_category    String
4 attribute      tow_type      long_name    String
                                            value
1                                                
2 Net gear type. See the CalCOFI Tow Types table.
3                                      Identifier
4                                        Tow Type

$tow_number
   row_type variable_name attribute_name data_type
1  variable    tow_number                      int
2 attribute    tow_number   actual_range       int
3 attribute    tow_number    description    String
4 attribute    tow_number  ioos_category    String
5 attribute    tow_number      long_name    String
                                                         value
1                                                             
2                                                        1, 48
3 Replicate tow number for the station, net type, and location
4                                                   Identifier
5                                                   Tow Number

$net_location
   row_type variable_name attribute_name data_type
1  variable  net_location                   String
2 attribute  net_location    description    String
3 attribute  net_location  ioos_category    String
4 attribute  net_location      long_name    String
                                                                             value
1                                                                                 
2 Port or Starboard location of net for paired tow types (e.g., bongo or pairovet)
3                                                                       Identifier
4                                                              Net Location (side)

$time
    row_type variable_name      attribute_name data_type
1   variable          time                        double
2  attribute          time _CoordinateAxisType    String
3  attribute          time        actual_range    double
4  attribute          time                axis    String
5  attribute          time         description    String
6  attribute          time       ioos_category    String
7  attribute          time           long_name    String
8  attribute          time       standard_name    String
9  attribute          time         time_origin    String
10 attribute          time               units    String
                                       value
1                                           
2                                       Time
3                  -5.988252E8, 1.67463186E9
4                                          T
5  Tow start time (yyyy-MM-dd'T'HH:mm:ss'Z')
6                                       Time
7                                       Time
8                                       time
9                       01-JAN-1970 00:00:00
10        seconds since 1970-01-01T00:00:00Z

$latitude
   row_type variable_name      attribute_name data_type               value
1  variable      latitude                         float                    
2 attribute      latitude _CoordinateAxisType    String                 Lat
3 attribute      latitude        actual_range     float     5.948333, 51.05
4 attribute      latitude                axis    String                   Y
5 attribute      latitude         description    String Latitude of Station
6 attribute      latitude       ioos_category    String            Location
7 attribute      latitude           long_name    String            Latitude
8 attribute      latitude       standard_name    String            latitude
9 attribute      latitude               units    String       degrees_north

$longitude
   row_type variable_name      attribute_name data_type                value
1  variable     longitude                         float                     
2 attribute     longitude _CoordinateAxisType    String                  Lon
3 attribute     longitude        actual_range     float    -139.0, -78.49333
4 attribute     longitude                axis    String                    X
5 attribute     longitude         description    String Longitude of Station
6 attribute     longitude       ioos_category    String             Location
7 attribute     longitude           long_name    String            Longitude
8 attribute     longitude       standard_name    String            longitude
9 attribute     longitude               units    String         degrees_east

$line
   row_type variable_name attribute_name data_type                value
1  variable          line                    float                     
2 attribute          line   actual_range     float         -11.1, 306.2
3 attribute          line    description    String Nominal CalCOFI Line
4 attribute          line  ioos_category    String             Location
5 attribute          line      long_name    String         CalCOFI Line

$station
   row_type variable_name attribute_name data_type                   value
1  variable       station                    float                        
2 attribute       station   actual_range     float           -269.1, 274.6
3 attribute       station    description    String Nominal CalCOFI Station
4 attribute       station  ioos_category    String                Location
5 attribute       station      long_name    String         CalCOFI Station

$standard_haul_factor
   row_type        variable_name attribute_name data_type
1  variable standard_haul_factor                    float
2 attribute standard_haul_factor   actual_range     float
3 attribute standard_haul_factor    description    String
4 attribute standard_haul_factor  ioos_category    String
5 attribute standard_haul_factor      long_name    String
                                                                                                                                                            value
1                                                                                                                                                                
2                                                                                                                                                    0.01, 835.58
3 Number used to standardize tows to catch per 10 meters squared of sea surface. See Kramer and Smith and Richardson references on the infosheet url for details.
4                                                                                                                                                           Other
5                                                                                                                                            Standard Haul Factor

$volume_sampled
   row_type  variable_name attribute_name data_type
1  variable volume_sampled                    float
2 attribute volume_sampled   actual_range     float
3 attribute volume_sampled    description    String
4 attribute volume_sampled  ioos_category    String
5 attribute volume_sampled      long_name    String
6 attribute volume_sampled          units    String
                               value
1                                   
2                       0.3, 51933.0
3 Volume of water sampled by the net
4                              Other
5                     Volume Sampled
6                           meters^3

$proportion_sorted
   row_type     variable_name attribute_name data_type
1  variable proportion_sorted                    float
2 attribute proportion_sorted   actual_range     float
3 attribute proportion_sorted    description    String
4 attribute proportion_sorted  ioos_category    String
5 attribute proportion_sorted      long_name    String
                                                           value
1                                                               
2                                                      0.06, 1.0
3 Proportion of the net sample that was sorted in the laboratory
4                                                          Other
5                                              Proportion Sorted

$scientific_name
   row_type   variable_name attribute_name data_type                   value
1  variable scientific_name                   String                        
2 attribute scientific_name    description    String Species scientific name
3 attribute scientific_name  ioos_category    String            Fish Species
4 attribute scientific_name      long_name    String         Scientific Name

$common_name
   row_type variable_name attribute_name data_type               value
1  variable   common_name                   String                    
2 attribute   common_name    description    String Species common name
3 attribute   common_name  ioos_category    String        Fish Species
4 attribute   common_name      long_name    String         Common Name

$itis_tsn
   row_type variable_name attribute_name data_type
1  variable      itis_tsn                      int
2 attribute      itis_tsn   actual_range       int
3 attribute      itis_tsn    description    String
4 attribute      itis_tsn  ioos_category    String
5 attribute      itis_tsn      long_name    String
                                                                                  value
1                                                                                      
2                                                                        161729, 636877
3 Integrated taxonomic information system taxonomic serial number. http://www.itis.gov/
4                                                                          Fish Species
5                                                                              ITIS TSN

$calcofi_species_code
   row_type        variable_name attribute_name data_type                value
1  variable calcofi_species_code                      int                     
2 attribute calcofi_species_code   actual_range       int              19, 946
3 attribute calcofi_species_code  ioos_category    String         Fish Species
4 attribute calcofi_species_code      long_name    String Calcofi Species Code

$larvae_size
   row_type variable_name attribute_name data_type                      value
1  variable   larvae_size                    float                           
2 attribute   larvae_size   actual_range     float                 1.0, 932.0
3 attribute   larvae_size    description    String Total length of the larvae
4 attribute   larvae_size  ioos_category    String                    Biology
5 attribute   larvae_size      long_name    String                Larvae Size
6 attribute   larvae_size          units    String                millimeters

$larvae_count
   row_type variable_name attribute_name data_type               value
1  variable  larvae_count                      int                    
2 attribute  larvae_count   actual_range       int             1, 7368
3 attribute  larvae_count    description    String Raw count of larvae
4 attribute  larvae_count  ioos_category    String      Fish Abundance
5 attribute  larvae_count      long_name    String        Larvae Count

$larvae_10m2
   row_type variable_name attribute_name data_type
1  variable   larvae_10m2                    float
2 attribute   larvae_10m2   actual_range     float
3 attribute   larvae_10m2    description    String
4 attribute   larvae_10m2  ioos_category    String
5 attribute   larvae_10m2      long_name    String
6 attribute   larvae_10m2          units    String
                                                                      value
1                                                                          
2                                                             0.1, 68225.23
3 larvae per 10 meters squared of water sampled (oblique and vertical tows)
4                                                            Fish Abundance
5                                                             Larvae 10/M^2
6                                                             Larvae 10/M^2

$larvae_100m3
   row_type variable_name attribute_name data_type
1  variable  larvae_100m3                    float
2 attribute  larvae_100m3   actual_range     float
3 attribute  larvae_100m3    description    String
4 attribute  larvae_100m3  ioos_category    String
5 attribute  larvae_100m3      long_name    String
6 attribute  larvae_100m3          units    String
                                                                  value
1                                                                      
2                                                 0.001925557, 1525.219
3 larvae per 100 cubic meters of water sampled (Manta and mocness tows)
4                                                        Fish Abundance
5                                                        Larvae 100/M^3
6                                                        Larvae 100/M^3</code></pre>
</div>
</div>
<!-- -->

</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb8" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "ingest_coastwatch.pfeg.noaa.gov-erdCalCOFIlrvsiz"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu"># CalCOFI NOAA Fish Larvae Sizes on ERDDAP</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="fu">## Read and write the tabledap dataset</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>**Goal**: Read in the NOAA CalCOFI Fish Larvae Sizes dataset from ERDDAP and write to Google Drive <span class="in">`calcofi/data/{dataset}`</span>.</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">erdCalCOFIlrvsiz.html</span><span class="co">](https://coastwatch.pfeg.noaa.gov/erddap/tabledap/erdCalCOFIlrvsiz.html)</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>librarian<span class="sc">::</span><span class="fu">shelf</span>(</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  DT, glue, here, readr, rerddap, stringr, tibble)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co"># variables</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>dir_data     <span class="ot">&lt;-</span> <span class="st">"/Users/bbest/Library/CloudStorage/GoogleDrive-ben@ecoquants.com/My Drive/projects/calcofi/data"</span> </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: change data to {provider}/{dataset}</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>dir_provider <span class="ot">&lt;-</span> <span class="st">"coastwatch.pfeg.noaa.gov"</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>ds_url       <span class="ot">&lt;-</span> <span class="st">"https://coastwatch.pfeg.noaa.gov/erddap/tabledap/erdCalCOFIlrvsiz.html"</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="co"># extract ERDDAP url and dataset ID from the dataset URL</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>ed_pattern  <span class="ot">&lt;-</span> <span class="st">"(https://.*)/tabledap/([A-Za-z0-9]+)</span><span class="sc">\\</span><span class="st">.html"</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>ed_url      <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(ds_url, ed_pattern, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>) <span class="co"># "erdCalCOFIlrvsiz"</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>ed_id       <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(ds_url, ed_pattern, <span class="st">"</span><span class="sc">\\</span><span class="st">2"</span>) <span class="co"># "https://coastwatch.pfeg.noaa.gov/erddap"</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>dir_dataset <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"{dir_data}/{dir_provider}"</span>)</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>d_csv       <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"{dir_dataset}/{ed_id}.csv"</span>)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(dir_dataset))</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(dir_dataset)</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>ed_info <span class="ot">&lt;-</span> <span class="fu">info</span>(ed_id, <span class="at">url =</span> ed_url)</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>ed_info</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(d_csv)){</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> <span class="fu">tabledap</span>(ed_info)</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(d, d_csv)</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(d_csv)</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(d)</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d) <span class="sc">|&gt;</span> </span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>()</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a><span class="fu">## TODO: Extract metadata from the dataset</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">ERDDAP - Information about CalCOFI NOAA Fish Larvae Sizes, from NOAA SWFSC</span><span class="co">](https://coastwatch.pfeg.noaa.gov/erddap/info/erdCalCOFIlrvsiz/index.html)</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>ed_info<span class="sc">$</span>alldata</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>